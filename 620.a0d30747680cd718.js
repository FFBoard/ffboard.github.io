(self.webpackChunkboard=self.webpackChunkboard||[]).push([[620],{9969:(Y,Q,t)=>{"use strict";t.d(Q,{R:()=>v});class v{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(x=>x in this).forEach(x=>this[x]=e[x]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(x=>x in this).forEach(x=>this[x]=e[x].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},2020:(Y,Q,t)=>{"use strict";t.d(Q,{y:()=>_});var v=t(5861);var C=t(4650);let _=(()=>{class g{constructor(){this.autoRotateSupported=function e(){return new Promise(g=>{const U=new Image;U.onload=()=>{g(1===U.width&&2===U.height)},U.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(i,O){return new Promise((h,A)=>{const S=new FileReader;S.onload=R=>{this.loadImage(R.target.result,i.type,O).then(h).catch(A)},S.readAsDataURL(i)})}loadImage(i,O,h){return this.isValidImageType(O)?this.loadBase64Image(i,h):Promise.reject(new Error("Invalid image type"))}isValidImageType(i){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(i)}loadImageFromURL(i,O){return new Promise((h,A)=>{const S=new Image;S.onerror=()=>A,S.onload=()=>{const R=document.createElement("canvas"),E=R.getContext("2d");R.width=S.width,R.height=S.height,E?.drawImage(S,0,0),this.loadBase64Image(R.toDataURL(),O).then(h)},S.crossOrigin="anonymous",S.src=i})}loadBase64Image(i,O){return new Promise((h,A)=>{const S=new Image;S.onload=()=>h({originalImage:S,originalBase64:i}),S.onerror=A,S.src=i}).then(h=>this.transformImageBase64(h,O))}transformImageBase64(i,O){var h=this;return(0,v.Z)(function*(){const A=yield h.autoRotateSupported,S=yield function x(g){switch("string"==typeof g&&(g=function F(g){const U=new DataView(function f(g){g=g.replace(/^data\:([^\;]+)\;base64,/gim,"");const U=atob(g),i=U.length,O=new Uint8Array(i);for(let h=0;h<i;h++)O[h]=U.charCodeAt(h);return O.buffer}(g));if(65496!==U.getUint16(0,!1))return-2;const i=U.byteLength;let O=2;for(;O<i;){if(U.getUint16(O+2,!1)<=8)return-1;const h=U.getUint16(O,!1);if(O+=2,65505==h){if(1165519206!==U.getUint32(O+=2,!1))return-1;const A=18761==U.getUint16(O+=6,!1);O+=U.getUint32(O+4,A);const S=U.getUint16(O,A);O+=2;for(let R=0;R<S;R++)if(274==U.getUint16(O+12*R,A))return U.getUint16(O+12*R+8,A)}else{if(65280!=(65280&h))break;O+=U.getUint16(O,!1)}}return-1}(g)),g){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(A?-1:i.originalBase64);return i.originalImage&&i.originalImage.complete?h.transformLoadedImage({original:{base64:i.originalBase64,image:i.originalImage,size:{width:i.originalImage.naturalWidth,height:i.originalImage.naturalHeight}},exifTransform:S},O):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(i,O){var h=this;return(0,v.Z)(function*(){const A=O.canvasRotation+i.exifTransform.rotate,S={width:i.original.image.naturalWidth,height:i.original.image.naturalHeight};if(0===A&&!i.exifTransform.flip&&!O.containWithinAspectRatio)return{original:{base64:i.original.base64,image:i.original.image,size:{...S}},transformed:{base64:i.original.base64,image:i.original.image,size:{...S}},exifTransform:i.exifTransform};const R=h.getTransformedSize(S,i.exifTransform,O),E=document.createElement("canvas");E.width=R.width,E.height=R.height;const M=E.getContext("2d");M?.setTransform(i.exifTransform.flip?-1:1,0,0,1,E.width/2,E.height/2),M?.rotate(Math.PI*(A/2)),M?.drawImage(i.original.image,-S.width/2,-S.height/2);const s=E.toDataURL(),u=yield h.loadImageFromBase64(s);return{original:{base64:i.original.base64,image:i.original.image,size:{...S}},transformed:{base64:s,image:u,size:{width:u.width,height:u.height}},exifTransform:i.exifTransform}})()}loadImageFromBase64(i){return new Promise((O,h)=>{const A=new Image;A.onload=()=>O(A),A.onerror=h,A.src=i})}getTransformedSize(i,O,h){const A=h.canvasRotation+O.rotate;if(h.containWithinAspectRatio){if(A%2){const R=i.height/h.aspectRatio;return{width:Math.max(i.height,i.width*h.aspectRatio),height:Math.max(i.width,R)}}{const R=i.width/h.aspectRatio;return{width:Math.max(i.width,i.height*h.aspectRatio),height:Math.max(i.height,R)}}}return A%2?{height:i.width,width:i.height}:{width:i.width,height:i.height}}}return g.\u0275fac=function(i){return new(i||g)},g.\u0275prov=C.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},8896:(Y,Q,t)=>{"use strict";function v(D){const e=D.split(","),x=e[0].replace("data:","").replace(";base64",""),F=atob(e[1]),f=new ArrayBuffer(F.length),C=new Uint8Array(f);for(let _=0;_<F.length;_+=1)C[_]=F.charCodeAt(_);return new Blob([f],{type:x})}t.d(Q,{L:()=>v})},1891:(Y,Q,t)=>{"use strict";t.d(Q,{B:()=>K});var v=t(5861),D=t(1309),e=t(4650),x=t(4968),F=t(3905),f=t(3848),C=t(1460),_=t(4323),g=t(6986),U=t(575),i=t(7693),O=t(7320),h=t(146),A=t(3612),S=t(6378),R=t(6895),E=t(433),M=t(4029),s=t(8279),u=t(3450),I=t(8212);const W=["fileInput"];function l(p,w){1&p&&(e.O4$(),e.TgZ(0,"svg",23),e._UZ(1,"path",24)(2,"path",25),e.qZA())}const m=function(){return["text-primary"]};function L(p,w){1&p&&e._UZ(0,"app-logo",26),2&p&&e.Q6J("svgClass",e.DdM(2,m))("responsive",!1)}function y(p,w){1&p&&(e.TgZ(0,"span"),e._uU(1,"Trascina i file da caricare oppure c"),e.qZA())}function Z(p,w){1&p&&(e.TgZ(0,"span"),e._uU(1,"C"),e.qZA())}function G(p,w){if(1&p&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2,"I file verranno caricati nella cartella "),e.qZA(),e._UZ(3,"em",27),e.ALo(4,"arrayJoin"),e.BQk()),2&p){const a=e.oxw(2);e.xp6(3),e.Q6J("innerText",a.currentFolderPath.length?e.xi3(4,1,a.currentFolderPath,"/"):"root")}}function $(p,w){if(1&p&&(e._UZ(0,"div",32),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&p){const a=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,a.currentFolderPath,0,-1),"/"))}}function X(p,w){if(1&p&&(e.TgZ(0,"div",28)(1,"div",29),e._uU(2,"Cartella:"),e.qZA(),e.YNc(3,$,3,8,"div",30),e._UZ(4,"div",31),e.ALo(5,"arrayJoin"),e.ALo(6,"slice"),e.qZA()),2&p){const a=e.oxw(2);e.xp6(3),e.Q6J("ngIf",a.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(a.currentFolderPath.length>1?"/":"")+(a.currentFolderPath.length?e.xi3(5,2,e.xi3(6,5,a.currentFolderPath,a.currentFolderPath.length-1),"/"):"root"))}}const q=function(){return{bottom:0,left:0}};function ae(p,w){if(1&p){const a=e.EpF();e.ynx(0),e.TgZ(1,"a",33),e.NdJ("click",function(){e.CHM(a);const n=e.oxw(2);return e.KtG(n.openInfoModal.emit())}),e._uU(2,"Informazioni"),e.qZA(),e.TgZ(3,"div",34),e.NdJ("click",function(){e.CHM(a),e.oxw(2);const n=e.MAs(7);return e.KtG(n.open())}),e._uU(4,"settings"),e.qZA(),e.BQk()}2&p&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(1,q)))}const b=function(p,w,a){return{"cursor-pointer":p,"p-4":w,"p-2 pb-3":a}},r=function(p,w){return{"fw-bold fs-lg":p,small:w}},o=function(p,w,a){return{"my-2":p,"mb-2":w,"mw-100":a}};function c(p,w){if(1&p){const a=e.EpF();e.ynx(0),e.TgZ(1,"div",15,16),e.NdJ("dragenter",function(){e.CHM(a);const n=e.MAs(2),j=e.oxw();return e.KtG(j.setDragOverEvent(n))})("drop",function(n){e.CHM(a);const j=e.oxw();return e.KtG(j.handleDropEvent(n))})("click",function(){e.CHM(a),e.oxw();const n=e.MAs(2);return e.KtG(n.click())}),e.YNc(3,l,3,0,"svg",17),e.YNc(4,L,1,3,"ng-template",null,18,e.W1O),e.TgZ(6,"div",19),e.YNc(7,y,2,0,"span",20),e.YNc(8,Z,2,0,"span",20),e.TgZ(9,"span"),e._uU(10,"licca per scegliere da memoria"),e.qZA()(),e.TgZ(11,"div",21),e.YNc(12,G,5,4,"ng-container",3),e.YNc(13,X,7,8,"ng-template",null,22,e.W1O),e.qZA()(),e.YNc(15,ae,5,2,"ng-container",20),e.BQk()}if(2&p){const a=e.MAs(5),d=e.MAs(14),n=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(10,b,!n.loading,!n.isWidget,n.isWidget)),e.xp6(2),e.Q6J("ngIf",!n.isWidget)("ngIfElse",a),e.xp6(3),e.Q6J("ngClass",e.WLB(14,r,!n.isWidget,n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.touchDevice),e.xp6(1),e.Q6J("ngIf",n.touchDevice),e.xp6(3),e.Q6J("ngClass",e.kEZ(17,o,!n.isWidget&&!n.touchDevice,!n.isWidget&&n.touchDevice,n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.isWidget)("ngIfElse",d),e.xp6(3),e.Q6J("ngIf",!n.isWidget)}}const B=function(p,w){return{"p-4":p,"p-2":w}};function T(p,w){if(1&p&&(e.TgZ(0,"div",35),e.O4$(),e.TgZ(1,"svg",36),e._UZ(2,"path",37),e.qZA(),e.kcU(),e._UZ(3,"app-loader",38),e.TgZ(4,"div",39),e._uU(5,"Attendi il completamento dell'upload per caricare altre immagini."),e.qZA()()),2&p){const a=e.oxw();e.Q6J("ngClass",e.WLB(3,B,!a.isWidget,a.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",a.loadingMessage)}}const H=function(p,w){return{uploading:p,"widget flex-grow-1":w}};let K=(()=>{class p{constructor(a,d,n,j,P,J,z){this.postMessageService=a,this.uploadService=d,this.uploadObservablesService=n,this.uploaderService=j,this.toastService=P,this.renderer=J,this.ngZone=z,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="Controllo dei file in corso",this.touchDevice=C.eX,this.dragOverEvent=!1,this.options=this.uploaderService.uploaderOptions;const te=this.uploadService.preferences.uploader;te.checkImage.active||(this.options.compress=!1),te.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){this.handleClipboardPasteEvent(),this.handleExternalUpload()}handleClipboardPasteEvent(){var a=this;this.clipboardPasteEventSubscription=(0,x.R)(document.body,"paste").subscribe(function(){var d=(0,v.Z)(function*(n){if(!a.canUpload)return;const j=Array.from((n.clipboardData||n.originalEvent.clipboardData).items);let P=[];for(const J of j)if(0===J.type.indexOf("image")){const z=J.getAsFile();z&&P.push(z)}P.length>0?yield a.preUpload(P):a.reset()});return function(n){return d.apply(this,arguments)}}())}handleExternalUpload(){var a=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var d=(0,v.Z)(function*(n){if(n){if(!a.canUpload)return;yield a.preUpload([n.file],n.options)}else a.fileInputRef.nativeElement.click()});return function(n){return d.apply(this,arguments)}}())}handleSelectionEvent(a){var d=this;return(0,v.Z)(function*(){if(!d.canUpload)return;const n=a.target;if(n.files&&n.files.length){const j=Array.from(n.files);return n.value="",d.preUpload(j)}d.reset()})()}handleDropEvent(a){var d=this;return(0,v.Z)(function*(){if(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),!d.canUpload)return;const n=a.dataTransfer?.files?Array.from(a.dataTransfer.files):[];if(n.length)return d.preUpload(n);d.reset()})()}saveOptions(a=!0){this.uploaderService.uploaderOptions=this.options,a&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(a){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(a,"dragover",d=>{d.preventDefault()})}))}get canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage="Controllo dei file da caricare",this.postMessageService.send(_.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(a,d){var n=this;return(0,v.Z)(function*(){const j=[...n.currentFolderPath];let P=[],J=[],z=[],te=[];d?d.allowOverwrite=d.allowOverwrite||!1:(d=n.uploaderService.uploaderOptions).allowOverwrite=!1;for(let k=0;k<a.length;k++){let V=d.compress?yield n.uploaderService.compressFileIfNeeded(a[k],d.imageDimensions):a[k];if(V=yield n.uploaderService.orientFileIfNeeded(V),V){const ne=(0,f.Tb)(V.name),ie=g.O8.find(N=>-1!==N.ext.indexOf(ne.ext));if(!ie){z.push(V);continue}if(V.size>ie.maxSize){te.push(V);continue}P.push({file:{name:V.name,size:V.size,time:0,url:"",ext:ne.ext,filename:ne.filename,isImage:(0,f.Or)(ne.ext),embedUrl:"",type:U.VC.FILE},progress:0,completed:!1}),J.push(V)}}if((z.length||te.length)&&(n.toastService.show({content:n.createToastMessage(z,te),level:D.m.ERROR}),[["UNSUPPORTED",z],["OVERSIZED",te]].forEach(k=>{k[1].forEach(V=>{n.postMessageService.send(_.l.UPLOAD_ERROR,{filename:V.name,error:k[0]})})})),0===J.length)return void n.reset();const oe=`Caricamento file {{fileNumber}} di ${J.length} in corso`;n.uploadObservablesService.pushUploadingFileQueue(P);for(let k=0;k<J.length;++k){n.loadingMessage="Creazione del pacchetto da inviare";const V=yield n.uploadService.getHostToken(j,J[k].name);P[k].progress+=20,n.loadingMessage=oe.replace("{{fileNumber}}",`${k+1}`),yield(0,F.z)(n.uploaderService.upload(J[k],P[k],V,d.allowOverwrite))}n.uploadObservablesService.pushUploadingFileQueue([]);const re=P.filter(k=>!k.error).map(k=>k.file);re.length>0&&(n.fileUploadedEvent.emit({list:re,rewrite:d.allowOverwrite,destPath:j}),n.postMessageService.send(_.l.UPLOAD_SUCCESS,{fileList:re.map(k=>({filename:k.name,isImage:k.isImage,url:k.url}))}),d.openLinkModalAfterUpload&&n.uploadObservablesService.pushAction({name:U.In.FILE_SHOW_LINKS,payload:{entities:(0,f.jL)(re)}})),n.reset()})()}createToastMessage(a,d){let n=[];return a.length&&n.push(a.length>1?`I file <strong>${a.map(j=>j.name).join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${a[0].name}</strong> ha un formato non supportato!`),d.length&&n.push(d.length>1?`I file <strong>${d.map(j=>j.name).join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${d[0].name}</strong> \xe8 troppo pesante!`),n.join("<br><br>")}ngOnDestroy(){this.startExternalUploadSubscription?.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return p.\u0275fac=function(a){return new(a||p)(e.Y36(i.F),e.Y36(O.C),e.Y36(h.r),e.Y36(A.q),e.Y36(S.k),e.Y36(e.Qsj),e.Y36(e.R0b))},p.\u0275cmp=e.Xpm({type:p,selectors:[["app-uploader"]],viewQuery:function(a,d){if(1&a&&e.Gf(W,5),2&a){let n;e.iGM(n=e.CRH())&&(d.fileInputRef=n.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:30,vars:10,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],["title","Opzioni di caricamento"],["optionsModal",""],[1,"mb-1"],[1,"mb-3"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto"],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],[1,"description","text-center",3,"ngClass"],[4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","options-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"]],template:function(a,d){if(1&a&&(e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(j){return d.handleSelectionEvent(j)}),e.qZA(),e.YNc(3,c,16,21,"ng-container",3),e.YNc(4,T,6,6,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6)(8,"p",7),e._uU(9,"Tramite questo modal \xe8 possibile gestire le opzioni di caricamento al momento disponibili:"),e.qZA(),e.TgZ(10,"ul",8)(11,"li")(12,"em"),e._uU(13,"caricamento veloce"),e.qZA(),e._uU(14,": abilitando questa opzione, l'immagine da caricare verr\xe0 adattata per terminare l'operazione di upload nel minor tempo possibile. "),e.qZA(),e.TgZ(15,"li")(16,"em"),e._uU(17,"mostra link dopo l'upload"),e.qZA(),e._uU(18,": abilitando questa opzione, una volta terminato il caricamento verr\xe0 aperto il modal contenente i link utili dei file caricati. "),e.qZA()(),e.TgZ(19,"ul",9)(20,"li")(21,"div",10)(22,"input",11),e.NdJ("ngModelChange",function(j){return d.options.compress=j})("ngModelChange",function(){return d.saveOptions()}),e.qZA(),e.TgZ(23,"label",12),e._uU(24,"Caricamento veloce"),e.qZA()()(),e.TgZ(25,"li")(26,"div",10)(27,"input",13),e.NdJ("ngModelChange",function(j){return d.options.openLinkModalAfterUpload=j})("ngModelChange",function(){return d.saveOptions()}),e.qZA(),e.TgZ(28,"label",14),e._uU(29,"Mostra link dopo l'upload"),e.qZA()()()()()),2&a){const n=e.MAs(5);e.Q6J("ngClass",e.WLB(7,H,d.isUploading,d.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",d.loading||d.isUploading),e.xp6(2),e.Q6J("ngIf",!d.isUploading)("ngIfElse",n),e.xp6(19),e.Q6J("ngModel",d.options.compress),e.xp6(5),e.Q6J("ngModel",d.options.openLinkModalAfterUpload)}},dependencies:[R.mk,R.O5,R.PC,E.Wl,E.JJ,E.On,M.R,s.R,u.z,I.J,R.OU],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864FE;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:400px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.options-icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{top:5px;right:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]:hover{opacity:1}.upload-area[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo){pointer-events:none}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),p})()},1197:(Y,Q,t)=>{"use strict";t.d(Q,{M:()=>_});var v=t(8694),D=t(6895),e=t(433),x=t(6818),F=t(1043),f=t(582),C=t(4650);let _=(()=>{class g{}return g.\u0275fac=function(i){return new(i||g)},g.\u0275mod=C.oAB({type:g}),g.\u0275inj=C.cJS({imports:[v.r,D.ez,e.u5,x.q,F.h,f.z]}),g})()},8694:(Y,Q,t)=>{"use strict";t.d(Q,{r:()=>e});var v=t(6895),D=t(4650);let e=(()=>{class x{}return x.\u0275fac=function(f){return new(f||x)},x.\u0275mod=D.oAB({type:x}),x.\u0275inj=D.cJS({imports:[v.ez]}),x})()},8212:(Y,Q,t)=>{"use strict";t.d(Q,{J:()=>D});var v=t(4650);let D=(()=>{class e{transform(F,f){return F.join(f)}}return e.\u0275fac=function(F){return new(F||e)},e.\u0275pipe=v.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},575:(Y,Q,t)=>{"use strict";t.d(Q,{In:()=>v,Ky:()=>F,VC:()=>D,c5:()=>x,gG:()=>e});var v=(()=>{return(f=v||(v={})).FILE_SHOW_LINKS="fileLinks",f.FILE_EDIT="fileEdit",f.DELETE="delete",f.RENAME="rename",f.MOVE="move",v;var f})(),D=(()=>{return(f=D||(D={})).FILE="file",f.FOLDER="folder",D;var f})(),e=(()=>{return(f=e||(e={})).FILENAME="filename",f.SIZE="size",f.TIME="time",f.EXTENSION="ext",e;var f})(),x=(()=>{return(f=x||(x={})).GRID="grid",f.LIST="list",x;var f})(),F=(()=>{return(f=F||(F={})).W_768_I_1="(max-width: 767.98px)",f.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",f.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",f.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",f.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",f.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",f.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",f.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",f.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",f.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",f.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",f.W_3738_I_10="(min-width: 3424px)",F;var f})()},6986:(Y,Q,t)=>{"use strict";t.d(Q,{C7:()=>x,Mi:()=>F,O8:()=>D,er:()=>f,p0:()=>e,xt:()=>C});var v=t(575);const D=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(_=>(_.maxSize*=1048576,_)),e={lastPath:[],layout:{asc:!0,orderBy:v.gG.FILENAME,type:v.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},x="https://upload.forumfree.net/api/",F=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,f=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,C={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},146:(Y,Q,t)=>{"use strict";t.d(Q,{r:()=>F});var v=t(7579),D=t(1135),e=t(4650),x=t(8745);let F=(()=>{class f{constructor(_){this.uploadPreferencesService=_,this.selectedFileListArray=[],this.actionSubject=new v.x,this.uploadingFileQueueSubject=new v.x,this.uploadingFileErrorSubject=new v.x,this.currentFolderPathSubject=new v.x,this.layoutOptionsSubject=new v.x,this.renameFileSubject=new v.x,this.entityPendingSubject=new v.x,this.deleteFileSubject=new v.x,this.uploadedFileSubject=new v.x,this.draggedFileListSubject=new v.x,this.startUploadSubject=new v.x,this.selectedFileListSubject=new D.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(_){this.actionSubject.next(_)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(_){this.uploadPreferencesService.layoutOptions=_,this.layoutOptionsSubject.next(_)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(_){this.uploadPreferencesService.lastFolderPath=_,this.currentFolderPathSubject.next(_)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(_){this.uploadingFileQueueSubject.next(_)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(_){this.uploadingFileErrorSubject.next(_)}get renameFileObservable(){return this.renameFileSubject.asObservable()}pushRenameFile(_){this.renameFileSubject.next(_)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(_){this.entityPendingSubject.next(_)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(_){this.deleteFileSubject.next(_)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(_){this.uploadedFileSubject.next(_)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(_){this.draggedFileListSubject.next(_)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(_){this.startUploadSubject.next(_)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(_){if(Array.isArray(_)||(_=[_]),0===_.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let g=!1;for(const U of _){const i=this.selectedFileListArray.findIndex(O=>O.name===U.name);U.selected?-1===i&&(this.selectedFileListArray.push({name:U.name}),g=!0):i>-1&&(this.selectedFileListArray.splice(i,1),g=!0)}g&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return f.\u0275fac=function(_){return new(_||f)(e.LFG(x.p))},f.\u0275prov=e.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},8745:(Y,Q,t)=>{"use strict";t.d(Q,{p:()=>f});var v=t(5044),D=t(6986),e=t(4650),x=t(2381),F=t(6161);let f=(()=>{class C{constructor(g,U){this.preferencesService=g,this.urlQueryParamsService=U;const i=this.urlQueryParamsService.getAndDeleteParam(v.RT.UPLOAD_PATH);i&&(this.lastFolderPath=i.split("/").filter(O=>O.length>0))}get preferences(){return this.preferencesService.getItem(v.Ye.UPLOAD)||D.p0}set preferences(g){this.preferencesService.setItem(v.Ye.UPLOAD,g)}get lastFolderPath(){return(this.preferences.lastPath||D.p0.lastPath).filter(g=>g.length>0)}set lastFolderPath(g){const U=this.preferences;U.lastPath=g,this.preferences=U}get layoutOptions(){const g=D.p0.layout,U=this.preferences.layout;return U&&0===Object.keys(g).filter(i=>!U.hasOwnProperty(i)).length?U:g}set layoutOptions(g){const U=this.preferences;U.layout=g,this.preferences=U}get uploader(){const g=this.preferences.uploader||D.p0.uploader;return!g.checkImage.active&&Date.now()-g.checkImage.time>6048e5&&(g.checkImage.active=!0,this.uploader=g),g.hasOwnProperty("showLinkModal")||(g.showLinkModal=!1),g}set uploader(g){const U=this.preferences;U.uploader=g,this.preferences=U}}return C.\u0275fac=function(g){return new(g||C)(e.LFG(x.y),e.LFG(F.J))},C.\u0275prov=e.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},7320:(Y,Q,t)=>{"use strict";t.d(Q,{C:()=>u});var v=t(5861),D=t(7824),e=t(3905),x=t(575),F=t(3848),O=t(6986),h=t(1042),A=t(4650),S=t(5395),R=t(3138);let E=(()=>{class I{constructor(l){this.globalsService=l,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(m=>{this.ffuid=m?m.user.ffuid:""})}getItem(l){const m=this.createKey(l);if(this.cache.hasOwnProperty(m))return this.cache[m]}setItem(l,m){this.cache[this.createKey(l)]=m}removeItem(l){const m=this.createKey(l);if(this.cache.hasOwnProperty(m)){if(this.cache[m].folders.length)for(const L of this.cache[m].folders)this.removeItem([...l,L.name]);return delete this.cache[m],!0}return!1}addEntities(l,m,L=x.VC.FILE){const y=this.createKey(l);return!!this.cache.hasOwnProperty(y)&&(Array.isArray(m)||(m=[m]),L===x.VC.FILE?this.cache[y].files.unshift(...m):this.cache[y].folders.unshift(...m),!0)}removeEntities(l,m,L=x.VC.FILE){if(Array.isArray(m)||(m=[m]),L===x.VC.FOLDER)for(const $ of m)this.removeItem([...l,$]);const y=this.createKey(l);if(!this.cache.hasOwnProperty(y))return[];const Z=L===x.VC.FILE?"files":"folders";let G=[];for(const $ of m){const X=this.cache[y][Z].findIndex(q=>q.name===$);X>-1&&(this.cache[y][Z].splice(X,1),G.push($))}return G}refactorFolderContent(l,m){const L=this.createKey(l);if(!this.cache.hasOwnProperty(L))return!1;m.endsWith("/")||(m+="/");for(const y of this.cache[L].folders)y.url=m+y.name;for(const y of this.cache[L].files)y.url=y.embedUrl=m+y.name,y.time=Date.now();return!0}createKey(l){return`${this.ffuid}/${l.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return I.\u0275fac=function(l){return new(l||I)(A.LFG(R.d))},I.\u0275prov=A.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),I})();var M=t(8745),s=t(529);let u=(()=>{class I{constructor(l,m,L,y){this.graphqlService=l,this.uploadCacheService=m,this.uploadPreferencesService=L,this.http=y}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(D._.HeaderKeys.UUID,(0,h.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(D._.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(D._.HeaderKeys.UUID)||""}getFileList(l,m){var L=this;return(0,v.Z)(function*(){const y=L.uploadCacheService.getItem(l);if(y)return y;const Z=(yield L.graphqlService.query({query:"\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",variables:{scope:m,target:l.join("/")}})).data.uploadEntitiesListToken,G=yield L.sendRequest(Z),X={files:G.files.map(q=>{const ae=(0,F.Tb)(q.url);return{...q,time:1e3*q.time,filename:ae.filename,ext:ae.ext,isImage:(0,F.Or)(ae.ext),embedUrl:`${q.url}?t=${q.time}`,type:x.VC.FILE}}),folders:G.folders.map(q=>({...q,type:x.VC.FOLDER}))};return L.uploadCacheService.setItem(l,X),X})()}createDirectory(l,m){var L=this;return(0,v.Z)(function*(){const y=(yield L.graphqlService.mutate({mutation:"\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",variables:{scope:m,target:l.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield L.sendRequest(y)})()}moveRenameEntity(l,m,L,y,Z){var G=this;return(0,v.Z)(function*(){y||(y=L);const $=(yield G.graphqlService.mutate({mutation:"\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",variables:{scope:Z,source:(l.length?`${l.join("/")}/`:"")+L,target:(m.length?`${m.join("/")}/`:"")+y}})).data.uploadEntitiesMoveToken;return yield G.sendRequest($)})()}deleteEntity(l,m,L){var y=this;return(0,v.Z)(function*(){const Z=(yield y.graphqlService.mutate({mutation:"\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",variables:{scope:L,target:(l.length?`${l.join("/")}/`:"")+m}})).data.uploadEntitiesDeleteToken;return yield y.sendRequest(Z),!0})()}getHostToken(l,m,L){var y=this;return(0,v.Z)(function*(){return(yield y.graphqlService.query({query:"\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",variables:{scope:L,target:(l.length?`${l.join("/")}/`:"")+m}})).data.uploadEntitiesHostToken})()}sendRequest(l){var m=this;return(0,v.Z)(function*(){return(yield(0,e.z)(m.http.post(O.C7,JSON.stringify({payload:l}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(l,m){var L=this;return(0,v.Z)(function*(){return yield L.graphqlService.subscribe({query:"\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}",variables:{scope:m}},y=>{if(!y.data?.uploadEntities)return;const Z=JSON.parse(y.data.uploadEntities.eventMessage);if(!Z.payload.customHeaders||!Z.payload.customHeaders.hasOwnProperty(D._.HeaderKeys.UUID)||Z.payload.customHeaders[D._.HeaderKeys.UUID]===L.getGqlIdHeader())return;const G=(Z.payload.content.source||"").split("/"),$=(Z.payload.content.target||"").split("/"),X=$[$.length-1].indexOf(".")>-1;let q;try{q=JSON.parse(Z.output).success||""}catch{return}l({type:y.data.uploadEntities.eventType,sourceName:G[G.length-1],sourcePaths:G.slice(0,-1),targetName:$[$.length-1],targetPaths:$.slice(0,-1),isFile:X,output:q})})})()}getBlobFromUrl(l){var m=this;return(0,v.Z)(function*(){return yield(0,e.z)(m.http.get(l,{responseType:"blob"})).catch(()=>{})})()}}return I.\u0275fac=function(l){return new(l||I)(A.LFG(S.J),A.LFG(E),A.LFG(M.p),A.LFG(s.eN))},I.\u0275prov=A.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),I})()},3848:(Y,Q,t)=>{"use strict";t.d(Q,{$H:()=>h,JN:()=>g,Lv:()=>f,Or:()=>O,Tb:()=>x,jL:()=>i,rc:()=>A,sT:()=>C,zO:()=>F});var v=t(5861),D=t(575),e=t(6986);function x(E){let M=E;if(E.indexOf("/")>-1){const W=E.split("/");M=W[W.length-1]}const s=M.split("."),u=s[s.length-1].toLowerCase(),I=decodeURIComponent(s.slice(0,-1).join("."));return{ext:u,filename:I,name:`${I}.${u}`}}function F(E,M=0){const s=x(E),u=Date.now();return{name:s.name,size:M,time:u,url:E,ext:s.ext,filename:s.filename,isImage:O(s.ext),embedUrl:`${E}?t=${u}`,type:D.VC.FILE}}function f(E){let M=E;M.endsWith("/")&&(M=M.slice(0,-1));const s=M.split("/");return{name:decodeURIComponent(s[s.length-1])}}function C(E){return _.apply(this,arguments)}function _(){return(_=(0,v.Z)(function*(E){const M=new FileReader,s=new Promise(u=>M.addEventListener("load",()=>u(M.result)));return M.readAsDataURL(E),s})).apply(this,arguments)}function g(E){return U.apply(this,arguments)}function U(){return(U=(0,v.Z)(function*(E){const M=new DataView(yield E.arrayBuffer());if(2303741511===M.getUint32(0)&&218765834===M.getUint32(4)){if(-1===[4,6].indexOf(M.getUint8(25)))return!1;const u=Object.assign(new Image,{src:yield C(E)});yield new Promise(l=>u.addEventListener("load",()=>l(!0)));const I=Object.assign(document.createElement("canvas"),{width:u.width,height:u.height}).getContext("2d");if(!I)return!1;I.imageSmoothingEnabled=!1,I.drawImage(u,0,0);const W=I?.getImageData(0,0,u.width,u.height);if(W)for(let l=0;l<W.data.length;l+=4)if(W.data[l+3]<255)return!0}return!1})).apply(this,arguments)}function i(E){return E.map(M=>({name:M.name,ext:M.ext,type:D.VC.FILE,url:M.url,embedUrl:M.embedUrl,isImage:M.isImage}))}function O(E,M=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(E)&&!M.includes(E)}function h(E){return O(E,["gif","svg"])}function A(E,M,s,u=[],I=""){let W={...e.xt};const l=E.trim();W.invalidLength=0===l.length;const m=(l+I).replace(/\s{2,}/g," ");return W.alreadyUsed=M!==l&&u.includes(m),W.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(E),W.invalidCharacter=!(s===D.VC.FILE?e.Mi.test(E):e.er.test(E)),W}},3612:(Y,Q,t)=>{"use strict";t.d(Q,{q:()=>R});var v=t(5861),D=t(8896),e=t(6730),x=t.n(e),F=t(9969),f=t(3848),C=t(529),_=t(7579),g=t(7445),U=t(2722),i=t(6986);class O{static findApp1Marker(M){const s=new DataView(M),u=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let I=0;I<M.byteLength-2;I+=2){const W=s.getUint16(I);if(65505===W)return{offset:I,size:s.getUint16(I+2),little:18761==s.getUint16(I+8,!1)};if(u.has(W))break}}static stripAndReturnExif(M){return(0,v.Z)(function*(){const s=yield M.arrayBuffer(),u=O.findApp1Marker(s);return u?{file:new File([s.slice(0,u.offset),s.slice(u.offset+u.size+2)],M.name,{type:M.type,lastModified:M.lastModified}),exif:s.slice(u.offset,u.offset+u.size)}:{file:M}})()}static checkImageOrientation(M){const s=new DataView(M);if(1165519206!=s.getUint32(4,!1))return-1;const u=18761==s.getUint16(10,!1);let I=10;I+=s.getUint32(I+4,u);const W=s.getUint16(I,u);I+=2;for(let l=0;l<W;l++)if(274==s.getUint16(I+12*l,u))return s.getUint16(I+12*l+8,u);return-1}}var h=t(4650),A=t(146),S=t(2020);let R=(()=>{class E{constructor(s,u,I){this.http=s,this.uploadObservablesService=u,this.loadImageService=I,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return{...this.uploaderOptionsObject}}set uploaderOptions(s){this.uploaderOptionsObject={...s}}compressFileIfNeeded(s,u){return(0,v.Z)(function*(){let I=["image/png","image/jpeg"],W={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};u&&(I.push("image/webp"),W.width=u.width,W.height=u.height,W.resize="cover",W.strict=!1);const l=s.type.toLowerCase();return s.size<=4e6&&void 0===u||-1===I.indexOf(s.type.toLowerCase())?s:("image/png"===l&&(yield(0,f.JN)(s))&&(W.convertSize=1/0),new Promise((m,L)=>{new(x())(s,{...W,success:y=>{const Z=y instanceof Blob?new File([y],s.name,{type:s.type,lastModified:s.lastModified}):s;m(Z)},error:L})}))})()}orientFileIfNeeded(s){var u=this;return(0,v.Z)(function*(){if(-1===["image/jpeg"].indexOf(s.type.toLowerCase()))return s;const W=yield O.stripAndReturnExif(s);if(s=W.file,W.exif){const l=O.checkImageOrientation(W.exif);if(1!==l){let m=0;switch(l){case 3:case 4:m=180;break;case 5:case 6:m=90;break;case 7:case 8:m=270}const L=yield(0,f.sT)(s),y=yield new Promise((G,$)=>{const X=new Image;X.onload=()=>G({originalImage:X,originalBase64:L}),X.onerror=$,X.src=L}),Z=yield u.loadImageService.transformLoadedImage({original:{base64:y.originalBase64,image:y.originalImage,size:{width:y.originalImage.naturalWidth,height:y.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(l),rotate:m/90}},new F.R);s=new File([(0,D.L)(Z.transformed.base64)],s.name,{type:s.type,lastModified:Date.now()})}}return s})()}upload(s,u,I,W=!1){const l=new _.x,m=new FormData;m.append("payload",I),m.append("upload",s,s.name),W&&m.append("allowOverwrite","1");const L=this.http.request(new C.aW("POST",i.C7,m,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(L.subscribe({next:y=>{if(y.type===C.dt.UploadProgress){if(!y.total||(u.progress=Math.round(50*y.loaded/y.total)+20,u.progress<70))return;(0,g.F)(1e3).pipe((0,U.R)(l.asObservable())).subscribe(()=>{if(u.progress<95){const Z=Math.round(8*Math.random()+8);u.progress+Z>95?u.progress=95:u.progress+=Z}})}else if(y instanceof C.Zn){if(u.progress=100,u.completed=!0,y.body?.error||!y.body?.success)u.error=!0,this.uploadObservablesService.pushUploadingFileError(u);else{u.file.url=y.body.success.url,u.file.time=Date.now(),u.file.embedUrl=`${u.file.url}?t=${u.file.time}`;const Z=(0,f.Tb)(u.file.url);u.file.name=Z.name,u.file.filename=Z.filename}l.next(),l.complete()}},error:()=>{u.error=!0,this.uploadObservablesService.pushUploadingFileError(u),l.next(),l.complete()}})),l.asObservable()}clearPendingRequests(){for(const s of this.requestSubscriptions)s.unsubscribe();this.requestSubscriptions=[]}}return E.\u0275fac=function(s){return new(s||E)(h.LFG(C.eN),h.LFG(A.r),h.LFG(S.y))},E.\u0275prov=h.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})()},6730:function(Y){Y.exports=function(){"use strict";function Q(b,r){var o=Object.keys(b);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(b);r&&(c=c.filter(function(B){return Object.getOwnPropertyDescriptor(b,B).enumerable})),o.push.apply(o,c)}return o}function t(b){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?Q(Object(o),!0).forEach(function(c){x(b,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(o)):Q(Object(o)).forEach(function(c){Object.defineProperty(b,c,Object.getOwnPropertyDescriptor(o,c))})}return b}function D(b,r){for(var o=0;o<r.length;o++){var c=r[o];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(b,c.key,c)}}function x(b,r,o){return r in b?Object.defineProperty(b,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):b[r]=o,b}function F(){return F=Object.assign||function(b){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(b[c]=o[c])}return b},F.apply(this,arguments)}var b,r,o,c,B,T,H,K,f={exports:{}};b=f,typeof window>"u"||(r=window,o=r.HTMLCanvasElement&&r.HTMLCanvasElement.prototype,c=r.Blob&&function(){try{return Boolean(new Blob)}catch{return!1}}(),B=c&&r.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch{return!1}}(),T=r.BlobBuilder||r.WebKitBlobBuilder||r.MozBlobBuilder||r.MSBlobBuilder,H=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,K=(c||T)&&r.atob&&r.ArrayBuffer&&r.Uint8Array&&function(p){var w,a,d,n,j,P,J,z,te;if(!(w=p.match(H)))throw new Error("invalid data URI");for(a=w[2]?w[1]:"text/plain"+(w[3]||";charset=US-ASCII"),d=!!w[4],n=p.slice(w[0].length),j=d?atob(n):decodeURIComponent(n),P=new ArrayBuffer(j.length),J=new Uint8Array(P),z=0;z<j.length;z+=1)J[z]=j.charCodeAt(z);return c?new Blob([B?J:P],{type:a}):((te=new T).append(P),te.getBlob(a))},r.HTMLCanvasElement&&!o.toBlob&&(o.mozGetAsFile?o.toBlob=function(p,w,a){var d=this;setTimeout(function(){p(a&&o.toDataURL&&K?K(d.toDataURL(w,a)):d.mozGetAsFile("blob",w))})}:o.toDataURL&&K&&(o.toBlob=o.msToBlob?function(p,w,a){var d=this;setTimeout(function(){p((w&&"image/png"!==w||a)&&o.toDataURL&&K?K(d.toDataURL(w,a)):d.msToBlob(w))})}:function(p,w,a){var d=this;setTimeout(function(){p(K(d.toDataURL(w,a)))})})),b.exports?b.exports=K:r.dataURLtoBlob=K);var C=f.exports,g={strict:!0,checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},i=typeof window<"u"&&typeof window.document<"u"?window:{},O=function(r){return r>0&&r<1/0},h=Array.prototype.slice;function A(b){return Array.from?Array.from(b):h.call(b)}var S=/^image\/.+$/;function R(b){return S.test(b)}var M=String.fromCharCode;var u=i.btoa;function W(b){var o,r=new DataView(b);try{var c,B,T;if(255===r.getUint8(0)&&216===r.getUint8(1))for(var H=r.byteLength,K=2;K+1<H;){if(255===r.getUint8(K)&&225===r.getUint8(K+1)){B=K;break}K+=1}if(B){var w=B+10;if("Exif"===function s(b,r,o){var B,c="";for(o+=r,B=r;B<o;B+=1)c+=M(b.getUint8(B));return c}(r,B+4,4)){var a=r.getUint16(w);if(((c=18761===a)||19789===a)&&42===r.getUint16(w+2,c)){var d=r.getUint32(w+4,c);d>=8&&(T=w+d)}}}if(T){var j,P,n=r.getUint16(T,c);for(P=0;P<n;P+=1)if(274===r.getUint16(j=T+12*P+2,c)){o=r.getUint16(j+=8,c),r.setUint16(j,1,c);break}}}catch{o=1}return o}var m=/\.\d*(?:0|9){12}\d*$/;function L(b){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return m.test(b)?Math.round(b*r)/r:b}function y(b){var r=b.aspectRatio,o=b.height,c=b.width,B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",T=O(c),H=O(o);if(T&&H){var K=o*r;("contain"===B||"none"===B)&&K>c||"cover"===B&&K<c?o=c/r:c=o*r}else T?o=c/r:H&&(c=o*r);return{width:c,height:o}}var Z=i.ArrayBuffer,G=i.FileReader,$=i.URL||i.webkitURL,X=/\.\w+$/,q=i.Compressor;return function(){function b(r,o){(function v(b,r){if(!(b instanceof r))throw new TypeError("Cannot call a class as a function")})(this,b),this.file=r,this.image=new Image,this.options=t(t({},g),o),this.aborted=!1,this.result=null,this.init()}return function e(b,r,o){return r&&D(b.prototype,r),o&&D(b,o),b}(b,[{key:"init",value:function(){var o=this,c=this.file,B=this.options;if(function(r){return!(typeof Blob>"u")&&(r instanceof Blob||"[object Blob]"===Object.prototype.toString.call(r))}(c)){var T=c.type;if(R(T))if($&&G)if(Z||(B.checkOrientation=!1),$&&!B.checkOrientation)this.load({url:$.createObjectURL(c)});else{var H=new G,K=B.checkOrientation&&"image/jpeg"===T;this.reader=H,H.onload=function(p){var a=p.target.result,d={};if(K){var n=W(a);n>1||!$?(d.url=function I(b,r){for(var o=[],B=new Uint8Array(b);B.length>0;)o.push(M.apply(null,A(B.subarray(0,8192)))),B=B.subarray(8192);return"data:".concat(r,";base64,").concat(u(o.join("")))}(a,T),n>1&&F(d,function l(b){var r=0,o=1,c=1;switch(b){case 2:o=-1;break;case 3:r=-180;break;case 4:c=-1;break;case 5:r=90,c=-1;break;case 6:r=90;break;case 7:r=90,o=-1;break;case 8:r=-90}return{rotate:r,scaleX:o,scaleY:c}}(n))):d.url=$.createObjectURL(c)}else d.url=a;o.load(d)},H.onabort=function(){o.fail(new Error("Aborted to read the image with FileReader."))},H.onerror=function(){o.fail(new Error("Failed to read the image with FileReader."))},H.onloadend=function(){o.reader=null},K?H.readAsArrayBuffer(c):H.readAsDataURL(c)}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(o){var c=this,B=this.file,T=this.image;T.onload=function(){c.draw(t(t({},o),{},{naturalWidth:T.naturalWidth,naturalHeight:T.naturalHeight}))},T.onabort=function(){c.fail(new Error("Aborted to load the image."))},T.onerror=function(){c.fail(new Error("Failed to load the image."))},i.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(i.navigator.userAgent)&&(T.crossOrigin="anonymous"),T.alt=B.name,T.src=o.url}},{key:"draw",value:function(o){var c=this,B=o.naturalWidth,T=o.naturalHeight,H=o.rotate,K=void 0===H?0:H,p=o.scaleX,w=void 0===p?1:p,a=o.scaleY,d=void 0===a?1:a,n=this.file,j=this.image,P=this.options,J=document.createElement("canvas"),z=J.getContext("2d"),te=Math.abs(K)%180==90,oe=("contain"===P.resize||"cover"===P.resize)&&O(P.width)&&O(P.height),re=Math.max(P.maxWidth,0)||1/0,k=Math.max(P.maxHeight,0)||1/0,V=Math.max(P.minWidth,0)||0,ne=Math.max(P.minHeight,0)||0,ie=B/T,N=P.width,ee=P.height;if(te){var ue=[k,re];re=ue[0],k=ue[1];var de=[ne,V];V=de[0],ne=de[1];var pe=[ee,N];N=pe[0],ee=pe[1]}oe&&(ie=N/ee);var he=y({aspectRatio:ie,width:re,height:k},"contain");re=he.width,k=he.height;var fe=y({aspectRatio:ie,width:V,height:ne},"cover");if(V=fe.width,ne=fe.height,oe){var ge=y({aspectRatio:ie,width:N,height:ee},P.resize);N=ge.width,ee=ge.height}else{var me=y({aspectRatio:ie,width:N,height:ee}),ve=me.width;N=void 0===ve?B:ve;var _e=me.height;ee=void 0===_e?T:_e}var Ue=-(N=Math.floor(L(Math.min(Math.max(N,V),re))))/2,Me=-(ee=Math.floor(L(Math.min(Math.max(ee,ne),k))))/2,we=N,Ce=ee,se=[];if(oe){var le,ce,ye=y({aspectRatio:ie,width:B,height:T},{contain:"cover",cover:"contain"}[P.resize]);se.push((B-(le=ye.width))/2,(T-(ce=ye.height))/2,le,ce)}if(se.push(Ue,Me,we,Ce),te){var be=[ee,N];N=be[0],ee=be[1]}J.width=N,J.height=ee,R(P.mimeType)||(P.mimeType=n.type);var xe="transparent";if(n.size>P.convertSize&&P.convertTypes.indexOf(P.mimeType)>=0&&(P.mimeType="image/jpeg"),"image/jpeg"===P.mimeType&&(xe="#fff"),z.fillStyle=xe,z.fillRect(0,0,N,ee),P.beforeDraw&&P.beforeDraw.call(this,z,J),!this.aborted&&(z.save(),z.translate(N/2,ee/2),z.rotate(K*Math.PI/180),z.scale(w,d),z.drawImage.apply(z,[j].concat(se)),z.restore(),P.drew&&P.drew.call(this,z,J),!this.aborted)){var Oe=function(Ie){c.aborted||c.done({naturalWidth:B,naturalHeight:T,result:Ie})};J.toBlob?J.toBlob(Oe,P.mimeType,P.quality):Oe(C(J.toDataURL(P.mimeType,P.quality)))}}},{key:"done",value:function(o){var c=o.naturalWidth,B=o.naturalHeight,T=o.result,H=this.file,p=this.options;if($&&!p.checkOrientation&&$.revokeObjectURL(this.image.src),T)if(p.strict&&T.size>H.size&&p.mimeType===H.type&&!(p.width>c||p.height>B||p.minWidth>c||p.minHeight>B||p.maxWidth<c||p.maxHeight<B))T=H;else{var w=new Date;T.lastModified=w.getTime(),T.lastModifiedDate=w,T.name=H.name,T.name&&T.type!==H.type&&(T.name=T.name.replace(X,function E(b){var r=R(b)?b.substr(6):"";return"jpeg"===r&&(r="jpg"),".".concat(r)}(T.type)))}else T=H;this.result=T,p.success&&p.success.call(this,T)}},{key:"fail",value:function(o){var c=this.options;if(!c.error)throw o;c.error.call(this,o)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=q,b}},{key:"setDefaults",value:function(o){F(g,o)}}]),b}()}()},7445:(Y,Q,t)=>{"use strict";t.d(Q,{F:()=>e});var v=t(4986),D=t(5963);function e(x=0,F=v.z){return x<0&&(x=0),(0,D.H)(x,x,F)}},1042:(Y,Q,t)=>{"use strict";t.d(Q,{Z:()=>O});var v,D=new Uint8Array(16);function e(){if(!v&&!(v=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return v(D)}const x=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,f=function F(h){return"string"==typeof h&&x.test(h)};for(var C=[],_=0;_<256;++_)C.push((_+256).toString(16).substr(1));const O=function i(h,A,S){var R=(h=h||{}).random||(h.rng||e)();if(R[6]=15&R[6]|64,R[8]=63&R[8]|128,A){S=S||0;for(var E=0;E<16;++E)A[S+E]=R[E];return A}return function g(h){var A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=(C[h[A+0]]+C[h[A+1]]+C[h[A+2]]+C[h[A+3]]+"-"+C[h[A+4]]+C[h[A+5]]+"-"+C[h[A+6]]+C[h[A+7]]+"-"+C[h[A+8]]+C[h[A+9]]+"-"+C[h[A+10]]+C[h[A+11]]+C[h[A+12]]+C[h[A+13]]+C[h[A+14]]+C[h[A+15]]).toLowerCase();if(!f(S))throw TypeError("Stringified UUID is invalid");return S}(R)}}}]);