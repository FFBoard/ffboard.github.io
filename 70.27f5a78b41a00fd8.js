(self.webpackChunkpages=self.webpackChunkpages||[]).push([[70],{9829:(V,B,t)=>{"use strict";t.d(B,{R:()=>f});class f{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(x=>x in this).forEach(x=>this[x]=e[x]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(x=>x in this).forEach(x=>this[x]=e[x].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},9582:(V,B,t)=>{"use strict";t.d(B,{y:()=>y});var f=t(1413),M=t(5861);var s=t(5879);let y=(()=>{class h{constructor(){this.autoRotateSupported=function x(){return new Promise(h=>{const U=new Image;U.onload=()=>{h(1===U.width&&2===U.height)},U.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(r,l){return new Promise((A,C)=>{const I=new FileReader;I.onload=b=>{this.loadImage(b.target.result,r.type,l).then(A).catch(C)},I.readAsDataURL(r)})}loadImage(r,l,A){return this.isValidImageType(l)?this.loadBase64Image(r,A):Promise.reject(new Error("Invalid image type"))}isValidImageType(r){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(r)}loadImageFromURL(r,l){return new Promise((A,C)=>{const I=new Image;I.onerror=()=>C,I.onload=()=>{const b=document.createElement("canvas"),N=b.getContext("2d");b.width=I.width,b.height=I.height,null==N||N.drawImage(I,0,0),this.loadBase64Image(b.toDataURL(),l).then(A)},I.crossOrigin="anonymous",I.src=r})}loadBase64Image(r,l){return new Promise((A,C)=>{const I=new Image;I.onload=()=>A({originalImage:I,originalBase64:r}),I.onerror=C,I.src=r}).then(A=>this.transformImageBase64(A,l))}transformImageBase64(r,l){var A=this;return(0,M.Z)(function*(){const C=yield A.autoRotateSupported,I=yield function P(h){switch("string"==typeof h&&(h=function c(h){const U=new DataView(function O(h){h=h.replace(/^data\:([^\;]+)\;base64,/gim,"");const U=atob(h),r=U.length,l=new Uint8Array(r);for(let A=0;A<r;A++)l[A]=U.charCodeAt(A);return l.buffer}(h));if(65496!==U.getUint16(0,!1))return-2;const r=U.byteLength;let l=2;for(;l<r;){if(U.getUint16(l+2,!1)<=8)return-1;const A=U.getUint16(l,!1);if(l+=2,65505==A){if(1165519206!==U.getUint32(l+=2,!1))return-1;const C=18761==U.getUint16(l+=6,!1);l+=U.getUint32(l+4,C);const I=U.getUint16(l,C);l+=2;for(let b=0;b<I;b++)if(274==U.getUint16(l+12*b,C))return U.getUint16(l+12*b+8,C)}else{if(65280!=(65280&A))break;l+=U.getUint16(l,!1)}}return-1}(h)),h){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(C?-1:r.originalBase64);return r.originalImage&&r.originalImage.complete?A.transformLoadedImage({original:{base64:r.originalBase64,image:r.originalImage,size:{width:r.originalImage.naturalWidth,height:r.originalImage.naturalHeight}},exifTransform:I},l):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(r,l){var A=this;return(0,M.Z)(function*(){const C=l.canvasRotation+r.exifTransform.rotate,I={width:r.original.image.naturalWidth,height:r.original.image.naturalHeight};if(0===C&&!r.exifTransform.flip&&!l.containWithinAspectRatio)return{original:{base64:r.original.base64,image:r.original.image,size:(0,f.Z)({},I)},transformed:{base64:r.original.base64,image:r.original.image,size:(0,f.Z)({},I)},exifTransform:r.exifTransform};const b=A.getTransformedSize(I,r.exifTransform,l),N=document.createElement("canvas");N.width=b.width,N.height=b.height;const m=N.getContext("2d");null==m||m.setTransform(r.exifTransform.flip?-1:1,0,0,1,N.width/2,N.height/2),null==m||m.rotate(Math.PI*(C/2)),null==m||m.drawImage(r.original.image,-I.width/2,-I.height/2);const _=N.toDataURL(),D=yield A.loadImageFromBase64(_);return{original:{base64:r.original.base64,image:r.original.image,size:(0,f.Z)({},I)},transformed:{base64:_,image:D,size:{width:D.width,height:D.height}},exifTransform:r.exifTransform}})()}loadImageFromBase64(r){return new Promise((l,A)=>{const C=new Image;C.onload=()=>l(C),C.onerror=A,C.src=r})}getTransformedSize(r,l,A){const C=A.canvasRotation+l.rotate;if(A.containWithinAspectRatio){if(C%2){const b=r.height/A.aspectRatio;return{width:Math.max(r.height,r.width*A.aspectRatio),height:Math.max(r.width,b)}}{const b=r.width/A.aspectRatio;return{width:Math.max(r.width,r.height*A.aspectRatio),height:Math.max(r.height,b)}}}return C%2?{height:r.width,width:r.height}:{width:r.width,height:r.height}}}return h.\u0275fac=function(r){return new(r||h)},h.\u0275prov=s.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},3705:(V,B,t)=>{"use strict";function f(M){const e=M.split(","),x=e[0].replace("data:","").replace(";base64",""),P=atob(e[1]),c=new ArrayBuffer(P.length),O=new Uint8Array(c);for(let s=0;s<P.length;s+=1)O[s]=P.charCodeAt(s);return new Blob([c],{type:x})}t.d(B,{L:()=>f})},5851:(V,B,t)=>{"use strict";t.d(B,{B:()=>Y});var f=t(5861),M=t(1378),e=t(5879),x=t(2438),P=t(4036),c=t(9054),O=t(4020),s=t(148),y=t(9093),h=t(7621),U=t(1990),r=t(5661),l=t(5172),A=t(3845),C=t(4887),I=t(5487),b=t(658),N=t(9515),m=t(6814),_=t(6223),D=t(9473),g=t(554),E=t(4464),w=t(4228);const S=["fileInput"];function J(o,F){1&o&&(e.O4$(),e.TgZ(0,"svg",31),e._UZ(1,"path",32)(2,"path",33),e.qZA())}const q=function(){return["text-primary"]};function te(o,F){1&o&&e._UZ(0,"app-logo",34),2&o&&e.Q6J("svgClass",e.DdM(2,q))("responsive",!1)}function G(o,F){1&o&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&o&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.DESKTOP"),e.oJD)}function oe(o,F){1&o&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&o&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.TOUCH"),e.oJD)}const se=function(o){return{"fw-bold fs-md-lg":o}},ne=function(o){return{"text-decoration-underline":o}};function le(o,F){if(1&o){const n=e.EpF();e.TgZ(0,"div",35),e.YNc(1,G,2,3,"span",36),e.YNc(2,oe,2,3,"span",36),e.TgZ(3,"span",37),e.NdJ("click",function(a){e.CHM(n);const R=e.oxw(2),Z=e.MAs(23);return e.KtG(R.toggleRemoteUrlForm(a,Z))}),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&o){const n=e.oxw(2);e.Q6J("ngClass",e.VKq(7,se,!n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.touchDevice),e.xp6(1),e.Q6J("ngIf",n.touchDevice),e.xp6(1),e.Q6J("ngClass",e.VKq(9,ne,n.isWidget)),e.xp6(1),e.Oqu(e.lcZ(5,5,"COMPONENTS.UPLOADER.DESCRIPTION.REMOTE_URL"))}}function he(o,F){1&o&&e.GkF(0)}function ue(o,F){if(1&o){const n=e.EpF();e.TgZ(0,"div",39),e.YNc(1,he,1,0,"ng-container",17),e.TgZ(2,"button",40),e.NdJ("click",function(a){e.CHM(n);const R=e.oxw(2);return e.KtG(R.handleRemoteUrlUpload(a))}),e.O4$(),e.TgZ(3,"svg",41),e._UZ(4,"path",42),e.qZA()(),e.kcU(),e.TgZ(5,"button",43),e.NdJ("click",function(a){e.CHM(n);const R=e.oxw(2);return e.KtG(R.toggleRemoteUrlForm(a))}),e.O4$(),e.TgZ(6,"svg",41),e._UZ(7,"path",44),e.qZA()()()}if(2&o){const n=e.oxw(2),p=e.MAs(34);e.xp6(1),e.Q6J("ngTemplateOutlet",p),e.xp6(1),e.Q6J("disabled",0===n.remoteUrl.length||!n.isRemoteUrlValid)}}function Ee(o,F){if(1&o&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"em",45),e.ALo(5,"arrayJoin"),e.BQk()),2&o){const n=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"COMPONENTS.UPLOADER.PATH.LONG")," "),e.xp6(2),e.Q6J("innerText",n.currentFolderPath.length?e.xi3(5,4,n.currentFolderPath,"/"):"root")}}function v(o,F){if(1&o&&(e._UZ(0,"div",50),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&o){const n=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,n.currentFolderPath,0,-1),"/"))}}function i(o,F){if(1&o&&(e.TgZ(0,"div",46)(1,"div",47),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,v,3,8,"div",48),e._UZ(5,"div",49),e.ALo(6,"arrayJoin"),e.ALo(7,"slice"),e.qZA()),2&o){const n=e.oxw(2);e.xp6(2),e.hij(" ",e.lcZ(3,3,"COMPONENTS.UPLOADER.PATH.SHORT")," "),e.xp6(2),e.Q6J("ngIf",n.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(n.currentFolderPath.length>1?"/":"")+(n.currentFolderPath.length?e.xi3(6,5,e.xi3(7,8,n.currentFolderPath,n.currentFolderPath.length-1),"/"):"root"))}}const u=function(){return{bottom:0,left:0}};function d(o,F){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"a",51),e.NdJ("click",function(){e.CHM(n);const a=e.oxw(2);return e.KtG(a.openInfoModal.emit())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",52),e.NdJ("click",function(){e.CHM(n),e.oxw(2);const a=e.MAs(7);return e.KtG(a.open())}),e._uU(5," settings "),e.qZA(),e.TgZ(6,"div",53),e.NdJ("click",function(a){e.CHM(n);const R=e.oxw(2),Z=e.MAs(23);return e.KtG(R.toggleRemoteUrlForm(a,Z))}),e._uU(7," add_link "),e.qZA(),e.BQk()}2&o&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,u)),e.xp6(1),e.Oqu(e.lcZ(3,2,"COMPONENTS.UPLOADER.INFO")))}const T=function(o,F,n){return{"cursor-pointer":o,"py-4 px-3 px-sm-4":F,"p-2 pb-3":n}},L=function(o,F,n){return{"my-2":o,"mb-2":F,"mw-100 mt-1":n}};function Q(o,F){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",22,23),e.NdJ("dragenter",function(){e.CHM(n);const a=e.MAs(2),R=e.oxw();return e.KtG(R.setDragOverEvent(a))})("drop",function(a){e.CHM(n);const R=e.oxw();return e.KtG(R.handleDropEvent(a))})("click",function(){e.CHM(n);const a=e.oxw(),R=e.MAs(2);return e.KtG(!a.isWaitingRemoteUrl&&R.click())}),e.YNc(3,J,3,0,"svg",24),e.YNc(4,te,1,3,"ng-template",null,25,e.W1O),e.YNc(6,le,6,11,"div",26),e.YNc(7,ue,8,2,"div",27),e.TgZ(8,"div",28),e.YNc(9,Ee,6,7,"ng-container",3),e.YNc(10,i,8,11,"ng-template",null,29,e.W1O),e.qZA()(),e.YNc(12,d,8,5,"ng-container",30),e.BQk()}if(2&o){const n=e.MAs(5),p=e.MAs(11),a=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(9,T,!a.loading&&!a.isWaitingRemoteUrl,!a.isWidget,a.isWidget)),e.xp6(2),e.Q6J("ngIf",!a.isWidget)("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",!a.isWidget||!a.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngIf",a.isWidget&&a.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngClass",e.kEZ(13,L,!a.isWidget&&!a.touchDevice,!a.isWidget&&a.touchDevice,a.isWidget)),e.xp6(1),e.Q6J("ngIf",!a.isWidget)("ngIfElse",p),e.xp6(3),e.Q6J("ngIf",!a.isWidget)}}const K=function(o,F){return{"p-4":o,"p-2":F}};function W(o,F){if(1&o&&(e.TgZ(0,"div",54),e.O4$(),e.TgZ(1,"svg",55),e._UZ(2,"path",56),e.qZA(),e.kcU(),e._UZ(3,"app-loader",57),e.TgZ(4,"div",58),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&o){const n=e.oxw();e.Q6J("ngClass",e.WLB(6,K,!n.isWidget,n.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",n.loadingMessage),e.xp6(2),e.hij(" ",e.lcZ(6,4,"COMPONENTS.UPLOADER.LOADING.SUBTEXT")," ")}}function j(o,F){1&o&&e.GkF(0)}const H=function(o){return{"fs-reset":o}};function z(o,F){if(1&o){const n=e.EpF();e.TgZ(0,"input",59,60),e.NdJ("ngModelChange",function(a){e.CHM(n);const R=e.oxw();return e.KtG(R.remoteUrl=a)})("ngModelChange",function(){e.CHM(n);const a=e.MAs(1),R=e.oxw();return e.KtG(R.isRemoteUrlValid=!a.invalid)}),e.ALo(2,"translate"),e.qZA()}if(2&o){const n=e.oxw();e.Q6J("placeholder",e.lcZ(2,4,"COMPONENTS.UPLOADER.REMOTE_URL_INPUT_PLACEHOLDER"))("ngClass",e.VKq(6,H,n.isWidget))("ngModel",n.remoteUrl)("pattern","^https?://[^.]+\\.(.+)")}}const re=function(o,F){return{uploading:o,"widget flex-grow-1 min-w-0":F}};let Y=(()=>{class o{constructor(n,p,a,R,Z,k,ie,ce,ee){this.postMessageService=n,this.uploadService=p,this.uploadObservablesService=a,this.uploaderService=R,this.toastService=Z,this.renderer=k,this.ngZone=ie,this.translateService=ce,this.proxyService=ee,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="",this.touchDevice=O.eX,this.isWaitingRemoteUrl=!1,this.remoteUrl="",this.isRemoteUrlValid=!1,this.dragOverEvent=!1,this.checkingFileMessage="",this.options=this.uploaderService.uploaderOptions;const X=this.uploadService.preferences.uploader;X.checkImage.active||(this.options.compress=!1),X.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){var n=this;return(0,f.Z)(function*(){n.handleClipboardPasteEvent(),n.handleExternalUpload(),n.checkingFileMessage=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CHECK"),n.loadingMessage=n.checkingFileMessage})()}handleClipboardPasteEvent(){var n=this;this.clipboardPasteEventSubscription=(0,x.R)(document.body,"paste").subscribe(function(){var p=(0,f.Z)(function*(a){if(n.isWidget&&n.isWaitingRemoteUrl||!n.canUpload())return;const R=Array.from((a.clipboardData||a.originalEvent.clipboardData).items);let Z=[];for(const k of R)if(0===k.type.indexOf("image")){const ie=k.getAsFile();ie&&Z.push(ie)}Z.length>0?yield n.preUpload(Z):n.reset()});return function(a){return p.apply(this,arguments)}}())}handleExternalUpload(){var n=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var p=(0,f.Z)(function*(a){if(a){if(!n.canUpload())return;yield n.preUpload([a.file],a.options)}else n.fileInputRef.nativeElement.click()});return function(a){return p.apply(this,arguments)}}())}handleSelectionEvent(n){var p=this;return(0,f.Z)(function*(){if(!p.canUpload())return;const a=n.target;if(a.files&&a.files.length){const R=Array.from(a.files);return a.value="",p.preUpload(R)}p.reset()})()}handleDropEvent(n){var p=this;return(0,f.Z)(function*(){var a;if(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!p.canUpload())return;const R=null!==(a=n.dataTransfer)&&void 0!==a&&a.files?Array.from(n.dataTransfer.files):[];if(R.length)return p.preUpload(R);p.reset()})()}handleRemoteUrlUpload(n,p){var a=this;return(0,f.Z)(function*(){if(!a.isRemoteUrlValid||0===a.remoteUrl.length||!a.canUpload())return;const R=a.remoteUrl;a.loadingMessage=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.GETTING_REMOTE_FILE"),a.toggleRemoteUrlForm(n,p);const Z=(0,c.Tb)(R);if(!Z.ext||-1===U.O8.findIndex(ie=>-1!==ie.ext.indexOf(Z.ext)))return a.handleErrors([Z.name],[]),void a.reset();const k=yield a.proxyService.get(R);return k?a.preUpload([new File([k],Z.name,{type:k.type,lastModified:Date.now()})]):(a.toastService.show({content:"Errore nel recupero dell'immagine dall'url!",level:M.m.ERROR}),a.postMessageService.send(s.l.UPLOAD_ERROR,{filename:Z.name,error:A.S.REMOTE_URL_RESPONSE}),void a.reset())})()}saveOptions(n=!0){this.uploaderService.uploaderOptions=this.options,n&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(n){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(n,"dragover",p=>{p.preventDefault()})}))}canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage=this.checkingFileMessage,this.postMessageService.send(s.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(n,p){var a=this;return(0,f.Z)(function*(){const R=[...a.currentFolderPath];let Z=[],k=[],ie=[],ce=[];p?p.allowOverwrite=p.allowOverwrite||!1:(p=a.uploaderService.uploaderOptions).allowOverwrite=!1;for(let $=0;$<n.length;$++){let ae=p.compress?yield a.uploaderService.compressFileIfNeeded(n[$],p.imageDimensions):n[$];if(ae=yield a.uploaderService.orientFileIfNeeded(ae),ae){const pe=(0,c.Tb)(ae.name),_e=U.O8.find(ve=>-1!==ve.ext.indexOf(pe.ext));if(!_e){ie.push(ae.name);continue}if(ae.size>_e.maxSize){ce.push(ae.name);continue}Z.push({file:{name:ae.name,size:ae.size,time:0,url:"",ext:pe.ext,filename:pe.filename,isImage:(0,c.Or)(pe.ext),embedUrl:"",type:l.VC.FILE},progress:0,completed:!1}),k.push(ae)}}if(a.handleErrors(ie,ce),0===k.length)return void a.reset();const ee=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.UPLOADING",{total:k.length}),X=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CREATING_PACKAGE",{total:k.length});a.uploadObservablesService.pushUploadingFileQueue(Z);for(let $=0;$<k.length;++$){a.loadingMessage=X;const ae=yield a.uploadService.getHostToken(R,k[$].name);Z[$].progress+=20,a.loadingMessage=ee.replace("{{current}}",`${$+1}`),yield(0,P.z)(a.uploaderService.upload(k[$],Z[$],ae,p.allowOverwrite))}a.uploadObservablesService.pushUploadingFileQueue([]);const de=Z.filter($=>!$.error).map($=>$.file);de.length>0&&(a.fileUploadedEvent.emit({list:de,rewrite:p.allowOverwrite,destPath:R}),a.postMessageService.send(s.l.UPLOAD_SUCCESS,{fileList:de.map($=>({filename:$.name,isImage:$.isImage,url:$.url}))}),p.openLinkModalAfterUpload&&a.uploadObservablesService.pushAction({name:l.In.FILE_SHOW_LINKS,payload:{entities:(0,c.jL)(de)}})),a.reset()})()}handleErrors(n,p){if(0!==n.length||0!==p.length){if(!this.isWidget)return void this.toastService.show({content:this.createToastMessage(n,p),level:M.m.ERROR});[[A.S.UNSUPPORTED,n],[A.S.OVERSIZED,p]].forEach(a=>{a[1].forEach(R=>{this.postMessageService.send(s.l.UPLOAD_ERROR,{filename:R,error:a[0]})})})}}createToastMessage(n,p){let a=[];return n.length&&a.push(n.length>1?`I file <strong>${n.join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${n[0]}</strong> ha un formato non supportato!`),p.length&&a.push(p.length>1?`I file <strong>${p.join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${p[0]}</strong> \xe8 troppo pesante!`),a.join("<br><br>")}toggleRemoteUrlForm(n,p){n.stopPropagation(),this.isWidget||(this.isWaitingRemoteUrl?null==p||p.close():null==p||p.open()),this.resetRemoteUrlForm(!this.isWaitingRemoteUrl)}resetRemoteUrlForm(n){this.isWaitingRemoteUrl=n,this.remoteUrl=""}ngOnDestroy(){var n;null===(n=this.startExternalUploadSubscription)||void 0===n||n.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return o.\u0275fac=function(n){return new(n||o)(e.Y36(y.F),e.Y36(b.C),e.Y36(I.r),e.Y36(C.q),e.Y36(r.k),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(N.sK),e.Y36(h.y))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-uploader"]],viewQuery:function(n,p){if(1&n&&e.Gf(S,5),2&n){let a;e.iGM(a=e.CRH())&&(p.fileInputRef=a.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:35,vars:37,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],[3,"title"],["optionsModal",""],[3,"innerHtml"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto",3,"innerHTML"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto",3,"innerHTML"],["size","md",3,"title","disableCloseButton","hidden"],["remoteUrlModal",""],[1,"mb-2",3,"innerHTML"],[4,"ngTemplateOutlet"],["footer",""],["type","button",1,"btn","btn-secondary",3,"innerText","click"],["type","button",1,"btn","btn-primary",3,"disabled","innerText","click"],["remoteUrlInput",""],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],["class","description text-center",3,"ngClass",4,"ngIf"],["class","input-group input-group-sm remote-url-form justify-content-center mb-1",4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"description","text-center",3,"ngClass"],[3,"innerHTML",4,"ngIf"],[1,"ms-1","remote-url-btn","fst-italic","cursor-pointer",3,"ngClass","click"],[3,"innerHTML"],[1,"input-group","input-group-sm","remote-url-form","justify-content-center","mb-1"],[1,"input-group-text","bg-light",3,"disabled","click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 16 16"],["d","M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"],[1,"input-group-text","bg-light",3,"click"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","options-icon",3,"click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","remote-url-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"],["type","text","required","",1,"form-control",3,"placeholder","ngClass","ngModel","pattern","ngModelChange"],["input","ngModel"]],template:function(n,p){if(1&n){const a=e.EpF();e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(Z){return p.handleSelectionEvent(Z)}),e.qZA(),e.YNc(3,Q,13,17,"ng-container",3),e.YNc(4,W,7,9,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6),e.ALo(8,"translate"),e._UZ(9,"div",7),e.ALo(10,"translate"),e.TgZ(11,"ul",8)(12,"li")(13,"div",9)(14,"input",10),e.NdJ("ngModelChange",function(Z){return p.options.compress=Z})("ngModelChange",function(){return p.saveOptions()}),e.qZA(),e._UZ(15,"label",11),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"li")(18,"div",9)(19,"input",12),e.NdJ("ngModelChange",function(Z){return p.options.openLinkModalAfterUpload=Z})("ngModelChange",function(){return p.saveOptions()}),e.qZA(),e._UZ(20,"label",13),e.ALo(21,"translate"),e.qZA()()()(),e.TgZ(22,"app-modal",14,15),e.NdJ("hidden",function(){return p.resetRemoteUrlForm(!1)}),e.ALo(24,"translate"),e._UZ(25,"p",16),e.ALo(26,"translate"),e.YNc(27,j,1,0,"ng-container",17),e.ynx(28,18),e.TgZ(29,"button",19),e.NdJ("click",function(){e.CHM(a);const Z=e.MAs(23);return e.KtG(Z.close())}),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",20),e.NdJ("click",function(Z){e.CHM(a);const k=e.MAs(23);return e.KtG(p.handleRemoteUrlUpload(Z,k))}),e.ALo(32,"translate"),e.qZA(),e.BQk(),e.qZA(),e.YNc(33,z,3,8,"ng-template",null,21,e.W1O)}if(2&n){const a=e.MAs(5),R=e.MAs(34);e.Q6J("ngClass",e.WLB(34,re,p.isUploading,p.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",p.loading||p.isUploading),e.xp6(2),e.Q6J("ngIf",!p.isUploading)("ngIfElse",a),e.xp6(3),e.Q6J("title",e.lcZ(8,18,"COMPONENTS.UPLOADER.SETTINGS_MODAL.TITLE")),e.xp6(3),e.Q6J("innerHtml",e.lcZ(10,20,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.DESCRIPTION"),e.oJD),e.xp6(5),e.Q6J("ngModel",p.options.compress),e.xp6(1),e.Q6J("innerHTML",e.lcZ(16,22,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.COMPRESS_SWITCH"),e.oJD),e.xp6(4),e.Q6J("ngModel",p.options.openLinkModalAfterUpload),e.xp6(1),e.Q6J("innerHTML",e.lcZ(21,24,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.SHOW_LINK_SWITCH"),e.oJD),e.xp6(2),e.Q6J("title",e.lcZ(24,26,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.TITLE"))("disableCloseButton",!0),e.xp6(3),e.Q6J("innerHTML",e.lcZ(26,28,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.CONTENT"),e.oJD),e.xp6(2),e.Q6J("ngTemplateOutlet",R),e.xp6(2),e.Q6J("innerText",e.lcZ(30,30,"SHARED.CANCEL")),e.xp6(2),e.Q6J("disabled",0===p.remoteUrl.length||!p.isRemoteUrlValid)("innerText",e.lcZ(32,32,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.UPLOAD_BTN"))}},dependencies:[m.mk,m.O5,m.tP,m.PC,_.Fj,_.Wl,_.JJ,_.Q7,_.c5,_.On,D.R,g.R,E.z,w.J,m.OU,N.X$],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864fe;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:350px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:_ngcontent-%COMP%_draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{top:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{opacity:1}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{right:5px}.uploader[_ngcontent-%COMP%]   .remote-url-icon[_ngcontent-%COMP%]{right:30px}.upload-area.cursor-pointer[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo):not(.description), .upload-area.cursor-pointer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.remote-url-btn){pointer-events:none}.remote-url-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:300px}.remote-url-form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:.5}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes _ngcontent-%COMP%_bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes _ngcontent-%COMP%_draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),o})()},529:(V,B,t)=>{"use strict";t.d(B,{M:()=>y});var f=t(4243),M=t(6814),e=t(6223),x=t(1394),P=t(2740),c=t(4610),O=t(9515),s=t(5879);let y=(()=>{class h{}return h.\u0275fac=function(r){return new(r||h)},h.\u0275mod=s.oAB({type:h}),h.\u0275inj=s.cJS({imports:[f.r,M.ez,e.u5,x.q,P.h,c.z,O.aw.forChild()]}),h})()},3845:(V,B,t)=>{"use strict";t.d(B,{S:()=>f});var f=function(M){return M.UNSUPPORTED="unsupported",M.OVERSIZED="oversized",M.REMOTE_URL_RESPONSE="remote-url-response",M.UPLOAD_FAILED="upload-failed",M}(f||{})},4243:(V,B,t)=>{"use strict";t.d(B,{r:()=>e});var f=t(6814),M=t(5879);let e=(()=>{class x{}return x.\u0275fac=function(c){return new(c||x)},x.\u0275mod=M.oAB({type:x}),x.\u0275inj=M.cJS({imports:[f.ez]}),x})()},4228:(V,B,t)=>{"use strict";t.d(B,{J:()=>M});var f=t(5879);let M=(()=>{class e{transform(P,c){return P.join(c)}}return e.\u0275fac=function(P){return new(P||e)},e.\u0275pipe=f.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},5172:(V,B,t)=>{"use strict";t.d(B,{In:()=>f,Ky:()=>P,VC:()=>M,c5:()=>x,gG:()=>e});var f=function(c){return c.FILE_SHOW_LINKS="fileLinks",c.FILE_EDIT="fileEdit",c.DELETE="delete",c.RENAME="rename",c.MOVE="move",c}(f||{}),M=function(c){return c.FILE="file",c.FOLDER="folder",c}(M||{}),e=function(c){return c.FILENAME="filename",c.SIZE="size",c.TIME="time",c.EXTENSION="ext",c}(e||{}),x=function(c){return c.GRID="grid",c.LIST="list",c}(x||{}),P=function(c){return c.W_768_I_1="(max-width: 767.98px)",c.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",c.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",c.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",c.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",c.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",c.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",c.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",c.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",c.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",c.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",c.W_3738_I_10="(min-width: 3424px)",c}(P||{})},1990:(V,B,t)=>{"use strict";t.d(B,{C7:()=>x,Mi:()=>P,O8:()=>M,er:()=>c,p0:()=>e,xt:()=>O});var f=t(5172);const M=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(s=>(s.maxSize*=1048576,s)),e={lastPath:[],layout:{asc:!0,orderBy:f.gG.FILENAME,type:f.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},x="https://upload.forumfree.net/api/",P=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,c=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,O={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},7621:(V,B,t)=>{"use strict";t.d(B,{y:()=>h});var f=t(5861),M=t(3564),e=t(708),x=t(8180),P=t(4664),c=t(2096),O=t(6306),s=t(5879),y=t(9862);let h=(()=>{class U{constructor(l,A){this.http=l,this.endpointsService=A}get(l){var A=this;return(0,f.Z)(function*(){const C=A.sendRequest(l);return yield(0,e.n)(C)})()}sendRequest(l){return this.getUrlContent(l).pipe((0,x.q)(1),(0,P.w)(A=>(0,c.of)(A)),(0,O.K)(()=>this.getUrlContentWithProxy(l)))}getUrlContent(l){return this.http.get(l,{responseType:"blob"})}getUrlContentWithProxy(l){return this.http.get(this.endpointsService.get(M.jQ.PROXY,M.ph.COMMON),{headers:{[M._o.HeaderKeys.TOKEN_TYPE]:M.s9.ACCESS,"x-remote-url":l},responseType:"blob"}).pipe((0,x.q)(1),(0,O.K)(()=>(0,c.of)(void 0)))}}return U.\u0275fac=function(l){return new(l||U)(s.LFG(y.eN),s.LFG(M.oz))},U.\u0275prov=s.Yz7({token:U,factory:U.\u0275fac,providedIn:"root"}),U})()},5983:(V,B,t)=>{"use strict";t.d(B,{B:()=>x});var f=t(5172),M=t(1410),e=t(5879);let x=(()=>{class P{constructor(O){this.globalsService=O,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(s=>{this.ffuid=s?s.user.ffuid:""})}getItem(O){const s=this.createKey(O);if(this.cache.hasOwnProperty(s))return this.cache[s]}setItem(O,s){this.cache[this.createKey(O)]=s}removeItem(O){const s=this.createKey(O);if(this.cache.hasOwnProperty(s)){if(this.cache[s].folders.length)for(const y of this.cache[s].folders)this.removeItem([...O,y.name]);return delete this.cache[s],!0}return!1}getEntities(O,s){let y={};const h=this.createKey(O);if(!this.cache.hasOwnProperty(h))return y;for(const U of s){const r=(U.type===f.VC.FILE?this.cache[h].files:this.cache[h].folders).find(l=>l.name===U.name);r&&(y[r.name]=r)}return y}addEntities(O,s,y=f.VC.FILE){const h=this.createKey(O);return!!this.cache.hasOwnProperty(h)&&(Array.isArray(s)||(s=[s]),y===f.VC.FILE?this.cache[h].files.unshift(...s):this.cache[h].folders.unshift(...s),!0)}removeEntities(O,s,y=f.VC.FILE){if(Array.isArray(s)||(s=[s]),y===f.VC.FOLDER)for(const l of s)this.removeItem([...O,l]);const h=this.createKey(O);if(!this.cache.hasOwnProperty(h))return[];const U=y===f.VC.FILE?"files":"folders";let r=[];for(const l of s){const A=this.cache[h][U].findIndex(C=>C.name===l);A>-1&&(this.cache[h][U].splice(A,1),r.push(l))}return r}refactorFolderContent(O,s){const y=this.createKey(O);if(!this.cache.hasOwnProperty(y))return!1;s.endsWith("/")||(s+="/");for(const h of this.cache[y].folders)h.url=s+h.name;for(const h of this.cache[y].files)h.url=h.embedUrl=s+h.name,h.time=Date.now();return!0}createKey(O){return`${this.ffuid}/${O.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return P.\u0275fac=function(O){return new(O||P)(e.LFG(M.d))},P.\u0275prov=e.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),P})()},5571:(V,B,t)=>{"use strict";t.d(B,{AD:()=>M,It:()=>c,ex:()=>f,mH:()=>O,r2:()=>x,vO:()=>P,xJ:()=>e});const f="\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",M="\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",e="\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",x="\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",P="\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",c="\nquery UploadHistoryAvailableDateRange {\n    uploadHistoryAvailableDateRange {\n        start\n        end\n    }\n}",O="\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}"},5487:(V,B,t)=>{"use strict";t.d(B,{r:()=>P});var f=t(8645),M=t(5619),e=t(446),x=t(5879);let P=(()=>{class c{constructor(s){this.uploadPreferencesService=s,this.selectedFileListArray=[],this.actionSubject=new f.x,this.uploadingFileQueueSubject=new f.x,this.uploadingFileErrorSubject=new f.x,this.currentFolderPathSubject=new f.x,this.layoutOptionsSubject=new f.x,this.renameEntitySubject=new f.x,this.entityPendingSubject=new f.x,this.deleteFileSubject=new f.x,this.uploadedFileSubject=new f.x,this.draggedFileListSubject=new f.x,this.startUploadSubject=new f.x,this.startMoveSubject=new f.x,this.selectedFileListSubject=new M.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(s){this.actionSubject.next(s)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(s){this.uploadPreferencesService.layoutOptions=s,this.layoutOptionsSubject.next(s)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(s){this.uploadPreferencesService.lastFolderPath=s,this.currentFolderPathSubject.next(s)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(s){this.uploadingFileQueueSubject.next(s)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(s){this.uploadingFileErrorSubject.next(s)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(s){this.renameEntitySubject.next(s)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(s){this.entityPendingSubject.next(s)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(s){this.deleteFileSubject.next(s)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(s){this.uploadedFileSubject.next(s)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(s){this.draggedFileListSubject.next(s)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(s){this.startUploadSubject.next(s)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(s){this.startMoveSubject.next(s)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(s){if(Array.isArray(s)||(s=[s]),0===s.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let y=!1;for(const h of s){const U=this.selectedFileListArray.findIndex(r=>r.name===h.name);h.selected?-1===U&&(this.selectedFileListArray.push({name:h.name}),y=!0):U>-1&&(this.selectedFileListArray.splice(U,1),y=!0)}y&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return c.\u0275fac=function(s){return new(s||c)(x.LFG(e.p))},c.\u0275prov=x.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},446:(V,B,t)=>{"use strict";t.d(B,{p:()=>c});var f=t(7165),M=t(463),e=t(1990),x=t(2986),P=t(5879);let c=(()=>{class O{constructor(y,h){this.preferencesService=y,this.urlQueryParamsService=h;const U=this.urlQueryParamsService.getAndDeleteParam(f.RT.UPLOAD_PATH);U&&(this.lastFolderPath=U.split("/").filter(r=>r.length>0))}get preferences(){return this.preferencesService.getItem(f.Ye.UPLOAD)||e.p0}set preferences(y){this.preferencesService.setItem(f.Ye.UPLOAD,y)}get lastFolderPath(){return(this.preferences.lastPath||e.p0.lastPath).filter(y=>y.length>0)}set lastFolderPath(y){const h=this.preferences;h.lastPath=y,this.preferences=h}get layoutOptions(){const y=e.p0.layout,h=this.preferences.layout;return h&&0===Object.keys(y).filter(U=>!h.hasOwnProperty(U)).length?h:y}set layoutOptions(y){const h=this.preferences;h.layout=y,this.preferences=h}get uploader(){const y=this.preferences.uploader||e.p0.uploader;return!y.checkImage.active&&Date.now()-y.checkImage.time>6048e5&&(y.checkImage.active=!0,this.uploader=y),y.hasOwnProperty("showLinkModal")||(y.showLinkModal=!1),y}set uploader(y){const h=this.preferences;h.uploader=y,this.preferences=h}}return O.\u0275fac=function(y){return new(y||O)(P.LFG(M.y),P.LFG(x.J))},O.\u0275prov=P.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"}),O})()},658:(V,B,t)=>{"use strict";t.d(B,{C:()=>A});var f=t(1413),M=t(5861),e=t(3564),x=t(4036),P=t(5172),c=t(9054),O=t(5571),s=t(5983),y=t(1990),h=t(446),U=t(4004),r=t(5879),l=t(9862);let A=(()=>{class C{constructor(b,N,m,_){this.graphqlService=b,this.uploadCacheService=N,this.uploadPreferencesService=m,this.http=_}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(e._o.HeaderKeys.UUID,(0,U.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(e._o.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(e._o.HeaderKeys.UUID)||""}getFileList(b,N){var m=this;return(0,M.Z)(function*(){const _=m.uploadCacheService.getItem(b);if(_)return _;const D=(yield m.graphqlService.query({query:O.ex,variables:{scope:N,target:b.join("/")}})).data.uploadEntitiesListToken,g=yield m.sendRequest(D),w={files:g.files.map(S=>{const J=(0,c.Tb)(S.url);return(0,f.Z)((0,f.Z)({},S),{time:1e3*S.time,filename:J.filename,ext:J.ext,isImage:(0,c.Or)(J.ext),embedUrl:`${S.url}?t=${S.time}`,type:P.VC.FILE})}),folders:g.folders.map(S=>(0,f.Z)((0,f.Z)({},S),{},{type:P.VC.FOLDER}))};return m.uploadCacheService.setItem(b,w),w})()}createDirectory(b,N){var m=this;return(0,M.Z)(function*(){const _=(yield m.graphqlService.mutate({mutation:O.xJ,variables:{scope:N,target:b.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield m.sendRequest(_)})()}moveRenameEntity(b,N,m,_,D){var g=this;return(0,M.Z)(function*(){_||(_=m);const E=(yield g.graphqlService.mutate({mutation:O.r2,variables:{scope:D,source:(b.length?`${b.join("/")}/`:"")+m,target:(N.length?`${N.join("/")}/`:"")+_}})).data.uploadEntitiesMoveToken,w=yield g.sendRequest(E);return(0,f.Z)((0,f.Z)({},w),{},{time:1e3*w.time})})()}deleteEntity(b,N,m){var _=this;return(0,M.Z)(function*(){const D=(yield _.graphqlService.mutate({mutation:O.vO,variables:{scope:m,target:(b.length?`${b.join("/")}/`:"")+N}})).data.uploadEntitiesDeleteToken;return yield _.sendRequest(D),!0})()}getHostToken(b,N,m){var _=this;return(0,M.Z)(function*(){return(yield _.graphqlService.query({query:O.AD,variables:{scope:m,target:(b.length?`${b.join("/")}/`:"")+N}})).data.uploadEntitiesHostToken})()}sendRequest(b){var N=this;return(0,M.Z)(function*(){return(yield(0,x.z)(N.http.post(y.C7,JSON.stringify({payload:b}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(b,N){var m=this;return(0,M.Z)(function*(){return yield m.graphqlService.subscribe({query:O.mH,variables:{scope:N}},_=>{var D;if(null===(D=_.data)||void 0===D||!D.uploadEntities)return;const g=JSON.parse(_.data.uploadEntities.eventMessage);!g.payload.customHeaders||!g.payload.customHeaders.hasOwnProperty(e._o.HeaderKeys.UUID)||g.payload.customHeaders[e._o.HeaderKeys.UUID]===m.getGqlIdHeader()||b({type:_.data.uploadEntities.eventType,message:g})})})()}}return C.\u0275fac=function(b){return new(b||C)(r.LFG(e.Jk),r.LFG(s.B),r.LFG(h.p),r.LFG(l.eN))},C.\u0275prov=r.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},9054:(V,B,t)=>{"use strict";t.d(B,{$H:()=>C,JN:()=>U,Lv:()=>O,Or:()=>A,Tb:()=>P,jL:()=>l,lY:()=>s,ok:()=>b,rQ:()=>N,rc:()=>I,sT:()=>y,zO:()=>c});var f=t(5861),M=t(1413),e=t(5172),x=t(1990);function P(m){let _=m;if(m.indexOf("/")>-1){const w=m.split("/");_=w[w.length-1]}const D=_.replace(/\?.*$/,"").split("."),g=D.length>1?D[D.length-1].toLowerCase():"",E=decodeURIComponent(D.slice(0,-1).join("."));return{ext:g,filename:E,name:g?`${E}.${g}`:""}}function c(m,_={}){const D=P(m),g=Date.now();return(0,M.Z)({name:D.name,size:0,time:g,url:m,ext:D.ext,filename:D.filename,isImage:A(D.ext),embedUrl:`${m}?t=${g}`,type:e.VC.FILE},_)}function O(m){let _=m;_.endsWith("/")&&(_=_.slice(0,-1));const D=_.split("/");return{name:decodeURIComponent(D[D.length-1])}}function s(m){return{name:O(m).name,url:m,type:e.VC.FOLDER}}function y(m){return h.apply(this,arguments)}function h(){return(h=(0,f.Z)(function*(m){const _=new FileReader,D=new Promise(g=>_.addEventListener("load",()=>g(_.result)));return _.readAsDataURL(m),D})).apply(this,arguments)}function U(m){return r.apply(this,arguments)}function r(){return(r=(0,f.Z)(function*(m){const _=new DataView(yield m.arrayBuffer());if(2303741511===_.getUint32(0)&&218765834===_.getUint32(4)){if(-1===[4,6].indexOf(_.getUint8(25)))return!1;const g=Object.assign(new Image,{src:yield y(m)});yield new Promise(S=>g.addEventListener("load",()=>S(!0)));const E=Object.assign(document.createElement("canvas"),{width:g.width,height:g.height}).getContext("2d");if(!E)return!1;E.imageSmoothingEnabled=!1,E.drawImage(g,0,0);const w=null==E?void 0:E.getImageData(0,0,g.width,g.height);if(w)for(let S=0;S<w.data.length;S+=4)if(w.data[S+3]<255)return!0}return!1})).apply(this,arguments)}function l(m){return m.map(_=>({name:_.name,ext:_.ext,type:e.VC.FILE,url:_.url,embedUrl:_.embedUrl,isImage:_.isImage}))}function A(m,_=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(m)&&!_.includes(m)}function C(m){return A(m,["gif","svg"])}function I(m,_,D,g=[],E=""){let w=(0,M.Z)({},x.xt);const S=m.trim();w.invalidLength=0===S.length;const J=(S+E).replace(/\s{2,}/g," ");return w.alreadyUsed=_!==S&&g.includes(J),w.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(m),w.invalidCharacter=!(D===e.VC.FILE?x.Mi.test(m):x.er.test(m)),w}function b(m,_){return m.join("/")===_.join("/")}function N(m){let _=[],D=[];for(const g of m)g.type===e.VC.FILE?_.push(g):D.push(g);return{[e.VC.FILE]:_,[e.VC.FOLDER]:D}}},4887:(V,B,t)=>{"use strict";t.d(B,{q:()=>m});var f=t(5861),M=t(1413),e=t(3705),x=t(4315),P=t.n(x),c=t(9829),O=t(9054),s=t(9862),y=t(8645),h=t(1687),U=t(9773),r=t(7621),l=t(1990),A=t(5487),C=function(_){return _[_.ORIENTATION=0]="ORIENTATION",_[_.CAMERA_MODEL=1]="CAMERA_MODEL",_}(C||{});class I{static findApp1Marker(D){const g=new DataView(D),E=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let w=0;w<D.byteLength-2;w+=2){const S=g.getUint16(w);if(65505===S)return{offset:w,size:g.getUint16(w+2),little:18761==g.getUint16(w+8,!1)};if(E.has(S))break}}static stripAndReturnExif(D){return(0,f.Z)(function*(){const g=yield D.arrayBuffer(),E=I.findApp1Marker(g);return E?{file:new File([g.slice(0,E.offset),g.slice(E.offset+E.size+2)],D.name,{type:D.type,lastModified:D.lastModified}),exif:g.slice(E.offset,E.offset+E.size)}:{file:D}})()}static checkExifTagValue(D,g){const E=new DataView(D);if(1165519206!==E.getUint32(4,!1))return;const w=18761===E.getUint16(10,!1);let S=10;S+=E.getUint32(S+4,w);const J=E.getUint16(S,w);S+=2;for(let q=0;q<J;q++){const te=E.getUint16(S+12*q,w);if(g===C.ORIENTATION&&274===te)return E.getUint16(S+12*q+8,w);if(g===C.CAMERA_MODEL&&272===te){const G=E.getUint32(S+12*q+4,w),oe=E.getUint32(S+12*q+8,w),se=new Uint8Array(D,oe,G),ne=Array.from(se);return String.fromCharCode.apply(null,ne)}}}}var b=t(5879),N=t(9582);let m=(()=>{class _{constructor(g,E,w,S){this.http=g,this.uploadObservablesService=E,this.loadImageService=w,this.proxyService=S,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return(0,M.Z)({},this.uploaderOptionsObject)}set uploaderOptions(g){this.uploaderOptionsObject=(0,M.Z)({},g)}compressFileIfNeeded(g,E){return(0,f.Z)(function*(){let w=["image/png","image/jpeg"],S={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};E&&(w.push("image/webp"),S.width=E.width,S.height=E.height,S.resize="cover",S.strict=!1);const J=g.type.toLowerCase();return g.size<=1e6&&void 0===E||-1===w.indexOf(g.type.toLowerCase())?g:("image/png"===J&&(yield(0,O.JN)(g))&&(S.convertSize=1/0),new Promise((q,te)=>{new(P())(g,(0,M.Z)((0,M.Z)({},S),{},{success:G=>{const oe=G instanceof Blob?new File([G],g.name,{type:g.type,lastModified:g.lastModified}):g;q(oe)},error:te}))}))})()}orientFileIfNeeded(g){var E=this;return(0,f.Z)(function*(){if(-1===["image/jpeg"].indexOf(g.type.toLowerCase()))return g;const S=yield I.stripAndReturnExif(g);if(g=S.file,S.exif){const J=I.checkExifTagValue(S.exif,C.CAMERA_MODEL);console.log(J,void 0!==J);const te=I.checkExifTagValue(S.exif,C.ORIENTATION);if(1!==te){let G=0;switch(te){case 3:case 4:G=180;break;case 5:case 6:G=90;break;case 7:case 8:G=270}const oe=yield(0,O.sT)(g),se=yield new Promise((le,he)=>{const ue=new Image;ue.onload=()=>le({originalImage:ue,originalBase64:oe}),ue.onerror=he,ue.src=oe}),ne=yield E.loadImageService.transformLoadedImage({original:{base64:se.originalBase64,image:se.originalImage,size:{width:se.originalImage.naturalWidth,height:se.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(te),rotate:G/90}},new c.R);g=new File([(0,e.L)(ne.transformed.base64)],g.name,{type:g.type,lastModified:Date.now()}),g=yield E.compressFileIfNeeded(g)}}return g})()}upload(g,E,w,S=!1){const J=new y.x,q=new FormData;q.append("payload",w),q.append("upload",g,g.name),S&&q.append("allowOverwrite","1");const te=this.http.request(new s.aW("POST",l.C7,q,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(te.subscribe({next:G=>{if(G.type===s.dt.UploadProgress){if(!G.total||(E.progress=Math.round(50*G.loaded/G.total)+20,E.progress<70))return;(0,h.F)(1e3).pipe((0,U.R)(J.asObservable())).subscribe(()=>{if(E.progress<95){const ne=Math.round(8*Math.random()+8);E.progress+ne>95?E.progress=95:E.progress+=ne}})}else if(G instanceof s.Zn){var oe,se;if(E.progress=100,E.completed=!0,null!==(oe=G.body)&&void 0!==oe&&oe.error||null===(se=G.body)||void 0===se||!se.success)E.error=!0,this.uploadObservablesService.pushUploadingFileError(E);else{E.file.url=G.body.success.url,E.file.time=Date.now(),E.file.embedUrl=`${E.file.url}?t=${E.file.time}`;const ne=(0,O.Tb)(E.file.url);E.file.name=ne.name,E.file.filename=ne.filename}J.next(),J.complete()}},error:()=>{E.error=!0,this.uploadObservablesService.pushUploadingFileError(E),J.next(),J.complete()}})),J.asObservable()}clearPendingRequests(){for(const g of this.requestSubscriptions)g.unsubscribe();this.requestSubscriptions=[]}}return _.\u0275fac=function(g){return new(g||_)(b.LFG(s.eN),b.LFG(A.r),b.LFG(N.y),b.LFG(r.y))},_.\u0275prov=b.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},4315:function(V){V.exports=function(){"use strict";function B(v,i){var u=Object.keys(v);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(v);i&&(d=d.filter(function(T){return Object.getOwnPropertyDescriptor(v,T).enumerable})),u.push.apply(u,d)}return u}function t(v){for(var i=1;i<arguments.length;i++){var u=null!=arguments[i]?arguments[i]:{};i%2?B(Object(u),!0).forEach(function(d){x(v,d,u[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(u)):B(Object(u)).forEach(function(d){Object.defineProperty(v,d,Object.getOwnPropertyDescriptor(u,d))})}return v}function M(v,i){for(var u=0;u<i.length;u++){var d=i[u];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(v,O(d.key),d)}}function x(v,i,u){return(i=O(i))in v?Object.defineProperty(v,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):v[i]=u,v}function P(){return P=Object.assign?Object.assign.bind():function(v){for(var i=1;i<arguments.length;i++){var u=arguments[i];for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(v[d]=u[d])}return v},P.apply(this,arguments)}function O(v){var i=function c(v,i){if("object"!=typeof v||null===v)return v;var u=v[Symbol.toPrimitive];if(void 0!==u){var d=u.call(v,i||"default");if("object"!=typeof d)return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(v)}(v,"string");return"symbol"==typeof i?i:String(i)}var v,i,u,d,T,L,Q,K,s={exports:{}};v=s,typeof window>"u"||(i=window,u=i.HTMLCanvasElement&&i.HTMLCanvasElement.prototype,d=i.Blob&&function(){try{return!!new Blob}catch(W){return!1}}(),T=d&&i.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(W){return!1}}(),L=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder,Q=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,K=(d||L)&&i.atob&&i.ArrayBuffer&&i.Uint8Array&&function(W){var j,H,z,re,Y,o,F,n,p;if(!(j=W.match(Q)))throw new Error("invalid data URI");for(H=j[2]?j[1]:"text/plain"+(j[3]||";charset=US-ASCII"),z=!!j[4],re=W.slice(j[0].length),Y=z?atob(re):decodeURIComponent(re),o=new ArrayBuffer(Y.length),F=new Uint8Array(o),n=0;n<Y.length;n+=1)F[n]=Y.charCodeAt(n);return d?new Blob([T?F:o],{type:H}):((p=new L).append(o),p.getBlob(H))},i.HTMLCanvasElement&&!u.toBlob&&(u.mozGetAsFile?u.toBlob=function(W,j,H){var z=this;setTimeout(function(){W(H&&u.toDataURL&&K?K(z.toDataURL(j,H)):z.mozGetAsFile("blob",j))})}:u.toDataURL&&K&&(u.toBlob=u.msToBlob?function(W,j,H){var z=this;setTimeout(function(){W((j&&"image/png"!==j||H)&&u.toDataURL&&K?K(z.toDataURL(j,H)):z.msToBlob(j))})}:function(W,j,H){var z=this;setTimeout(function(){W(K(z.toDataURL(j,H)))})})),v.exports?v.exports=K:i.dataURLtoBlob=K);var y=s.exports,U={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},l=typeof window<"u"&&typeof window.document<"u"?window:{},A=function(i){return i>0&&i<1/0},C=Array.prototype.slice;function I(v){return Array.from?Array.from(v):C.call(v)}var b=/^image\/.+$/;function N(v){return b.test(v)}var _=String.fromCharCode;var g=l.btoa;function E(v,i){for(var u=[],T=new Uint8Array(v);T.length>0;)u.push(_.apply(null,I(T.subarray(0,8192)))),T=T.subarray(8192);return"data:".concat(i,";base64,").concat(g(u.join("")))}function w(v){var u,i=new DataView(v);try{var d,T,L;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var Q=i.byteLength,K=2;K+1<Q;){if(255===i.getUint8(K)&&225===i.getUint8(K+1)){T=K;break}K+=1}if(T){var j=T+10;if("Exif"===function D(v,i,u){var T,d="";for(u+=i,T=i;T<u;T+=1)d+=_(v.getUint8(T));return d}(i,T+4,4)){var H=i.getUint16(j);if(((d=18761===H)||19789===H)&&42===i.getUint16(j+2,d)){var z=i.getUint32(j+4,d);z>=8&&(L=j+z)}}}if(L){var Y,o,re=i.getUint16(L,d);for(o=0;o<re;o+=1)if(274===i.getUint16(Y=L+12*o+2,d)){u=i.getUint16(Y+=8,d),i.setUint16(Y,1,d);break}}}catch(F){u=1}return u}var J=/\.\d*(?:0|9){12}\d*$/;function q(v){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return J.test(v)?Math.round(v*i)/i:v}function te(v){var i=v.aspectRatio,u=v.height,d=v.width,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",L=A(d),Q=A(u);if(L&&Q){var K=u*i;("contain"===T||"none"===T)&&K>d||"cover"===T&&K<d?u=d/i:d=u*i}else L?u=d/i:Q&&(d=u*i);return{width:d,height:u}}var se=l.ArrayBuffer,ne=l.FileReader,le=l.URL||l.webkitURL,he=/\.\w+$/,ue=l.Compressor,Ee=function(){function v(i,u){(function f(v,i){if(!(v instanceof i))throw new TypeError("Cannot call a class as a function")})(this,v),this.file=i,this.exif=[],this.image=new Image,this.options=t(t({},U),u),this.aborted=!1,this.result=null,this.init()}return function e(v,i,u){return i&&M(v.prototype,i),u&&M(v,u),Object.defineProperty(v,"prototype",{writable:!1}),v}(v,[{key:"init",value:function(){var u=this,d=this.file,T=this.options;if(function(i){return!(typeof Blob>"u")&&(i instanceof Blob||"[object Blob]"===Object.prototype.toString.call(i))}(d)){var L=d.type;if(N(L))if(le&&ne){se||(T.checkOrientation=!1,T.retainExif=!1);var Q="image/jpeg"===L,K=Q&&T.checkOrientation,W=Q&&T.retainExif;if(!le||K||W){var j=new ne;this.reader=j,j.onload=function(H){var re=H.target.result,Y={},o=1;K&&(o=w(re))>1&&P(Y,function S(v){var i=0,u=1,d=1;switch(v){case 2:u=-1;break;case 3:i=-180;break;case 4:d=-1;break;case 5:i=90,d=-1;break;case 6:i=90;break;case 7:i=90,u=-1;break;case 8:i=-90}return{rotate:i,scaleX:u,scaleY:d}}(o)),W&&(u.exif=function G(v){for(var i=I(new Uint8Array(v)),u=i.length,d=[],T=0;T+3<u;){var L=i[T],Q=i[T+1];if(255===L&&218===Q)break;if(255===L&&216===Q)T+=2;else{var W=T+(256*i[T+2]+i[T+3])+2,j=i.slice(T,W);d.push(j),T=W}}return d.reduce(function(H,z){return 255===z[0]&&225===z[1]?H.concat(z):H},[])}(re)),Y.url=K||W?!le||o>1?E(re,L):le.createObjectURL(d):re,u.load(Y)},j.onabort=function(){u.fail(new Error("Aborted to read the image with FileReader."))},j.onerror=function(){u.fail(new Error("Failed to read the image with FileReader."))},j.onloadend=function(){u.reader=null},K||W?j.readAsArrayBuffer(d):j.readAsDataURL(d)}else this.load({url:le.createObjectURL(d)})}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(u){var d=this,T=this.file,L=this.image;L.onload=function(){d.draw(t(t({},u),{},{naturalWidth:L.naturalWidth,naturalHeight:L.naturalHeight}))},L.onabort=function(){d.fail(new Error("Aborted to load the image."))},L.onerror=function(){d.fail(new Error("Failed to load the image."))},l.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(l.navigator.userAgent)&&(L.crossOrigin="anonymous"),L.alt=T.name,L.src=u.url}},{key:"draw",value:function(u){var d=this,T=u.naturalWidth,L=u.naturalHeight,Q=u.rotate,K=void 0===Q?0:Q,W=u.scaleX,j=void 0===W?1:W,H=u.scaleY,z=void 0===H?1:H,re=this.file,Y=this.image,o=this.options,F=document.createElement("canvas"),n=F.getContext("2d"),p=Math.abs(K)%180==90,a=("contain"===o.resize||"cover"===o.resize)&&A(o.width)&&A(o.height),R=Math.max(o.maxWidth,0)||1/0,Z=Math.max(o.maxHeight,0)||1/0,k=Math.max(o.minWidth,0)||0,ie=Math.max(o.minHeight,0)||0,ce=T/L,ee=o.width,X=o.height;if(p){var de=[Z,R];R=de[0],Z=de[1];var $=[ie,k];k=$[0],ie=$[1];var ae=[X,ee];ee=ae[0],X=ae[1]}a&&(ce=ee/X);var pe=te({aspectRatio:ce,width:R,height:Z},"contain");R=pe.width,Z=pe.height;var _e=te({aspectRatio:ce,width:k,height:ie},"cover");if(k=_e.width,ie=_e.height,a){var ve=te({aspectRatio:ce,width:ee,height:X},o.resize);ee=ve.width,X=ve.height}else{var xe=te({aspectRatio:ce,width:ee,height:X}),Ue=xe.width;ee=void 0===Ue?T:Ue;var be=xe.height;X=void 0===be?L:be}var Be=-(ee=Math.floor(q(Math.min(Math.max(ee,k),R))))/2,Fe=-(X=Math.floor(q(Math.min(Math.max(X,ie),Z))))/2,We=ee,je=X,Oe=[];if(a){var Ae,Me,Ce=te({aspectRatio:ce,width:T,height:L},{contain:"cover",cover:"contain"}[o.resize]);Oe.push((T-(Ae=Ce.width))/2,(L-(Me=Ce.height))/2,Ae,Me)}if(Oe.push(Be,Fe,We,je),p){var De=[X,ee];ee=De[0],X=De[1]}F.width=ee,F.height=X,N(o.mimeType)||(o.mimeType=re.type);var Ie="transparent";re.size>o.convertSize&&o.convertTypes.indexOf(o.mimeType)>=0&&(o.mimeType="image/jpeg");var Le="image/jpeg"===o.mimeType;if(Le&&(Ie="#fff"),n.fillStyle=Ie,n.fillRect(0,0,ee,X),o.beforeDraw&&o.beforeDraw.call(this,n,F),!this.aborted&&(n.save(),n.translate(ee/2,X/2),n.rotate(K*Math.PI/180),n.scale(j,z),n.drawImage.apply(n,[Y].concat(Oe)),n.restore(),o.drew&&o.drew.call(this,n,F),!this.aborted)){var Re=function(fe){if(!d.aborted){var Se=function(me){return d.done({naturalWidth:T,naturalHeight:L,result:me})};if(fe&&Le&&o.retainExif&&d.exif&&d.exif.length>0){var we=function(me){return Se(y(E(function oe(v,i){var u=I(new Uint8Array(v));if(255!==u[2]||224!==u[3])return v;var T=[255,216].concat(i,u.slice(4+(256*u[4]+u[5])));return new Uint8Array(T)}(me,d.exif),o.mimeType)))};if(fe.arrayBuffer)fe.arrayBuffer().then(we).catch(function(){d.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var ge=new ne;d.reader=ge,ge.onload=function(ye){we(ye.target.result)},ge.onabort=function(){d.fail(new Error("Aborted to read the compressed image with FileReader."))},ge.onerror=function(){d.fail(new Error("Failed to read the compressed image with FileReader."))},ge.onloadend=function(){d.reader=null},ge.readAsArrayBuffer(fe)}}else Se(fe)}};F.toBlob?F.toBlob(Re,o.mimeType,o.quality):Re(y(F.toDataURL(o.mimeType,o.quality)))}}},{key:"done",value:function(u){var d=u.naturalWidth,T=u.naturalHeight,L=u.result,Q=this.file,K=this.image,W=this.options;if(le&&0===K.src.indexOf("blob:")&&le.revokeObjectURL(K.src),L)if(W.strict&&!W.retainExif&&L.size>Q.size&&W.mimeType===Q.type&&!(W.width>d||W.height>T||W.minWidth>d||W.minHeight>T||W.maxWidth<d||W.maxHeight<T))L=Q;else{var j=new Date;L.lastModified=j.getTime(),L.lastModifiedDate=j,L.name=Q.name,L.name&&L.type!==Q.type&&(L.name=L.name.replace(he,function m(v){var i=N(v)?v.substr(6):"";return"jpeg"===i&&(i="jpg"),".".concat(i)}(L.type)))}else L=Q;this.result=L,W.success&&W.success.call(this,L)}},{key:"fail",value:function(u){var d=this.options;if(!d.error)throw u;d.error.call(this,u)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ue,v}},{key:"setDefaults",value:function(u){P(U,u)}}]),v}();return Ee}()},1687:(V,B,t)=>{"use strict";t.d(B,{F:()=>e});var f=t(6321),M=t(4825);function e(x=0,P=f.z){return x<0&&(x=0),(0,M.H)(x,x,P)}},4004:(V,B,t)=>{"use strict";t.d(B,{Z:()=>U});const M={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let e;const x=new Uint8Array(16);function P(){if(!e&&(e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(x)}const c=[];for(let r=0;r<256;++r)c.push((r+256).toString(16).slice(1));const U=function h(r,l,A){if(M.randomUUID&&!l&&!r)return M.randomUUID();const C=(r=r||{}).random||(r.rng||P)();if(C[6]=15&C[6]|64,C[8]=63&C[8]|128,l){A=A||0;for(let I=0;I<16;++I)l[A+I]=C[I];return l}return function O(r,l=0){return(c[r[l+0]]+c[r[l+1]]+c[r[l+2]]+c[r[l+3]]+"-"+c[r[l+4]]+c[r[l+5]]+"-"+c[r[l+6]]+c[r[l+7]]+"-"+c[r[l+8]]+c[r[l+9]]+"-"+c[r[l+10]]+c[r[l+11]]+c[r[l+12]]+c[r[l+13]]+c[r[l+14]]+c[r[l+15]]).toLowerCase()}(C)}}}]);