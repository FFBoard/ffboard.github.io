"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[625],{3285:(F,O,d)=>{d.d(O,{L:()=>k});var b=d(9300),n=d(7165),a=d(9212);let L=(()=>{var o;class v{constructor(){this.dependencies={[n.B2.LOGIN]:null,[n.B2.HOME]:null,[n.B2.SETTINGS]:n.B2.HOME,[n.B2.SCRIPT]:n.B2.HOME,[n.B2.SCRIPT_FORUM]:n.B2.SCRIPT,[n.B2.SCRIPT_USER]:n.B2.SCRIPT,[n.B2.SCRIPT_SETTINGS]:[n.B2.SCRIPT_USER,n.B2.SCRIPT_FORUM],[n.B2.SCRIPT_SANDBOX]:[n.B2.SCRIPT_USER,n.B2.SCRIPT_FORUM],[n.B2.SCRIPT_DEV]:n.B2.SCRIPT,[n.B2.SCRIPT_DEV_SETTINGS]:n.B2.SCRIPT_DEV,[n.B2.UPLOAD]:n.B2.HOME,[n.B2.ADMIN]:n.B2.HOME,[n.B2.STATS]:n.B2.HOME,[n.B2.STATS_UPLOAD]:n.B2.STATS},this.names={[n.B2.LOGIN]:"Login",[n.B2.HOME]:"Home",[n.B2.SETTINGS]:"Notifiche",[n.B2.SCRIPT]:"Script",[n.B2.SCRIPT_FORUM]:"Forum",[n.B2.SCRIPT_USER]:"Utenti",[n.B2.SCRIPT_SETTINGS]:"Impostazioni",[n.B2.SCRIPT_SANDBOX]:"Altro",[n.B2.SCRIPT_DEV]:"Sviluppo",[n.B2.SCRIPT_DEV_SETTINGS]:"Impostazioni",[n.B2.UPLOAD]:"Upload",[n.B2.ADMIN]:"Amministrazione",[n.B2.STATS]:"Statistiche",[n.B2.STATS_UPLOAD]:"Upload"}}createPathList(S,I=[]){const G=(B,E)=>{B.unshift({name:this.names[E]||"",path:E})},P=B=>(0,b.o8)(this.dependencies,B)?this.dependencies[B]instanceof Array?this.dependencies[B].includes(I[0])?I.shift():this.dependencies[B][0]:this.dependencies[B]:null,D=[{name:this.names[S]||"",path:""}];let y=P(S);for(;y;)G(D,y),y=P(y);return D}}return(o=v).\u0275fac=function(S){return new(S||o)},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),v})();var f=d(4190),C=d(6814);function T(o,v){if(1&o&&a._UZ(0,"a",8),2&o){const h=a.oxw().$implicit;a.Q6J("routerLink",h.path)("innerText",h.name)}}function p(o,v){if(1&o&&a._UZ(0,"span",9),2&o){const h=a.oxw().$implicit;a.Q6J("innerText",h.name)}}const R=o=>({active:o});function M(o,v){if(1&o&&(a.TgZ(0,"li",5),a.YNc(1,T,1,2,"a",6)(2,p,1,1,"ng-template",null,7,a.W1O),a.qZA()),2&o){const h=v.last,S=a.MAs(3);a.Q6J("ngClass",a.VKq(4,R,h)),a.uIk("aria-current",h?"page":null),a.xp6(),a.Q6J("ngIf",!h)("ngIfElse",S)}}const w=o=>({"hide-nav":o}),N=o=>({"d-none d-md-block":o});let k=(()=>{var o;class v{constructor(S,I){this.breadcrumbService=S,this.router=I,this.pageTitle="",this.url="",this.nodes=[],this.hideNavOnSmallScreen=!1,this.breadcrumbs=[]}ngOnInit(){this.url||(this.url=this.router.url),this.breadcrumbs=this.breadcrumbService.createPathList(this.url,this.nodes)}}return(o=v).\u0275fac=function(S){return new(S||o)(a.Y36(L),a.Y36(f.F0))},o.\u0275cmp=a.Xpm({type:o,selectors:[["app-breadcrumb"]],inputs:{pageTitle:"pageTitle",url:"url",nodes:"nodes",hideNavOnSmallScreen:"hideNavOnSmallScreen"},decls:5,vars:8,consts:[[1,"container-fluid","px-md-1","d-flex","flex-column","flex-md-row","align-items-md-center",3,"ngClass"],[1,"h3","fw-light","mb-0","lh-1","fv-small-caps","pb-1",3,"innerText"],["aria-label","breadcrumb",1,"ms-md-auto","mt-1","flex-shrink-0",3,"ngClass"],[1,"breadcrumb","mb-0","justify-content-md-end"],["class","breadcrumb-item",3,"ngClass",4,"ngFor","ngForOf"],[1,"breadcrumb-item",3,"ngClass"],[3,"routerLink","innerText",4,"ngIf","ngIfElse"],["lastItem",""],[3,"routerLink","innerText"],[3,"innerText"]],template:function(S,I){1&S&&(a.TgZ(0,"div",0),a._UZ(1,"h2",1),a.TgZ(2,"nav",2)(3,"ol",3),a.YNc(4,M,4,6,"li",4),a.qZA()()()),2&S&&(a.Q6J("ngClass",a.VKq(4,w,I.hideNavOnSmallScreen)),a.xp6(),a.Q6J("innerText",I.pageTitle),a.xp6(),a.Q6J("ngClass",a.VKq(6,N,I.hideNavOnSmallScreen)),a.xp6(2),a.Q6J("ngForOf",I.breadcrumbs))},dependencies:[C.mk,C.sg,C.O5,f.rH],styles:[".container-fluid[_ngcontent-%COMP%]:not(.hide-nav){margin-bottom:.75rem}.container-fluid.hide-nav[_ngcontent-%COMP%]{margin-bottom:.5rem}@media (min-width: 768px){.container-fluid.hide-nav[_ngcontent-%COMP%]{margin-bottom:.75rem}}@media (min-width: 960px){.container-fluid[_ngcontent-%COMP%]{margin-top:.5rem}}"]}),v})()},9090:(F,O,d)=>{d.d(O,{w:()=>L});var b=d(6814),n=d(4190),a=d(9212);let L=(()=>{var f;class C{}return(f=C).\u0275fac=function(p){return new(p||f)},f.\u0275mod=a.oAB({type:f}),f.\u0275inj=a.cJS({imports:[b.ez,n.Bz]}),C})()},3040:(F,O,d)=>{d.d(O,{AH:()=>f,M$:()=>p,Mu:()=>b,RK:()=>a,gD:()=>C,nm:()=>T,rJ:()=>L,v1:()=>n});const b="\nquery FullScript($id: String!, $type: ScriptTargetTypeEnum!) {\n    scriptList {\n        scriptId\n        type\n        author\n        name\n        description\n        faqLink\n        preview\n        publisher\n        source\n        sourceBeta\n        position\n        sandboxes {\n            name\n            slug\n            value\n            inSettings\n        }\n        packages\n        dependencies\n        settingsSchema\n        settingsDefault\n        html\n        hidden\n        cpQuirks\n        cpStandard\n        cpMobile\n        webhook\n        webhookCallOnSettings\n        webhookCallOnManage\n    }\n    scriptSettings(targetId: $id, targetType: $type) {\n        scriptId,\n        settings,\n    }\n    scriptInstalledList(targetId: $id, targetType: $type)\n    scriptRankedList {\n        scriptId\n        scriptRank\n    }\n    scriptPermissions {\n        scriptId\n        manage\n        edit\n        settings\n    }\n}",n="\nquery Script($id: String!, $type: ScriptTargetTypeEnum!) {\n    scriptSettings(targetId: $id, targetType: $type) {\n        scriptId,\n        settings,\n    }\n    scriptInstalledList(targetId: $id, targetType: $type)\n}",a="\nquery ScriptStats {\n    scriptStats {\n        scriptId\n        entities {\n            targetId\n            targetType\n        }\n    }\n}",L="\nmutation DelCache($scriptId: String!) {\n    delCache(scriptId: $scriptId)\n}",f="\nmutation ScriptUpsert($scriptId: String, $type: String, $name: String, $description: String, $faqLink: String, $preview: String, $publisher: String, $source: String, $sourceBeta: String, $sandboxes: [JSSandboxInput!], $position: String, $packages: [String], $dependencies: [String], $settingsSchema: String, $settingsDefault: String, $html: String, $hidden: Boolean, $cpQuirks: Boolean, $cpStandard: Boolean, $cpMobile: Boolean, $webhook: String, $webhookCallOnSettings: Boolean, $whManage: Boolean) {\n    scriptUpsert(scriptId: $scriptId, type: $type, name: $name, description: $description, faqLink: $faqLink, preview: $preview, publisher: $publisher, source: $source, sourceBeta: $sourceBeta, sandboxes: $sandboxes, position: $position, packages: $packages, dependencies: $dependencies, settingsSchema: $settingsSchema, settingsDefault: $settingsDefault, html: $html, hidden: $hidden, cpQuirks: $cpQuirks, cpStandard: $cpStandard, cpMobile: $cpMobile, webhook: $webhook, webhookCallOnSettings: $webhookCallOnSettings, whManage: $whManage)\n}",C="\nmutation DelScript($scriptId: String!) {\n    delScript(scriptId: $scriptId)\n}",T="\nmutation ScriptManage(\n    $targetId: String!,\n    $targetType: ScriptTargetTypeEnum!,\n    $scriptId: String!,\n    $action: ScriptManageActionEnum!\n) {\n    scriptManage(\n        targetId: $targetId,\n        targetType: $targetType,\n        scriptId: $scriptId,\n        action: $action\n    )\n}",p="\nmutation ScriptSettings(\n    $targetId: String!,\n    $targetType: ScriptTargetTypeEnum!,\n    $scriptId: String!,\n    $settings: String!\n) {\n    scriptSettings(\n        targetId: $targetId,\n        targetType: $targetType,\n        scriptId: $scriptId,\n        settings: $settings\n    )\n}"},6245:(F,O,d)=>{d.d(O,{o:()=>j});var b=d(5861),n=d(8645),a=d(5619),L=d(4036),f=d(2181),C=d(1410),T=d(9300),p=d(3729),R=d(4064);const M=/^whitelist\[([^\]]*)]/i;function k(e){const l=e.match(M);let g=[],t=[];if(l){const s=l[1].toLowerCase().split(",");g=s.reduce((r,i)=>{const c=i.match(/^(ff|fc|bf)u(\d+)/);return c&&r.push(c[1]+c[2]),r},[]),t=s.filter(r=>/^(ff|fc|bf)\d+/.test(r))}return{users:g,forums:t}}function o(e){return e.replace(M,"").trim()}function v(e,l,g,t=[],s){const r={};return{list:e.reduce((c,u)=>{const $=[...new Set([...I(u.permissions,l),...t])];return!$.includes(p.Af.EDIT)&&S(u,g)||0===$.length||s&&!s.every(U=>$.includes(U))||(r[u.id]=$,c.push(u)),c},[]),permissions:r}}function S(e,l){return!!e.privacy.hidden&&(!l||l.type===p.D7.USER&&!e.privacy.allowed.users.includes(l.id)||l.type===p.D7.FORUM&&!e.privacy.allowed.forums.includes(l.id))}function I(e,l){return l?[...D(l,e)?[p.Af.SETTINGS]:[],...G(l,e)?[p.Af.EDIT]:[],...P(l,e)?[p.Af.MANAGE]:[]]:[]}function G(e,l){return l.edit.includes(e)}function P(e,l){return l.manage.includes(e)}function D(e,l){return l.settings.includes(e)}var y=d(7165),B=d(463),E=d(3040),A=d(9212);let j=(()=>{var e;class l{constructor(t,s,r){this.graphqlService=t,this.globalsService=s,this.preferencesService=r,this.installedScript={cacheKey:"",list:[]},this.lastRequestTime=0,this.scriptCache={},this.scriptFilteredByPermissionsCache={},this.listInputsSubject=new n.x,this.isRequestingListSubject=new a.X(!1),this.profileSubscription=this.globalsService.profileObservable.subscribe(i=>{this.ffuid=null==i?void 0:i.user.ffuid})}createCacheKey(t,s){return t+s+this.ffuid}isCurrentUserForumAdmin(t){return!(!this.globalsService.forum||this.globalsService.forum.cid!==t||!this.globalsService.forum.admin)}getData(t,s=p.D7.FORUM,r=!0){var i=this;return(0,b.Z)(function*(){if(i.isRequestingListSubject.value&&(yield(0,L.z)(i.isRequestingListSubject.pipe((0,f.h)(m=>!m)))),!i.ffuid||!t)return{list:[],settings:{},permissions:{}};const c=i.createCacheKey(t,s),u=Date.now()-i.lastRequestTime>18e5;if(i.installedScript={cacheKey:c,list:[]},!u){if(!r)return{list:i.scriptList,settings:{},permissions:{}};if((0,T.o8)(i.scriptCache,c))return i.installedScript.list=i.scriptCache[c].installedList,i.scriptCache[c]}i.isRequestingListSubject.next(!0);let $,U=[];if(u){i.clearCache(),i.lastRequestTime=Date.now();const m=yield i.graphqlService.query({query:E.Mu,variables:{id:t,type:s}});i.scriptList=function w(e,l,g){const t={},s=e.map(r=>{const i=function N(e,l,g,t){var s;return{author:R.vs[e.author]||R.vs.ff7482873,dependencies:{parents:e.dependencies.reduce((r,i)=>{const c=l.find(u=>u.scriptId===i);return c&&r.push({id:c.scriptId,name:o(c.name)}),r},[]),children:[]},description:e.description,docs:{link:e.faqLink},html:e.html,id:e.scriptId,layouts:{quirks:e.cpQuirks,standard:e.cpStandard,mobile:e.cpMobile},name:o(e.name),packages:e.packages,permissions:{manage:(null==t?void 0:t.manage)||[],edit:(null==t?void 0:t.edit)||[],settings:(null==t?void 0:t.settings)||[]},preview:e.preview,privacy:{hidden:e.hidden,allowed:k(e.name)},publisher:R.Oh[e.publisher]||R.Oh[p.tr.OTHER],rank:(null===(s=g.find(r=>r.scriptId===e.scriptId))||void 0===s?void 0:s.scriptRank)||999,sandboxes:e.sandboxes,settings:{default:e.settingsDefault,schema:"{}"!==e.settingsSchema?e.settingsSchema:void 0},sources:{prod:e.source,beta:e.sourceBeta,position:e.position},type:e.type,webhook:{source:e.webhook,calls:{onManage:e.webhookCallOnManage,onSettings:e.webhookCallOnSettings}}}}(r,e,l,g.find(c=>c.scriptId===r.scriptId));for(const c of Object.keys(i.dependencies.parents))(0,T.o8)(t,c)||(t[c]=[]),t[c].push({id:i.id,name:i.name});return i});for(const[r,i]of Object.entries(t)){const c=s.find(u=>u.id===r);c&&(c.dependencies.children=i)}return s}(m.data.scriptList,m.data.scriptRankedList,m.data.scriptPermissions),$=m.data}else $=(yield i.graphqlService.query({query:E.v1,variables:{id:t,type:s}})).data;if(!r)return i.isRequestingListSubject.next(!1),{list:i.scriptList,settings:{},permissions:{}};i.installedScript.list=$.scriptInstalledList.filter(m=>i.scriptList.findIndex(x=>x.id===m)>-1),U=$.scriptSettings;const _=s===p.D7.FORUM?p.AV.FORUM:p.AV.USER,H=s===p.D7.FORUM&&i.isCurrentUserForumAdmin(t)||s===p.D7.USER&&t===i.ffuid?[p.Af.SETTINGS,p.Af.MANAGE]:[],K=v(i.scriptList.filter(m=>m.type===_||m.type===p.AV.ALL),i.ffuid,{id:t,type:s},H);return i.scriptCache[c]={list:K.list,installedList:i.installedScript.list,settings:U.reduce((m,x)=>(m[x.scriptId]=x.settings,m),{}),permissions:K.permissions},i.isRequestingListSubject.next(!1),i.scriptCache[c]})()}splitTabs(t){const s={};for(const r of t)(0,T.o8)(s,r.publisher.id)?s[r.publisher.id].push(r):s[r.publisher.id]=[r];return s}getListInputsObservable(){return this.listInputsSubject.asObservable()}pushListInputs(t){this.listInputsSubject.next(t),this.listInputs=t}get listInputs(){return this.listInputsData}set listInputs(t){this.listInputsData=t}updateInstalledScriptList(t,s){if(s)this.installedScript.list.push(t);else{const r=this.installedScript.list.indexOf(t);r>-1&&this.installedScript.list.splice(r,1)}this.scriptCache[this.installedScript.cacheKey].installedList=this.installedScript.list}get installedList(){return this.installedScript.list}getSingleScriptData(t,s,r){var i=this;return(0,b.Z)(function*(){const c=yield i.getData(s,r),u=c.list.find($=>$.id===t);if(u)return{script:u,installed:i.installedList.includes(u.id),settings:c.settings[u.id],permissions:c.permissions[u.id]}})()}updateInstalledScriptSettings(t,s,r,i){const c=this.createCacheKey(t,s);this.scriptCache[c]&&(this.scriptCache[c].settings[r]=i)}getScriptsByPermissions(t){var s=this;return(0,b.Z)(function*(){if(!s.ffuid)return{list:[],permissions:{}};const r="".concat(s.ffuid,":").concat(t.join("-"));if((0,T.o8)(s.scriptFilteredByPermissionsCache,r))return s.scriptFilteredByPermissionsCache[r];const i=(yield s.getData(s.ffuid,p.D7.USER,!1)).list;return s.scriptFilteredByPermissionsCache[r]=v(i,s.ffuid,{id:s.ffuid,type:p.D7.USER},[],t)})()}clearCache(){this.lastRequestTime=0,this.scriptList=void 0,this.scriptCache={},this.scriptFilteredByPermissionsCache={}}getAllScripts(){var t=this;return(0,b.Z)(function*(){return(yield t.getData(t.ffuid,p.D7.USER,!1)).list})()}getAllVisibleScripts(){var t=this;return(0,b.Z)(function*(){var s;const r=null===(s=t.globalsService.forum)||void 0===s?void 0:s.cid;return function h(e,l,g){return e.reduce((t,s)=>{const r=g?I(s.permissions,g):[],i=l.length?!l.map(c=>S(s,c)).includes(!1):s.privacy.hidden;return!r.includes(p.Af.EDIT)&&i||t.push(s),t},[])}(yield t.getAllScripts(),[...t.ffuid?[{id:t.ffuid,type:p.D7.USER}]:[],...r?[{id:r,type:p.D7.FORUM}]:[]],t.ffuid)})()}get settingsOptions(){return this.preferencesService.getItem(y.Ye.SCRIPT_SETTINGS_OPTIONS)||R.OH}set settingsOptions(t){this.preferencesService.setItem(y.Ye.SCRIPT_SETTINGS_OPTIONS,t)}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return(e=l).\u0275fac=function(t){return new(t||e)(A.LFG(T.Jk),A.LFG(C.d),A.LFG(B.y))},e.\u0275prov=A.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),l})()}}]);