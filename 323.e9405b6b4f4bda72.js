"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[323],{431:(I,R,a)=>{a.r(R),a.d(R,{ScriptSandboxModule:()=>Q});var T=a(9090),S=a(6814),x=a(2630),D=a(259),h=a(2655),i=a(1874),b=a(5861),f=a(7165),C=a(1410),U=a(6245),y=a(3729),n=a(137),o=a(8645),v=a(9773),p=a(6306),t=a(5879),M=a(3285),O=a(146),F=a(9473),N=a(7980);function E(r,m){1&r&&t._UZ(0,"app-forum-required")}function Z(r,m){if(1&r&&t._UZ(0,"app-loader",5),2&r){const d=t.oxw(2);t.Q6J("message",d.loaderMessage)}}const B=function(r){return{"d-none":r}},J=function(){return["bg-light"]};function Y(r,m){if(1&r){const d=t.EpF();t.ynx(0),t.TgZ(1,"app-sandbox",6),t.NdJ("loadEvent",function(){t.CHM(d);const l=t.oxw(2);return t.KtG(l.sandboxLoaded())}),t.qZA(),t.BQk()}if(2&r){const d=t.oxw(2);t.xp6(1),t.Q6J("ngClass",t.VKq(7,B,d.sandbox.loading))("head",d.sandbox.headData)("body",d.sandbox.bodyData)("bodyClass",t.DdM(9,J))("initData",d.sandbox.initData)("eventsObservable",d.sandbox.eventObservable)("resetMainPadding",!0)}}function P(r,m){if(1&r&&(t.YNc(0,Z,1,1,"app-loader",3),t.YNc(1,Y,2,10,"ng-container",4)),2&r){const d=t.oxw();t.Q6J("ngIf",!d.sandbox||d.sandbox.loading),t.xp6(1),t.Q6J("ngIf",d.sandbox)}}const A=[{path:"",component:(()=>{var r;class m{constructor(e,l,s,c,u,g){this.activatedRoute=e,this.router=l,this.globalsService=s,this.scriptListService=c,this.scriptSandboxService=u,this.tokensService=g,this.loaderMessage="Recupero dei dati",this.breadcrumbUrl=f.B2.SCRIPT_SANDBOX,this.breadcrumbNodes=[],this.breadcrumbTitle="",this.forumRequired=!1,this.isForum=!1,this.targetType=y.D7.USER,this.componentDestroyed=new o.x,this.forum=this.globalsService.forum}ngOnInit(){var e=this;return(0,b.Z)(function*(){var l;const s=e.activatedRoute.snapshot.paramMap.get("scriptId"),c=e.activatedRoute.snapshot.paramMap.get("sandboxSlug")||"";e.targetType=(null===(l=e.activatedRoute.parent)||void 0===l?void 0:l.snapshot.data.type)||y.D7.USER,e.isForum=e.targetType===y.D7.FORUM,s?(e.breadcrumbNodes=[e.isForum?f.B2.SCRIPT_FORUM:f.B2.SCRIPT_USER],e.globalsService.forumObservable.pipe((0,v.R)(e.componentDestroyed)).subscribe(function(){var u=(0,b.Z)(function*(g){e.forum=g,e.isForum&&(e.loaderMessage="Recupero dei dati",e.breadcrumbTitle="",e.sandbox=void 0,yield e.setData(s,c))});return function(g){return u.apply(this,arguments)}}()),yield e.setData(s,c)):yield e.redirect()})()}setData(e,l){var s=this;return(0,b.Z)(function*(){if(s.isForum&&!s.forum)return void(s.forumRequired=!0);s.forumRequired=!1;const c=yield s.scriptListService.getSingleScriptData(e,s.isForum?s.forum.cid:s.globalsService.credentials.user.ffuid,s.targetType),u=null==c?void 0:c.script.sandboxes.find(g=>!g.inSettings&&g.slug===l);c&&c.installed&&u&&(!s.isForum||s.forum.admin||c.permissions.includes(y.Af.SETTINGS))?(s.breadcrumbTitle=c.script.name+(u.name?` - ${u.name}`:""),s.loaderMessage="Caricamento della sandbox",s.setSandbox(u,c.script.id,c.settings)):yield s.redirect()})()}setSandbox(e,l,s){var c=this;return(0,b.Z)(function*(){const u=yield c.tokensService.generateJwe(p.s9.SANDBOX),g=JSON.parse(s||"{}");c.scriptSandboxService.create(e,{token:u,script:{id:l,settings:g}}).subscribe(L=>c.sandbox=L)})()}redirect(){var e=this;return(0,b.Z)(function*(){yield e.router.navigate([e.isForum?f.B2.SCRIPT_FORUM:f.B2.SCRIPT_USER])})()}sandboxLoaded(){this.sandbox.loading=!1}ngOnDestroy(){this.componentDestroyed.next(),this.componentDestroyed.complete()}}return(r=m).\u0275fac=function(e){return new(e||r)(t.Y36(h.gz),t.Y36(h.F0),t.Y36(C.d),t.Y36(U.o),t.Y36(n.s),t.Y36(p.H))},r.\u0275cmp=t.Xpm({type:r,selectors:[["ng-component"]],decls:4,vars:6,consts:[[1,"d-block",3,"pageTitle","url","nodes","hideNavOnSmallScreen"],[4,"ngIf","ngIfElse"],["content",""],[3,"message",4,"ngIf"],[4,"ngIf"],[3,"message"],[3,"ngClass","head","body","bodyClass","initData","eventsObservable","resetMainPadding","loadEvent"]],template:function(e,l){if(1&e&&(t._UZ(0,"app-breadcrumb",0),t.YNc(1,E,1,0,"app-forum-required",1),t.YNc(2,P,2,2,"ng-template",null,2,t.W1O)),2&e){const s=t.MAs(3);t.Q6J("pageTitle",l.breadcrumbTitle)("url",l.breadcrumbUrl)("nodes",l.breadcrumbNodes)("hideNavOnSmallScreen",!0),t.xp6(1),t.Q6J("ngIf",l.forumRequired)("ngIfElse",s)}},dependencies:[M.L,S.mk,S.O5,O.P,F.R,N.w],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}"]}),m})()}];let Q=(()=>{var r;class m{}return(r=m).\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[T.w,S.ez,x.z,D.q,h.Bz.forChild(A),i.i]}),m})()},4004:(I,R,a)=>{a.d(R,{Z:()=>y});const S={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let x;const D=new Uint8Array(16);function h(){if(!x&&(x=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!x))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return x(D)}const i=[];for(let n=0;n<256;++n)i.push((n+256).toString(16).slice(1));const y=function U(n,o,v){if(S.randomUUID&&!o&&!n)return S.randomUUID();const p=(n=n||{}).random||(n.rng||h)();if(p[6]=15&p[6]|64,p[8]=63&p[8]|128,o){v=v||0;for(let t=0;t<16;++t)o[v+t]=p[t];return o}return function b(n,o=0){return i[n[o+0]]+i[n[o+1]]+i[n[o+2]]+i[n[o+3]]+"-"+i[n[o+4]]+i[n[o+5]]+"-"+i[n[o+6]]+i[n[o+7]]+"-"+i[n[o+8]]+i[n[o+9]]+"-"+i[n[o+10]]+i[n[o+11]]+i[n[o+12]]+i[n[o+13]]+i[n[o+14]]+i[n[o+15]]}(p)}}}]);