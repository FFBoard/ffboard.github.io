"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[431],{431:(Y,x,o)=>{o.r(x),o.d(x,{ScriptSandboxModule:()=>Z});var h=o(9090),u=o(6814),f=o(7535),b=o(8109),y=o(1874),l=o(5861),p=o(7165),C=o(1410),R=o(9121),v=o(3729),T=o(137),D=o(8645),M=o(9773),S=o(4908),e=o(5879),F=o(3285),O=o(4929),I=o(7980);function N(a,c){if(1&a&&e._UZ(0,"app-loader",3),2&a){const t=e.oxw();e.Q6J("message",t.loaderMessage)}}const U=function(a){return{"d-none":a}};function B(a,c){if(1&a){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-sandbox",4),e.NdJ("loadEvent",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.sandboxLoaded())}),e.qZA(),e.BQk()}if(2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(5,U,t.sandbox.loading))("head",t.sandbox.headData)("body",t.sandbox.bodyData)("initData",t.sandbox.initData)("eventsObservable",t.sandbox.eventObservable)}}const J=[{path:"",component:(()=>{class a{constructor(t,s,n,r,d,i){this.activatedRoute=t,this.router=s,this.globalsService=n,this.scriptListService=r,this.scriptSandboxService=d,this.tokensService=i,this.loaderMessage="Recupero dei dati",this.breadcrumbUrl=p.B2.SCRIPT_SANDBOX,this.breadcrumbNodes=[],this.breadcrumbTitle="",this.isForum=!1,this.targetType=v.D7.USER,this.componentDestroyed=new D.x,this.forum=this.globalsService.forum}ngOnInit(){var t=this;return(0,l.Z)(function*(){var s;const n=Number(t.activatedRoute.snapshot.paramMap.get("scriptId")),r=t.activatedRoute.snapshot.paramMap.get("sandboxSlug")||"";t.targetType=(null===(s=t.activatedRoute.parent)||void 0===s?void 0:s.snapshot.data.type)||v.D7.USER,t.isForum=t.targetType===v.D7.FORUM,isNaN(n)||n<1?yield t.redirect():(t.breadcrumbNodes=[t.isForum?p.B2.SCRIPT_FORUM:p.B2.SCRIPT_USER],t.globalsService.forumObservable.pipe((0,M.R)(t.componentDestroyed)).subscribe(function(){var d=(0,l.Z)(function*(i){t.forum=i,t.isForum&&(t.loaderMessage="Recupero dei dati",t.breadcrumbTitle="",t.sandbox=void 0,yield t.setData(n,r))});return function(i){return d.apply(this,arguments)}}()),yield t.setData(n,r))})()}setData(t,s){var n=this;return(0,l.Z)(function*(){if(n.isForum&&!n.forum)return void(yield n.redirect());const[r,d,i,E]=yield n.scriptListService.getScript(t,n.isForum?n.forum.cid:n.globalsService.credentials.user.ffuid,n.targetType),m=null==r?void 0:r.js_sandboxes.find(g=>!g.inSettings&&g.slug===s);r&&i&&m&&(!n.isForum||n.forum.admin||E.edit)?(n.breadcrumbTitle=r.name+(m.name?` - ${m.name}`:""),n.loaderMessage="Caricamento della sandbox",n.setSandbox(m,d)):yield n.redirect()})()}setSandbox(t,s){var n=this;return(0,l.Z)(function*(){const r=yield n.tokensService.generateJwe(S.s9.SANDBOX),d=JSON.parse(s);n.scriptSandboxService.create(t,{token:r,script:{settings:d}}).subscribe(i=>n.sandbox=i)})()}redirect(){var t=this;return(0,l.Z)(function*(){yield t.router.navigate([t.isForum?p.B2.SCRIPT_FORUM:p.B2.SCRIPT_USER])})()}sandboxLoaded(){this.sandbox.loading=!1}ngOnDestroy(){this.componentDestroyed.next(),this.componentDestroyed.complete()}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(b.gz),e.Y36(b.F0),e.Y36(C.d),e.Y36(R.o),e.Y36(T.s),e.Y36(S.H))},a.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],decls:3,vars:5,consts:[[1,"d-block",3,"pageTitle","url","nodes"],[3,"message",4,"ngIf"],[4,"ngIf"],[3,"message"],[3,"ngClass","head","body","initData","eventsObservable","loadEvent"]],template:function(t,s){1&t&&(e._UZ(0,"app-breadcrumb",0),e.YNc(1,N,1,1,"app-loader",1),e.YNc(2,B,2,7,"ng-container",2)),2&t&&(e.Q6J("pageTitle",s.breadcrumbTitle)("url",s.breadcrumbUrl)("nodes",s.breadcrumbNodes),e.xp6(1),e.Q6J("ngIf",!s.sandbox||s.sandbox.loading),e.xp6(1),e.Q6J("ngIf",s.sandbox))},dependencies:[F.L,u.mk,u.O5,O.R,I.w],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1;max-height:calc(100vh - 172px - 2rem)}@media (min-width: 960px){[_nghost-%COMP%]{max-height:calc(100vh - 119px - 3rem)}}"]}),a})()}];let Z=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[h.w,u.ez,f.q,b.Bz.forChild(J),y.i]}),a})()}}]);