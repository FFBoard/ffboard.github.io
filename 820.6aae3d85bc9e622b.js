"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[820],{3285:(b,P,o)=>{o.d(P,{L:()=>O});var s=o(7165),r=o(5879);let L=(()=>{var p;class u{constructor(){this.dependences={[s.B2.LOGIN]:null,[s.B2.HOME]:null,[s.B2.SETTINGS]:s.B2.HOME,[s.B2.SCRIPT]:s.B2.HOME,[s.B2.SCRIPT_FORUM]:s.B2.SCRIPT,[s.B2.SCRIPT_USER]:s.B2.SCRIPT,[s.B2.SCRIPT_SETTINGS]:[s.B2.SCRIPT_USER,s.B2.SCRIPT_FORUM],[s.B2.SCRIPT_SANDBOX]:[s.B2.SCRIPT_USER,s.B2.SCRIPT_FORUM],[s.B2.SCRIPT_DEV]:s.B2.SCRIPT,[s.B2.SCRIPT_DEV_SETTINGS]:s.B2.SCRIPT_DEV,[s.B2.UPLOAD]:s.B2.HOME,[s.B2.ADMIN]:s.B2.HOME,[s.B2.STATS]:s.B2.HOME,[s.B2.STATS_UPLOAD]:s.B2.STATS},this.names={[s.B2.LOGIN]:"Login",[s.B2.HOME]:"Home",[s.B2.SETTINGS]:"Notifiche",[s.B2.SCRIPT]:"Script",[s.B2.SCRIPT_FORUM]:"Forum",[s.B2.SCRIPT_USER]:"Utenti",[s.B2.SCRIPT_SETTINGS]:"Impostazioni",[s.B2.SCRIPT_SANDBOX]:"Altro",[s.B2.SCRIPT_DEV]:"Sviluppo",[s.B2.SCRIPT_DEV_SETTINGS]:"Impostazioni",[s.B2.UPLOAD]:"Upload",[s.B2.ADMIN]:"Amministrazione",[s.B2.STATS]:"Statistiche",[s.B2.STATS_UPLOAD]:"Upload"}}createPathList(m,e=[]){const n=(c,d)=>{c.unshift({name:this.names[d]||"",path:d})},i=c=>this.dependences.hasOwnProperty(c)?this.dependences[c]instanceof Array?this.dependences[c].includes(e[0])?e.shift():this.dependences[c][0]:this.dependences[c]:null;let t=[{name:this.names[m]||"",path:""}],a=i(m);for(;a;)n(t,a),a=i(a);return t}}return(p=u).\u0275fac=function(m){return new(m||p)},p.\u0275prov=r.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),u})();var I=o(8109),f=o(6814);function T(p,u){if(1&p&&r._UZ(0,"a",8),2&p){const h=r.oxw().$implicit;r.Q6J("routerLink",h.path)("innerText",h.name)}}function l(p,u){if(1&p&&r._UZ(0,"span",9),2&p){const h=r.oxw().$implicit;r.Q6J("innerText",h.name)}}const v=function(p){return{active:p}};function B(p,u){if(1&p&&(r.TgZ(0,"li",5),r.YNc(1,T,1,2,"a",6),r.YNc(2,l,1,1,"ng-template",null,7,r.W1O),r.qZA()),2&p){const h=u.last,m=r.MAs(3);r.Q6J("ngClass",r.VKq(4,v,h)),r.uIk("aria-current",h?"page":null),r.xp6(1),r.Q6J("ngIf",!h)("ngIfElse",m)}}const $=function(p){return{"hide-nav":p}},C=function(p){return{"d-none d-md-block":p}};let O=(()=>{var p;class u{constructor(m,e){this.breadcrumbService=m,this.router=e,this.pageTitle="",this.url="",this.nodes=[],this.hideNavOnSmallScreen=!1,this.breadcrumbs=[]}ngOnInit(){this.url||(this.url=this.router.url),this.breadcrumbs=this.breadcrumbService.createPathList(this.url,this.nodes)}}return(p=u).\u0275fac=function(m){return new(m||p)(r.Y36(L),r.Y36(I.F0))},p.\u0275cmp=r.Xpm({type:p,selectors:[["app-breadcrumb"]],inputs:{pageTitle:"pageTitle",url:"url",nodes:"nodes",hideNavOnSmallScreen:"hideNavOnSmallScreen"},decls:5,vars:8,consts:[[1,"container-fluid","px-md-1","d-flex","flex-column","flex-md-row","align-items-md-center",3,"ngClass"],[1,"h3","fw-light","mb-0","lh-1","fv-small-caps","pb-1",3,"innerText"],["aria-label","breadcrumb",1,"ms-md-auto","mt-1",3,"ngClass"],[1,"breadcrumb","mb-0","justify-content-md-end"],["class","breadcrumb-item",3,"ngClass",4,"ngFor","ngForOf"],[1,"breadcrumb-item",3,"ngClass"],[3,"routerLink","innerText",4,"ngIf","ngIfElse"],["lastItem",""],[3,"routerLink","innerText"],[3,"innerText"]],template:function(m,e){1&m&&(r.TgZ(0,"div",0),r._UZ(1,"h2",1),r.TgZ(2,"nav",2)(3,"ol",3),r.YNc(4,B,4,6,"li",4),r.qZA()()()),2&m&&(r.Q6J("ngClass",r.VKq(4,$,e.hideNavOnSmallScreen)),r.xp6(1),r.Q6J("innerText",e.pageTitle),r.xp6(1),r.Q6J("ngClass",r.VKq(6,C,e.hideNavOnSmallScreen)),r.xp6(2),r.Q6J("ngForOf",e.breadcrumbs))},dependencies:[f.mk,f.sg,f.O5,I.rH],styles:[".container-fluid[_ngcontent-%COMP%]:not(.hide-nav){margin-bottom:.75rem}.container-fluid.hide-nav[_ngcontent-%COMP%]{margin-bottom:.5rem}@media (min-width: 768px){.container-fluid.hide-nav[_ngcontent-%COMP%]{margin-bottom:.75rem}}@media (min-width: 960px){.container-fluid[_ngcontent-%COMP%]{margin-top:.5rem}}"]}),u})()},9090:(b,P,o)=>{o.d(P,{w:()=>I});var s=o(6814),r=o(8109),L=o(5879);let I=(()=>{var f;class T{}return(f=T).\u0275fac=function(v){return new(v||f)},f.\u0275mod=L.oAB({type:f}),f.\u0275inj=L.cJS({imports:[s.ez,r.Bz]}),T})()},3040:(b,P,o)=>{o.d(P,{HF:()=>T,Ry:()=>f,in:()=>l,m:()=>r,n8:()=>L,t6:()=>v,uD:()=>s,xt:()=>I});const s="\nquery FullScript($id: String!, $type: ScriptTargetTypeEnum!) {\n    scriptList {\n        scriptId\n        type\n        author\n        name\n        description\n        faqLink\n        preview\n        publisher\n        source\n        sourceBeta\n        position\n        sandboxes {\n            name\n            slug\n            value\n            inSettings\n        }\n        packages\n        dependencies\n        settingsSchema\n        settingsDefault\n        html\n        hidden\n        cpQuirks\n        cpStandard\n        cpMobile\n        webhook\n        webhookCallOnSettings\n        webhookCallOnManage\n    }\n    scriptSettings(targetId: $id, targetType: $type) {\n        scriptId,\n        settings,\n    }\n    scriptInstalledList(targetId: $id, targetType: $type)\n    scriptRankedList {\n        scriptId\n        scriptRank\n    }\n    scriptPermissions {\n        scriptId\n        manage\n        edit\n    }\n}",r="\nquery Script($id: String!, $type: ScriptTargetTypeEnum!) {\n    scriptSettings(targetId: $id, targetType: $type) {\n        scriptId,\n        settings,\n    }\n    scriptInstalledList(targetId: $id, targetType: $type)\n}",L="\nquery ScriptStats {\n    scriptStats {\n        scriptId\n        entities {\n            targetId\n            targetType\n        }\n    }\n}",I="\nmutation DelCache($scriptId: String!) {\n    delCache(scriptId: $scriptId)\n}",f="\nmutation ScriptUpsert($scriptId: String, $type: String, $name: String, $description: String, $faqLink: String, $preview: String, $publisher: String, $source: String, $sourceBeta: String, $sandboxes: [JSSandboxInput!], $position: String, $packages: [String], $dependencies: [String], $settingsSchema: String, $settingsDefault: String, $html: String, $hidden: Boolean, $cpQuirks: Boolean, $cpStandard: Boolean, $cpMobile: Boolean, $webhook: String, $webhookCallOnSettings: Boolean, $whManage: Boolean) {\n    scriptUpsert(scriptId: $scriptId, type: $type, name: $name, description: $description, faqLink: $faqLink, preview: $preview, publisher: $publisher, source: $source, sourceBeta: $sourceBeta, sandboxes: $sandboxes, position: $position, packages: $packages, dependencies: $dependencies, settingsSchema: $settingsSchema, settingsDefault: $settingsDefault, html: $html, hidden: $hidden, cpQuirks: $cpQuirks, cpStandard: $cpStandard, cpMobile: $cpMobile, webhook: $webhook, webhookCallOnSettings: $webhookCallOnSettings, whManage: $whManage)\n}",T="\nmutation DelScript($scriptId: String!) {\n    delScript(scriptId: $scriptId)\n}",l="\nmutation ScriptManage(\n    $targetId: String!,\n    $targetType: ScriptTargetTypeEnum!,\n    $scriptId: String!,\n    $action: ScriptManageActionEnum!\n) {\n    scriptManage(\n        targetId: $targetId,\n        targetType: $targetType,\n        scriptId: $scriptId,\n        action: $action\n    )\n}",v="\nmutation ScriptSettings(\n    $targetId: String!,\n    $targetType: ScriptTargetTypeEnum!,\n    $scriptId: String!,\n    $settings: String!\n) {\n    scriptSettings(\n        targetId: $targetId,\n        targetType: $targetType,\n        scriptId: $scriptId,\n        settings: $settings\n    )\n}"},9121:(b,P,o)=>{o.d(P,{o:()=>p});var s=o(1413),r=o(5861),L=o(1410),I=o(8391),f=o(8645),T=o(8372),l=o(3729),v=o(7165),B=o(463),$=o(3040),C=o(4064),O=o(5879);let p=(()=>{var u;class h{constructor(e,n,i,t){this.graphqlService=e,this.globalsService=n,this.profileService=i,this.preferencesService=t,this.scriptInstalledList=[],this.listInputsSubject=new f.x,this.ffuid="",this.cache={},this.allScriptCache={},this.lastRequestTime=0,this.profileSubscription=this.globalsService.profileObservable.subscribe(a=>{this.ffuid=(null==a?void 0:a.user.ffuid)||""})}createCacheKey(e,n){return e+n+this.ffuid}getData(e,n=l.D7.FORUM,i=!1){var t=this;return(0,r.Z)(function*(){var a;const c=t.createCacheKey(e,n);if(Date.now()-t.lastRequestTime>18e5&&t.clearCache(!0),i){if(t.scriptList)return{scriptList:t.scriptList,scriptSettings:[],scriptInstalledList:[],scriptRankedList:[],scriptPermissions:t.scriptPermissions}}else if(t.cache.hasOwnProperty(c))return t.cache[c];const d=yield t.graphqlService.query({query:t.scriptList?$.m:$.uD,variables:{id:e,type:n}});t.scriptList||(t.lastRequestTime=Date.now(),t.scriptList=t.parseScriptList(d.data.scriptList,d.data.scriptRankedList),t.scriptRankedList=d.data.scriptRankedList,t.scriptPermissions=d.data.scriptPermissions),t.scriptInstalledList=d.data.scriptInstalledList.filter(_=>t.scriptList.findIndex(g=>g.scriptId===_)>-1);const S=n===l.D7.FORUM&&!(null!==(a=t.globalsService.forum)&&void 0!==a&&a.admin);return t.cache[c]={scriptList:t.filterType(t.scriptList,e,n,S?t.scriptPermissions:void 0),scriptSettings:d.data.scriptSettings,scriptInstalledList:t.scriptInstalledList,scriptPermissions:t.scriptPermissions,scriptRankedList:t.scriptRankedList},i?{scriptList:t.scriptList,scriptSettings:[],scriptInstalledList:[],scriptRankedList:[],scriptPermissions:t.scriptPermissions}:t.cache[c]})()}parseScriptList(e,n){let i={};const t=e.map(a=>{const c=this.parseScript(a,e,n);if(c.parentIdList.length)for(const d of c.parentIdList)i[`script${d}`]=[...i[`script${d}`]||[],{childId:c.scriptId,childName:c.name}];return c});for(const[a,c]of Object.entries(i)){const d=a.replace("script",""),S=t.find(_=>_.scriptId===d);S&&(S.childIdList=c.map(_=>_.childId),S.childNameList=c.map(_=>_.childName))}return t}parseScript(e,n,i){let t=(0,s.Z)((0,s.Z)({},e),{},{rank:1e3,parentIdList:[],parentNameList:[],childIdList:[],childNameList:[],originalName:e.name});if(t.name=t.name.replace(/^whitelist\[([^\]]*)]/i,"").trim(),i){const a=i.findIndex(c=>c.scriptId===t.scriptId);a>-1&&(t.rank=i[a].scriptRank)}t.parentIdList=t.dependencies.filter(a=>a!==t.scriptId);for(const a of t.parentIdList.keys()){const c=n.find(d=>d.scriptId===t.parentIdList[a]);c?t.parentNameList.push(c.name):t.parentIdList.splice(a,1)}return t}filterType(e,n,i,t){let c,d,a=null===i?[l.AV.FORUM,l.AV.USER,l.AV.ALL]:i===l.D7.FORUM?[l.AV.FORUM,l.AV.ALL]:[l.AV.USER,l.AV.ALL],S=-1;const _=this.profileService.hasAtLeastOnePermission([I.vX.ADMIN]);return e.filter(g=>!(0===g.source.length||t&&(S=t.findIndex(E=>E.scriptId===g.scriptId),S<0||!t[S].manage.includes(this.ffuid)&&(!t[S].edit.includes(this.ffuid)||!this.scriptInstalledList.includes(g.scriptId))))&&(d=!1,g.hidden&&(d=g.author===this.ffuid||_,c=g.originalName.match(/^whitelist\[([^\]]*)]/i),c&&!d&&(d=c[1].toLowerCase().split(",").includes(n))),a.includes(g.type)&&(!g.hidden||d)))}splitTabs(e){let n={};return e.forEach(i=>{n.hasOwnProperty(i.publisher)||(n[i.publisher]=[]),n[i.publisher].push(i)}),n}getListInputsObservable(){return this.listInputsSubject.asObservable()}pushListInputs(e){this.listInputsSubject.next(e),this.listInputs=e}get listInputs(){return this.listInputsData}set listInputs(e){this.listInputsData=e}getScript(e,n,i){var t=this;return(0,r.Z)(function*(){var a;const c=yield t.getData(n,i),d=yield t.getScriptPermissions();return[(yield t.getAllScripts(n,i)).find(S=>S.scriptId===e),(null===(a=c.scriptSettings.find(S=>S.scriptId===e))||void 0===a?void 0:a.settings)||"{}",c.scriptInstalledList.includes(e),d[`script${e}`]||{scriptId:e,manage:!1,edit:!1}]})()}getScriptsByAuthor(e){var n=this;return(0,r.Z)(function*(){return(yield n.getData(e,l.D7.USER,!0)).scriptList.filter(t=>t.author===e)})()}updateInstalledScriptSettings(e,n,i,t){const a=this.createCacheKey(e,n);if(this.cache[a]){let c=this.cache[a].scriptSettings.find(d=>d.scriptId=i);c?c.settings=t:this.cache[a].scriptSettings.push({scriptId:i,settings:t})}}getAllScripts(e,n){var i=this;return(0,r.Z)(function*(){if(e||(e=i.ffuid,n=l.D7.USER),i.allScriptCache.hasOwnProperty(e))return i.allScriptCache[e];const t=yield i.getData(e,n,!0);return i.allScriptCache[e]=i.filterType(t.scriptList,e,null)})()}getScriptPermissions(){var e=this;return(0,r.Z)(function*(){const n=e.scriptPermissions||(yield e.getData(e.ffuid,l.D7.USER)).scriptPermissions;let i={};return n.forEach(t=>{t.manage.includes(e.ffuid)&&(i[`script${t.scriptId}`]={scriptId:t.scriptId,manage:!0,edit:!1}),t.edit.includes(e.ffuid)&&(i.hasOwnProperty(`script${t.scriptId}`)?i[`script${t.scriptId}`].edit=!0:i[`script${t.scriptId}`]={scriptId:t.scriptId,manage:!1,edit:!0})}),i})()}updateScript(e,n){if(!this.scriptList)return;const i=this.scriptList.findIndex(t=>t.scriptId===n);if(i>-1){const t=this.scriptList[i].parentIdList.filter(c=>!e.dependencies.includes(c));for(const c of t){const d=this.scriptList.find(S=>S.scriptId===c);d&&this.removeChildFromParent(d,c)}const a=(0,s.Z)((0,s.Z)({},this.parseScript((0,s.Z)((0,s.Z)({},this.scriptList[i]),e),this.scriptList)),{},{rank:this.scriptList[i].rank,childIdList:this.scriptList[i].childIdList,childNameList:this.scriptList[i].childNameList});Object.assign(this.scriptList[i],a),this.clearCache(!1)}}removeScript(e){if(!this.scriptList)return;const n=this.scriptList.findIndex(i=>i.scriptId===e);if(n>-1){for(const i of this.scriptList[n].childIdList){const t=this.scriptList.find(a=>a.scriptId===i);t&&this.removeChildFromParent(t,e)}this.scriptList.splice(n,1),this.clearCache(!1)}}removeChildFromParent(e,n){const i=e.childIdList.indexOf(n);e.childIdList.splice(i,1),e.childNameList.splice(i,1)}clearCache(e=!0){this.cache={},this.allScriptCache={},e&&(this.scriptList=void 0,this.scriptPermissions=void 0)}get settingsOptions(){return this.preferencesService.getItem(v.Ye.SCRIPT_SETTINGS_OPTIONS)||C.iK}set settingsOptions(e){this.preferencesService.setItem(v.Ye.SCRIPT_SETTINGS_OPTIONS,e)}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return(u=h).\u0275fac=function(e){return new(e||u)(O.LFG(I.Jk),O.LFG(L.d),O.LFG(T.H),O.LFG(B.y))},u.\u0275prov=O.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),h})()}}]);