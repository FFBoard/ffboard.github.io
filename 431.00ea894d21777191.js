"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[431],{431:(L,f,a)=>{a.r(f),a.d(f,{ScriptSandboxModule:()=>Q});var v=a(9090),b=a(6814),x=a(2630),h=a(578),S=a(4190),y=a(1874),p=a(5861),u=a(7165),C=a(1410),R=a(6245),m=a(3729),T=a(137),D=a(8645),M=a(9773),g=a(2721),t=a(9212),I=a(3285),O=a(146),F=a(9473),U=a(7980);function N(n,c){1&n&&t._UZ(0,"app-forum-required")}function E(n,c){if(1&n&&t._UZ(0,"app-loader",5),2&n){const s=t.oxw(2);t.Q6J("message",s.loaderMessage)}}const B=n=>({"d-none":n}),J=()=>["bg-light"];function Z(n,c){if(1&n){const s=t.EpF();t.ynx(0),t.TgZ(1,"app-sandbox",6),t.NdJ("loadEvent",function(){t.CHM(s);const i=t.oxw(2);return t.KtG(i.sandboxLoaded())}),t.qZA(),t.BQk()}if(2&n){const s=t.oxw(2);t.xp6(),t.Q6J("ngClass",t.VKq(7,B,s.sandbox.loading))("head",s.sandbox.headData)("body",s.sandbox.bodyData)("bodyClass",t.DdM(9,J))("initData",s.sandbox.initData)("eventsObservable",s.sandbox.eventObservable)("resetMainPadding",!0)}}function P(n,c){if(1&n&&t.YNc(0,E,1,1,"app-loader",3)(1,Z,2,10,"ng-container",4),2&n){const s=t.oxw();t.Q6J("ngIf",!s.sandbox||s.sandbox.loading),t.xp6(),t.Q6J("ngIf",s.sandbox)}}const Y=[{path:"",component:(()=>{var n;class c{constructor(e,i,o,r,d,l){this.activatedRoute=e,this.router=i,this.globalsService=o,this.scriptListService=r,this.scriptSandboxService=d,this.tokensService=l,this.loaderMessage="Recupero dei dati",this.breadcrumbUrl=u.B2.SCRIPT_SANDBOX,this.breadcrumbNodes=[],this.breadcrumbTitle="",this.forumRequired=!1,this.isForum=!1,this.targetType=m.D7.USER,this.componentDestroyed=new D.x,this.forum=this.globalsService.forum}ngOnInit(){var e=this;return(0,p.Z)(function*(){var i;const o=e.activatedRoute.snapshot.paramMap.get("scriptId"),r=e.activatedRoute.snapshot.paramMap.get("sandboxSlug")||"";e.targetType=(null===(i=e.activatedRoute.parent)||void 0===i?void 0:i.snapshot.data.type)||m.D7.USER,e.isForum=e.targetType===m.D7.FORUM,o?(e.breadcrumbNodes=[e.isForum?u.B2.SCRIPT_FORUM:u.B2.SCRIPT_USER],e.globalsService.forumObservable.pipe((0,M.R)(e.componentDestroyed)).subscribe(function(){var d=(0,p.Z)(function*(l){e.forum=l,e.isForum&&(e.loaderMessage="Recupero dei dati",e.breadcrumbTitle="",e.sandbox=void 0,yield e.setData(o,r))});return function(l){return d.apply(this,arguments)}}()),yield e.setData(o,r)):yield e.redirect()})()}setData(e,i){var o=this;return(0,p.Z)(function*(){if(o.isForum&&!o.forum)return void(o.forumRequired=!0);o.forumRequired=!1;const r=yield o.scriptListService.getSingleScriptData(e,o.isForum?o.forum.cid:o.globalsService.credentials.user.ffuid,o.targetType),d=null==r?void 0:r.script.sandboxes.find(l=>!l.inSettings&&l.slug===i);r&&r.installed&&d&&(!o.isForum||o.forum.admin||r.permissions.includes(m.Af.SETTINGS))?(o.breadcrumbTitle=r.script.name+(d.name?" - ".concat(d.name):""),o.loaderMessage="Caricamento della sandbox",o.setSandbox(d,r.script.id,r.settings)):yield o.redirect()})()}setSandbox(e,i,o){var r=this;return(0,p.Z)(function*(){const d=yield r.tokensService.generateJwe(g.s9.SANDBOX),l=JSON.parse(o||"{}");r.scriptSandboxService.create(e,{token:d,script:{id:i,settings:l}}).subscribe(A=>r.sandbox=A)})()}redirect(){var e=this;return(0,p.Z)(function*(){yield e.router.navigate([e.isForum?u.B2.SCRIPT_FORUM:u.B2.SCRIPT_USER])})()}sandboxLoaded(){this.sandbox.loading=!1}ngOnDestroy(){this.componentDestroyed.next(),this.componentDestroyed.complete()}}return(n=c).\u0275fac=function(e){return new(e||n)(t.Y36(S.gz),t.Y36(S.F0),t.Y36(C.d),t.Y36(R.o),t.Y36(T.s),t.Y36(g.H))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],decls:4,vars:6,consts:[[1,"d-block",3,"pageTitle","url","nodes","hideNavOnSmallScreen"],[4,"ngIf","ngIfElse"],["content",""],[3,"message",4,"ngIf"],[4,"ngIf"],[3,"message"],[3,"ngClass","head","body","bodyClass","initData","eventsObservable","resetMainPadding","loadEvent"]],template:function(e,i){if(1&e&&(t._UZ(0,"app-breadcrumb",0),t.YNc(1,N,1,0,"app-forum-required",1)(2,P,2,2,"ng-template",null,2,t.W1O)),2&e){const o=t.MAs(3);t.Q6J("pageTitle",i.breadcrumbTitle)("url",i.breadcrumbUrl)("nodes",i.breadcrumbNodes)("hideNavOnSmallScreen",!0),t.xp6(),t.Q6J("ngIf",i.forumRequired)("ngIfElse",o)}},dependencies:[I.L,b.mk,b.O5,O.P,F.R,U.w],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}"]}),c})()}];let Q=(()=>{var n;class c{}return(n=c).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[v.w,b.ez,x.z,h.q,S.Bz.forChild(Y),y.i]}),c})()}}]);