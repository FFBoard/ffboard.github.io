(self.webpackChunkpages=self.webpackChunkpages||[]).push([[70],{5851:(te,Z,t)=>{"use strict";t.d(Z,{B:()=>me});var m=t(5861),v=t(1378),e=t(9212),y=t(2438),D=t(4036),a=t(9054),S=t(4020),K=t(148),p=t(9093),O=t(7621),E=t(1990),c=t(5661),U=t(5172),C=t(3845),B=t(4887),H=t(5487),se=t(658),L=t(9515),R=t(6814),A=t(6223),d=t(9473),T=t(554),i=t(4464),f=t(8366),M=t(5290),P=t(4228);const k=["fileInput"];function j(_,N){1&_&&(e.O4$(),e.TgZ(0,"svg",21),e._UZ(1,"path",22)(2,"path",23),e.qZA())}const G=()=>["text-primary"];function ne(_,N){1&_&&e._UZ(0,"app-logo",24),2&_&&e.Q6J("svgClass",e.DdM(2,G))("responsive",!1)}function le(_,N){1&_&&(e._UZ(0,"span",28),e.ALo(1,"translate")),2&_&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.DESKTOP"),e.oJD)}function he(_,N){1&_&&(e._UZ(0,"span",28),e.ALo(1,"translate")),2&_&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.TOUCH"),e.oJD)}const ce=_=>({"fw-bold fs-md-lg":_}),Ue=_=>({"text-decoration-underline":_});function xe(_,N){if(1&_){const h=e.EpF();e.TgZ(0,"div",25),e.YNc(1,le,2,3,"span",26)(2,he,2,3,"span",26),e.TgZ(3,"span",27),e.NdJ("click",function(r){e.CHM(h);const o=e.oxw(2),w=e.MAs(11);return e.KtG(o.toggleRemoteUrlForm(r,w))}),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&_){const h=e.oxw(2);e.Q6J("ngClass",e.VKq(7,ce,!h.isWidget)),e.xp6(),e.Q6J("ngIf",!h.touchDevice),e.xp6(),e.Q6J("ngIf",h.touchDevice),e.xp6(),e.Q6J("ngClass",e.VKq(9,Ue,h.isWidget)),e.xp6(),e.Oqu(e.lcZ(5,5,"COMPONENTS.UPLOADER.DESCRIPTION.REMOTE_URL"))}}function ye(_,N){1&_&&e.GkF(0)}function g(_,N){if(1&_){const h=e.EpF();e.TgZ(0,"div",29),e.YNc(1,ye,1,0,"ng-container",30),e.TgZ(2,"button",31),e.NdJ("click",function(r){e.CHM(h);const o=e.oxw(2);return e.KtG(o.handleRemoteUrlUpload(r))}),e.O4$(),e.TgZ(3,"svg",32),e._UZ(4,"path",33),e.qZA()(),e.kcU(),e.TgZ(5,"button",34),e.NdJ("click",function(r){e.CHM(h);const o=e.oxw(2);return e.KtG(o.toggleRemoteUrlForm(r))}),e.O4$(),e.TgZ(6,"svg",32),e._UZ(7,"path",35),e.qZA()()()}if(2&_){const h=e.oxw(2),u=e.MAs(16);e.xp6(),e.Q6J("ngTemplateOutlet",u),e.xp6(),e.Q6J("disabled",0===h.remoteUrl.length||!h.isRemoteUrlValid)}}function n(_,N){if(1&_&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"em",36),e.ALo(5,"arrayJoin"),e.BQk()),2&_){const h=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"COMPONENTS.UPLOADER.PATH.LONG")," "),e.xp6(2),e.Q6J("innerText",h.currentFolderPath.length?e.xi3(5,4,h.currentFolderPath,"/"):"root")}}function s(_,N){if(1&_&&(e._UZ(0,"div",41),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&_){const h=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,h.currentFolderPath,0,-1),"/"))}}function l(_,N){if(1&_&&(e.TgZ(0,"div",37)(1,"div",38),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,s,3,8,"div",39),e._UZ(5,"div",40),e.ALo(6,"arrayJoin"),e.ALo(7,"slice"),e.qZA()),2&_){const h=e.oxw(2);e.xp6(2),e.hij(" ",e.lcZ(3,3,"COMPONENTS.UPLOADER.PATH.SHORT")," "),e.xp6(2),e.Q6J("ngIf",h.currentFolderPath.length>1),e.xp6(),e.Q6J("innerText",(h.currentFolderPath.length>1?"/":"")+(h.currentFolderPath.length?e.xi3(6,5,e.xi3(7,8,h.currentFolderPath,h.currentFolderPath.length-1),"/"):"root"))}}const x=()=>({bottom:0,left:0});function b(_,N){if(1&_){const h=e.EpF();e.ynx(0),e.TgZ(1,"a",42),e.NdJ("click",function(){e.CHM(h);const r=e.oxw(2);return e.KtG(r.openInfoModal.emit())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",43),e.NdJ("click",function(){e.CHM(h),e.oxw(2);const r=e.MAs(7);return e.KtG(r.open())}),e._uU(5," settings "),e.qZA(),e.TgZ(6,"div",44),e.NdJ("click",function(r){e.CHM(h);const o=e.oxw(2),w=e.MAs(11);return e.KtG(o.toggleRemoteUrlForm(r,w))}),e._uU(7," add_link "),e.qZA(),e.BQk()}2&_&&(e.xp6(),e.Q6J("ngStyle",e.DdM(4,x)),e.xp6(),e.Oqu(e.lcZ(3,2,"COMPONENTS.UPLOADER.INFO")))}const z=(_,N,h)=>({"cursor-pointer":_,"py-4 px-3 px-sm-4":N,"p-2 pb-3":h}),J=(_,N,h)=>({"my-2":_,"mb-2":N,"mw-100 mt-1":h});function F(_,N){if(1&_){const h=e.EpF();e.ynx(0),e.TgZ(1,"div",12,13),e.NdJ("dragenter",function(){e.CHM(h);const r=e.MAs(2),o=e.oxw();return e.KtG(o.setDragOverEvent(r))})("drop",function(r){e.CHM(h);const o=e.oxw();return e.KtG(o.handleDropEvent(r))})("click",function(){e.CHM(h);const r=e.oxw(),o=e.MAs(2);return e.KtG(!r.isWaitingRemoteUrl&&o.click())}),e.YNc(3,j,3,0,"svg",14)(4,ne,1,3,"ng-template",null,15,e.W1O)(6,xe,6,11,"div",16)(7,g,8,2,"div",17),e.TgZ(8,"div",18),e.YNc(9,n,6,7,"ng-container",3)(10,l,8,11,"ng-template",null,19,e.W1O),e.qZA()(),e.YNc(12,b,8,5,"ng-container",20),e.BQk()}if(2&_){const h=e.MAs(5),u=e.MAs(11),r=e.oxw();e.xp6(),e.Q6J("ngClass",e.kEZ(9,z,!r.loading&&!r.isWaitingRemoteUrl,!r.isWidget,r.isWidget)),e.xp6(2),e.Q6J("ngIf",!r.isWidget)("ngIfElse",h),e.xp6(3),e.Q6J("ngIf",!r.isWidget||!r.isWaitingRemoteUrl),e.xp6(),e.Q6J("ngIf",r.isWidget&&r.isWaitingRemoteUrl),e.xp6(),e.Q6J("ngClass",e.kEZ(13,J,!r.isWidget&&!r.touchDevice,!r.isWidget&&r.touchDevice,r.isWidget)),e.xp6(),e.Q6J("ngIf",!r.isWidget)("ngIfElse",u),e.xp6(3),e.Q6J("ngIf",!r.isWidget)}}const W=(_,N)=>({"p-4":_,"p-2":N});function V(_,N){if(1&_&&(e.TgZ(0,"div",45),e.O4$(),e.TgZ(1,"svg",46),e._UZ(2,"path",47),e.qZA(),e.kcU(),e._UZ(3,"app-loader",48),e.TgZ(4,"div",49),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&_){const h=e.oxw();e.Q6J("ngClass",e.WLB(6,W,!h.isWidget,h.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",h.loadingMessage),e.xp6(2),e.hij(" ",e.lcZ(6,4,"COMPONENTS.UPLOADER.LOADING.SUBTEXT")," ")}}function $(_,N){if(1&_){const h=e.EpF();e._UZ(0,"div",28),e.ALo(1,"translate"),e.TgZ(2,"ul",50)(3,"li")(4,"div",51)(5,"input",52),e.NdJ("ngModelChange",function(r){e.CHM(h);const o=e.oxw();return e.KtG(o.options.compress=r)})("ngModelChange",function(){e.CHM(h);const r=e.oxw();return e.KtG(r.saveOptions())}),e.qZA(),e._UZ(6,"label",53),e.ALo(7,"translate"),e.qZA()(),e.TgZ(8,"li")(9,"div",51)(10,"input",54),e.NdJ("ngModelChange",function(r){e.CHM(h);const o=e.oxw();return e.KtG(o.options.openLinkModalAfterUpload=r)})("ngModelChange",function(){e.CHM(h);const r=e.oxw();return e.KtG(r.saveOptions())}),e.qZA(),e._UZ(11,"label",55),e.ALo(12,"translate"),e.qZA()()()}if(2&_){const h=e.oxw();e.Q6J("innerHTML",e.lcZ(1,5,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.DESCRIPTION"),e.oJD),e.xp6(5),e.Q6J("ngModel",h.options.compress),e.xp6(),e.Q6J("innerHTML",e.lcZ(7,7,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.COMPRESS_SWITCH"),e.oJD),e.xp6(4),e.Q6J("ngModel",h.options.openLinkModalAfterUpload),e.xp6(),e.Q6J("innerHTML",e.lcZ(12,9,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.SHOW_LINK_SWITCH"),e.oJD)}}function re(_,N){1&_&&e.GkF(0)}function Y(_,N){if(1&_&&(e._UZ(0,"p",56),e.ALo(1,"translate"),e.YNc(2,re,1,0,"ng-container",30)),2&_){e.oxw();const h=e.MAs(16);e.Q6J("innerHTML",e.lcZ(1,2,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.CONTENT"),e.oJD),e.xp6(2),e.Q6J("ngTemplateOutlet",h)}}function I(_,N){if(1&_){const h=e.EpF();e.TgZ(0,"button",57),e.NdJ("click",function(){e.CHM(h),e.oxw();const r=e.MAs(11);return e.KtG(r.close())}),e.ALo(1,"translate"),e.qZA(),e.TgZ(2,"button",58),e.NdJ("click",function(r){e.CHM(h);const o=e.oxw(),w=e.MAs(11);return e.KtG(o.handleRemoteUrlUpload(r,w))}),e.ALo(3,"translate"),e.qZA()}if(2&_){const h=e.oxw();e.Q6J("innerText",e.lcZ(1,3,"SHARED.CANCEL")),e.xp6(2),e.Q6J("disabled",0===h.remoteUrl.length||!h.isRemoteUrlValid)("innerText",e.lcZ(3,5,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.UPLOAD_BTN"))}}const ie=_=>({"fs-reset":_});function q(_,N){if(1&_){const h=e.EpF();e.TgZ(0,"input",59,60),e.NdJ("ngModelChange",function(r){e.CHM(h);const o=e.oxw();return e.KtG(o.remoteUrl=r)})("ngModelChange",function(){e.CHM(h);const r=e.MAs(1),o=e.oxw();return e.KtG(o.isRemoteUrlValid=!r.invalid)}),e.ALo(2,"translate"),e.qZA()}if(2&_){const h=e.oxw();e.Q6J("placeholder",e.lcZ(2,4,"COMPONENTS.UPLOADER.REMOTE_URL_INPUT_PLACEHOLDER"))("ngClass",e.VKq(6,ie,h.isWidget))("ngModel",h.remoteUrl)("pattern","^https?://[^.]+\\.(.+)")}}const ue=(_,N)=>({uploading:_,"widget flex-grow-1 min-w-0":N});let me=(()=>{var _;class N{constructor(u,r,o,w,X,ee,oe,de,ge){this.postMessageService=u,this.uploadService=r,this.uploadObservablesService=o,this.uploaderService=w,this.toastService=X,this.renderer=ee,this.ngZone=oe,this.translateService=de,this.proxyService=ge,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="",this.touchDevice=S.b1,this.isWaitingRemoteUrl=!1,this.remoteUrl="",this.isRemoteUrlValid=!1,this.dragOverEvent=!1,this.checkingFileMessage="",this.options=this.uploaderService.uploaderOptions;const pe=this.uploadService.preferences.uploader;pe.checkImage.active||(this.options.compress=!1),this.options.openLinkModalAfterUpload=pe.showLinkModal||this.options.openLinkModalAfterUpload||!1,this.uploaderService.uploaderOptions=this.options}ngOnInit(){var u=this;return(0,m.Z)(function*(){u.handleClipboardPasteEvent(),u.handleExternalUpload(),u.checkingFileMessage=u.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CHECK"),u.loadingMessage=u.checkingFileMessage})()}handleClipboardPasteEvent(){var u=this;this.clipboardPasteEventSubscription=(0,y.R)(document.body,"paste").subscribe(function(){var r=(0,m.Z)(function*(o){if(u.isWidget&&u.isWaitingRemoteUrl||!u.canUpload())return;const w=Array.from((o.clipboardData||o.originalEvent.clipboardData).items),X=[];for(const ee of w)if(0===ee.type.indexOf("image")){const oe=ee.getAsFile();oe&&X.push(oe)}X.length>0?yield u.preUpload(X):u.reset()});return function(o){return r.apply(this,arguments)}}())}handleExternalUpload(){var u=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var r=(0,m.Z)(function*(o){if(o){if(!u.canUpload())return;yield u.preUpload([o.file],o.options)}else u.fileInputRef.nativeElement.click()});return function(o){return r.apply(this,arguments)}}())}handleSelectionEvent(u){var r=this;return(0,m.Z)(function*(){if(!r.canUpload())return;const o=u.target;if(o.files&&o.files.length){const w=Array.from(o.files);return o.value="",r.preUpload(w)}r.reset()})()}handleDropEvent(u){var r=this;return(0,m.Z)(function*(){var o;if(u.preventDefault(),u.stopPropagation(),u.stopImmediatePropagation(),!r.canUpload())return;const w=null!==(o=u.dataTransfer)&&void 0!==o&&o.files?Array.from(u.dataTransfer.files):[];if(w.length)return r.preUpload(w);r.reset()})()}handleRemoteUrlUpload(u,r){var o=this;return(0,m.Z)(function*(){if(!o.isRemoteUrlValid||0===o.remoteUrl.length||!o.canUpload())return;const w=o.remoteUrl;o.loadingMessage=o.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.GETTING_REMOTE_FILE"),o.toggleRemoteUrlForm(u,r);const X=(0,a.Tb)(w);if(!X.ext||-1===E.KK.findIndex(oe=>-1!==oe.ext.indexOf(X.ext)))return o.handleErrors([X.name],[]),void o.reset();const ee=yield o.proxyService.get(w);return ee?o.preUpload([new File([ee],X.name,{type:ee.type,lastModified:Date.now()})]):(S.II||o.toastService.show({content:"Errore nel recupero dell'immagine dall'url!",level:v.m.ERROR}),o.postMessageService.send(K.l.UPLOAD_ERROR,{filename:X.name,error:C.S.REMOTE_URL_RESPONSE}),void o.reset())})()}saveOptions(u=!0){this.uploaderService.uploaderOptions=this.options,u&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload||!1}}setDragOverEvent(u){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(u,"dragover",r=>{r.preventDefault()})}))}canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage=this.checkingFileMessage,this.postMessageService.send(K.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(u,r){var o=this;return(0,m.Z)(function*(){const w=[...o.currentFolderPath],X=[],ee=[],oe=[],de=[];r?r.allowOverwrite=r.allowOverwrite||!1:(r=o.uploaderService.uploaderOptions).allowOverwrite=!1;for(let Q=0;Q<u.length;Q++){const ae=yield o.uploaderService.prepareFile(u[Q],r);if(ae){const Oe=(0,a.Tb)(ae.name),Me=(0,a.g8)(Oe.ext);if(!Me){oe.push(ae.name);continue}if(ae.size>Me.maxSize){de.push(ae.name);continue}X.push((0,a.g0)(ae,Oe)),ee.push(ae)}}if(o.handleErrors(oe,de),0===ee.length)return void o.reset();const ge=o.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.UPLOADING",{total:ee.length}),pe=o.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CREATING_PACKAGE",{total:ee.length});o.uploadObservablesService.pushUploadingFileQueue(X);for(let Q=0;Q<ee.length;++Q){o.loadingMessage=pe;const ae=yield o.uploadService.getHostToken(w,ee[Q].name);X[Q].progress+=20,o.loadingMessage=ge.replace("{{current}}","".concat(Q+1)),yield(0,D.z)(o.uploaderService.upload(ee[Q],ae,X[Q],r.allowOverwrite))}o.uploadObservablesService.pushUploadingFileQueue([]);const _e=X.filter(Q=>!Q.error).map(Q=>Q.file);_e.length>0&&(o.fileUploadedEvent.emit({list:_e,rewrite:r.allowOverwrite,destPath:w}),o.postMessageService.send(K.l.UPLOAD_SUCCESS,{fileList:_e.map(Q=>({filename:Q.name,isImage:Q.isImage,url:Q.url}))}),r.openLinkModalAfterUpload&&o.uploadObservablesService.pushAction({name:U.In.FILE_SHOW_LINKS,payload:{entities:(0,a.jL)(_e)}})),o.reset()})()}handleErrors(u,r){if(0!==u.length||0!==r.length){if(!S.II)return void this.toastService.show({content:this.createToastMessage(u,r),level:v.m.ERROR});[[C.S.UNSUPPORTED,u],[C.S.OVERSIZED,r]].forEach(o=>{o[1].forEach(w=>{this.postMessageService.send(K.l.UPLOAD_ERROR,{filename:w,error:o[0]})})})}}createToastMessage(u,r){const o=[];return u.length&&o.push(u.length>1?"I file <strong>".concat(u.join(", "),"</strong> hanno un formato non supportato!"):"Il file <strong>".concat(u[0],"</strong> ha un formato non supportato!")),r.length&&o.push(r.length>1?"I file <strong>".concat(r.join(", "),"</strong> sono troppo pesanti!"):"Il file <strong>".concat(r[0],"</strong> \xe8 troppo pesante!")),o.join("<br><br>")}toggleRemoteUrlForm(u,r){u.stopPropagation(),this.isWidget||(this.isWaitingRemoteUrl?null==r||r.close():null==r||r.open()),this.resetRemoteUrlForm(!this.isWaitingRemoteUrl)}resetRemoteUrlForm(u){this.isWaitingRemoteUrl=u,this.remoteUrl=""}ngOnDestroy(){var u;null===(u=this.startExternalUploadSubscription)||void 0===u||u.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return(_=N).\u0275fac=function(u){return new(u||_)(e.Y36(p.F),e.Y36(se.C),e.Y36(H.r),e.Y36(B.q),e.Y36(c.k),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(L.sK),e.Y36(O.y))},_.\u0275cmp=e.Xpm({type:_,selectors:[["app-uploader"]],viewQuery:function(u,r){if(1&u&&e.Gf(k,5),2&u){let o;e.iGM(o=e.CRH())&&(r.fileInputRef=o.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:17,vars:15,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],[3,"title"],["optionsModal",""],["appModalBody",""],["size","md",3,"title","disableCloseButton","hidden"],["remoteUrlModal",""],["appModalFooter",""],["remoteUrlInput",""],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],["class","description text-center",3,"ngClass",4,"ngIf"],["class","input-group input-group-sm remote-url-form justify-content-center mb-1",4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"description","text-center",3,"ngClass"],[3,"innerHTML",4,"ngIf"],[1,"ms-1","remote-url-btn","fst-italic","cursor-pointer",3,"ngClass","click"],[3,"innerHTML"],[1,"input-group","input-group-sm","remote-url-form","justify-content-center","mb-1"],[4,"ngTemplateOutlet"],[1,"input-group-text","bg-light",3,"disabled","click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 16 16"],["d","M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"],[1,"input-group-text","bg-light",3,"click"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","options-icon",3,"click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","remote-url-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto",3,"innerHTML"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto",3,"innerHTML"],[1,"mb-2",3,"innerHTML"],["type","button",1,"btn","btn-secondary",3,"innerText","click"],["type","button",1,"btn","btn-primary",3,"disabled","innerText","click"],["type","text","required","",1,"form-control",3,"placeholder","ngClass","ngModel","pattern","ngModelChange"],["input","ngModel"]],template:function(u,r){if(1&u&&(e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(w){return r.handleSelectionEvent(w)}),e.qZA(),e.YNc(3,F,13,17,"ng-container",3)(4,V,7,9,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6),e.ALo(8,"translate"),e.YNc(9,$,13,11,"ng-template",7),e.qZA(),e.TgZ(10,"app-modal",8,9),e.NdJ("hidden",function(){return r.resetRemoteUrlForm(!1)}),e.ALo(12,"translate"),e.YNc(13,Y,3,4,"ng-template",7)(14,I,4,7,"ng-template",10),e.qZA(),e.YNc(15,q,3,8,"ng-template",null,11,e.W1O)),2&u){const o=e.MAs(5);e.Q6J("ngClass",e.WLB(12,ue,r.isUploading,r.isWidget)),e.xp6(),e.Q6J("multiple",!0)("disabled",r.loading||r.isUploading),e.xp6(2),e.Q6J("ngIf",!r.isUploading)("ngIfElse",o),e.xp6(3),e.Q6J("title",e.lcZ(8,8,"COMPONENTS.UPLOADER.SETTINGS_MODAL.TITLE")),e.xp6(4),e.Q6J("title",e.lcZ(12,10,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.TITLE"))("disableCloseButton",!0)}},dependencies:[R.mk,R.O5,R.tP,R.PC,A.Fj,A.Wl,A.JJ,A.Q7,A.c5,A.On,d.R,T.R,i.z,f.J,M.j,P.J,R.OU,L.X$],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864fe;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:350px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:_ngcontent-%COMP%_draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{top:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{opacity:1}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{right:5px}.uploader[_ngcontent-%COMP%]   .remote-url-icon[_ngcontent-%COMP%]{right:30px}.upload-area.cursor-pointer[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo):not(.description), .upload-area.cursor-pointer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.remote-url-btn){pointer-events:none}.remote-url-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:300px}.remote-url-form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:.5}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes _ngcontent-%COMP%_bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes _ngcontent-%COMP%_draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),N})()},529:(te,Z,t)=>{"use strict";t.d(Z,{M:()=>p});var m=t(4243),v=t(6814),e=t(6223),y=t(259),D=t(2740),a=t(4610),S=t(9515),K=t(9212);let p=(()=>{var O;class E{}return(O=E).\u0275fac=function(U){return new(U||O)},O.\u0275mod=K.oAB({type:O}),O.\u0275inj=K.cJS({imports:[m.r,v.ez,e.u5,y.q,D.h,a.z,S.aw.forChild()]}),E})()},3845:(te,Z,t)=>{"use strict";t.d(Z,{S:()=>m});var m=function(v){return v.UNSUPPORTED="unsupported",v.OVERSIZED="oversized",v.REMOTE_URL_RESPONSE="remote-url-response",v.UPLOAD_FAILED="upload-failed",v}(m||{})},4243:(te,Z,t)=>{"use strict";t.d(Z,{r:()=>e});var m=t(6814),v=t(9212);let e=(()=>{var y;class D{}return(y=D).\u0275fac=function(S){return new(S||y)},y.\u0275mod=v.oAB({type:y}),y.\u0275inj=v.cJS({imports:[m.ez]}),D})()},4228:(te,Z,t)=>{"use strict";t.d(Z,{J:()=>v});var m=t(9212);let v=(()=>{var e;class y{transform(a,S){return a.join(S)}}return(e=y).\u0275fac=function(a){return new(a||e)},e.\u0275pipe=m.Yjl({name:"arrayJoin",type:e,pure:!0}),y})()},5172:(te,Z,t)=>{"use strict";t.d(Z,{In:()=>m,Ky:()=>D,VC:()=>v,c5:()=>y,gG:()=>e});var m=function(a){return a.FILE_SHOW_LINKS="fileLinks",a.FILE_EDIT="fileEdit",a.DELETE="delete",a.RENAME="rename",a.MOVE="move",a}(m||{}),v=function(a){return a.FILE="file",a.FOLDER="folder",a}(v||{}),e=function(a){return a.FILENAME="filename",a.SIZE="size",a.TIME="time",a.EXTENSION="ext",a}(e||{}),y=function(a){return a.GRID="grid",a.LIST="list",a}(y||{}),D=function(a){return a.W_768_I_1="(max-width: 767.98px)",a.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",a.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",a.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",a.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",a.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",a.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",a.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",a.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",a.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",a.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",a.W_3738_I_10="(min-width: 3424px)",a}(D||{})},1990:(te,Z,t)=>{"use strict";t.d(Z,{JJ:()=>D,KK:()=>v,b3:()=>a,ql:()=>y,uJ:()=>S,vV:()=>e});var m=t(5172);const v=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(K=>(K.maxSize*=1048576,K)),e={lastPath:[],layout:{asc:!0,orderBy:m.gG.FILENAME,type:m.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},y="https://upload.forumfree.net/api/",D=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,a=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,S={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},7621:(te,Z,t)=>{"use strict";t.d(Z,{y:()=>O});var m=t(5861),v=t(6306),e=t(708),y=t(8180),D=t(4664),a=t(2096),S=t(9931),K=t(9212),p=t(9862);let O=(()=>{var E;class c{constructor(C,B){this.http=C,this.endpointsService=B}get(C){var B=this;return(0,m.Z)(function*(){const H=B.sendRequest(C);return yield(0,e.n)(H)})()}sendRequest(C){return this.getUrlContent(C).pipe((0,y.q)(1),(0,D.w)(B=>(0,a.of)(B)),(0,S.K)(()=>this.getUrlContentWithProxy(C)))}getUrlContent(C){return this.http.get(C,{responseType:"blob"})}getUrlContentWithProxy(C){return this.http.get(this.endpointsService.get(v.jQ.PROXY,v.ph.COMMON),{headers:{[v._3.TOKEN_TYPE]:v.s9.ACCESS,"x-remote-url":C},responseType:"blob"}).pipe((0,y.q)(1),(0,S.K)(()=>(0,a.of)(void 0)))}}return(E=c).\u0275fac=function(C){return new(C||E)(K.LFG(p.eN),K.LFG(v.oz))},E.\u0275prov=K.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),c})()},5983:(te,Z,t)=>{"use strict";t.d(Z,{B:()=>D});var m=t(5172),v=t(6306),e=t(1410),y=t(9212);let D=(()=>{var a;class S{constructor(p){this.globalsService=p,this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(O=>{this.ffuid=null==O?void 0:O.user.ffuid})}getItem(p){const O=this.createKey(p);if((0,v.o8)(this.cache,O))return this.cache[O]}setItem(p,O){this.cache[this.createKey(p)]=O}removeItem(p){const O=this.createKey(p);if((0,v.o8)(this.cache,O)){if(this.cache[O].folders.length)for(const E of this.cache[O].folders)this.removeItem([...p,E.name]);return delete this.cache[O],!0}return!1}getEntities(p,O){const E={},c=this.createKey(p);if(!(0,v.o8)(this.cache,c))return E;for(const U of O){const C=(U.type===m.VC.FILE?this.cache[c].files:this.cache[c].folders).find(B=>B.name===U.name);C&&(E[C.name]=C)}return E}addEntities(p,O,E=m.VC.FILE){const c=this.createKey(p);return!!(0,v.o8)(this.cache,c)&&(Array.isArray(O)||(O=[O]),E===m.VC.FILE?this.cache[c].files.unshift(...O):this.cache[c].folders.unshift(...O),!0)}removeEntities(p,O,E=m.VC.FILE){if(Array.isArray(O)||(O=[O]),E===m.VC.FOLDER)for(const B of O)this.removeItem([...p,B]);const c=this.createKey(p);if(!(0,v.o8)(this.cache,c))return[];const U=E===m.VC.FILE?"files":"folders",C=[];for(const B of O){const H=this.cache[c][U].findIndex(se=>se.name===B);H>-1&&(this.cache[c][U].splice(H,1),C.push(B))}return C}refactorFolderContent(p,O){const E=this.createKey(p);if(!(0,v.o8)(this.cache,E))return!1;O.endsWith("/")||(O+="/");for(const c of this.cache[E].folders)c.url=O+c.name;for(const c of this.cache[E].files)c.url=c.embedUrl=O+c.name,c.time=Date.now();return!0}createKey(p){return"".concat(this.ffuid,"/").concat(p.join("/"))}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return(a=S).\u0275fac=function(p){return new(p||a)(y.LFG(e.d))},a.\u0275prov=y.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),S})()},5571:(te,Z,t)=>{"use strict";t.d(Z,{He:()=>a,jt:()=>y,oT:()=>v,pf:()=>D,vJ:()=>S,wm:()=>m,xj:()=>e});const m="\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",v="\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",e="\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",y="\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",D="\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",a="\nquery UploadHistoryAvailableDateRange {\n    uploadHistoryAvailableDateRange {\n        start\n        end\n    }\n}",S="\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}"},5487:(te,Z,t)=>{"use strict";t.d(Z,{r:()=>D});var m=t(8645),v=t(5619),e=t(446),y=t(9212);let D=(()=>{var a;class S{constructor(p){this.uploadPreferencesService=p,this.selectedFileListArray=[],this.actionSubject=new m.x,this.uploadingFileQueueSubject=new m.x,this.uploadingFileErrorSubject=new m.x,this.currentFolderPathSubject=new m.x,this.layoutOptionsSubject=new m.x,this.renameEntitySubject=new m.x,this.entityPendingSubject=new m.x,this.deleteFileSubject=new m.x,this.uploadedFileSubject=new m.x,this.draggedFileListSubject=new m.x,this.startUploadSubject=new m.x,this.startMoveSubject=new m.x,this.selectedFileListSubject=new v.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(p){this.actionSubject.next(p)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(p){this.uploadPreferencesService.layoutOptions=p,this.layoutOptionsSubject.next(p)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(p){this.uploadPreferencesService.lastFolderPath=p,this.currentFolderPathSubject.next(p)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(p){this.uploadingFileQueueSubject.next(p)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(p){this.uploadingFileErrorSubject.next(p)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(p){this.renameEntitySubject.next(p)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(p){this.entityPendingSubject.next(p)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(p){this.deleteFileSubject.next(p)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(p){this.uploadedFileSubject.next(p)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(p){this.draggedFileListSubject.next(p)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(p){this.startUploadSubject.next(p)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(p){this.startMoveSubject.next(p)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(p){if(Array.isArray(p)||(p=[p]),0===p.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let O=!1;for(const E of p){const c=this.selectedFileListArray.findIndex(U=>U.name===E.name);E.selected?-1===c&&(this.selectedFileListArray.push({name:E.name}),O=!0):c>-1&&(this.selectedFileListArray.splice(c,1),O=!0)}O&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return(a=S).\u0275fac=function(p){return new(p||a)(y.LFG(e.p))},a.\u0275prov=y.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),S})()},446:(te,Z,t)=>{"use strict";t.d(Z,{p:()=>S});var m=t(6306),v=t(7165),e=t(463),y=t(1990),D=t(2986),a=t(9212);let S=(()=>{var K;class p{constructor(E,c){this.preferencesService=E,this.urlQueryParamsService=c;const U=this.urlQueryParamsService.getAndDeleteParam(v.RT.UPLOAD_PATH);U&&(this.lastFolderPath=U.split("/").filter(C=>C.length>0))}get preferences(){return this.preferencesService.getItem(v.Ye.UPLOAD)||y.vV}set preferences(E){this.preferencesService.setItem(v.Ye.UPLOAD,E)}get lastFolderPath(){return(this.preferences.lastPath||y.vV.lastPath).filter(E=>E.length>0)}set lastFolderPath(E){const c=this.preferences;c.lastPath=E,this.preferences=c}get layoutOptions(){const E=y.vV.layout,c=this.preferences.layout;return c&&0===Object.keys(E).filter(U=>!(0,m.o8)(c,U)).length?c:E}set layoutOptions(E){const c=this.preferences;c.layout=E,this.preferences=c}get uploader(){const E=this.preferences.uploader||y.vV.uploader;return!E.checkImage.active&&Date.now()-E.checkImage.time>6048e5&&(E.checkImage.active=!0,this.uploader=E),(0,m.o8)(E,"showLinkModal")||(E.showLinkModal=!1),E}set uploader(E){const c=this.preferences;c.uploader=E,this.preferences=c}}return(K=p).\u0275fac=function(E){return new(E||K)(a.LFG(e.y),a.LFG(D.J))},K.\u0275prov=a.Yz7({token:K,factory:K.\u0275fac,providedIn:"root"}),p})()},658:(te,Z,t)=>{"use strict";t.d(Z,{C:()=>C});var m=t(1413),v=t(5861),e=t(6306),y=t(4036),D=t(5172),a=t(9054),S=t(5571),K=t(5983),p=t(1990),O=t(446),E=t(4004),c=t(9212),U=t(9862);let C=(()=>{var B;class H{constructor(L,R,A,d){this.graphqlService=L,this.uploadCacheService=R,this.uploadPreferencesService=A,this.http=d}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(e._3.UUID,(0,E.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(e._3.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(e._3.UUID)||""}getFileList(L,R){var A=this;return(0,v.Z)(function*(){const d=A.uploadCacheService.getItem(L);if(d)return d;const T=(yield A.graphqlService.query({query:S.wm,variables:{scope:R,target:L.join("/")}})).data.uploadEntitiesListToken,i=yield A.sendRequest(T),M={files:i.files.map(P=>{const k=(0,a.Tb)(P.url);return(0,m.Z)((0,m.Z)({},P),{time:1e3*P.time,filename:k.filename,ext:k.ext,isImage:(0,a.Or)(k.ext),embedUrl:"".concat(P.url,"?t=").concat(P.time),type:D.VC.FILE})}),folders:i.folders.map(P=>(0,m.Z)((0,m.Z)({},P),{},{type:D.VC.FOLDER}))};return A.uploadCacheService.setItem(L,M),M})()}createDirectory(L,R){var A=this;return(0,v.Z)(function*(){const d=(yield A.graphqlService.mutate({mutation:S.xj,variables:{scope:R,target:L.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield A.sendRequest(d)})()}moveRenameEntity(L,R,A,d,T){var i=this;return(0,v.Z)(function*(){d||(d=A);const f=(yield i.graphqlService.mutate({mutation:S.jt,variables:{scope:T,source:(L.length?"".concat(L.join("/"),"/"):"")+A,target:(R.length?"".concat(R.join("/"),"/"):"")+d}})).data.uploadEntitiesMoveToken,M=yield i.sendRequest(f);return(0,m.Z)((0,m.Z)({},M),{},{time:1e3*M.time})})()}deleteEntity(L,R,A){var d=this;return(0,v.Z)(function*(){const T=(yield d.graphqlService.mutate({mutation:S.pf,variables:{scope:A,target:(L.length?"".concat(L.join("/"),"/"):"")+R}})).data.uploadEntitiesDeleteToken;return yield d.sendRequest(T),!0})()}getHostToken(L,R,A){var d=this;return(0,v.Z)(function*(){return(yield d.graphqlService.query({query:S.oT,variables:{scope:A,target:(L.length?"".concat(L.join("/"),"/"):"")+R}})).data.uploadEntitiesHostToken})()}sendRequest(L){var R=this;return(0,v.Z)(function*(){return(yield(0,y.z)(R.http.post(p.ql,JSON.stringify({payload:L}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(L,R){var A=this;return(0,v.Z)(function*(){return yield A.graphqlService.subscribe({query:S.vJ,variables:{scope:R}},d=>{var T;if(null===(T=d.data)||void 0===T||!T.uploadEntities)return;const i=JSON.parse(d.data.uploadEntities.eventMessage);!i.payload.customHeaders||!(0,e.o8)(i.payload.customHeaders,e._3.UUID)||i.payload.customHeaders[e._3.UUID]===A.getGqlIdHeader()||L({type:d.data.uploadEntities.eventType,message:i})})})()}}return(B=H).\u0275fac=function(L){return new(L||B)(c.LFG(e.Jk),c.LFG(K.B),c.LFG(O.p),c.LFG(U.eN))},B.\u0275prov=c.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"}),H})()},9054:(te,Z,t)=>{"use strict";t.d(Z,{$H:()=>se,JN:()=>E,LZ:()=>U,Lv:()=>S,Or:()=>H,Tb:()=>D,g0:()=>T,g8:()=>d,jL:()=>B,lY:()=>K,ok:()=>R,rQ:()=>A,rc:()=>L,zO:()=>a});var m=t(5861),v=t(1413),e=t(5172),y=t(1990);function D(i){let f=i;if(i.indexOf("/")>-1){const j=i.split("/");f=j[j.length-1]}const M=f.replace(/\?.*$/,"").split("."),P=M.length>1?M[M.length-1].toLowerCase():"",k=decodeURIComponent(M.slice(0,-1).join("."));return{ext:P,filename:k,name:P?"".concat(k,".").concat(P):""}}function a(i,f={}){const M=D(i),P=Date.now();return(0,v.Z)({name:M.name,size:0,time:P,url:i,ext:M.ext,filename:M.filename,isImage:H(M.ext),embedUrl:"".concat(i,"?t=").concat(P),type:e.VC.FILE},f)}function S(i){let f=i;f.endsWith("/")&&(f=f.slice(0,-1));const M=f.split("/");return{name:decodeURIComponent(M[M.length-1])}}function K(i){return{name:S(i).name,url:i,type:e.VC.FOLDER}}function p(i){return O.apply(this,arguments)}function O(){return(O=(0,m.Z)(function*(i){const f=new FileReader,M=new Promise(P=>f.addEventListener("load",()=>P(f.result)));return f.readAsDataURL(i),M})).apply(this,arguments)}function E(i){return c.apply(this,arguments)}function c(){return(c=(0,m.Z)(function*(i){const f=new DataView(yield i.arrayBuffer());if(2303741511===f.getUint32(0)&&218765834===f.getUint32(4)){if(-1===[4,6].indexOf(f.getUint8(25)))return!1;const P=Object.assign(new Image,{src:yield p(i)});yield new Promise(G=>P.addEventListener("load",()=>G(!0)));const k=Object.assign(document.createElement("canvas"),{width:P.width,height:P.height}).getContext("2d");if(!k)return!1;k.imageSmoothingEnabled=!1,k.drawImage(P,0,0);const j=null==k?void 0:k.getImageData(0,0,P.width,P.height);if(j)for(let G=0;G<j.data.length;G+=4)if(j.data[G+3]<255)return!0}return!1})).apply(this,arguments)}function U(i){return C.apply(this,arguments)}function C(){return(C=(0,m.Z)(function*(i){const f=Object.assign(new Image,{src:yield p(i)});return yield new Promise(M=>f.addEventListener("load",()=>M(!0))),f})).apply(this,arguments)}function B(i){return i.map(f=>({name:f.name,ext:f.ext,type:e.VC.FILE,url:f.url,embedUrl:f.embedUrl,isImage:f.isImage}))}function H(i,f=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(i)&&!f.includes(i)}function se(i){return H(i,["gif","svg"])}function L(i,f,M,P=[],k=""){const j=(0,v.Z)({},y.uJ),G=i.trim();j.invalidLength=0===G.length;const ne=(G+k).replace(/\s{2,}/g," ");return j.alreadyUsed=f!==G&&P.includes(ne),j.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(i),j.invalidCharacter=!(M===e.VC.FILE?y.JJ.test(i):y.b3.test(i)),j}function R(i,f){return i.join("/")===f.join("/")}function A(i){const f=[],M=[];for(const P of i)P.type===e.VC.FILE?f.push(P):M.push(P);return{[e.VC.FILE]:f,[e.VC.FOLDER]:M}}function d(i){return y.KK.find(f=>-1!==f.ext.indexOf(i))}function T(i,f){return f=f||D(i.name),{file:{name:i.name,size:i.size,time:0,url:"",ext:f.ext,filename:f.filename,isImage:H(f.ext),embedUrl:"",type:e.VC.FILE},progress:0,completed:!1}}},4887:(te,Z,t)=>{"use strict";t.d(Z,{q:()=>se});var m=t(5861),v=t(1413),e=t(4315),y=t.n(e),D=t(9054),a=t(9862),S=t(8645),K=t(1687),p=t(9773),O=t(4036),E=t(1990),c=t(5487),U=t(658),C=function(L){return L[L.ORIENTATION=0]="ORIENTATION",L[L.CAMERA_MODEL=1]="CAMERA_MODEL",L}(C||{});class B{static findApp1Marker(R){const A=new DataView(R),d=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let T=0;T<R.byteLength-2;T+=2){const i=A.getUint16(T);if(65505===i)return{offset:T,size:A.getUint16(T+2),little:18761==A.getUint16(T+8,!1)};if(d.has(i))break}}static stripAndReturnExif(R){return(0,m.Z)(function*(){const A=yield R.arrayBuffer(),d=B.findApp1Marker(A);return d?{file:new File([A.slice(0,d.offset),A.slice(d.offset+d.size+2)],R.name,{type:R.type,lastModified:R.lastModified}),exif:A.slice(d.offset,d.offset+d.size)}:{file:R}})()}static checkExifTagValue(R,A){const d=new DataView(R);if(1165519206!==d.getUint32(4,!1))return;const T=18761===d.getUint16(10,!1);let i=10;i+=d.getUint32(i+4,T);const f=d.getUint16(i,T);i+=2;for(let M=0;M<f;M++){const P=d.getUint16(i+12*M,T);if(A===C.ORIENTATION&&274===P)return d.getUint16(i+12*M+8,T);if(A===C.CAMERA_MODEL&&272===P){const k=d.getUint32(i+12*M+4,T),j=d.getUint32(i+12*M+8,T),G=new Uint8Array(R,j,k),ne=Array.from(G);return String.fromCharCode.apply(null,ne)}}}}var H=t(9212);let se=(()=>{var L;class R{constructor(d,T,i){this.http=d,this.uploadObservablesService=T,this.uploadService=i,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return(0,v.Z)({},this.uploaderOptionsObject)}set uploaderOptions(d){this.uploaderOptionsObject=(0,v.Z)({},d)}prepareFile(d,T){var i=this;return(0,m.Z)(function*(){const f=yield i.orientAndCompressFileIfNeeded(d);return f.compressorCheck?f.file:T.compress?yield i.compressFileIfNeeded(d,T.imageDimensions?{width:T.imageDimensions.width,height:T.imageDimensions.height}:{}):d})()}compressFileIfNeeded(d,T={},i=!1){return(0,m.Z)(function*(){const f=["image/png","image/jpeg"],M=(0,v.Z)({strict:!0,checkOrientation:!0,quality:.8,convertSize:1},T),P=void 0!==M.width||void 0!==M.height;P&&(f.push("image/webp"),M.resize="cover",M.strict=T.strict||!1);const k=d.type.toLowerCase();return d.size<=1e6&&!P&&!i||-1===f.indexOf(d.type.toLowerCase())?d:("image/png"===k&&(yield(0,D.JN)(d))&&(M.convertSize=1/0),new Promise((j,G)=>{new(y())(d,(0,v.Z)((0,v.Z)({},M),{},{success:ne=>{const le=ne instanceof Blob?new File([ne],d.name,{type:d.type,lastModified:d.lastModified}):d;j(le)},error:G}))}))})()}getDimensionsForForcedResize(d){return(0,m.Z)(function*(){const i=yield(0,D.LZ)(d),f=i.width>i.height?"width":"height";if(i[f]>1e3)return{[f]:1e3}})()}orientAndCompressFileIfNeeded(d){var T=this;return(0,m.Z)(function*(){if(-1===["image/jpeg"].indexOf(d.type.toLowerCase()))return{file:d,compressorCheck:!1};const f=yield B.stripAndReturnExif(d),M=f.file;if(f.exif){if(void 0!==B.checkExifTagValue(f.exif,C.CAMERA_MODEL)){const G=yield T.getDimensionsForForcedResize(d);if(G)return{file:yield T.compressFileIfNeeded(d,(0,v.Z)({strict:!0,quality:.7},G)),compressorCheck:!0}}if(1!==B.checkExifTagValue(f.exif,C.ORIENTATION))return{file:yield T.compressFileIfNeeded(d,{},!0),compressorCheck:!0}}return{file:M,compressorCheck:!1}})()}upload(d,T,i,f=!1){const M=new S.x,P=new FormData;P.append("payload",T),P.append("upload",d,d.name),f&&P.append("allowOverwrite","1");const k=this.http.request(new a.aW("POST",E.ql,P,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(k.subscribe({next:j=>{if(j.type===a.dt.UploadProgress){if(!j.total||(i.progress=Math.round(50*j.loaded/j.total)+20,i.progress<70))return;(0,K.F)(1e3).pipe((0,p.R)(M.asObservable())).subscribe(()=>{if(i.progress<95){const le=Math.round(8*Math.random()+8);i.progress+le>95?i.progress=95:i.progress+=le}})}else if(j instanceof a.Zn){var G,ne;if(i.progress=100,i.completed=!0,null!==(G=j.body)&&void 0!==G&&G.error||null===(ne=j.body)||void 0===ne||!ne.success)i.error=!0,this.uploadObservablesService.pushUploadingFileError(i);else{i.file.url=j.body.success.url,i.file.time=Date.now(),i.file.embedUrl="".concat(i.file.url,"?t=").concat(i.file.time);const le=(0,D.Tb)(i.file.url);i.file.name=le.name,i.file.filename=le.filename}M.next(i),M.complete()}},error:()=>{i.error=!0,this.uploadObservablesService.pushUploadingFileError(i),M.next(i),M.complete()}})),M.asObservable()}uploadFromList(d,T=[],i){var f=this;return(0,m.Z)(function*(){const M=[];for(const P of d){const k=(0,D.Tb)(P.name),j=(0,D.g8)(k.ext);if(!j||P.size>j.maxSize||i&&!i(k))continue;const G=yield f.prepareFile(P,{compress:!0}),ne=yield f.uploadService.getHostToken(T,P.name);M.push(yield(0,O.z)(f.upload(G,ne,(0,D.g0)(G,k))))}return M})()}clearPendingRequests(){for(const d of this.requestSubscriptions)d.unsubscribe();this.requestSubscriptions=[]}}return(L=R).\u0275fac=function(d){return new(d||L)(H.LFG(a.eN),H.LFG(c.r),H.LFG(U.C))},L.\u0275prov=H.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),R})()},4315:function(te){te.exports=function(){"use strict";function Z(g,n){var s=Object.keys(g);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(g);n&&(l=l.filter(function(x){return Object.getOwnPropertyDescriptor(g,x).enumerable})),s.push.apply(s,l)}return s}function t(g){for(var n=1;n<arguments.length;n++){var s=null!=arguments[n]?arguments[n]:{};n%2?Z(Object(s),!0).forEach(function(l){y(g,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(s)):Z(Object(s)).forEach(function(l){Object.defineProperty(g,l,Object.getOwnPropertyDescriptor(s,l))})}return g}function v(g,n){for(var s=0;s<n.length;s++){var l=n[s];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(g,S(l.key),l)}}function y(g,n,s){return(n=S(n))in g?Object.defineProperty(g,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):g[n]=s,g}function D(){return D=Object.assign?Object.assign.bind():function(g){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(g[l]=s[l])}return g},D.apply(this,arguments)}function S(g){var n=function a(g,n){if("object"!=typeof g||null===g)return g;var s=g[Symbol.toPrimitive];if(void 0!==s){var l=s.call(g,n||"default");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(g)}(g,"string");return"symbol"==typeof n?n:String(n)}var g,n,s,l,x,b,z,J,K={exports:{}};g=K,typeof window>"u"||(n=window,s=n.HTMLCanvasElement&&n.HTMLCanvasElement.prototype,l=n.Blob&&function(){try{return!!new Blob}catch(F){return!1}}(),x=l&&n.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(F){return!1}}(),b=n.BlobBuilder||n.WebKitBlobBuilder||n.MozBlobBuilder||n.MSBlobBuilder,z=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,J=(l||b)&&n.atob&&n.ArrayBuffer&&n.Uint8Array&&function(F){var W,V,$,re,Y,I,ie,q,ue;if(!(W=F.match(z)))throw new Error("invalid data URI");for(V=W[2]?W[1]:"text/plain"+(W[3]||";charset=US-ASCII"),$=!!W[4],re=F.slice(W[0].length),Y=$?atob(re):decodeURIComponent(re),I=new ArrayBuffer(Y.length),ie=new Uint8Array(I),q=0;q<Y.length;q+=1)ie[q]=Y.charCodeAt(q);return l?new Blob([x?ie:I],{type:V}):((ue=new b).append(I),ue.getBlob(V))},n.HTMLCanvasElement&&!s.toBlob&&(s.mozGetAsFile?s.toBlob=function(F,W,V){var $=this;setTimeout(function(){F(V&&s.toDataURL&&J?J($.toDataURL(W,V)):$.mozGetAsFile("blob",W))})}:s.toDataURL&&J&&(s.toBlob=s.msToBlob?function(F,W,V){var $=this;setTimeout(function(){F((W&&"image/png"!==W||V)&&s.toDataURL&&J?J($.toDataURL(W,V)):$.msToBlob(W))})}:function(F,W,V){var $=this;setTimeout(function(){F(J($.toDataURL(W,V)))})})),g.exports?g.exports=J:n.dataURLtoBlob=J);var p=K.exports,E={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},U=typeof window<"u"&&typeof window.document<"u"?window:{},C=function(n){return n>0&&n<1/0},B=Array.prototype.slice;function H(g){return Array.from?Array.from(g):B.call(g)}var se=/^image\/.+$/;function L(g){return se.test(g)}var A=String.fromCharCode;var T=U.btoa;function i(g,n){for(var s=[],x=new Uint8Array(g);x.length>0;)s.push(A.apply(null,H(x.subarray(0,8192)))),x=x.subarray(8192);return"data:".concat(n,";base64,").concat(T(s.join("")))}function f(g){var s,n=new DataView(g);try{var l,x,b;if(255===n.getUint8(0)&&216===n.getUint8(1))for(var z=n.byteLength,J=2;J+1<z;){if(255===n.getUint8(J)&&225===n.getUint8(J+1)){x=J;break}J+=1}if(x){var W=x+10;if("Exif"===function d(g,n,s){var x,l="";for(s+=n,x=n;x<s;x+=1)l+=A(g.getUint8(x));return l}(n,x+4,4)){var V=n.getUint16(W);if(((l=18761===V)||19789===V)&&42===n.getUint16(W+2,l)){var $=n.getUint32(W+4,l);$>=8&&(b=W+$)}}}if(b){var Y,I,re=n.getUint16(b,l);for(I=0;I<re;I+=1)if(274===n.getUint16(Y=b+12*I+2,l)){s=n.getUint16(Y+=8,l),n.setUint16(Y,1,l);break}}}catch(ie){s=1}return s}var P=/\.\d*(?:0|9){12}\d*$/;function k(g){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return P.test(g)?Math.round(g*n)/n:g}function j(g){var n=g.aspectRatio,s=g.height,l=g.width,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",b=C(l),z=C(s);if(b&&z){var J=s*n;("contain"===x||"none"===x)&&J>l||"cover"===x&&J<l?s=l/n:l=s*n}else b?s=l/n:z&&(l=s*n);return{width:l,height:s}}var le=U.ArrayBuffer,he=U.FileReader,ce=U.URL||U.webkitURL,Ue=/\.\w+$/,xe=U.Compressor,ye=function(){function g(n,s){(function m(g,n){if(!(g instanceof n))throw new TypeError("Cannot call a class as a function")})(this,g),this.file=n,this.exif=[],this.image=new Image,this.options=t(t({},E),s),this.aborted=!1,this.result=null,this.init()}return function e(g,n,s){return n&&v(g.prototype,n),s&&v(g,s),Object.defineProperty(g,"prototype",{writable:!1}),g}(g,[{key:"init",value:function(){var s=this,l=this.file,x=this.options;if(function(n){return!(typeof Blob>"u")&&(n instanceof Blob||"[object Blob]"===Object.prototype.toString.call(n))}(l)){var b=l.type;if(L(b))if(ce&&he){le||(x.checkOrientation=!1,x.retainExif=!1);var z="image/jpeg"===b,J=z&&x.checkOrientation,F=z&&x.retainExif;if(!ce||J||F){var W=new he;this.reader=W,W.onload=function(V){var re=V.target.result,Y={},I=1;J&&(I=f(re))>1&&D(Y,function M(g){var n=0,s=1,l=1;switch(g){case 2:s=-1;break;case 3:n=-180;break;case 4:l=-1;break;case 5:n=90,l=-1;break;case 6:n=90;break;case 7:n=90,s=-1;break;case 8:n=-90}return{rotate:n,scaleX:s,scaleY:l}}(I)),F&&(s.exif=function G(g){for(var n=H(new Uint8Array(g)),s=n.length,l=[],x=0;x+3<s;){var b=n[x],z=n[x+1];if(255===b&&218===z)break;if(255===b&&216===z)x+=2;else{var F=x+(256*n[x+2]+n[x+3])+2,W=n.slice(x,F);l.push(W),x=F}}return l.reduce(function(V,$){return 255===$[0]&&225===$[1]?V.concat($):V},[])}(re)),Y.url=J||F?!ce||I>1?i(re,b):ce.createObjectURL(l):re,s.load(Y)},W.onabort=function(){s.fail(new Error("Aborted to read the image with FileReader."))},W.onerror=function(){s.fail(new Error("Failed to read the image with FileReader."))},W.onloadend=function(){s.reader=null},J||F?W.readAsArrayBuffer(l):W.readAsDataURL(l)}else this.load({url:ce.createObjectURL(l)})}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(s){var l=this,x=this.file,b=this.image;b.onload=function(){l.draw(t(t({},s),{},{naturalWidth:b.naturalWidth,naturalHeight:b.naturalHeight}))},b.onabort=function(){l.fail(new Error("Aborted to load the image."))},b.onerror=function(){l.fail(new Error("Failed to load the image."))},U.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(U.navigator.userAgent)&&(b.crossOrigin="anonymous"),b.alt=x.name,b.src=s.url}},{key:"draw",value:function(s){var l=this,x=s.naturalWidth,b=s.naturalHeight,z=s.rotate,J=void 0===z?0:z,F=s.scaleX,W=void 0===F?1:F,V=s.scaleY,$=void 0===V?1:V,re=this.file,Y=this.image,I=this.options,ie=document.createElement("canvas"),q=ie.getContext("2d"),ue=Math.abs(J)%180==90,me=("contain"===I.resize||"cover"===I.resize)&&C(I.width)&&C(I.height),_=Math.max(I.maxWidth,0)||1/0,N=Math.max(I.maxHeight,0)||1/0,h=Math.max(I.minWidth,0)||0,u=Math.max(I.minHeight,0)||0,r=x/b,o=I.width,w=I.height;if(ue){var X=[N,_];_=X[0],N=X[1];var ee=[u,h];h=ee[0],u=ee[1];var oe=[w,o];o=oe[0],w=oe[1]}me&&(r=o/w);var de=j({aspectRatio:r,width:_,height:N},"contain");_=de.width,N=de.height;var ge=j({aspectRatio:r,width:h,height:u},"cover");if(h=ge.width,u=ge.height,me){var pe=j({aspectRatio:r,width:o,height:w},I.resize);o=pe.width,w=pe.height}else{var _e=j({aspectRatio:r,width:o,height:w}),Q=_e.width;o=void 0===Q?x:Q;var ae=_e.height;w=void 0===ae?b:ae}var Oe=-(o=Math.floor(k(Math.min(Math.max(o,h),_))))/2,Me=-(w=Math.floor(k(Math.min(Math.max(w,u),N))))/2,Be=o,je=w,Pe=[];if(me){var be,Ce,Ie=j({aspectRatio:r,width:x,height:b},{contain:"cover",cover:"contain"}[I.resize]);Pe.push((x-(be=Ie.width))/2,(b-(Ce=Ie.height))/2,be,Ce)}if(Pe.push(Oe,Me,Be,je),ue){var Le=[w,o];o=Le[0],w=Le[1]}ie.width=o,ie.height=w,L(I.mimeType)||(I.mimeType=re.type);var Se="transparent";re.size>I.convertSize&&I.convertTypes.indexOf(I.mimeType)>=0&&(I.mimeType="image/jpeg");var Re="image/jpeg"===I.mimeType;if(Re&&(Se="#fff"),q.fillStyle=Se,q.fillRect(0,0,o,w),I.beforeDraw&&I.beforeDraw.call(this,q,ie),!this.aborted&&(q.save(),q.translate(o/2,w/2),q.rotate(J*Math.PI/180),q.scale(W,$),q.drawImage.apply(q,[Y].concat(Pe)),q.restore(),I.drew&&I.drew.call(this,q,ie),!this.aborted)){var we=function(ve){if(!l.aborted){var Fe=function(Ee){return l.done({naturalWidth:x,naturalHeight:b,result:Ee})};if(ve&&Re&&I.retainExif&&l.exif&&l.exif.length>0){var We=function(Ee){return Fe(p(i(function ne(g,n){var s=H(new Uint8Array(g));if(255!==s[2]||224!==s[3])return g;var x=[255,216].concat(n,s.slice(4+(256*s[4]+s[5])));return new Uint8Array(x)}(Ee,l.exif),I.mimeType)))};if(ve.arrayBuffer)ve.arrayBuffer().then(We).catch(function(){l.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var fe=new he;l.reader=fe,fe.onload=function(Te){We(Te.target.result)},fe.onabort=function(){l.fail(new Error("Aborted to read the compressed image with FileReader."))},fe.onerror=function(){l.fail(new Error("Failed to read the compressed image with FileReader."))},fe.onloadend=function(){l.reader=null},fe.readAsArrayBuffer(ve)}}else Fe(ve)}};ie.toBlob?ie.toBlob(we,I.mimeType,I.quality):we(p(ie.toDataURL(I.mimeType,I.quality)))}}},{key:"done",value:function(s){var l=s.naturalWidth,x=s.naturalHeight,b=s.result,z=this.file,J=this.image,F=this.options;if(ce&&0===J.src.indexOf("blob:")&&ce.revokeObjectURL(J.src),b)if(F.strict&&!F.retainExif&&b.size>z.size&&F.mimeType===z.type&&!(F.width>l||F.height>x||F.minWidth>l||F.minHeight>x||F.maxWidth<l||F.maxHeight<x))b=z;else{var W=new Date;b.lastModified=W.getTime(),b.lastModifiedDate=W,b.name=z.name,b.name&&b.type!==z.type&&(b.name=b.name.replace(Ue,function R(g){var n=L(g)?g.substr(6):"";return"jpeg"===n&&(n="jpg"),".".concat(n)}(b.type)))}else b=z;this.result=b,F.success&&F.success.call(this,b)}},{key:"fail",value:function(s){var l=this.options;if(!l.error)throw s;l.error.call(this,s)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=xe,g}},{key:"setDefaults",value:function(s){D(E,s)}}]),g}();return ye}()},1687:(te,Z,t)=>{"use strict";t.d(Z,{F:()=>e});var m=t(6321),v=t(4825);function e(y=0,D=m.z){return y<0&&(y=0),(0,v.H)(y,y,D)}},4004:(te,Z,t)=>{"use strict";t.d(Z,{Z:()=>E});const v={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let e;const y=new Uint8Array(16);function D(){if(!e&&(e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(y)}const a=[];for(let c=0;c<256;++c)a.push((c+256).toString(16).slice(1));const E=function O(c,U,C){if(v.randomUUID&&!U&&!c)return v.randomUUID();const B=(c=c||{}).random||(c.rng||D)();if(B[6]=15&B[6]|64,B[8]=63&B[8]|128,U){C=C||0;for(let H=0;H<16;++H)U[C+H]=B[H];return U}return function S(c,U=0){return a[c[U+0]]+a[c[U+1]]+a[c[U+2]]+a[c[U+3]]+"-"+a[c[U+4]]+a[c[U+5]]+"-"+a[c[U+6]]+a[c[U+7]]+"-"+a[c[U+8]]+a[c[U+9]]+"-"+a[c[U+10]]+a[c[U+11]]+a[c[U+12]]+a[c[U+13]]+a[c[U+14]]+a[c[U+15]]}(B)}}}]);