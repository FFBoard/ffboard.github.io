(self.webpackChunkboard=self.webpackChunkboard||[]).push([[620],{9969:(Y,j,t)=>{"use strict";t.d(j,{R:()=>m});class m{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(U=>U in this).forEach(U=>this[U]=e[U]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(U=>U in this).forEach(U=>this[U]=e[U].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},2020:(Y,j,t)=>{"use strict";t.d(j,{y:()=>_});var m=t(5861);var I=t(4650);let _=(()=>{class f{constructor(){this.autoRotateSupported=function e(){return new Promise(f=>{const O=new Image;O.onload=()=>{f(1===O.width&&2===O.height)},O.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(i,x){return new Promise((s,M)=>{const P=new FileReader;P.onload=d=>{this.loadImage(d.target.result,i.type,x).then(s).catch(M)},P.readAsDataURL(i)})}loadImage(i,x,s){return this.isValidImageType(x)?this.loadBase64Image(i,s):Promise.reject(new Error("Invalid image type"))}isValidImageType(i){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(i)}loadImageFromURL(i,x){return new Promise((s,M)=>{const P=new Image;P.onerror=()=>M,P.onload=()=>{const d=document.createElement("canvas"),E=d.getContext("2d");d.width=P.width,d.height=P.height,E?.drawImage(P,0,0),this.loadBase64Image(d.toDataURL(),x).then(s)},P.crossOrigin="anonymous",P.src=i})}loadBase64Image(i,x){return new Promise((s,M)=>{const P=new Image;P.onload=()=>s({originalImage:P,originalBase64:i}),P.onerror=M,P.src=i}).then(s=>this.transformImageBase64(s,x))}transformImageBase64(i,x){var s=this;return(0,m.Z)(function*(){const M=yield s.autoRotateSupported,P=yield function U(f){switch("string"==typeof f&&(f=function R(f){const O=new DataView(function h(f){f=f.replace(/^data\:([^\;]+)\;base64,/gim,"");const O=atob(f),i=O.length,x=new Uint8Array(i);for(let s=0;s<i;s++)x[s]=O.charCodeAt(s);return x.buffer}(f));if(65496!==O.getUint16(0,!1))return-2;const i=O.byteLength;let x=2;for(;x<i;){if(O.getUint16(x+2,!1)<=8)return-1;const s=O.getUint16(x,!1);if(x+=2,65505==s){if(1165519206!==O.getUint32(x+=2,!1))return-1;const M=18761==O.getUint16(x+=6,!1);x+=O.getUint32(x+4,M);const P=O.getUint16(x,M);x+=2;for(let d=0;d<P;d++)if(274==O.getUint16(x+12*d,M))return O.getUint16(x+12*d+8,M)}else{if(65280!=(65280&s))break;x+=O.getUint16(x,!1)}}return-1}(f)),f){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(M?-1:i.originalBase64);return i.originalImage&&i.originalImage.complete?s.transformLoadedImage({original:{base64:i.originalBase64,image:i.originalImage,size:{width:i.originalImage.naturalWidth,height:i.originalImage.naturalHeight}},exifTransform:P},x):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(i,x){var s=this;return(0,m.Z)(function*(){const M=x.canvasRotation+i.exifTransform.rotate,P={width:i.original.image.naturalWidth,height:i.original.image.naturalHeight};if(0===M&&!i.exifTransform.flip&&!x.containWithinAspectRatio)return{original:{base64:i.original.base64,image:i.original.image,size:{...P}},transformed:{base64:i.original.base64,image:i.original.image,size:{...P}},exifTransform:i.exifTransform};const d=s.getTransformedSize(P,i.exifTransform,x),E=document.createElement("canvas");E.width=d.width,E.height=d.height;const F=E.getContext("2d");F?.setTransform(i.exifTransform.flip?-1:1,0,0,1,E.width/2,E.height/2),F?.rotate(Math.PI*(M/2)),F?.drawImage(i.original.image,-P.width/2,-P.height/2);const p=E.toDataURL(),A=yield s.loadImageFromBase64(p);return{original:{base64:i.original.base64,image:i.original.image,size:{...P}},transformed:{base64:p,image:A,size:{width:A.width,height:A.height}},exifTransform:i.exifTransform}})()}loadImageFromBase64(i){return new Promise((x,s)=>{const M=new Image;M.onload=()=>x(M),M.onerror=s,M.src=i})}getTransformedSize(i,x,s){const M=s.canvasRotation+x.rotate;if(s.containWithinAspectRatio){if(M%2){const d=i.height/s.aspectRatio;return{width:Math.max(i.height,i.width*s.aspectRatio),height:Math.max(i.width,d)}}{const d=i.width/s.aspectRatio;return{width:Math.max(i.width,i.height*s.aspectRatio),height:Math.max(i.height,d)}}}return M%2?{height:i.width,width:i.height}:{width:i.width,height:i.height}}}return f.\u0275fac=function(i){return new(i||f)},f.\u0275prov=I.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},8896:(Y,j,t)=>{"use strict";function m(D){const e=D.split(","),U=e[0].replace("data:","").replace(";base64",""),R=atob(e[1]),h=new ArrayBuffer(R.length),I=new Uint8Array(h);for(let _=0;_<R.length;_+=1)I[_]=R.charCodeAt(_);return new Blob([h],{type:U})}t.d(j,{L:()=>m})},1891:(Y,j,t)=>{"use strict";t.d(j,{B:()=>K});var m=t(5861),D=t(1309),e=t(4650),U=t(4968),R=t(3905),h=t(3848),I=t(1460),_=t(4323),f=t(6986),O=t(575),i=t(7693),x=t(7320),s=t(146),M=t(3612),P=t(6378),d=t(6895),E=t(433),F=t(4029),p=t(8279),A=t(3450),C=t(8212);const Q=["fileInput"];function g(u,w){1&u&&(e.O4$(),e.TgZ(0,"svg",23),e._UZ(1,"path",24)(2,"path",25),e.qZA())}const v=function(){return["text-primary"]};function L(u,w){1&u&&e._UZ(0,"app-logo",26),2&u&&e.Q6J("svgClass",e.DdM(2,v))("responsive",!1)}function b(u,w){1&u&&(e.TgZ(0,"span"),e._uU(1,"Trascina i file da caricare oppure c"),e.qZA())}function Z(u,w){1&u&&(e.TgZ(0,"span"),e._uU(1,"C"),e.qZA())}function N(u,w){if(1&u&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2,"I file verranno caricati nella cartella "),e.qZA(),e._UZ(3,"em",27),e.ALo(4,"arrayJoin"),e.BQk()),2&u){const a=e.oxw(2);e.xp6(3),e.Q6J("innerText",a.currentFolderPath.length?e.xi3(4,1,a.currentFolderPath,"/"):"root")}}function J(u,w){if(1&u&&(e._UZ(0,"div",32),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&u){const a=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,a.currentFolderPath,0,-1),"/"))}}function X(u,w){if(1&u&&(e.TgZ(0,"div",28)(1,"div",29),e._uU(2,"Cartella:"),e.qZA(),e.YNc(3,J,3,8,"div",30),e._UZ(4,"div",31),e.ALo(5,"arrayJoin"),e.ALo(6,"slice"),e.qZA()),2&u){const a=e.oxw(2);e.xp6(3),e.Q6J("ngIf",a.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(a.currentFolderPath.length>1?"/":"")+(a.currentFolderPath.length?e.xi3(5,2,e.xi3(6,5,a.currentFolderPath,a.currentFolderPath.length-1),"/"):"root"))}}const ee=function(){return{bottom:0,left:0}};function ae(u,w){if(1&u){const a=e.EpF();e.ynx(0),e.TgZ(1,"a",33),e.NdJ("click",function(){e.CHM(a);const n=e.oxw(2);return e.KtG(n.openInfoModal.emit())}),e._uU(2,"Informazioni"),e.qZA(),e.TgZ(3,"div",34),e.NdJ("click",function(){e.CHM(a),e.oxw(2);const n=e.MAs(7);return e.KtG(n.open())}),e._uU(4,"settings"),e.qZA(),e.BQk()}2&u&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(1,ee)))}const y=function(u,w,a){return{"cursor-pointer":u,"p-4":w,"p-2 pb-3":a}},r=function(u,w){return{"fw-bold fs-lg":u,small:w}},o=function(u,w,a){return{"my-2":u,"mb-2":w,"mw-100":a}};function l(u,w){if(1&u){const a=e.EpF();e.ynx(0),e.TgZ(1,"div",15,16),e.NdJ("dragenter",function(){e.CHM(a);const n=e.MAs(2),W=e.oxw();return e.KtG(W.setDragOverEvent(n))})("drop",function(n){e.CHM(a);const W=e.oxw();return e.KtG(W.handleDropEvent(n))})("click",function(){e.CHM(a),e.oxw();const n=e.MAs(2);return e.KtG(n.click())}),e.YNc(3,g,3,0,"svg",17),e.YNc(4,L,1,3,"ng-template",null,18,e.W1O),e.TgZ(6,"div",19),e.YNc(7,b,2,0,"span",20),e.YNc(8,Z,2,0,"span",20),e.TgZ(9,"span"),e._uU(10,"licca per scegliere da memoria"),e.qZA()(),e.TgZ(11,"div",21),e.YNc(12,N,5,4,"ng-container",3),e.YNc(13,X,7,8,"ng-template",null,22,e.W1O),e.qZA()(),e.YNc(15,ae,5,2,"ng-container",20),e.BQk()}if(2&u){const a=e.MAs(5),c=e.MAs(14),n=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(10,y,!n.loading,!n.isWidget,n.isWidget)),e.xp6(2),e.Q6J("ngIf",!n.isWidget)("ngIfElse",a),e.xp6(3),e.Q6J("ngClass",e.WLB(14,r,!n.isWidget,n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.touchDevice),e.xp6(1),e.Q6J("ngIf",n.touchDevice),e.xp6(3),e.Q6J("ngClass",e.kEZ(17,o,!n.isWidget&&!n.touchDevice,!n.isWidget&&n.touchDevice,n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.isWidget)("ngIfElse",c),e.xp6(3),e.Q6J("ngIf",!n.isWidget)}}const B=function(u,w){return{"p-4":u,"p-2":w}};function S(u,w){if(1&u&&(e.TgZ(0,"div",35),e.O4$(),e.TgZ(1,"svg",36),e._UZ(2,"path",37),e.qZA(),e.kcU(),e._UZ(3,"app-loader",38),e.TgZ(4,"div",39),e._uU(5,"Attendi il completamento dell'upload per caricare altre immagini."),e.qZA()()),2&u){const a=e.oxw();e.Q6J("ngClass",e.WLB(3,B,!a.isWidget,a.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",a.loadingMessage)}}const H=function(u,w){return{uploading:u,"widget flex-grow-1":w}};let K=(()=>{class u{constructor(a,c,n,W,T,$,z){this.postMessageService=a,this.uploadService=c,this.uploadObservablesService=n,this.uploaderService=W,this.toastService=T,this.renderer=$,this.ngZone=z,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="Controllo dei file in corso",this.touchDevice=I.eX,this.dragOverEvent=!1,this.options=this.uploaderService.uploaderOptions;const te=this.uploadService.preferences.uploader;te.checkImage.active||(this.options.compress=!1),te.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){this.handleClipboardPasteEvent(),this.handleExternalUpload()}handleClipboardPasteEvent(){var a=this;this.clipboardPasteEventSubscription=(0,U.R)(document.body,"paste").subscribe(function(){var c=(0,m.Z)(function*(n){if(!a.canUpload)return;const W=Array.from((n.clipboardData||n.originalEvent.clipboardData).items);let T=[];for(const $ of W)if(0===$.type.indexOf("image")){const z=$.getAsFile();z&&T.push(z)}T.length>0?yield a.preUpload(T):a.reset()});return function(n){return c.apply(this,arguments)}}())}handleExternalUpload(){var a=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var c=(0,m.Z)(function*(n){if(n){if(!a.canUpload)return;yield a.preUpload([n.file],n.options)}else a.fileInputRef.nativeElement.click()});return function(n){return c.apply(this,arguments)}}())}handleSelectionEvent(a){var c=this;return(0,m.Z)(function*(){if(!c.canUpload)return;const n=a.target;if(n.files&&n.files.length){const W=Array.from(n.files);return n.value="",c.preUpload(W)}c.reset()})()}handleDropEvent(a){var c=this;return(0,m.Z)(function*(){if(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),!c.canUpload)return;const n=a.dataTransfer?.files?Array.from(a.dataTransfer.files):[];if(n.length)return c.preUpload(n);c.reset()})()}saveOptions(a=!0){this.uploaderService.uploaderOptions=this.options,a&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(a){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(a,"dragover",c=>{c.preventDefault()})}))}get canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage="Controllo dei file da caricare",this.postMessageService.send(_.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(a,c){var n=this;return(0,m.Z)(function*(){const W=[...n.currentFolderPath];let T=[],$=[],z=[],te=[];c?c.allowOverwrite=c.allowOverwrite||!1:(c=n.uploaderService.uploaderOptions).allowOverwrite=!1;for(let k=0;k<a.length;k++){let G=c.compress?yield n.uploaderService.compressFileIfNeeded(a[k],c.imageDimensions):a[k];if(G=yield n.uploaderService.orientFileIfNeeded(G),G){const ne=(0,h.Tb)(G.name),ie=f.O8.find(V=>-1!==V.ext.indexOf(ne.ext));if(!ie){z.push(G);continue}if(G.size>ie.maxSize){te.push(G);continue}T.push({file:{name:G.name,size:G.size,time:0,url:"",ext:ne.ext,filename:ne.filename,isImage:(0,h.Or)(ne.ext),embedUrl:""},progress:0,completed:!1}),$.push(G)}}if((z.length||te.length)&&(n.toastService.show({content:n.createToastMessage(z,te),level:D.m.ERROR}),[["UNSUPPORTED",z],["OVERSIZED",te]].forEach(k=>{k[1].forEach(G=>{n.postMessageService.send(_.l.UPLOAD_ERROR,{filename:G.name,error:k[0]})})})),0===$.length)return void n.reset();const oe=`Caricamento file {{fileNumber}} di ${$.length} in corso`;n.uploadObservablesService.pushUploadingFileQueue(T);for(let k=0;k<$.length;++k){n.loadingMessage="Creazione del pacchetto da inviare";const G=yield n.uploadService.getHostToken(W,$[k].name);T[k].progress+=20,n.loadingMessage=oe.replace("{{fileNumber}}",`${k+1}`),yield(0,R.z)(n.uploaderService.upload($[k],T[k],G,c.allowOverwrite))}n.uploadObservablesService.pushUploadingFileQueue([]);const re=T.filter(k=>!k.error).map(k=>k.file);re.length>0&&(n.fileUploadedEvent.emit({list:re,rewrite:c.allowOverwrite,destPath:W}),n.postMessageService.send(_.l.UPLOAD_SUCCESS,{fileList:re.map(k=>({filename:k.name,isImage:k.isImage,url:k.url}))}),c.openLinkModalAfterUpload&&n.uploadObservablesService.pushAction({name:O.In.FILE_SHOW_LINKS,payload:{entities:(0,h.jL)(re)}})),n.reset()})()}createToastMessage(a,c){let n=[];return a.length&&n.push(a.length>1?`I file <strong>${a.map(W=>W.name).join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${a[0].name}</strong> ha un formato non supportato!`),c.length&&n.push(c.length>1?`I file <strong>${c.map(W=>W.name).join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${c[0].name}</strong> \xe8 troppo pesante!`),n.join("<br><br>")}ngOnDestroy(){this.startExternalUploadSubscription?.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return u.\u0275fac=function(a){return new(a||u)(e.Y36(i.F),e.Y36(x.C),e.Y36(s.r),e.Y36(M.q),e.Y36(P.k),e.Y36(e.Qsj),e.Y36(e.R0b))},u.\u0275cmp=e.Xpm({type:u,selectors:[["app-uploader"]],viewQuery:function(a,c){if(1&a&&e.Gf(Q,5),2&a){let n;e.iGM(n=e.CRH())&&(c.fileInputRef=n.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:30,vars:10,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],["title","Opzioni di caricamento"],["optionsModal",""],[1,"mb-1"],[1,"mb-3"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto"],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],[1,"description","text-center",3,"ngClass"],[4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","options-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"]],template:function(a,c){if(1&a&&(e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(W){return c.handleSelectionEvent(W)}),e.qZA(),e.YNc(3,l,16,21,"ng-container",3),e.YNc(4,S,6,6,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6)(8,"p",7),e._uU(9,"Tramite questo modal \xe8 possibile gestire le opzioni di caricamento al momento disponibili:"),e.qZA(),e.TgZ(10,"ul",8)(11,"li")(12,"em"),e._uU(13,"caricamento veloce"),e.qZA(),e._uU(14,": abilitando questa opzione, l'immagine da caricare verr\xe0 adattata per terminare l'operazione di upload nel minor tempo possibile. "),e.qZA(),e.TgZ(15,"li")(16,"em"),e._uU(17,"mostra link dopo l'upload"),e.qZA(),e._uU(18,": abilitando questa opzione, una volta terminato il caricamento verr\xe0 aperto il modal contenente i link utili dei file caricati. "),e.qZA()(),e.TgZ(19,"ul",9)(20,"li")(21,"div",10)(22,"input",11),e.NdJ("ngModelChange",function(W){return c.options.compress=W})("ngModelChange",function(){return c.saveOptions()}),e.qZA(),e.TgZ(23,"label",12),e._uU(24,"Caricamento veloce"),e.qZA()()(),e.TgZ(25,"li")(26,"div",10)(27,"input",13),e.NdJ("ngModelChange",function(W){return c.options.openLinkModalAfterUpload=W})("ngModelChange",function(){return c.saveOptions()}),e.qZA(),e.TgZ(28,"label",14),e._uU(29,"Mostra link dopo l'upload"),e.qZA()()()()()),2&a){const n=e.MAs(5);e.Q6J("ngClass",e.WLB(7,H,c.isUploading,c.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",c.loading||c.isUploading),e.xp6(2),e.Q6J("ngIf",!c.isUploading)("ngIfElse",n),e.xp6(19),e.Q6J("ngModel",c.options.compress),e.xp6(5),e.Q6J("ngModel",c.options.openLinkModalAfterUpload)}},dependencies:[d.mk,d.O5,d.PC,E.Wl,E.JJ,E.On,F.R,p.R,A.z,C.J,d.OU],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864FE;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:400px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.options-icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{top:5px;right:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]:hover{opacity:1}.upload-area[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo){pointer-events:none}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),u})()},1197:(Y,j,t)=>{"use strict";t.d(j,{M:()=>_});var m=t(8694),D=t(6895),e=t(433),U=t(6818),R=t(1043),h=t(582),I=t(4650);let _=(()=>{class f{}return f.\u0275fac=function(i){return new(i||f)},f.\u0275mod=I.oAB({type:f}),f.\u0275inj=I.cJS({imports:[m.r,D.ez,e.u5,U.q,R.h,h.z]}),f})()},8694:(Y,j,t)=>{"use strict";t.d(j,{r:()=>e});var m=t(6895),D=t(4650);let e=(()=>{class U{}return U.\u0275fac=function(h){return new(h||U)},U.\u0275mod=D.oAB({type:U}),U.\u0275inj=D.cJS({imports:[m.ez]}),U})()},8212:(Y,j,t)=>{"use strict";t.d(j,{J:()=>D});var m=t(4650);let D=(()=>{class e{transform(R,h){return R.join(h)}}return e.\u0275fac=function(R){return new(R||e)},e.\u0275pipe=m.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},575:(Y,j,t)=>{"use strict";t.d(j,{In:()=>m,Ky:()=>R,VC:()=>D,c5:()=>U,gG:()=>e});var m=(()=>{return(h=m||(m={})).FILE_SHOW_LINKS="fileLinks",h.FILE_EDIT="fileEdit",h.DELETE="delete",h.RENAME="rename",h.MOVE="move",m;var h})(),D=(()=>{return(h=D||(D={})).FILE="file",h.FOLDER="folder",D;var h})(),e=(()=>{return(h=e||(e={})).FILENAME="filename",h.SIZE="size",h.TIME="time",h.EXTENSION="ext",e;var h})(),U=(()=>{return(h=U||(U={})).GRID="grid",h.LIST="list",U;var h})(),R=(()=>{return(h=R||(R={})).W_768_I_1="(max-width: 767.98px)",h.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",h.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",h.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",h.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",h.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",h.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",h.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",h.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",h.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",h.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",h.W_3738_I_10="(min-width: 3424px)",R;var h})()},6986:(Y,j,t)=>{"use strict";t.d(j,{C7:()=>U,Mi:()=>R,O8:()=>D,er:()=>h,p0:()=>e,xt:()=>I});var m=t(575);const D=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(_=>(_.maxSize*=1048576,_)),e={lastPath:[],layout:{asc:!0,orderBy:m.gG.FILENAME,type:m.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},U="https://upload.forumfree.net/api/",R=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,h=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,I={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},146:(Y,j,t)=>{"use strict";t.d(j,{r:()=>R});var m=t(7579),D=t(1135),e=t(4650),U=t(8745);let R=(()=>{class h{constructor(_){this.uploadPreferencesService=_,this.selectedFileListArray=[],this.actionSubject=new m.x,this.uploadingFileQueueSubject=new m.x,this.uploadingFileErrorSubject=new m.x,this.currentFolderPathSubject=new m.x,this.layoutOptionsSubject=new m.x,this.renameFileSubject=new m.x,this.entityPendingSubject=new m.x,this.deleteFileSubject=new m.x,this.uploadedFileSubject=new m.x,this.draggedFileListSubject=new m.x,this.startUploadSubject=new m.x,this.selectedFileListSubject=new D.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(_){this.actionSubject.next(_)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(_){this.uploadPreferencesService.layoutOptions=_,this.layoutOptionsSubject.next(_)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(_){this.uploadPreferencesService.lastFolderPath=_,this.currentFolderPathSubject.next(_)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(_){this.uploadingFileQueueSubject.next(_)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(_){this.uploadingFileErrorSubject.next(_)}get renameFileObservable(){return this.renameFileSubject.asObservable()}pushRenameFile(_){this.renameFileSubject.next(_)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(_){this.entityPendingSubject.next(_)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(_){this.deleteFileSubject.next(_)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(_){this.uploadedFileSubject.next(_)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(_){this.draggedFileListSubject.next(_)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(_){this.startUploadSubject.next(_)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(_){if(Array.isArray(_)||(_=[_]),0===_.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let f=!1;for(const O of _){const i=this.selectedFileListArray.findIndex(x=>x.name===O.name);O.selected?-1===i&&(this.selectedFileListArray.push({name:O.name}),f=!0):i>-1&&(this.selectedFileListArray.splice(i,1),f=!0)}f&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return h.\u0275fac=function(_){return new(_||h)(e.LFG(U.p))},h.\u0275prov=e.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},8745:(Y,j,t)=>{"use strict";t.d(j,{p:()=>h});var m=t(5044),D=t(6986),e=t(4650),U=t(2381),R=t(6161);let h=(()=>{class I{constructor(f,O){this.preferencesService=f,this.urlQueryParamsService=O;const i=this.urlQueryParamsService.getAndDeleteParam(m.RT.UPLOAD_PATH);i&&(this.lastFolderPath=i.split("/").filter(x=>x.length>0))}get preferences(){return this.preferencesService.getItem(m.Ye.UPLOAD)||D.p0}set preferences(f){this.preferencesService.setItem(m.Ye.UPLOAD,f)}get lastFolderPath(){return(this.preferences.lastPath||D.p0.lastPath).filter(f=>f.length>0)}set lastFolderPath(f){const O=this.preferences;O.lastPath=f,this.preferences=O}get layoutOptions(){const f=D.p0.layout,O=this.preferences.layout;return O&&0===Object.keys(f).filter(i=>!O.hasOwnProperty(i)).length?O:f}set layoutOptions(f){const O=this.preferences;O.layout=f,this.preferences=O}get uploader(){const f=this.preferences.uploader||D.p0.uploader;return!f.checkImage.active&&Date.now()-f.checkImage.time>6048e5&&(f.checkImage.active=!0,this.uploader=f),f.hasOwnProperty("showLinkModal")||(f.showLinkModal=!1),f}set uploader(f){const O=this.preferences;O.uploader=f,this.preferences=O}}return I.\u0275fac=function(f){return new(f||I)(e.LFG(U.y),e.LFG(R.J))},I.\u0275prov=e.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),I})()},7320:(Y,j,t)=>{"use strict";t.d(j,{C:()=>A});var m=t(5861),D=t(7824),e=t(3905),U=t(3848),i=t(6986),x=t(1042),s=t(4650),M=t(5395),P=t(575),d=t(3138);let E=(()=>{class C{constructor(g){this.globalsService=g,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(v=>{this.ffuid=v?v.user.ffuid:""})}getItem(g){const v=this.createKey(g);if(this.cache.hasOwnProperty(v))return this.cache[v]}setItem(g,v){this.cache[this.createKey(g)]=v}removeItem(g){const v=this.createKey(g);if(this.cache.hasOwnProperty(v)){if(this.cache[v].folders.length)for(const L of this.cache[v].folders)this.removeItem([...g,L.name]);return delete this.cache[v],!0}return!1}addEntities(g,v,L=P.VC.FILE){const b=this.createKey(g);return!!this.cache.hasOwnProperty(b)&&(Array.isArray(v)||(v=[v]),L===P.VC.FILE?this.cache[b].files.unshift(...v):this.cache[b].folders.unshift(...v),!0)}removeEntities(g,v,L=P.VC.FILE){if(Array.isArray(v)||(v=[v]),L===P.VC.FOLDER)for(const J of v)this.removeItem([...g,J]);const b=this.createKey(g);if(!this.cache.hasOwnProperty(b))return!1;const Z=L===P.VC.FILE?"files":"folders";let N=!1;for(const J of v){const X=this.cache[b][Z].findIndex(ee=>ee.name===J);X>-1&&(this.cache[b][Z].splice(X,1),N=!0)}return N}refactorFolderContent(g,v){const L=this.createKey(g);if(!this.cache.hasOwnProperty(L))return!1;v.endsWith("/")||(v+="/");for(const b of this.cache[L].folders)b.url=v+b.name;for(const b of this.cache[L].files)b.url=b.embedUrl=v+b.name,b.time=Date.now();return!0}createKey(g){return`${this.ffuid}/${g.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return C.\u0275fac=function(g){return new(g||C)(s.LFG(d.d))},C.\u0275prov=s.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})();var F=t(8745),p=t(529);let A=(()=>{class C{constructor(g,v,L,b){this.graphqlService=g,this.uploadCacheService=v,this.uploadPreferencesService=L,this.http=b}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(D._.HeaderKeys.UUID,(0,x.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(D._.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(D._.HeaderKeys.UUID)||""}getFileList(g,v){var L=this;return(0,m.Z)(function*(){const b=L.uploadCacheService.getItem(g);if(b)return b;const Z=(yield L.graphqlService.query({query:"\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",variables:{scope:v,target:g.join("/")}})).data.uploadEntitiesListToken,N=yield L.sendRequest(Z),X={files:N.files.map(ee=>{const ae=(0,U.Tb)(ee.url);return{...ee,time:1e3*ee.time,filename:ae.filename,ext:ae.ext,isImage:(0,U.Or)(ae.ext),embedUrl:`${ee.url}?t=${ee.time}`}}),folders:N.folders};return L.uploadCacheService.setItem(g,X),X})()}createDirectory(g,v){var L=this;return(0,m.Z)(function*(){const b=(yield L.graphqlService.mutate({mutation:"\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",variables:{scope:v,target:g.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield L.sendRequest(b)})()}moveRenameEntity(g,v,L,b,Z){var N=this;return(0,m.Z)(function*(){b||(b=L);const J=(yield N.graphqlService.mutate({mutation:"\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",variables:{scope:Z,source:(g.length?`${g.join("/")}/`:"")+L,target:(v.length?`${v.join("/")}/`:"")+b}})).data.uploadEntitiesMoveToken;return yield N.sendRequest(J)})()}deleteEntity(g,v,L){var b=this;return(0,m.Z)(function*(){const Z=(yield b.graphqlService.mutate({mutation:"\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",variables:{scope:L,target:(g.length?`${g.join("/")}/`:"")+v}})).data.uploadEntitiesDeleteToken;return yield b.sendRequest(Z),!0})()}getHostToken(g,v,L){var b=this;return(0,m.Z)(function*(){return(yield b.graphqlService.query({query:"\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",variables:{scope:L,target:(g.length?`${g.join("/")}/`:"")+v}})).data.uploadEntitiesHostToken})()}sendRequest(g){var v=this;return(0,m.Z)(function*(){return(yield(0,e.z)(v.http.post(i.C7,JSON.stringify({payload:g}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(g,v){var L=this;return(0,m.Z)(function*(){return yield L.graphqlService.subscribe({query:"\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}",variables:{scope:v}},b=>{if(!b.data?.uploadEntities)return;const Z=JSON.parse(b.data.uploadEntities.eventMessage);if(!Z.payload.customHeaders||!Z.payload.customHeaders.hasOwnProperty(D._.HeaderKeys.UUID)||Z.payload.customHeaders[D._.HeaderKeys.UUID]===L.getGqlIdHeader())return;const N=(Z.payload.content.source||"").split("/"),J=(Z.payload.content.target||"").split("/"),X=J[J.length-1].indexOf(".")>-1;let ee;try{ee=JSON.parse(Z.output).success||""}catch{return}g({type:b.data.uploadEntities.eventType,sourceName:N[N.length-1],sourcePaths:N.slice(0,-1),targetName:J[J.length-1],targetPaths:J.slice(0,-1),isFile:X,output:ee})})})()}getBlobFromUrl(g){var v=this;return(0,m.Z)(function*(){return yield(0,e.z)(v.http.get(g,{responseType:"blob"})).catch(()=>{})})()}}return C.\u0275fac=function(g){return new(g||C)(s.LFG(M.J),s.LFG(E),s.LFG(F.p),s.LFG(p.eN))},C.\u0275prov=s.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},3848:(Y,j,t)=>{"use strict";t.d(j,{$H:()=>s,JN:()=>f,Lv:()=>h,Or:()=>x,Tb:()=>U,jL:()=>i,rc:()=>M,sT:()=>I,zO:()=>R});var m=t(5861),D=t(575),e=t(6986);function U(d){let E=d;if(d.indexOf("/")>-1){const C=d.split("/");E=C[C.length-1]}const F=E.split("."),p=F[F.length-1].toLowerCase(),A=decodeURIComponent(F.slice(0,-1).join("."));return{ext:p,filename:A,name:`${A}.${p}`}}function R(d){const E=U(d),F=Date.now();return{name:E.name,size:0,time:F,url:d,ext:E.ext,filename:E.filename,isImage:x(E.ext),embedUrl:`${d}?t=${F}`}}function h(d){let E=d;E.endsWith("/")&&(E=E.slice(0,-1));const F=E.split("/");return{name:decodeURIComponent(F[F.length-1])}}function I(d){return _.apply(this,arguments)}function _(){return(_=(0,m.Z)(function*(d){const E=new FileReader,F=new Promise(p=>E.addEventListener("load",()=>p(E.result)));return E.readAsDataURL(d),F})).apply(this,arguments)}function f(d){return O.apply(this,arguments)}function O(){return(O=(0,m.Z)(function*(d){const E=new DataView(yield d.arrayBuffer());if(2303741511===E.getUint32(0)&&218765834===E.getUint32(4)){if(-1===[4,6].indexOf(E.getUint8(25)))return!1;const p=Object.assign(new Image,{src:yield I(d)});yield new Promise(Q=>p.addEventListener("load",()=>Q(!0)));const A=Object.assign(document.createElement("canvas"),{width:p.width,height:p.height}).getContext("2d");if(!A)return!1;A.imageSmoothingEnabled=!1,A.drawImage(p,0,0);const C=A?.getImageData(0,0,p.width,p.height);if(C)for(let Q=0;Q<C.data.length;Q+=4)if(C.data[Q+3]<255)return!0}return!1})).apply(this,arguments)}function i(d){return d.map(E=>({name:E.name,ext:E.ext,type:D.VC.FILE,url:E.url,embedUrl:E.embedUrl,isImage:E.isImage}))}function x(d,E=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(d)&&!E.includes(d)}function s(d){return x(d,["gif","svg"])}function M(d,E,F,p=[],A=""){let C={...e.xt};const Q=d.trim();C.invalidLength=0===Q.length;const g=(Q+A).replace(/\s{2,}/g," ");return C.alreadyUsed=E!==Q&&p.includes(g),C.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(d),C.invalidCharacter=!(F===D.VC.FILE?e.Mi.test(d):e.er.test(d)),C}},3612:(Y,j,t)=>{"use strict";t.d(j,{q:()=>d});var m=t(5861),D=t(8896),e=t(6730),U=t.n(e),R=t(9969),h=t(3848),I=t(529),_=t(7579),f=t(7445),O=t(2722),i=t(6986);class x{static findApp1Marker(F){const p=new DataView(F),A=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let C=0;C<F.byteLength-2;C+=2){const Q=p.getUint16(C);if(65505===Q)return{offset:C,size:p.getUint16(C+2),little:18761==p.getUint16(C+8,!1)};if(A.has(Q))break}}static stripAndReturnExif(F){return(0,m.Z)(function*(){const p=yield F.arrayBuffer(),A=x.findApp1Marker(p);return A?{file:new File([p.slice(0,A.offset),p.slice(A.offset+A.size+2)],F.name,{type:F.type,lastModified:F.lastModified}),exif:p.slice(A.offset,A.offset+A.size)}:{file:F}})()}static checkImageOrientation(F){const p=new DataView(F);if(1165519206!=p.getUint32(4,!1))return-1;const A=18761==p.getUint16(10,!1);let C=10;C+=p.getUint32(C+4,A);const Q=p.getUint16(C,A);C+=2;for(let g=0;g<Q;g++)if(274==p.getUint16(C+12*g,A))return p.getUint16(C+12*g+8,A);return-1}}var s=t(4650),M=t(146),P=t(2020);let d=(()=>{class E{constructor(p,A,C){this.http=p,this.uploadObservablesService=A,this.loadImageService=C,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return{...this.uploaderOptionsObject}}set uploaderOptions(p){this.uploaderOptionsObject={...p}}compressFileIfNeeded(p,A){return(0,m.Z)(function*(){let C=["image/png","image/jpeg"],Q={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};A&&(C.push("image/webp"),Q.width=A.width,Q.height=A.height,Q.resize="cover",Q.strict=!1);const g=p.type.toLowerCase();return p.size<=4e6&&void 0===A||-1===C.indexOf(p.type.toLowerCase())?p:("image/png"===g&&(yield(0,h.JN)(p))&&(Q.convertSize=1/0),new Promise((v,L)=>{new(U())(p,{...Q,success:b=>{const Z=b instanceof Blob?new File([b],p.name,{type:p.type,lastModified:p.lastModified}):p;v(Z)},error:L})}))})()}orientFileIfNeeded(p){var A=this;return(0,m.Z)(function*(){if(-1===["image/jpeg"].indexOf(p.type.toLowerCase()))return p;const Q=yield x.stripAndReturnExif(p);if(p=Q.file,Q.exif){const g=x.checkImageOrientation(Q.exif);if(1!==g){let v=0;switch(g){case 3:case 4:v=180;break;case 5:case 6:v=90;break;case 7:case 8:v=270}const L=yield(0,h.sT)(p),b=yield new Promise((N,J)=>{const X=new Image;X.onload=()=>N({originalImage:X,originalBase64:L}),X.onerror=J,X.src=L}),Z=yield A.loadImageService.transformLoadedImage({original:{base64:b.originalBase64,image:b.originalImage,size:{width:b.originalImage.naturalWidth,height:b.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(g),rotate:v/90}},new R.R);p=new File([(0,D.L)(Z.transformed.base64)],p.name,{type:p.type,lastModified:Date.now()})}}return p})()}upload(p,A,C,Q=!1){const g=new _.x,v=new FormData;v.append("payload",C),v.append("upload",p,p.name),Q&&v.append("allowOverwrite","1");const L=this.http.request(new I.aW("POST",i.C7,v,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(L.subscribe({next:b=>{if(b.type===I.dt.UploadProgress){if(!b.total||(A.progress=Math.round(50*b.loaded/b.total)+20,A.progress<70))return;(0,f.F)(1e3).pipe((0,O.R)(g.asObservable())).subscribe(()=>{if(A.progress<95){const Z=Math.round(8*Math.random()+8);A.progress+Z>95?A.progress=95:A.progress+=Z}})}else if(b instanceof I.Zn){if(A.progress=100,A.completed=!0,b.body?.error||!b.body?.success)A.error=!0,this.uploadObservablesService.pushUploadingFileError(A);else{A.file.url=b.body.success.url,A.file.time=Date.now(),A.file.embedUrl=`${A.file.url}?t=${A.file.time}`;const Z=(0,h.Tb)(A.file.url);A.file.name=Z.name,A.file.filename=Z.filename}g.next(),g.complete()}},error:()=>{A.error=!0,this.uploadObservablesService.pushUploadingFileError(A),g.next(),g.complete()}})),g.asObservable()}clearPendingRequests(){for(const p of this.requestSubscriptions)p.unsubscribe();this.requestSubscriptions=[]}}return E.\u0275fac=function(p){return new(p||E)(s.LFG(I.eN),s.LFG(M.r),s.LFG(P.y))},E.\u0275prov=s.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})()},6730:function(Y){Y.exports=function(){"use strict";function j(y,r){var o=Object.keys(y);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(y);r&&(l=l.filter(function(B){return Object.getOwnPropertyDescriptor(y,B).enumerable})),o.push.apply(o,l)}return o}function t(y){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?j(Object(o),!0).forEach(function(l){U(y,l,o[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(o)):j(Object(o)).forEach(function(l){Object.defineProperty(y,l,Object.getOwnPropertyDescriptor(o,l))})}return y}function D(y,r){for(var o=0;o<r.length;o++){var l=r[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(y,l.key,l)}}function U(y,r,o){return r in y?Object.defineProperty(y,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):y[r]=o,y}function R(){return R=Object.assign||function(y){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(y[l]=o[l])}return y},R.apply(this,arguments)}var y,r,o,l,B,S,H,K,h={exports:{}};y=h,typeof window>"u"||(r=window,o=r.HTMLCanvasElement&&r.HTMLCanvasElement.prototype,l=r.Blob&&function(){try{return Boolean(new Blob)}catch{return!1}}(),B=l&&r.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch{return!1}}(),S=r.BlobBuilder||r.WebKitBlobBuilder||r.MozBlobBuilder||r.MSBlobBuilder,H=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,K=(l||S)&&r.atob&&r.ArrayBuffer&&r.Uint8Array&&function(u){var w,a,c,n,W,T,$,z,te;if(!(w=u.match(H)))throw new Error("invalid data URI");for(a=w[2]?w[1]:"text/plain"+(w[3]||";charset=US-ASCII"),c=!!w[4],n=u.slice(w[0].length),W=c?atob(n):decodeURIComponent(n),T=new ArrayBuffer(W.length),$=new Uint8Array(T),z=0;z<W.length;z+=1)$[z]=W.charCodeAt(z);return l?new Blob([B?$:T],{type:a}):((te=new S).append(T),te.getBlob(a))},r.HTMLCanvasElement&&!o.toBlob&&(o.mozGetAsFile?o.toBlob=function(u,w,a){var c=this;setTimeout(function(){u(a&&o.toDataURL&&K?K(c.toDataURL(w,a)):c.mozGetAsFile("blob",w))})}:o.toDataURL&&K&&(o.toBlob=o.msToBlob?function(u,w,a){var c=this;setTimeout(function(){u((w&&"image/png"!==w||a)&&o.toDataURL&&K?K(c.toDataURL(w,a)):c.msToBlob(w))})}:function(u,w,a){var c=this;setTimeout(function(){u(K(c.toDataURL(w,a)))})})),y.exports?y.exports=K:r.dataURLtoBlob=K);var I=h.exports,f={strict:!0,checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},i=typeof window<"u"&&typeof window.document<"u"?window:{},x=function(r){return r>0&&r<1/0},s=Array.prototype.slice;function M(y){return Array.from?Array.from(y):s.call(y)}var P=/^image\/.+$/;function d(y){return P.test(y)}var F=String.fromCharCode;var A=i.btoa;function Q(y){var o,r=new DataView(y);try{var l,B,S;if(255===r.getUint8(0)&&216===r.getUint8(1))for(var H=r.byteLength,K=2;K+1<H;){if(255===r.getUint8(K)&&225===r.getUint8(K+1)){B=K;break}K+=1}if(B){var w=B+10;if("Exif"===function p(y,r,o){var B,l="";for(o+=r,B=r;B<o;B+=1)l+=F(y.getUint8(B));return l}(r,B+4,4)){var a=r.getUint16(w);if(((l=18761===a)||19789===a)&&42===r.getUint16(w+2,l)){var c=r.getUint32(w+4,l);c>=8&&(S=w+c)}}}if(S){var W,T,n=r.getUint16(S,l);for(T=0;T<n;T+=1)if(274===r.getUint16(W=S+12*T+2,l)){o=r.getUint16(W+=8,l),r.setUint16(W,1,l);break}}}catch{o=1}return o}var v=/\.\d*(?:0|9){12}\d*$/;function L(y){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return v.test(y)?Math.round(y*r)/r:y}function b(y){var r=y.aspectRatio,o=y.height,l=y.width,B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",S=x(l),H=x(o);if(S&&H){var K=o*r;("contain"===B||"none"===B)&&K>l||"cover"===B&&K<l?o=l/r:l=o*r}else S?o=l/r:H&&(l=o*r);return{width:l,height:o}}var Z=i.ArrayBuffer,N=i.FileReader,J=i.URL||i.webkitURL,X=/\.\w+$/,ee=i.Compressor;return function(){function y(r,o){(function m(y,r){if(!(y instanceof r))throw new TypeError("Cannot call a class as a function")})(this,y),this.file=r,this.image=new Image,this.options=t(t({},f),o),this.aborted=!1,this.result=null,this.init()}return function e(y,r,o){return r&&D(y.prototype,r),o&&D(y,o),y}(y,[{key:"init",value:function(){var o=this,l=this.file,B=this.options;if(function(r){return!(typeof Blob>"u")&&(r instanceof Blob||"[object Blob]"===Object.prototype.toString.call(r))}(l)){var S=l.type;if(d(S))if(J&&N)if(Z||(B.checkOrientation=!1),J&&!B.checkOrientation)this.load({url:J.createObjectURL(l)});else{var H=new N,K=B.checkOrientation&&"image/jpeg"===S;this.reader=H,H.onload=function(u){var a=u.target.result,c={};if(K){var n=Q(a);n>1||!J?(c.url=function C(y,r){for(var o=[],B=new Uint8Array(y);B.length>0;)o.push(F.apply(null,M(B.subarray(0,8192)))),B=B.subarray(8192);return"data:".concat(r,";base64,").concat(A(o.join("")))}(a,S),n>1&&R(c,function g(y){var r=0,o=1,l=1;switch(y){case 2:o=-1;break;case 3:r=-180;break;case 4:l=-1;break;case 5:r=90,l=-1;break;case 6:r=90;break;case 7:r=90,o=-1;break;case 8:r=-90}return{rotate:r,scaleX:o,scaleY:l}}(n))):c.url=J.createObjectURL(l)}else c.url=a;o.load(c)},H.onabort=function(){o.fail(new Error("Aborted to read the image with FileReader."))},H.onerror=function(){o.fail(new Error("Failed to read the image with FileReader."))},H.onloadend=function(){o.reader=null},K?H.readAsArrayBuffer(l):H.readAsDataURL(l)}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(o){var l=this,B=this.file,S=this.image;S.onload=function(){l.draw(t(t({},o),{},{naturalWidth:S.naturalWidth,naturalHeight:S.naturalHeight}))},S.onabort=function(){l.fail(new Error("Aborted to load the image."))},S.onerror=function(){l.fail(new Error("Failed to load the image."))},i.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(i.navigator.userAgent)&&(S.crossOrigin="anonymous"),S.alt=B.name,S.src=o.url}},{key:"draw",value:function(o){var l=this,B=o.naturalWidth,S=o.naturalHeight,H=o.rotate,K=void 0===H?0:H,u=o.scaleX,w=void 0===u?1:u,a=o.scaleY,c=void 0===a?1:a,n=this.file,W=this.image,T=this.options,$=document.createElement("canvas"),z=$.getContext("2d"),te=Math.abs(K)%180==90,oe=("contain"===T.resize||"cover"===T.resize)&&x(T.width)&&x(T.height),re=Math.max(T.maxWidth,0)||1/0,k=Math.max(T.maxHeight,0)||1/0,G=Math.max(T.minWidth,0)||0,ne=Math.max(T.minHeight,0)||0,ie=B/S,V=T.width,q=T.height;if(te){var ue=[k,re];re=ue[0],k=ue[1];var de=[ne,G];G=de[0],ne=de[1];var pe=[q,V];V=pe[0],q=pe[1]}oe&&(ie=V/q);var he=b({aspectRatio:ie,width:re,height:k},"contain");re=he.width,k=he.height;var fe=b({aspectRatio:ie,width:G,height:ne},"cover");if(G=fe.width,ne=fe.height,oe){var ge=b({aspectRatio:ie,width:V,height:q},T.resize);V=ge.width,q=ge.height}else{var me=b({aspectRatio:ie,width:V,height:q}),ve=me.width;V=void 0===ve?B:ve;var _e=me.height;q=void 0===_e?S:_e}var Ue=-(V=Math.floor(L(Math.min(Math.max(V,G),re))))/2,Me=-(q=Math.floor(L(Math.min(Math.max(q,ne),k))))/2,we=V,Ce=q,se=[];if(oe){var le,ce,be=b({aspectRatio:ie,width:B,height:S},{contain:"cover",cover:"contain"}[T.resize]);se.push((B-(le=be.width))/2,(S-(ce=be.height))/2,le,ce)}if(se.push(Ue,Me,we,Ce),te){var ye=[q,V];V=ye[0],q=ye[1]}$.width=V,$.height=q,d(T.mimeType)||(T.mimeType=n.type);var xe="transparent";if(n.size>T.convertSize&&T.convertTypes.indexOf(T.mimeType)>=0&&(T.mimeType="image/jpeg"),"image/jpeg"===T.mimeType&&(xe="#fff"),z.fillStyle=xe,z.fillRect(0,0,V,q),T.beforeDraw&&T.beforeDraw.call(this,z,$),!this.aborted&&(z.save(),z.translate(V/2,q/2),z.rotate(K*Math.PI/180),z.scale(w,c),z.drawImage.apply(z,[W].concat(se)),z.restore(),T.drew&&T.drew.call(this,z,$),!this.aborted)){var Oe=function(Pe){l.aborted||l.done({naturalWidth:B,naturalHeight:S,result:Pe})};$.toBlob?$.toBlob(Oe,T.mimeType,T.quality):Oe(I($.toDataURL(T.mimeType,T.quality)))}}},{key:"done",value:function(o){var l=o.naturalWidth,B=o.naturalHeight,S=o.result,H=this.file,u=this.options;if(J&&!u.checkOrientation&&J.revokeObjectURL(this.image.src),S)if(u.strict&&S.size>H.size&&u.mimeType===H.type&&!(u.width>l||u.height>B||u.minWidth>l||u.minHeight>B||u.maxWidth<l||u.maxHeight<B))S=H;else{var w=new Date;S.lastModified=w.getTime(),S.lastModifiedDate=w,S.name=H.name,S.name&&S.type!==H.type&&(S.name=S.name.replace(X,function E(y){var r=d(y)?y.substr(6):"";return"jpeg"===r&&(r="jpg"),".".concat(r)}(S.type)))}else S=H;this.result=S,u.success&&u.success.call(this,S)}},{key:"fail",value:function(o){var l=this.options;if(!l.error)throw o;l.error.call(this,o)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ee,y}},{key:"setDefaults",value:function(o){R(f,o)}}]),y}()}()},7445:(Y,j,t)=>{"use strict";t.d(j,{F:()=>e});var m=t(4986),D=t(5963);function e(U=0,R=m.z){return U<0&&(U=0),(0,D.H)(U,U,R)}},1042:(Y,j,t)=>{"use strict";t.d(j,{Z:()=>x});var m,D=new Uint8Array(16);function e(){if(!m&&!(m=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return m(D)}const U=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,h=function R(s){return"string"==typeof s&&U.test(s)};for(var I=[],_=0;_<256;++_)I.push((_+256).toString(16).substr(1));const x=function i(s,M,P){var d=(s=s||{}).random||(s.rng||e)();if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,M){P=P||0;for(var E=0;E<16;++E)M[P+E]=d[E];return M}return function f(s){var M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=(I[s[M+0]]+I[s[M+1]]+I[s[M+2]]+I[s[M+3]]+"-"+I[s[M+4]]+I[s[M+5]]+"-"+I[s[M+6]]+I[s[M+7]]+"-"+I[s[M+8]]+I[s[M+9]]+"-"+I[s[M+10]]+I[s[M+11]]+I[s[M+12]]+I[s[M+13]]+I[s[M+14]]+I[s[M+15]]).toLowerCase();if(!h(P))throw TypeError("Stringified UUID is invalid");return P}(d)}}}]);