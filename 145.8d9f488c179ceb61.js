(self.webpackChunkboard=self.webpackChunkboard||[]).push([[145],{2986:(X,w,t)=>{"use strict";t.d(w,{R:()=>_});class _{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(U=>U in this).forEach(U=>this[U]=e[U]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(U=>U in this).forEach(U=>this[U]=e[U].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},6126:(X,w,t)=>{"use strict";t.d(w,{y:()=>o});var _=t(5861);var y=t(5879);let o=(()=>{class f{constructor(){this.autoRotateSupported=function e(){return new Promise(f=>{const g=new Image;g.onload=()=>{f(1===g.width&&2===g.height)},g.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(s,u){return new Promise((h,M)=>{const D=new FileReader;D.onload=S=>{this.loadImage(S.target.result,s.type,u).then(h).catch(M)},D.readAsDataURL(s)})}loadImage(s,u,h){return this.isValidImageType(u)?this.loadBase64Image(s,h):Promise.reject(new Error("Invalid image type"))}isValidImageType(s){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(s)}loadImageFromURL(s,u){return new Promise((h,M)=>{const D=new Image;D.onerror=()=>M,D.onload=()=>{const S=document.createElement("canvas"),Q=S.getContext("2d");S.width=D.width,S.height=D.height,Q?.drawImage(D,0,0),this.loadBase64Image(S.toDataURL(),u).then(h)},D.crossOrigin="anonymous",D.src=s})}loadBase64Image(s,u){return new Promise((h,M)=>{const D=new Image;D.onload=()=>h({originalImage:D,originalBase64:s}),D.onerror=M,D.src=s}).then(h=>this.transformImageBase64(h,u))}transformImageBase64(s,u){var h=this;return(0,_.Z)(function*(){const M=yield h.autoRotateSupported,D=yield function U(f){switch("string"==typeof f&&(f=function I(f){const g=new DataView(function l(f){f=f.replace(/^data\:([^\;]+)\;base64,/gim,"");const g=atob(f),s=g.length,u=new Uint8Array(s);for(let h=0;h<s;h++)u[h]=g.charCodeAt(h);return u.buffer}(f));if(65496!==g.getUint16(0,!1))return-2;const s=g.byteLength;let u=2;for(;u<s;){if(g.getUint16(u+2,!1)<=8)return-1;const h=g.getUint16(u,!1);if(u+=2,65505==h){if(1165519206!==g.getUint32(u+=2,!1))return-1;const M=18761==g.getUint16(u+=6,!1);u+=g.getUint32(u+4,M);const D=g.getUint16(u,M);u+=2;for(let S=0;S<D;S++)if(274==g.getUint16(u+12*S,M))return g.getUint16(u+12*S+8,M)}else{if(65280!=(65280&h))break;u+=g.getUint16(u,!1)}}return-1}(f)),f){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(M?-1:s.originalBase64);return s.originalImage&&s.originalImage.complete?h.transformLoadedImage({original:{base64:s.originalBase64,image:s.originalImage,size:{width:s.originalImage.naturalWidth,height:s.originalImage.naturalHeight}},exifTransform:D},u):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(s,u){var h=this;return(0,_.Z)(function*(){const M=u.canvasRotation+s.exifTransform.rotate,D={width:s.original.image.naturalWidth,height:s.original.image.naturalHeight};if(0===M&&!s.exifTransform.flip&&!u.containWithinAspectRatio)return{original:{base64:s.original.base64,image:s.original.image,size:{...D}},transformed:{base64:s.original.base64,image:s.original.image,size:{...D}},exifTransform:s.exifTransform};const S=h.getTransformedSize(D,s.exifTransform,u),Q=document.createElement("canvas");Q.width=S.width,Q.height=S.height;const b=Q.getContext("2d");b?.setTransform(s.exifTransform.flip?-1:1,0,0,1,Q.width/2,Q.height/2),b?.rotate(Math.PI*(M/2)),b?.drawImage(s.original.image,-D.width/2,-D.height/2);const A=Q.toDataURL(),d=yield h.loadImageFromBase64(A);return{original:{base64:s.original.base64,image:s.original.image,size:{...D}},transformed:{base64:A,image:d,size:{width:d.width,height:d.height}},exifTransform:s.exifTransform}})()}loadImageFromBase64(s){return new Promise((u,h)=>{const M=new Image;M.onload=()=>u(M),M.onerror=h,M.src=s})}getTransformedSize(s,u,h){const M=h.canvasRotation+u.rotate;if(h.containWithinAspectRatio){if(M%2){const S=s.height/h.aspectRatio;return{width:Math.max(s.height,s.width*h.aspectRatio),height:Math.max(s.width,S)}}{const S=s.width/h.aspectRatio;return{width:Math.max(s.width,s.height*h.aspectRatio),height:Math.max(s.height,S)}}}return M%2?{height:s.width,width:s.height}:{width:s.width,height:s.height}}}return f.\u0275fac=function(s){return new(s||f)},f.\u0275prov=y.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},3859:(X,w,t)=>{"use strict";function _(O){const e=O.split(","),U=e[0].replace("data:","").replace(";base64",""),I=atob(e[1]),l=new ArrayBuffer(I.length),y=new Uint8Array(l);for(let o=0;o<I.length;o+=1)y[o]=I.charCodeAt(o);return new Blob([l],{type:U})}t.d(w,{L:()=>_})},1128:(X,w,t)=>{"use strict";t.d(w,{B:()=>V});var _=t(5861),O=t(7414),e=t(5879),U=t(2438),I=t(4036),l=t(1284),y=t(6885),o=t(6470),f=t(9877),g=t(8934),s=t(1422),u=t(233),h=t(8945),M=t(5389),D=t(4606),S=t(2600),Q=t(2800),b=t(5613),A=t(6814),d=t(6223),E=t(6479),x=t(3798),P=t(8560),T=t(1589);const B=["fileInput"];function $(a,F){1&a&&(e.O4$(),e.TgZ(0,"svg",31),e._UZ(1,"path",32)(2,"path",33),e.qZA())}const K=function(){return["text-primary"]};function q(a,F){1&a&&e._UZ(0,"app-logo",34),2&a&&e.Q6J("svgClass",e.DdM(2,K))("responsive",!1)}function oe(a,F){1&a&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&a&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.DESKTOP"),e.oJD)}function ie(a,F){1&a&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&a&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.TOUCH"),e.oJD)}const ae=function(a){return{"fw-bold fs-md-lg":a}},pe=function(a){return{"text-decoration-underline":a}};function le(a,F){if(1&a){const n=e.EpF();e.TgZ(0,"div",35),e.YNc(1,oe,2,3,"span",36),e.YNc(2,ie,2,3,"span",36),e.TgZ(3,"span",37),e.NdJ("click",function(i){e.CHM(n);const R=e.oxw(2),N=e.MAs(23);return e.KtG(R.toggleRemoteUrlForm(i,N))}),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&a){const n=e.oxw(2);e.Q6J("ngClass",e.VKq(7,ae,!n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.touchDevice),e.xp6(1),e.Q6J("ngIf",n.touchDevice),e.xp6(1),e.Q6J("ngClass",e.VKq(9,pe,n.isWidget)),e.xp6(1),e.Oqu(e.lcZ(5,5,"COMPONENTS.UPLOADER.DESCRIPTION.REMOTE_URL"))}}function _e(a,F){1&a&&e.GkF(0)}function ve(a,F){if(1&a){const n=e.EpF();e.TgZ(0,"div",39),e.YNc(1,_e,1,0,"ng-container",17),e.TgZ(2,"button",40),e.NdJ("click",function(i){e.CHM(n);const R=e.oxw(2);return e.KtG(R.handleRemoteUrlUpload(i))}),e.O4$(),e.TgZ(3,"svg",41),e._UZ(4,"path",42),e.qZA()(),e.kcU(),e.TgZ(5,"button",43),e.NdJ("click",function(i){e.CHM(n);const R=e.oxw(2);return e.KtG(R.toggleRemoteUrlForm(i))}),e.O4$(),e.TgZ(6,"svg",41),e._UZ(7,"path",44),e.qZA()()()}if(2&a){const n=e.oxw(2),m=e.MAs(34);e.xp6(1),e.Q6J("ngTemplateOutlet",m),e.xp6(1),e.Q6J("disabled",0===n.remoteUrl.length||!n.isRemoteUrlValid)}}function Ee(a,F){if(1&a&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"em",45),e.ALo(5,"arrayJoin"),e.BQk()),2&a){const n=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"COMPONENTS.UPLOADER.PATH.LONG")," "),e.xp6(2),e.Q6J("innerText",n.currentFolderPath.length?e.xi3(5,4,n.currentFolderPath,"/"):"root")}}function v(a,F){if(1&a&&(e._UZ(0,"div",50),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&a){const n=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,n.currentFolderPath,0,-1),"/"))}}function r(a,F){if(1&a&&(e.TgZ(0,"div",46)(1,"div",47),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,v,3,8,"div",48),e._UZ(5,"div",49),e.ALo(6,"arrayJoin"),e.ALo(7,"slice"),e.qZA()),2&a){const n=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,3,"COMPONENTS.UPLOADER.PATH.SHORT")),e.xp6(2),e.Q6J("ngIf",n.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(n.currentFolderPath.length>1?"/":"")+(n.currentFolderPath.length?e.xi3(6,5,e.xi3(7,8,n.currentFolderPath,n.currentFolderPath.length-1),"/"):"root"))}}const c=function(){return{bottom:0,left:0}};function p(a,F){if(1&a){const n=e.EpF();e.ynx(0),e.TgZ(1,"a",51),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.openInfoModal.emit())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",52),e.NdJ("click",function(){e.CHM(n),e.oxw(2);const i=e.MAs(7);return e.KtG(i.open())}),e._uU(5,"settings"),e.qZA(),e.TgZ(6,"div",53),e.NdJ("click",function(i){e.CHM(n);const R=e.oxw(2),N=e.MAs(23);return e.KtG(R.toggleRemoteUrlForm(i,N))}),e._uU(7,"add_link"),e.qZA(),e.BQk()}2&a&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,c)),e.xp6(1),e.Oqu(e.lcZ(3,2,"COMPONENTS.UPLOADER.INFO")))}const C=function(a,F,n){return{"cursor-pointer":a,"py-4 px-3 px-sm-4":F,"p-2 pb-3":n}},L=function(a,F,n){return{"my-2":a,"mb-2":F,"mw-100 mt-1":n}};function H(a,F){if(1&a){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",22,23),e.NdJ("dragenter",function(){e.CHM(n);const i=e.MAs(2),R=e.oxw();return e.KtG(R.setDragOverEvent(i))})("drop",function(i){e.CHM(n);const R=e.oxw();return e.KtG(R.handleDropEvent(i))})("click",function(){e.CHM(n);const i=e.oxw(),R=e.MAs(2);return e.KtG(!i.isWaitingRemoteUrl&&R.click())}),e.YNc(3,$,3,0,"svg",24),e.YNc(4,q,1,3,"ng-template",null,25,e.W1O),e.YNc(6,le,6,11,"div",26),e.YNc(7,ve,8,2,"div",27),e.TgZ(8,"div",28),e.YNc(9,Ee,6,7,"ng-container",3),e.YNc(10,r,8,11,"ng-template",null,29,e.W1O),e.qZA()(),e.YNc(12,p,8,5,"ng-container",30),e.BQk()}if(2&a){const n=e.MAs(5),m=e.MAs(11),i=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(9,C,!i.loading&&!i.isWaitingRemoteUrl,!i.isWidget,i.isWidget)),e.xp6(2),e.Q6J("ngIf",!i.isWidget)("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",!i.isWidget||!i.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngIf",i.isWidget&&i.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngClass",e.kEZ(13,L,!i.isWidget&&!i.touchDevice,!i.isWidget&&i.touchDevice,i.isWidget)),e.xp6(1),e.Q6J("ngIf",!i.isWidget)("ngIfElse",m),e.xp6(3),e.Q6J("ngIf",!i.isWidget)}}const Z=function(a,F){return{"p-4":a,"p-2":F}};function W(a,F){if(1&a&&(e.TgZ(0,"div",54),e.O4$(),e.TgZ(1,"svg",55),e._UZ(2,"path",56),e.qZA(),e.kcU(),e._UZ(3,"app-loader",57),e.TgZ(4,"div",58),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&a){const n=e.oxw();e.Q6J("ngClass",e.WLB(6,Z,!n.isWidget,n.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",n.loadingMessage),e.xp6(2),e.Oqu(e.lcZ(6,4,"COMPONENTS.UPLOADER.LOADING.SUBTEXT"))}}function j(a,F){1&a&&e.GkF(0)}const k=function(a){return{"fs-reset":a}};function G(a,F){if(1&a){const n=e.EpF();e.TgZ(0,"input",59,60),e.NdJ("ngModelChange",function(i){e.CHM(n);const R=e.oxw();return e.KtG(R.remoteUrl=i)})("ngModelChange",function(){e.CHM(n);const i=e.MAs(1),R=e.oxw();return e.KtG(R.isRemoteUrlValid=!i.invalid)}),e.ALo(2,"translate"),e.qZA()}if(2&a){const n=e.oxw();e.Q6J("placeholder",e.lcZ(2,4,"COMPONENTS.UPLOADER.REMOTE_URL_INPUT_PLACEHOLDER"))("ngClass",e.VKq(6,k,n.isWidget))("ngModel",n.remoteUrl)("pattern","^https?://[^.]+\\.(.+)")}}const te=function(a,F){return{uploading:a,"widget flex-grow-1 min-w-0":F}};let V=(()=>{class a{constructor(n,m,i,R,N,J,ne,se,ee){this.postMessageService=n,this.uploadService=m,this.uploadObservablesService=i,this.uploaderService=R,this.toastService=N,this.renderer=J,this.ngZone=ne,this.translateService=se,this.proxyService=ee,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="",this.touchDevice=y.eX,this.isWaitingRemoteUrl=!1,this.remoteUrl="",this.isRemoteUrlValid=!1,this.dragOverEvent=!1,this.checkingFileMessage="",this.options=this.uploaderService.uploaderOptions;const Y=this.uploadService.preferences.uploader;Y.checkImage.active||(this.options.compress=!1),Y.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){var n=this;return(0,_.Z)(function*(){n.handleClipboardPasteEvent(),n.handleExternalUpload(),n.checkingFileMessage=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CHECK"),n.loadingMessage=n.checkingFileMessage})()}handleClipboardPasteEvent(){var n=this;this.clipboardPasteEventSubscription=(0,U.R)(document.body,"paste").subscribe(function(){var m=(0,_.Z)(function*(i){if(n.isWidget&&n.isWaitingRemoteUrl||!n.canUpload())return;const R=Array.from((i.clipboardData||i.originalEvent.clipboardData).items);let N=[];for(const J of R)if(0===J.type.indexOf("image")){const ne=J.getAsFile();ne&&N.push(ne)}N.length>0?yield n.preUpload(N):n.reset()});return function(i){return m.apply(this,arguments)}}())}handleExternalUpload(){var n=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var m=(0,_.Z)(function*(i){if(i){if(!n.canUpload())return;yield n.preUpload([i.file],i.options)}else n.fileInputRef.nativeElement.click()});return function(i){return m.apply(this,arguments)}}())}handleSelectionEvent(n){var m=this;return(0,_.Z)(function*(){if(!m.canUpload())return;const i=n.target;if(i.files&&i.files.length){const R=Array.from(i.files);return i.value="",m.preUpload(R)}m.reset()})()}handleDropEvent(n){var m=this;return(0,_.Z)(function*(){if(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!m.canUpload())return;const i=n.dataTransfer?.files?Array.from(n.dataTransfer.files):[];if(i.length)return m.preUpload(i);m.reset()})()}handleRemoteUrlUpload(n,m){var i=this;return(0,_.Z)(function*(){if(!i.isRemoteUrlValid||0===i.remoteUrl.length||!i.canUpload())return;const R=i.remoteUrl;i.loadingMessage=i.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.GETTING_REMOTE_FILE"),i.toggleRemoteUrlForm(n,m);const N=(0,l.Tb)(R);if(!N.ext||-1===f.O8.findIndex(ne=>-1!==ne.ext.indexOf(N.ext)))return i.handleErrors([N.name],[]),void i.reset();const J=yield i.proxyService.get(R);return J?i.preUpload([new File([J],N.name,{type:J.type,lastModified:Date.now()})]):(i.toastService.show({content:"Errore nel recupero dell'immagine dall'url!",level:O.m.ERROR}),i.reset(),void i.postMessageService.send(o.l.UPLOAD_ERROR,{filename:N.name,error:s.S.REMOTE_URL_RESPONSE}))})()}saveOptions(n=!0){this.uploaderService.uploaderOptions=this.options,n&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(n){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(n,"dragover",m=>{m.preventDefault()})}))}canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage=this.checkingFileMessage,this.postMessageService.send(o.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(n,m){var i=this;return(0,_.Z)(function*(){const R=[...i.currentFolderPath];let N=[],J=[],ne=[],se=[];m?m.allowOverwrite=m.allowOverwrite||!1:(m=i.uploaderService.uploaderOptions).allowOverwrite=!1;for(let z=0;z<n.length;z++){let re=m.compress?yield i.uploaderService.compressFileIfNeeded(n[z],m.imageDimensions):n[z];if(re=yield i.uploaderService.orientFileIfNeeded(re),re){const ue=(0,l.Tb)(re.name),he=f.O8.find(me=>-1!==me.ext.indexOf(ue.ext));if(!he){ne.push(re.name);continue}if(re.size>he.maxSize){se.push(re.name);continue}N.push({file:{name:re.name,size:re.size,time:0,url:"",ext:ue.ext,filename:ue.filename,isImage:(0,l.Or)(ue.ext),embedUrl:"",type:g.VC.FILE},progress:0,completed:!1}),J.push(re)}}if(i.handleErrors(ne,se),0===J.length)return void i.reset();const ee=i.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.UPLOADING",{total:J.length}),Y=i.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CREATING_PACKAGE",{total:J.length});i.uploadObservablesService.pushUploadingFileQueue(N);for(let z=0;z<J.length;++z){i.loadingMessage=Y;const re=yield i.uploadService.getHostToken(R,J[z].name);N[z].progress+=20,i.loadingMessage=ee.replace("{{current}}",`${z+1}`),yield(0,I.z)(i.uploaderService.upload(J[z],N[z],re,m.allowOverwrite))}i.uploadObservablesService.pushUploadingFileQueue([]);const ce=N.filter(z=>!z.error).map(z=>z.file);ce.length>0&&(i.fileUploadedEvent.emit({list:ce,rewrite:m.allowOverwrite,destPath:R}),i.postMessageService.send(o.l.UPLOAD_SUCCESS,{fileList:ce.map(z=>({filename:z.name,isImage:z.isImage,url:z.url}))}),m.openLinkModalAfterUpload&&i.uploadObservablesService.pushAction({name:g.In.FILE_SHOW_LINKS,payload:{entities:(0,l.jL)(ce)}})),i.reset()})()}handleErrors(n,m){if(0!==n.length||0!==m.length){if(!this.isWidget)return void this.toastService.show({content:this.createToastMessage(n,m),level:O.m.ERROR});[[s.S.UNSUPPORTED,n],[s.S.OVERSIZED,m]].forEach(i=>{i[1].forEach(R=>{this.postMessageService.send(o.l.UPLOAD_ERROR,{filename:R,error:i[0]})})})}}createToastMessage(n,m){let i=[];return n.length&&i.push(n.length>1?`I file <strong>${n.join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${n[0]}</strong> ha un formato non supportato!`),m.length&&i.push(m.length>1?`I file <strong>${m.join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${m[0]}</strong> \xe8 troppo pesante!`),i.join("<br><br>")}toggleRemoteUrlForm(n,m){n.stopPropagation(),this.isWidget||(this.isWaitingRemoteUrl?m?.close():m?.open()),this.resetRemoteUrlForm(!this.isWaitingRemoteUrl)}resetRemoteUrlForm(n){this.isWaitingRemoteUrl=n,this.remoteUrl=""}ngOnDestroy(){this.startExternalUploadSubscription?.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return a.\u0275fac=function(n){return new(n||a)(e.Y36(u.F),e.Y36(h.C),e.Y36(M.r),e.Y36(D.q),e.Y36(S.k),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(Q.sK),e.Y36(b.y))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-uploader"]],viewQuery:function(n,m){if(1&n&&e.Gf(B,5),2&n){let i;e.iGM(i=e.CRH())&&(m.fileInputRef=i.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:35,vars:37,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],[3,"title"],["optionsModal",""],[3,"innerHtml"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto",3,"innerHTML"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto",3,"innerHTML"],["size","md",3,"title","disableCloseButton","hidden"],["remoteUrlModal",""],[1,"mb-2",3,"innerHTML"],[4,"ngTemplateOutlet"],["footer",""],["type","button",1,"btn","btn-secondary",3,"innerText","click"],["type","button",1,"btn","btn-primary",3,"disabled","innerText","click"],["remoteUrlInput",""],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],["class","description text-center",3,"ngClass",4,"ngIf"],["class","input-group input-group-sm remote-url-form justify-content-center mb-1",4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"description","text-center",3,"ngClass"],[3,"innerHTML",4,"ngIf"],[1,"ms-1","remote-url-btn","fst-italic","cursor-pointer",3,"ngClass","click"],[3,"innerHTML"],[1,"input-group","input-group-sm","remote-url-form","justify-content-center","mb-1"],[1,"input-group-text","bg-light",3,"disabled","click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 16 16"],["d","M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"],[1,"input-group-text","bg-light",3,"click"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","options-icon",3,"click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","remote-url-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"],["type","text","required","",1,"form-control",3,"placeholder","ngClass","ngModel","pattern","ngModelChange"],["input","ngModel"]],template:function(n,m){if(1&n){const i=e.EpF();e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(N){return m.handleSelectionEvent(N)}),e.qZA(),e.YNc(3,H,13,17,"ng-container",3),e.YNc(4,W,7,9,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6),e.ALo(8,"translate"),e._UZ(9,"div",7),e.ALo(10,"translate"),e.TgZ(11,"ul",8)(12,"li")(13,"div",9)(14,"input",10),e.NdJ("ngModelChange",function(N){return m.options.compress=N})("ngModelChange",function(){return m.saveOptions()}),e.qZA(),e._UZ(15,"label",11),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"li")(18,"div",9)(19,"input",12),e.NdJ("ngModelChange",function(N){return m.options.openLinkModalAfterUpload=N})("ngModelChange",function(){return m.saveOptions()}),e.qZA(),e._UZ(20,"label",13),e.ALo(21,"translate"),e.qZA()()()(),e.TgZ(22,"app-modal",14,15),e.NdJ("hidden",function(){return m.resetRemoteUrlForm(!1)}),e.ALo(24,"translate"),e._UZ(25,"p",16),e.ALo(26,"translate"),e.YNc(27,j,1,0,"ng-container",17),e.ynx(28,18),e.TgZ(29,"button",19),e.NdJ("click",function(){e.CHM(i);const N=e.MAs(23);return e.KtG(N.close())}),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",20),e.NdJ("click",function(N){e.CHM(i);const J=e.MAs(23);return e.KtG(m.handleRemoteUrlUpload(N,J))}),e.ALo(32,"translate"),e.qZA(),e.BQk(),e.qZA(),e.YNc(33,G,3,8,"ng-template",null,21,e.W1O)}if(2&n){const i=e.MAs(5),R=e.MAs(34);e.Q6J("ngClass",e.WLB(34,te,m.isUploading,m.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",m.loading||m.isUploading),e.xp6(2),e.Q6J("ngIf",!m.isUploading)("ngIfElse",i),e.xp6(3),e.Q6J("title",e.lcZ(8,18,"COMPONENTS.UPLOADER.SETTINGS_MODAL.TITLE")),e.xp6(3),e.Q6J("innerHtml",e.lcZ(10,20,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.DESCRIPTION"),e.oJD),e.xp6(5),e.Q6J("ngModel",m.options.compress),e.xp6(1),e.Q6J("innerHTML",e.lcZ(16,22,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.COMPRESS_SWITCH"),e.oJD),e.xp6(4),e.Q6J("ngModel",m.options.openLinkModalAfterUpload),e.xp6(1),e.Q6J("innerHTML",e.lcZ(21,24,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.SHOW_LINK_SWITCH"),e.oJD),e.xp6(2),e.Q6J("title",e.lcZ(24,26,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.TITLE"))("disableCloseButton",!0),e.xp6(3),e.Q6J("innerHTML",e.lcZ(26,28,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.CONTENT"),e.oJD),e.xp6(2),e.Q6J("ngTemplateOutlet",R),e.xp6(2),e.Q6J("innerText",e.lcZ(30,30,"SHARED.CANCEL")),e.xp6(2),e.Q6J("disabled",0===m.remoteUrl.length||!m.isRemoteUrlValid)("innerText",e.lcZ(32,32,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.UPLOAD_BTN"))}},dependencies:[A.mk,A.O5,A.tP,A.PC,d.Fj,d.Wl,d.JJ,d.Q7,d.c5,d.On,E.R,x.R,P.z,T.J,A.OU,Q.X$],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864FE;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:350px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:_ngcontent-%COMP%_draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{top:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{opacity:1}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{right:5px}.uploader[_ngcontent-%COMP%]   .remote-url-icon[_ngcontent-%COMP%]{right:30px}.upload-area.cursor-pointer[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo):not(.description), .upload-area.cursor-pointer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.remote-url-btn){pointer-events:none}.remote-url-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:300px}.remote-url-form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:.5}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes _ngcontent-%COMP%_bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes _ngcontent-%COMP%_draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),a})()},687:(X,w,t)=>{"use strict";t.d(w,{M:()=>f});var _=t(9019),O=t(6814),e=t(6223),U=t(3961),I=t(3347),l=t(5411),y=t(2800),o=t(5879);let f=(()=>{class g{}return g.\u0275fac=function(u){return new(u||g)},g.\u0275mod=o.oAB({type:g}),g.\u0275inj=o.cJS({imports:[_.r,O.ez,e.u5,U.q,I.h,l.z,y.aw.forChild()]}),g})()},1422:(X,w,t)=>{"use strict";t.d(w,{S:()=>_});var _=function(O){return O.UNSUPPORTED="unsupported",O.OVERSIZED="oversized",O.REMOTE_URL_RESPONSE="remote-url-response",O.UPLOAD_FAILED="upload-failed",O}(_||{})},9019:(X,w,t)=>{"use strict";t.d(w,{r:()=>e});var _=t(6814),O=t(5879);let e=(()=>{class U{}return U.\u0275fac=function(l){return new(l||U)},U.\u0275mod=O.oAB({type:U}),U.\u0275inj=O.cJS({imports:[_.ez]}),U})()},1589:(X,w,t)=>{"use strict";t.d(w,{J:()=>O});var _=t(5879);let O=(()=>{class e{transform(I,l){return I.join(l)}}return e.\u0275fac=function(I){return new(I||e)},e.\u0275pipe=_.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},8934:(X,w,t)=>{"use strict";t.d(w,{In:()=>_,Ky:()=>I,VC:()=>O,c5:()=>U,gG:()=>e});var _=function(l){return l.FILE_SHOW_LINKS="fileLinks",l.FILE_EDIT="fileEdit",l.DELETE="delete",l.RENAME="rename",l.MOVE="move",l}(_||{}),O=function(l){return l.FILE="file",l.FOLDER="folder",l}(O||{}),e=function(l){return l.FILENAME="filename",l.SIZE="size",l.TIME="time",l.EXTENSION="ext",l}(e||{}),U=function(l){return l.GRID="grid",l.LIST="list",l}(U||{}),I=function(l){return l.W_768_I_1="(max-width: 767.98px)",l.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",l.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",l.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",l.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",l.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",l.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",l.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",l.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",l.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",l.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",l.W_3738_I_10="(min-width: 3424px)",l}(I||{})},9877:(X,w,t)=>{"use strict";t.d(w,{C7:()=>U,Mi:()=>I,O8:()=>O,er:()=>l,p0:()=>e,xt:()=>y});var _=t(8934);const O=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(o=>(o.maxSize*=1048576,o)),e={lastPath:[],layout:{asc:!0,orderBy:_.gG.FILENAME,type:_.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},U="https://upload.forumfree.net/api/",I=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,l=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,y={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},5613:(X,w,t)=>{"use strict";t.d(w,{y:()=>h});var _=t(5861),O=t(7840),e=t(2362),U=t(708),I=t(8180),l=t(4664),y=t(2096),o=t(6306),f=t(8561),g=t(5879),s=t(9862),u=t(2649);let h=(()=>{class M{constructor(S,Q){this.http=S,this.endpointsService=Q}get(S){var Q=this;return(0,_.Z)(function*(){const b=Q.sendRequest(S);return yield(0,U.n)(b)})()}sendRequest(S){return this.getUrlContent(S).pipe((0,I.q)(1),(0,l.w)(Q=>(0,y.of)(Q)),(0,o.K)(()=>this.getUrlContentWithProxy(S)))}getUrlContent(S){return this.http.get(S,{responseType:"blob"})}getUrlContentWithProxy(S){return this.http.get(this.endpointsService.get(O.jQ.PROXY,O.ph.COMMON),{headers:{[e._.HeaderKeys.TOKEN_TYPE]:f.s.ACCESS,"x-remote-url":S},responseType:"blob"}).pipe((0,I.q)(1),(0,o.K)(()=>(0,y.of)(void 0)))}}return M.\u0275fac=function(S){return new(S||M)(g.LFG(s.eN),g.LFG(u.o))},M.\u0275prov=g.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})()},3453:(X,w,t)=>{"use strict";t.d(w,{B:()=>U});var _=t(8934),O=t(5879),e=t(9994);let U=(()=>{class I{constructor(y){this.globalsService=y,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(o=>{this.ffuid=o?o.user.ffuid:""})}getItem(y){const o=this.createKey(y);if(this.cache.hasOwnProperty(o))return this.cache[o]}setItem(y,o){this.cache[this.createKey(y)]=o}removeItem(y){const o=this.createKey(y);if(this.cache.hasOwnProperty(o)){if(this.cache[o].folders.length)for(const f of this.cache[o].folders)this.removeItem([...y,f.name]);return delete this.cache[o],!0}return!1}getEntities(y,o){let f={};const g=this.createKey(y);if(!this.cache.hasOwnProperty(g))return f;for(const s of o){const u=(s.type===_.VC.FILE?this.cache[g].files:this.cache[g].folders).find(h=>h.name===s.name);u&&(f[u.name]=u)}return f}addEntities(y,o,f=_.VC.FILE){const g=this.createKey(y);return!!this.cache.hasOwnProperty(g)&&(Array.isArray(o)||(o=[o]),f===_.VC.FILE?this.cache[g].files.unshift(...o):this.cache[g].folders.unshift(...o),!0)}removeEntities(y,o,f=_.VC.FILE){if(Array.isArray(o)||(o=[o]),f===_.VC.FOLDER)for(const h of o)this.removeItem([...y,h]);const g=this.createKey(y);if(!this.cache.hasOwnProperty(g))return[];const s=f===_.VC.FILE?"files":"folders";let u=[];for(const h of o){const M=this.cache[g][s].findIndex(D=>D.name===h);M>-1&&(this.cache[g][s].splice(M,1),u.push(h))}return u}refactorFolderContent(y,o){const f=this.createKey(y);if(!this.cache.hasOwnProperty(f))return!1;o.endsWith("/")||(o+="/");for(const g of this.cache[f].folders)g.url=o+g.name;for(const g of this.cache[f].files)g.url=g.embedUrl=o+g.name,g.time=Date.now();return!0}createKey(y){return`${this.ffuid}/${y.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return I.\u0275fac=function(y){return new(y||I)(O.LFG(e.d))},I.\u0275prov=O.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),I})()},5389:(X,w,t)=>{"use strict";t.d(w,{r:()=>I});var _=t(8645),O=t(5619),e=t(5879),U=t(2674);let I=(()=>{class l{constructor(o){this.uploadPreferencesService=o,this.selectedFileListArray=[],this.actionSubject=new _.x,this.uploadingFileQueueSubject=new _.x,this.uploadingFileErrorSubject=new _.x,this.currentFolderPathSubject=new _.x,this.layoutOptionsSubject=new _.x,this.renameEntitySubject=new _.x,this.entityPendingSubject=new _.x,this.deleteFileSubject=new _.x,this.uploadedFileSubject=new _.x,this.draggedFileListSubject=new _.x,this.startUploadSubject=new _.x,this.startMoveSubject=new _.x,this.selectedFileListSubject=new O.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(o){this.actionSubject.next(o)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(o){this.uploadPreferencesService.layoutOptions=o,this.layoutOptionsSubject.next(o)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(o){this.uploadPreferencesService.lastFolderPath=o,this.currentFolderPathSubject.next(o)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(o){this.uploadingFileQueueSubject.next(o)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(o){this.uploadingFileErrorSubject.next(o)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(o){this.renameEntitySubject.next(o)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(o){this.entityPendingSubject.next(o)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(o){this.deleteFileSubject.next(o)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(o){this.uploadedFileSubject.next(o)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(o){this.draggedFileListSubject.next(o)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(o){this.startUploadSubject.next(o)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(o){this.startMoveSubject.next(o)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(o){if(Array.isArray(o)||(o=[o]),0===o.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let f=!1;for(const g of o){const s=this.selectedFileListArray.findIndex(u=>u.name===g.name);g.selected?-1===s&&(this.selectedFileListArray.push({name:g.name}),f=!0):s>-1&&(this.selectedFileListArray.splice(s,1),f=!0)}f&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return l.\u0275fac=function(o){return new(o||l)(e.LFG(U.p))},l.\u0275prov=e.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()},2674:(X,w,t)=>{"use strict";t.d(w,{p:()=>l});var _=t(201),O=t(9877),e=t(5879),U=t(4356),I=t(1088);let l=(()=>{class y{constructor(f,g){this.preferencesService=f,this.urlQueryParamsService=g;const s=this.urlQueryParamsService.getAndDeleteParam(_.RT.UPLOAD_PATH);s&&(this.lastFolderPath=s.split("/").filter(u=>u.length>0))}get preferences(){return this.preferencesService.getItem(_.Ye.UPLOAD)||O.p0}set preferences(f){this.preferencesService.setItem(_.Ye.UPLOAD,f)}get lastFolderPath(){return(this.preferences.lastPath||O.p0.lastPath).filter(f=>f.length>0)}set lastFolderPath(f){const g=this.preferences;g.lastPath=f,this.preferences=g}get layoutOptions(){const f=O.p0.layout,g=this.preferences.layout;return g&&0===Object.keys(f).filter(s=>!g.hasOwnProperty(s)).length?g:f}set layoutOptions(f){const g=this.preferences;g.layout=f,this.preferences=g}get uploader(){const f=this.preferences.uploader||O.p0.uploader;return!f.checkImage.active&&Date.now()-f.checkImage.time>6048e5&&(f.checkImage.active=!0,this.uploader=f),f.hasOwnProperty("showLinkModal")||(f.showLinkModal=!1),f}set uploader(f){const g=this.preferences;g.uploader=f,this.preferences=g}}return y.\u0275fac=function(f){return new(f||y)(e.LFG(U.y),e.LFG(I.J))},y.\u0275prov=e.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()},8945:(X,w,t)=>{"use strict";t.d(w,{C:()=>A});var _=t(5861),O=t(2362),e=t(4036),U=t(8934),I=t(1284),u=t(9877),h=t(4004),M=t(5879),D=t(5530),S=t(3453),Q=t(2674),b=t(9862);let A=(()=>{class d{constructor(x,P,T,B){this.graphqlService=x,this.uploadCacheService=P,this.uploadPreferencesService=T,this.http=B}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(O._.HeaderKeys.UUID,(0,h.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(O._.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(O._.HeaderKeys.UUID)||""}getFileList(x,P){var T=this;return(0,_.Z)(function*(){const B=T.uploadCacheService.getItem(x);if(B)return B;const $=(yield T.graphqlService.query({query:"\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",variables:{scope:P,target:x.join("/")}})).data.uploadEntitiesListToken,K=yield T.sendRequest($),oe={files:K.files.map(ie=>{const ae=(0,I.Tb)(ie.url);return{...ie,time:1e3*ie.time,filename:ae.filename,ext:ae.ext,isImage:(0,I.Or)(ae.ext),embedUrl:`${ie.url}?t=${ie.time}`,type:U.VC.FILE}}),folders:K.folders.map(ie=>({...ie,type:U.VC.FOLDER}))};return T.uploadCacheService.setItem(x,oe),oe})()}createDirectory(x,P){var T=this;return(0,_.Z)(function*(){const B=(yield T.graphqlService.mutate({mutation:"\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",variables:{scope:P,target:x.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield T.sendRequest(B)})()}moveRenameEntity(x,P,T,B,$){var K=this;return(0,_.Z)(function*(){B||(B=T);const q=(yield K.graphqlService.mutate({mutation:"\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",variables:{scope:$,source:(x.length?`${x.join("/")}/`:"")+T,target:(P.length?`${P.join("/")}/`:"")+B}})).data.uploadEntitiesMoveToken,oe=yield K.sendRequest(q);return{...oe,time:1e3*oe.time}})()}deleteEntity(x,P,T){var B=this;return(0,_.Z)(function*(){const $=(yield B.graphqlService.mutate({mutation:"\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",variables:{scope:T,target:(x.length?`${x.join("/")}/`:"")+P}})).data.uploadEntitiesDeleteToken;return yield B.sendRequest($),!0})()}getHostToken(x,P,T){var B=this;return(0,_.Z)(function*(){return(yield B.graphqlService.query({query:"\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",variables:{scope:T,target:(x.length?`${x.join("/")}/`:"")+P}})).data.uploadEntitiesHostToken})()}sendRequest(x){var P=this;return(0,_.Z)(function*(){return(yield(0,e.z)(P.http.post(u.C7,JSON.stringify({payload:x}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(x,P){var T=this;return(0,_.Z)(function*(){return yield T.graphqlService.subscribe({query:"\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}",variables:{scope:P}},B=>{if(!B.data?.uploadEntities)return;const $=JSON.parse(B.data.uploadEntities.eventMessage);!$.payload.customHeaders||!$.payload.customHeaders.hasOwnProperty(O._.HeaderKeys.UUID)||$.payload.customHeaders[O._.HeaderKeys.UUID]===T.getGqlIdHeader()||x({type:B.data.uploadEntities.eventType,message:$})})})()}}return d.\u0275fac=function(x){return new(x||d)(M.LFG(D.J),M.LFG(S.B),M.LFG(Q.p),M.LFG(b.eN))},d.\u0275prov=M.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},1284:(X,w,t)=>{"use strict";t.d(w,{$H:()=>M,JN:()=>g,Lv:()=>l,Or:()=>h,Tb:()=>U,jL:()=>u,lY:()=>y,ok:()=>S,rQ:()=>Q,rc:()=>D,sT:()=>o,zO:()=>I});var _=t(5861),O=t(8934),e=t(9877);function U(b){let A=b;if(b.indexOf("/")>-1){const P=b.split("/");A=P[P.length-1]}const d=A.replace(/\?.*$/,"").split("."),E=d.length>1?d[d.length-1].toLowerCase():"",x=decodeURIComponent(d.slice(0,-1).join("."));return{ext:E,filename:x,name:E?`${x}.${E}`:""}}function I(b,A={}){const d=U(b),E=Date.now();return{name:d.name,size:0,time:E,url:b,ext:d.ext,filename:d.filename,isImage:h(d.ext),embedUrl:`${b}?t=${E}`,type:O.VC.FILE,...A}}function l(b){let A=b;A.endsWith("/")&&(A=A.slice(0,-1));const d=A.split("/");return{name:decodeURIComponent(d[d.length-1])}}function y(b){return{name:l(b).name,url:b,type:O.VC.FOLDER}}function o(b){return f.apply(this,arguments)}function f(){return(f=(0,_.Z)(function*(b){const A=new FileReader,d=new Promise(E=>A.addEventListener("load",()=>E(A.result)));return A.readAsDataURL(b),d})).apply(this,arguments)}function g(b){return s.apply(this,arguments)}function s(){return(s=(0,_.Z)(function*(b){const A=new DataView(yield b.arrayBuffer());if(2303741511===A.getUint32(0)&&218765834===A.getUint32(4)){if(-1===[4,6].indexOf(A.getUint8(25)))return!1;const E=Object.assign(new Image,{src:yield o(b)});yield new Promise(T=>E.addEventListener("load",()=>T(!0)));const x=Object.assign(document.createElement("canvas"),{width:E.width,height:E.height}).getContext("2d");if(!x)return!1;x.imageSmoothingEnabled=!1,x.drawImage(E,0,0);const P=x?.getImageData(0,0,E.width,E.height);if(P)for(let T=0;T<P.data.length;T+=4)if(P.data[T+3]<255)return!0}return!1})).apply(this,arguments)}function u(b){return b.map(A=>({name:A.name,ext:A.ext,type:O.VC.FILE,url:A.url,embedUrl:A.embedUrl,isImage:A.isImage}))}function h(b,A=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(b)&&!A.includes(b)}function M(b){return h(b,["gif","svg"])}function D(b,A,d,E=[],x=""){let P={...e.xt};const T=b.trim();P.invalidLength=0===T.length;const B=(T+x).replace(/\s{2,}/g," ");return P.alreadyUsed=A!==T&&E.includes(B),P.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(b),P.invalidCharacter=!(d===O.VC.FILE?e.Mi.test(b):e.er.test(b)),P}function S(b,A){return b.join("/")===A.join("/")}function Q(b){let A=[],d=[];for(const E of b)E.type===O.VC.FILE?A.push(E):d.push(E);return{[O.VC.FILE]:A,[O.VC.FOLDER]:d}}},4606:(X,w,t)=>{"use strict";t.d(w,{q:()=>Q});var _=t(5861),O=t(3859),e=t(4315),U=t.n(e),I=t(2986),l=t(1284),y=t(9862),o=t(8645),f=t(1687),g=t(9773),s=t(9877);class u{static findApp1Marker(A){const d=new DataView(A),E=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let x=0;x<A.byteLength-2;x+=2){const P=d.getUint16(x);if(65505===P)return{offset:x,size:d.getUint16(x+2),little:18761==d.getUint16(x+8,!1)};if(E.has(P))break}}static stripAndReturnExif(A){return(0,_.Z)(function*(){const d=yield A.arrayBuffer(),E=u.findApp1Marker(d);return E?{file:new File([d.slice(0,E.offset),d.slice(E.offset+E.size+2)],A.name,{type:A.type,lastModified:A.lastModified}),exif:d.slice(E.offset,E.offset+E.size)}:{file:A}})()}static checkImageOrientation(A){const d=new DataView(A);if(1165519206!=d.getUint32(4,!1))return-1;const E=18761==d.getUint16(10,!1);let x=10;x+=d.getUint32(x+4,E);const P=d.getUint16(x,E);x+=2;for(let T=0;T<P;T++)if(274==d.getUint16(x+12*T,E))return d.getUint16(x+12*T+8,E);return-1}}var h=t(5879),M=t(5389),D=t(6126),S=t(5613);let Q=(()=>{class b{constructor(d,E,x,P){this.http=d,this.uploadObservablesService=E,this.loadImageService=x,this.proxyService=P,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return{...this.uploaderOptionsObject}}set uploaderOptions(d){this.uploaderOptionsObject={...d}}compressFileIfNeeded(d,E){return(0,_.Z)(function*(){let x=["image/png","image/jpeg"],P={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};E&&(x.push("image/webp"),P.width=E.width,P.height=E.height,P.resize="cover",P.strict=!1);const T=d.type.toLowerCase();return d.size<=4e6&&void 0===E||-1===x.indexOf(d.type.toLowerCase())?d:("image/png"===T&&(yield(0,l.JN)(d))&&(P.convertSize=1/0),new Promise((B,$)=>{new(U())(d,{...P,success:K=>{const q=K instanceof Blob?new File([K],d.name,{type:d.type,lastModified:d.lastModified}):d;B(q)},error:$})}))})()}orientFileIfNeeded(d){var E=this;return(0,_.Z)(function*(){if(-1===["image/jpeg"].indexOf(d.type.toLowerCase()))return d;const P=yield u.stripAndReturnExif(d);if(d=P.file,P.exif){const T=u.checkImageOrientation(P.exif);if(1!==T){let B=0;switch(T){case 3:case 4:B=180;break;case 5:case 6:B=90;break;case 7:case 8:B=270}const $=yield(0,l.sT)(d),K=yield new Promise((oe,ie)=>{const ae=new Image;ae.onload=()=>oe({originalImage:ae,originalBase64:$}),ae.onerror=ie,ae.src=$}),q=yield E.loadImageService.transformLoadedImage({original:{base64:K.originalBase64,image:K.originalImage,size:{width:K.originalImage.naturalWidth,height:K.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(T),rotate:B/90}},new I.R);d=new File([(0,O.L)(q.transformed.base64)],d.name,{type:d.type,lastModified:Date.now()}),d=yield E.compressFileIfNeeded(d)}}return d})()}upload(d,E,x,P=!1){const T=new o.x,B=new FormData;B.append("payload",x),B.append("upload",d,d.name),P&&B.append("allowOverwrite","1");const $=this.http.request(new y.aW("POST",s.C7,B,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push($.subscribe({next:K=>{if(K.type===y.dt.UploadProgress){if(!K.total||(E.progress=Math.round(50*K.loaded/K.total)+20,E.progress<70))return;(0,f.F)(1e3).pipe((0,g.R)(T.asObservable())).subscribe(()=>{if(E.progress<95){const q=Math.round(8*Math.random()+8);E.progress+q>95?E.progress=95:E.progress+=q}})}else if(K instanceof y.Zn){if(E.progress=100,E.completed=!0,K.body?.error||!K.body?.success)E.error=!0,this.uploadObservablesService.pushUploadingFileError(E);else{E.file.url=K.body.success.url,E.file.time=Date.now(),E.file.embedUrl=`${E.file.url}?t=${E.file.time}`;const q=(0,l.Tb)(E.file.url);E.file.name=q.name,E.file.filename=q.filename}T.next(),T.complete()}},error:()=>{E.error=!0,this.uploadObservablesService.pushUploadingFileError(E),T.next(),T.complete()}})),T.asObservable()}clearPendingRequests(){for(const d of this.requestSubscriptions)d.unsubscribe();this.requestSubscriptions=[]}}return b.\u0275fac=function(d){return new(d||b)(h.LFG(y.eN),h.LFG(M.r),h.LFG(D.y),h.LFG(S.y))},b.\u0275prov=h.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"}),b})()},4315:function(X){X.exports=function(){"use strict";function w(v,r){var c=Object.keys(v);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(v);r&&(p=p.filter(function(C){return Object.getOwnPropertyDescriptor(v,C).enumerable})),c.push.apply(c,p)}return c}function t(v){for(var r=1;r<arguments.length;r++){var c=null!=arguments[r]?arguments[r]:{};r%2?w(Object(c),!0).forEach(function(p){U(v,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(c)):w(Object(c)).forEach(function(p){Object.defineProperty(v,p,Object.getOwnPropertyDescriptor(c,p))})}return v}function O(v,r){for(var c=0;c<r.length;c++){var p=r[c];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(v,y(p.key),p)}}function U(v,r,c){return(r=y(r))in v?Object.defineProperty(v,r,{value:c,enumerable:!0,configurable:!0,writable:!0}):v[r]=c,v}function I(){return I=Object.assign?Object.assign.bind():function(v){for(var r=1;r<arguments.length;r++){var c=arguments[r];for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(v[p]=c[p])}return v},I.apply(this,arguments)}function y(v){var r=function l(v,r){if("object"!=typeof v||null===v)return v;var c=v[Symbol.toPrimitive];if(void 0!==c){var p=c.call(v,r||"default");if("object"!=typeof p)return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(v)}(v,"string");return"symbol"==typeof r?r:String(r)}var v,r,c,p,C,L,H,Z,o={exports:{}};v=o,typeof window>"u"||(r=window,c=r.HTMLCanvasElement&&r.HTMLCanvasElement.prototype,p=r.Blob&&function(){try{return!!new Blob}catch{return!1}}(),C=p&&r.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch{return!1}}(),L=r.BlobBuilder||r.WebKitBlobBuilder||r.MozBlobBuilder||r.MSBlobBuilder,H=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,Z=(p||L)&&r.atob&&r.ArrayBuffer&&r.Uint8Array&&function(W){var j,k,G,te,V,a,F,n,m;if(!(j=W.match(H)))throw new Error("invalid data URI");for(k=j[2]?j[1]:"text/plain"+(j[3]||";charset=US-ASCII"),G=!!j[4],te=W.slice(j[0].length),V=G?atob(te):decodeURIComponent(te),a=new ArrayBuffer(V.length),F=new Uint8Array(a),n=0;n<V.length;n+=1)F[n]=V.charCodeAt(n);return p?new Blob([C?F:a],{type:k}):((m=new L).append(a),m.getBlob(k))},r.HTMLCanvasElement&&!c.toBlob&&(c.mozGetAsFile?c.toBlob=function(W,j,k){var G=this;setTimeout(function(){W(k&&c.toDataURL&&Z?Z(G.toDataURL(j,k)):G.mozGetAsFile("blob",j))})}:c.toDataURL&&Z&&(c.toBlob=c.msToBlob?function(W,j,k){var G=this;setTimeout(function(){W((j&&"image/png"!==j||k)&&c.toDataURL&&Z?Z(G.toDataURL(j,k)):G.msToBlob(j))})}:function(W,j,k){var G=this;setTimeout(function(){W(Z(G.toDataURL(j,k)))})})),v.exports?v.exports=Z:r.dataURLtoBlob=Z);var f=o.exports,s={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},h=typeof window<"u"&&typeof window.document<"u"?window:{},M=function(r){return r>0&&r<1/0},D=Array.prototype.slice;function S(v){return Array.from?Array.from(v):D.call(v)}var Q=/^image\/.+$/;function b(v){return Q.test(v)}var d=String.fromCharCode;var x=h.btoa;function P(v,r){for(var c=[],C=new Uint8Array(v);C.length>0;)c.push(d.apply(null,S(C.subarray(0,8192)))),C=C.subarray(8192);return"data:".concat(r,";base64,").concat(x(c.join("")))}function T(v){var c,r=new DataView(v);try{var p,C,L;if(255===r.getUint8(0)&&216===r.getUint8(1))for(var H=r.byteLength,Z=2;Z+1<H;){if(255===r.getUint8(Z)&&225===r.getUint8(Z+1)){C=Z;break}Z+=1}if(C){var j=C+10;if("Exif"===function E(v,r,c){var C,p="";for(c+=r,C=r;C<c;C+=1)p+=d(v.getUint8(C));return p}(r,C+4,4)){var k=r.getUint16(j);if(((p=18761===k)||19789===k)&&42===r.getUint16(j+2,p)){var G=r.getUint32(j+4,p);G>=8&&(L=j+G)}}}if(L){var V,a,te=r.getUint16(L,p);for(a=0;a<te;a+=1)if(274===r.getUint16(V=L+12*a+2,p)){c=r.getUint16(V+=8,p),r.setUint16(V,1,p);break}}}catch{c=1}return c}var $=/\.\d*(?:0|9){12}\d*$/;function K(v){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return $.test(v)?Math.round(v*r)/r:v}function q(v){var r=v.aspectRatio,c=v.height,p=v.width,C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",L=M(p),H=M(c);if(L&&H){var Z=c*r;("contain"===C||"none"===C)&&Z>p||"cover"===C&&Z<p?c=p/r:p=c*r}else L?c=p/r:H&&(p=c*r);return{width:p,height:c}}var ae=h.ArrayBuffer,pe=h.FileReader,le=h.URL||h.webkitURL,_e=/\.\w+$/,ve=h.Compressor,Ee=function(){function v(r,c){(function _(v,r){if(!(v instanceof r))throw new TypeError("Cannot call a class as a function")})(this,v),this.file=r,this.exif=[],this.image=new Image,this.options=t(t({},s),c),this.aborted=!1,this.result=null,this.init()}return function e(v,r,c){return r&&O(v.prototype,r),c&&O(v,c),Object.defineProperty(v,"prototype",{writable:!1}),v}(v,[{key:"init",value:function(){var c=this,p=this.file,C=this.options;if(function(r){return!(typeof Blob>"u")&&(r instanceof Blob||"[object Blob]"===Object.prototype.toString.call(r))}(p)){var L=p.type;if(b(L))if(le&&pe){ae||(C.checkOrientation=!1,C.retainExif=!1);var H="image/jpeg"===L,Z=H&&C.checkOrientation,W=H&&C.retainExif;if(!le||Z||W){var j=new pe;this.reader=j,j.onload=function(k){var te=k.target.result,V={},a=1;Z&&(a=T(te))>1&&I(V,function B(v){var r=0,c=1,p=1;switch(v){case 2:c=-1;break;case 3:r=-180;break;case 4:p=-1;break;case 5:r=90,p=-1;break;case 6:r=90;break;case 7:r=90,c=-1;break;case 8:r=-90}return{rotate:r,scaleX:c,scaleY:p}}(a)),W&&(c.exif=function oe(v){for(var r=S(new Uint8Array(v)),c=r.length,p=[],C=0;C+3<c;){var L=r[C],H=r[C+1];if(255===L&&218===H)break;if(255===L&&216===H)C+=2;else{var W=C+(256*r[C+2]+r[C+3])+2,j=r.slice(C,W);p.push(j),C=W}}return p.reduce(function(k,G){return 255===G[0]&&225===G[1]?k.concat(G):k},[])}(te)),V.url=Z||W?!le||a>1?P(te,L):le.createObjectURL(p):te,c.load(V)},j.onabort=function(){c.fail(new Error("Aborted to read the image with FileReader."))},j.onerror=function(){c.fail(new Error("Failed to read the image with FileReader."))},j.onloadend=function(){c.reader=null},Z||W?j.readAsArrayBuffer(p):j.readAsDataURL(p)}else this.load({url:le.createObjectURL(p)})}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(c){var p=this,C=this.file,L=this.image;L.onload=function(){p.draw(t(t({},c),{},{naturalWidth:L.naturalWidth,naturalHeight:L.naturalHeight}))},L.onabort=function(){p.fail(new Error("Aborted to load the image."))},L.onerror=function(){p.fail(new Error("Failed to load the image."))},h.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(h.navigator.userAgent)&&(L.crossOrigin="anonymous"),L.alt=C.name,L.src=c.url}},{key:"draw",value:function(c){var p=this,C=c.naturalWidth,L=c.naturalHeight,H=c.rotate,Z=void 0===H?0:H,W=c.scaleX,j=void 0===W?1:W,k=c.scaleY,G=void 0===k?1:k,te=this.file,V=this.image,a=this.options,F=document.createElement("canvas"),n=F.getContext("2d"),m=Math.abs(Z)%180==90,i=("contain"===a.resize||"cover"===a.resize)&&M(a.width)&&M(a.height),R=Math.max(a.maxWidth,0)||1/0,N=Math.max(a.maxHeight,0)||1/0,J=Math.max(a.minWidth,0)||0,ne=Math.max(a.minHeight,0)||0,se=C/L,ee=a.width,Y=a.height;if(m){var ce=[N,R];R=ce[0],N=ce[1];var z=[ne,J];J=z[0],ne=z[1];var re=[Y,ee];ee=re[0],Y=re[1]}i&&(se=ee/Y);var ue=q({aspectRatio:se,width:R,height:N},"contain");R=ue.width,N=ue.height;var he=q({aspectRatio:se,width:J,height:ne},"cover");if(J=he.width,ne=he.height,i){var me=q({aspectRatio:se,width:ee,height:Y},a.resize);ee=me.width,Y=me.height}else{var Me=q({aspectRatio:se,width:ee,height:Y}),Ue=Me.width;ee=void 0===Ue?C:Ue;var be=Me.height;Y=void 0===be?L:be}var Fe=-(ee=Math.floor(K(Math.min(Math.max(ee,J),R))))/2,Be=-(Y=Math.floor(K(Math.min(Math.max(Y,ne),N))))/2,We=ee,je=Y,Oe=[];if(i){var Ae,ye,Te=q({aspectRatio:se,width:C,height:L},{contain:"cover",cover:"contain"}[a.resize]);Oe.push((C-(Ae=Te.width))/2,(L-(ye=Te.height))/2,Ae,ye)}if(Oe.push(Fe,Be,We,je),m){var De=[Y,ee];ee=De[0],Y=De[1]}F.width=ee,F.height=Y,b(a.mimeType)||(a.mimeType=te.type);var Ie="transparent";te.size>a.convertSize&&a.convertTypes.indexOf(a.mimeType)>=0&&(a.mimeType="image/jpeg");var Se="image/jpeg"===a.mimeType;if(Se&&(Ie="#fff"),n.fillStyle=Ie,n.fillRect(0,0,ee,Y),a.beforeDraw&&a.beforeDraw.call(this,n,F),!this.aborted&&(n.save(),n.translate(ee/2,Y/2),n.rotate(Z*Math.PI/180),n.scale(j,G),n.drawImage.apply(n,[V].concat(Oe)),n.restore(),a.drew&&a.drew.call(this,n,F),!this.aborted)){var Le=function(ge){if(!p.aborted){var Re=function(fe){return p.done({naturalWidth:C,naturalHeight:L,result:fe})};if(ge&&Se&&a.retainExif&&p.exif&&p.exif.length>0){var we=function(fe){return Re(f(P(function ie(v,r){var c=S(new Uint8Array(v));if(255!==c[2]||224!==c[3])return v;var C=[255,216].concat(r,c.slice(4+(256*c[4]+c[5])));return new Uint8Array(C)}(fe,p.exif),a.mimeType)))};if(ge.arrayBuffer)ge.arrayBuffer().then(we).catch(function(){p.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var de=new pe;p.reader=de,de.onload=function(xe){we(xe.target.result)},de.onabort=function(){p.fail(new Error("Aborted to read the compressed image with FileReader."))},de.onerror=function(){p.fail(new Error("Failed to read the compressed image with FileReader."))},de.onloadend=function(){p.reader=null},de.readAsArrayBuffer(ge)}}else Re(ge)}};F.toBlob?F.toBlob(Le,a.mimeType,a.quality):Le(f(F.toDataURL(a.mimeType,a.quality)))}}},{key:"done",value:function(c){var p=c.naturalWidth,C=c.naturalHeight,L=c.result,H=this.file,Z=this.image,W=this.options;if(le&&0===Z.src.indexOf("blob:")&&le.revokeObjectURL(Z.src),L)if(W.strict&&!W.retainExif&&L.size>H.size&&W.mimeType===H.type&&!(W.width>p||W.height>C||W.minWidth>p||W.minHeight>C||W.maxWidth<p||W.maxHeight<C))L=H;else{var j=new Date;L.lastModified=j.getTime(),L.lastModifiedDate=j,L.name=H.name,L.name&&L.type!==H.type&&(L.name=L.name.replace(_e,function A(v){var r=b(v)?v.substr(6):"";return"jpeg"===r&&(r="jpg"),".".concat(r)}(L.type)))}else L=H;this.result=L,W.success&&W.success.call(this,L)}},{key:"fail",value:function(c){var p=this.options;if(!p.error)throw c;p.error.call(this,c)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ve,v}},{key:"setDefaults",value:function(c){I(s,c)}}]),v}();return Ee}()},1687:(X,w,t)=>{"use strict";t.d(w,{F:()=>e});var _=t(6321),O=t(4825);function e(U=0,I=_.z){return U<0&&(U=0),(0,O.H)(U,U,I)}},4004:(X,w,t)=>{"use strict";t.d(w,{Z:()=>s});const O={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let e;const U=new Uint8Array(16);function I(){if(!e&&(e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(U)}const l=[];for(let u=0;u<256;++u)l.push((u+256).toString(16).slice(1));const s=function g(u,h,M){if(O.randomUUID&&!h&&!u)return O.randomUUID();const D=(u=u||{}).random||(u.rng||I)();if(D[6]=15&D[6]|64,D[8]=63&D[8]|128,h){M=M||0;for(let S=0;S<16;++S)h[M+S]=D[S];return h}return function y(u,h=0){return(l[u[h+0]]+l[u[h+1]]+l[u[h+2]]+l[u[h+3]]+"-"+l[u[h+4]]+l[u[h+5]]+"-"+l[u[h+6]]+l[u[h+7]]+"-"+l[u[h+8]]+l[u[h+9]]+"-"+l[u[h+10]]+l[u[h+11]]+l[u[h+12]]+l[u[h+13]]+l[u[h+14]]+l[u[h+15]]).toLowerCase()}(D)}}}]);