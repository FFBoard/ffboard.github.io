"use strict";(self.webpackChunkboard=self.webpackChunkboard||[]).push([[75],{8053:(C,g,c)=>{c.d(g,{L:()=>R});var r=c(5e3),n=c(3022);let u=(()=>{class l{constructor(){this.dependences={[n.B2.LOGIN]:null,[n.B2.HOME]:null,[n.B2.SETTINGS]:n.B2.HOME,[n.B2.SCRIPT]:n.B2.HOME,[n.B2.SCRIPT_FORUM]:n.B2.SCRIPT,[n.B2.SCRIPT_USER]:n.B2.SCRIPT,[n.B2.SCRIPT_SETTINGS]:[n.B2.SCRIPT_USER,n.B2.SCRIPT_FORUM],[n.B2.SCRIPT_DEV]:n.B2.SCRIPT,[n.B2.SCRIPT_DEV_SETTINGS]:n.B2.SCRIPT_DEV,[n.B2.UPLOAD]:n.B2.HOME,[n.B2.ADMIN]:n.B2.HOME},this.names={[n.B2.LOGIN]:"Login",[n.B2.HOME]:"Home",[n.B2.SETTINGS]:"Notifiche",[n.B2.SCRIPT]:"Script",[n.B2.SCRIPT_FORUM]:"Forum",[n.B2.SCRIPT_USER]:"Utenti",[n.B2.SCRIPT_SETTINGS]:"Impostazioni",[n.B2.SCRIPT_DEV]:"Sviluppo",[n.B2.SCRIPT_DEV_SETTINGS]:"Impostazioni",[n.B2.UPLOAD]:"Upload",[n.B2.ADMIN]:"Amministrazione"}}createPathList(d,t=[]){const s=(o,p)=>{o.unshift({name:this.names[p]||"",path:p})},i=o=>this.dependences.hasOwnProperty(o)?this.dependences[o]instanceof Array?this.dependences[o].includes(t[0])?t.shift():this.dependences[o][0]:this.dependences[o]:null;let e=[{name:this.names[d]||"",path:""}],a=i(d);for(;a;)s(e,a),a=i(a);return e}}return l.\u0275fac=function(d){return new(d||l)},l.\u0275prov=r.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})();var L=c(1420),h=c(9808);function I(l,_){if(1&l&&r._UZ(0,"a",8),2&l){const d=r.oxw().$implicit;r.Q6J("routerLink",d.path)("innerText",d.name)}}function m(l,_){if(1&l&&r._UZ(0,"span",9),2&l){const d=r.oxw().$implicit;r.Q6J("innerText",d.name)}}const v=function(l){return{active:l}};function P(l,_){if(1&l&&(r.TgZ(0,"li",5),r.YNc(1,I,1,2,"a",6),r.YNc(2,m,1,1,"ng-template",null,7,r.W1O),r.qZA()),2&l){const d=_.last,t=r.MAs(3);r.Q6J("ngClass",r.VKq(4,v,d)),r.uIk("aria-current",d?"page":null),r.xp6(1),r.Q6J("ngIf",!d)("ngIfElse",t)}}let R=(()=>{class l{constructor(d,t){this.breadcrumbService=d,this.router=t,this.pageTitle="",this.url="",this.nodes=[],this.breadcrumbs=[]}ngOnInit(){this.url||(this.url=this.router.url),this.breadcrumbs=this.breadcrumbService.createPathList(this.url,this.nodes)}}return l.\u0275fac=function(d){return new(d||l)(r.Y36(u),r.Y36(L.F0))},l.\u0275cmp=r.Xpm({type:l,selectors:[["app-breadcrumb"]],inputs:{pageTitle:"pageTitle",url:"url",nodes:"nodes"},decls:5,vars:2,consts:[[1,"container-fluid","xxl-screen","px-md-1","d-flex","flex-column","flex-md-row","align-items-md-center"],[1,"h3","fw-light","mb-0","lh-1","fv-small-caps","pb-1",3,"innerText"],["aria-label","breadcrumb",1,"ms-md-auto","mt-1"],[1,"breadcrumb","mb-0","justify-content-md-end"],["class","breadcrumb-item",3,"ngClass",4,"ngFor","ngForOf"],[1,"breadcrumb-item",3,"ngClass"],[3,"routerLink","innerText",4,"ngIf","ngIfElse"],["lastItem",""],[3,"routerLink","innerText"],[3,"innerText"]],template:function(d,t){1&d&&(r.TgZ(0,"div",0),r._UZ(1,"h2",1),r.TgZ(2,"nav",2)(3,"ol",3),r.YNc(4,P,4,6,"li",4),r.qZA()()()),2&d&&(r.xp6(1),r.Q6J("innerText",t.pageTitle),r.xp6(3),r.Q6J("ngForOf",t.breadcrumbs))},directives:[h.sg,h.mk,h.O5,L.yS],styles:[".container-fluid[_ngcontent-%COMP%]{margin-bottom:.75rem}@media (min-width: 960px){.container-fluid[_ngcontent-%COMP%]{margin-top:.5rem}}"]}),l})()},8420:(C,g,c)=>{c.d(g,{w:()=>L});var r=c(9808),n=c(1420),u=c(5e3);let L=(()=>{class h{}return h.\u0275fac=function(m){return new(m||h)},h.\u0275mod=u.oAB({type:h}),h.\u0275inj=u.cJS({imports:[[r.ez,n.Bz]]}),h})()},6284:(C,g,c)=>{c.d(g,{y:()=>L});var r=c(3022),n=c(5e3),u=c(6303);let L=(()=>{class h{constructor(m){this.cookieConsentService=m,this.storage=null}getItem(m){return null===this.storage&&(this.storage=this.data),this.storage[m]}get data(){const m=localStorage.getItem(r.dR.PREFERENCES);if(!m)return{};try{return JSON.parse(m)}catch(v){return{}}}setItem(m,v){var P;null===this.storage&&(this.storage=this.data),v?this.storage[m]=v:delete this.storage[m],(null===(P=this.cookieConsentService.choice)||void 0===P?void 0:P.preferences)&&localStorage.setItem(r.dR.PREFERENCES,JSON.stringify(this.storage))}}return h.\u0275fac=function(m){return new(m||h)(n.LFG(u.C))},h.\u0275prov=n.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},7205:(C,g,c)=>{c.d(g,{o:()=>l});var r=c(5861),n=c(7579),u=c(8795),L=c(3022),h=c(8600),I=c(5e3),m=c(5787),v=c(3011),P=c(882),R=c(6284);let l=(()=>{class _{constructor(t,s,i,e){this.graphqlService=t,this.globalsService=s,this.profileService=i,this.preferencesService=e,this.fullQuery="\n        query FullScript($id: ID!, $type: ScriptTargetTypeEnum!) {\n            scriptList {\n                scriptId,\n                script_type,\n                forum,\n                name,\n                sdesc,\n                public_link,\n                preview,\n                tab,\n                js,\n                js_admin,\n                js_pos,\n                webhook,\n                libs,\n                deps,\n                settings_schema,\n                settings_default,\n                html_head,\n                hidden_script,\n                old_layout,\n                new_layout,\n                responsive_layout,\n                mobile,\n                demo,\n                wh_settings,\n                wh_manage,\n            }\n            scriptSettings(targetId: $id, targetType: $type) {\n                scriptId,\n                settings,\n            }\n            scriptInstalledList(targetId: $id, targetType: $type)\n            scriptRankedList {\n                scriptId\n                scriptRank\n            }\n            scriptPermissions {\n                scriptId\n                manage\n                edit\n            }\n        }",this.query="\n        query Script($id: ID!, $type: ScriptTargetTypeEnum!) {\n            scriptSettings(targetId: $id, targetType: $type) {\n                scriptId,\n                settings,\n            }\n            scriptInstalledList(targetId: $id, targetType: $type)\n        }",this.scriptInstalledList=[],this.listInputsSubject=new n.x,this.ffuid="",this.cache={},this.allScriptCache={},this.lastRequestTime=0,this.profileSubscription=this.globalsService.profileObservable.subscribe(a=>{this.ffuid=(null==a?void 0:a.user.ffuid)||""})}createCacheKey(t,s){return t+s+this.ffuid}getData(t,s=u.D7.FORUM,i=!1){var e=this;return(0,r.Z)(function*(){var a;const o=e.createCacheKey(t,s);if(Date.now()-e.lastRequestTime>18e5&&e.clearCache(!0),i){if(e.scriptList)return{scriptList:e.scriptList,scriptSettings:[],scriptInstalledList:[],scriptRankedList:[],scriptPermissions:e.scriptPermissions}}else if(e.cache.hasOwnProperty(o))return e.cache[o];const p=yield e.graphqlService.query({query:e.scriptList?e.query:e.fullQuery,variables:{id:t,type:s}});e.scriptList?(p.data.scriptRankedList=e.scriptRankedList,p.data.scriptPermissions=e.scriptPermissions):(e.lastRequestTime=Date.now(),e.scriptList=p.data.scriptList,e.parseScriptList(),e.scriptRankedList=p.data.scriptRankedList,e.scriptPermissions=p.data.scriptPermissions),e.scriptInstalledList=p.data.scriptInstalledList=p.data.scriptInstalledList.filter(E=>e.scriptList.findIndex(T=>T.scriptId===E)>-1);const S=s===u.D7.FORUM&&!(null===(a=e.globalsService.forum)||void 0===a?void 0:a.admin);return p.data.scriptList=e.filterType(e.scriptList,t,s,S?e.scriptPermissions:void 0,e.scriptRankedList),e.cache[o]=p.data,i?{scriptList:e.scriptList,scriptSettings:[],scriptInstalledList:[],scriptRankedList:[],scriptPermissions:e.scriptPermissions}:e.cache[o]})()}parseScriptList(){var t;this.scriptList=null===(t=this.scriptList)||void 0===t?void 0:t.map(s=>(this.parseScript(s),s))}parseScript(t){var s;t.parentIdList=t.parentNameList=[],t.childIdList=t.childIdList||[],t.childNameList=t.childNameList||[];try{t.parentIdList=t.deps.filter(i=>i!==t.scriptId);for(const i of t.parentIdList.keys()){let e=null===(s=this.scriptList)||void 0===s?void 0:s.find(a=>a.scriptId===t.parentIdList[i]);if(e){if(t.parentNameList.push(e.name),e.childIdList){if(e.childIdList.indexOf(t.scriptId)>-1)continue}else e.childIdList=[];e.childIdList.push(t.scriptId),e.childNameList||(e.childNameList=[]),e.childNameList.push(t.name)}else t.parentIdList.splice(i,1)}}catch(i){}}filterType(t,s,i,e,a){let S,E,o=null===i?[u.AV.FORUM,u.AV.USER,u.AV.ALL]:i===u.D7.FORUM?[u.AV.FORUM,u.AV.ALL]:[u.AV.USER,u.AV.ALL],p=-1,T=-1;return t.filter(f=>{if(0===f.js.length||(f.originalName||(f.originalName=f.name),e&&(T=e.findIndex(O=>O.scriptId===f.scriptId),T<0||!e[T].manage.includes(this.ffuid)&&(!e[T].edit.includes(this.ffuid)||!this.scriptInstalledList.includes(f.scriptId)))))return!1;if(E=!1,f.rank=1e3,a&&(p=a.findIndex(O=>O.scriptId===f.scriptId),p>-1&&(f.rank=a[p].scriptRank)),f.hidden_script){const O=f.originalName;E=f.forum===this.ffuid||this.profileService.isAdmin(),S=O.match(/^whitelist\[([^\]]*)]/i),S&&(f.name===f.originalName&&(f.name=f.name.replace(S[0],"").trim()),E||(E=S[1].toLowerCase().split(",").includes(s)))}return o.includes(f.script_type)&&(!f.hidden_script||E)})}splitTabs(t){let s={};return t.forEach(i=>{s.hasOwnProperty(i.tab)||(s[i.tab]=[]),s[i.tab].push(i)}),s}getListInputsObservable(){return this.listInputsSubject.asObservable()}pushListInputs(t){this.listInputsSubject.next(t),this.listInputs=t}get listInputs(){return this.listInputsData}set listInputs(t){this.listInputsData=t}getScript(t,s,i){var e=this;return(0,r.Z)(function*(){var a;const o=yield e.getData(s,i),p=yield e.getScriptPermissions();return[(yield e.getAllScripts(s,i)).find(S=>S.scriptId===t),(null===(a=o.scriptSettings.find(S=>S.scriptId===t))||void 0===a?void 0:a.settings)||"{}",o.scriptInstalledList.includes(t),p[`script${t}`]||{scriptId:t,manage:!1,edit:!1}]})()}getScriptsByAuthor(t){var s=this;return(0,r.Z)(function*(){return(yield s.getData(t,u.D7.USER,!0)).scriptList.filter(e=>e.forum===t)})()}updateInstalledScriptSettings(t,s,i,e){const a=this.createCacheKey(t,s);if(this.cache[a]){let o=this.cache[a].scriptSettings.find(p=>p.scriptId=i);o?o.settings=e:this.cache[a].scriptSettings.push({scriptId:i,settings:e})}}getAllScripts(t,s){var i=this;return(0,r.Z)(function*(){if(t||(t=i.ffuid,s=u.D7.USER),i.allScriptCache.hasOwnProperty(t))return i.allScriptCache[t];const e=yield i.getData(t,s,!0);return i.allScriptCache[t]=i.filterType(e.scriptList,t,null)})()}getScriptPermissions(){var t=this;return(0,r.Z)(function*(){const s=t.scriptPermissions||(yield t.getData(t.ffuid,u.D7.USER)).scriptPermissions;let i={};return s.forEach(e=>{e.manage.includes(t.ffuid)&&(i[`script${e.scriptId}`]={scriptId:e.scriptId,manage:!0,edit:!1}),e.edit.includes(t.ffuid)&&(i.hasOwnProperty(`script${e.scriptId}`)?i[`script${e.scriptId}`].edit=!0:i[`script${e.scriptId}`]={scriptId:e.scriptId,manage:!1,edit:!0})}),i})()}updateScript(t,s){if(!this.scriptList)return;const i=this.scriptList.findIndex(e=>e.scriptId===s);if(i){const e=this.scriptList[i].parentIdList.filter(a=>!t.deps.includes(a));for(const a of e){const o=this.scriptList.find(p=>p.scriptId===a);o&&this.removeChildFromParent(o,a)}Object.assign(this.scriptList[i],t),this.scriptList[i].originalName=t.name,this.parseScript(this.scriptList[i]),this.clearCache(!1)}}removeScript(t){if(!this.scriptList)return;const s=this.scriptList.findIndex(i=>i.scriptId===t);if(s){for(const i of this.scriptList[s].childIdList){const e=this.scriptList.find(a=>a.scriptId===i);e&&this.removeChildFromParent(e,t)}this.scriptList.splice(s,1),this.clearCache(!1)}}removeChildFromParent(t,s){const i=t.childIdList.indexOf(s);t.childIdList.splice(i,1),t.childNameList.splice(i,1)}clearCache(t=!0){this.cache={},this.allScriptCache={},t&&(this.scriptList=void 0,this.scriptPermissions=void 0)}get settingsOptions(){return this.preferencesService.getItem(L.Ye.SCRIPT_SETTINGS_OPTIONS)||h.iK}set settingsOptions(t){this.preferencesService.setItem(L.Ye.SCRIPT_SETTINGS_OPTIONS,t)}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return _.\u0275fac=function(t){return new(t||_)(I.LFG(m.J),I.LFG(v.d),I.LFG(P.H),I.LFG(R.y))},_.\u0275prov=I.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()}}]);