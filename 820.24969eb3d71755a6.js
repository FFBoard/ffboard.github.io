"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[820],{3285:(y,T,c)=>{c.d(T,{L:()=>E});var r=c(7165),n=c(5879);let g=(()=>{class p{constructor(){this.dependences={[r.B2.LOGIN]:null,[r.B2.HOME]:null,[r.B2.SETTINGS]:r.B2.HOME,[r.B2.SCRIPT]:r.B2.HOME,[r.B2.SCRIPT_FORUM]:r.B2.SCRIPT,[r.B2.SCRIPT_USER]:r.B2.SCRIPT,[r.B2.SCRIPT_SETTINGS]:[r.B2.SCRIPT_USER,r.B2.SCRIPT_FORUM],[r.B2.SCRIPT_DEV]:r.B2.SCRIPT,[r.B2.SCRIPT_DEV_SETTINGS]:r.B2.SCRIPT_DEV,[r.B2.UPLOAD]:r.B2.HOME,[r.B2.ADMIN]:r.B2.HOME},this.names={[r.B2.LOGIN]:"Login",[r.B2.HOME]:"Home",[r.B2.SETTINGS]:"Notifiche",[r.B2.SCRIPT]:"Script",[r.B2.SCRIPT_FORUM]:"Forum",[r.B2.SCRIPT_USER]:"Utenti",[r.B2.SCRIPT_SETTINGS]:"Impostazioni",[r.B2.SCRIPT_DEV]:"Sviluppo",[r.B2.SCRIPT_DEV_SETTINGS]:"Impostazioni",[r.B2.UPLOAD]:"Upload",[r.B2.ADMIN]:"Amministrazione"}}createPathList(d,h=[]){const O=(e,a)=>{e.unshift({name:this.names[a]||"",path:a})},t=e=>this.dependences.hasOwnProperty(e)?this.dependences[e]instanceof Array?this.dependences[e].includes(h[0])?h.shift():this.dependences[e][0]:this.dependences[e]:null;let s=[{name:this.names[d]||"",path:""}],i=t(d);for(;i;)O(s,i),i=t(i);return s}}return p.\u0275fac=function(d){return new(d||p)},p.\u0275prov=n.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();var _=c(8109),f=c(6814);function l(p,S){if(1&p&&n._UZ(0,"a",8),2&p){const d=n.oxw().$implicit;n.Q6J("routerLink",d.path)("innerText",d.name)}}function L(p,S){if(1&p&&n._UZ(0,"span",9),2&p){const d=n.oxw().$implicit;n.Q6J("innerText",d.name)}}const P=function(p){return{active:p}};function B(p,S){if(1&p&&(n.TgZ(0,"li",5),n.YNc(1,l,1,2,"a",6),n.YNc(2,L,1,1,"ng-template",null,7,n.W1O),n.qZA()),2&p){const d=S.last,h=n.MAs(3);n.Q6J("ngClass",n.VKq(4,P,d)),n.uIk("aria-current",d?"page":null),n.xp6(1),n.Q6J("ngIf",!d)("ngIfElse",h)}}let E=(()=>{class p{constructor(d,h){this.breadcrumbService=d,this.router=h,this.pageTitle="",this.url="",this.nodes=[],this.breadcrumbs=[]}ngOnInit(){this.url||(this.url=this.router.url),this.breadcrumbs=this.breadcrumbService.createPathList(this.url,this.nodes)}}return p.\u0275fac=function(d){return new(d||p)(n.Y36(g),n.Y36(_.F0))},p.\u0275cmp=n.Xpm({type:p,selectors:[["app-breadcrumb"]],inputs:{pageTitle:"pageTitle",url:"url",nodes:"nodes"},decls:5,vars:2,consts:[[1,"container-fluid","px-md-1","d-flex","flex-column","flex-md-row","align-items-md-center"],[1,"h3","fw-light","mb-0","lh-1","fv-small-caps","pb-1",3,"innerText"],["aria-label","breadcrumb",1,"ms-md-auto","mt-1"],[1,"breadcrumb","mb-0","justify-content-md-end"],["class","breadcrumb-item",3,"ngClass",4,"ngFor","ngForOf"],[1,"breadcrumb-item",3,"ngClass"],[3,"routerLink","innerText",4,"ngIf","ngIfElse"],["lastItem",""],[3,"routerLink","innerText"],[3,"innerText"]],template:function(d,h){1&d&&(n.TgZ(0,"div",0),n._UZ(1,"h2",1),n.TgZ(2,"nav",2)(3,"ol",3),n.YNc(4,B,4,6,"li",4),n.qZA()()()),2&d&&(n.xp6(1),n.Q6J("innerText",h.pageTitle),n.xp6(3),n.Q6J("ngForOf",h.breadcrumbs))},dependencies:[f.mk,f.sg,f.O5,_.rH],styles:[".container-fluid[_ngcontent-%COMP%]{margin-bottom:.75rem}@media (min-width: 960px){.container-fluid[_ngcontent-%COMP%]{margin-top:.5rem}}"]}),p})()},9090:(y,T,c)=>{c.d(T,{w:()=>_});var r=c(6814),n=c(8109),g=c(5879);let _=(()=>{class f{}return f.\u0275fac=function(L){return new(L||f)},f.\u0275mod=g.oAB({type:f}),f.\u0275inj=g.cJS({imports:[r.ez,n.Bz]}),f})()},3040:(y,T,c)=>{c.d(T,{HF:()=>l,Ry:()=>f,in:()=>L,m:()=>n,n8:()=>g,t6:()=>P,uD:()=>r,xt:()=>_});const r="\nquery FullScript($id: String!, $type: ScriptTargetTypeEnum!) {\n    scriptList {\n        scriptId,\n        script_type,\n        forum,\n        name,\n        sdesc,\n        public_link,\n        preview,\n        tab,\n        js,\n        js_beta,\n        js_sandboxes {\n            name\n            value\n            inSettings\n        },\n        js_pos,\n        webhook,\n        libs,\n        deps,\n        settings_schema,\n        settings_default,\n        html_head,\n        hidden_script,\n        old_layout,\n        new_layout,\n        responsive_layout,\n        mobile,\n        demo,\n        wh_settings,\n        wh_manage,\n    }\n    scriptSettings(targetId: $id, targetType: $type) {\n        scriptId,\n        settings,\n    }\n    scriptInstalledList(targetId: $id, targetType: $type)\n    scriptRankedList {\n        scriptId\n        scriptRank\n    }\n    scriptPermissions {\n        scriptId\n        manage\n        edit\n    }\n}",n="\nquery Script($id: String!, $type: ScriptTargetTypeEnum!) {\n    scriptSettings(targetId: $id, targetType: $type) {\n        scriptId,\n        settings,\n    }\n    scriptInstalledList(targetId: $id, targetType: $type)\n}",g="\nquery ScriptStats {\n    scriptStats {\n        scriptId\n        entities {\n            targetId\n            targetType\n        }\n    }\n}",_="\nmutation DelCache($scriptId: Int!) {\n    delCache(id: $scriptId)\n}",f="\nmutation ScriptUpsert($scriptId: Int, $scriptType: Int, $name: String, $publicLink: String, $sdesc: String, $preview: String, $tab: String, $js: String, $jsBeta: String, $jsSandboxes: [JSSandboxInput!], $jsPos: String, $webhook: String, $libs: [String], $deps: [Int], $settingsSchema: String, $settingsDefault: String, $htmlHead: String, $hiddenScript: Boolean, $oldLayout: Boolean, $newLayout: Boolean, $responsiveLayout: Boolean, $mobile: Boolean, $demo: Boolean, $whSettings: Boolean, $whManage: Boolean) {\n    scriptUpsert(scriptId: $scriptId, scriptType: $scriptType, name: $name, publicLink: $publicLink, sdesc: $sdesc, preview: $preview, tab: $tab, js: $js, jsBeta: $jsBeta, jsSandboxes: $jsSandboxes, jsPos: $jsPos, webhook: $webhook, libs: $libs, deps: $deps, settingsSchema: $settingsSchema, settingsDefault: $settingsDefault, htmlHead: $htmlHead, hiddenScript: $hiddenScript, oldLayout: $oldLayout, newLayout: $newLayout, responsiveLayout: $responsiveLayout, mobile: $mobile, demo: $demo, whSettings: $whSettings, whManage: $whManage)\n}",l="\nmutation DelScript($scriptId: Int!) {\n    delScript(scriptId: $scriptId)\n}",L="\nmutation ScriptManage(\n    $targetId: String!,\n    $targetType: ScriptTargetTypeEnum!,\n    $scriptId: Int!,\n    $action: ScriptManageActionEnum!\n) {\n    scriptManage(\n        targetId: $targetId,\n        targetType: $targetType,\n        scriptId: $scriptId,\n        action: $action\n    )\n}",P="\nmutation ScriptSettings(\n    $targetId: String!,\n    $targetType: ScriptTargetTypeEnum!,\n    $scriptId: Int!,\n    $settings: String!\n) {\n    scriptSettings(\n        targetId: $targetId,\n        targetType: $targetType,\n        scriptId: $scriptId,\n        settings: $settings\n    )\n}"},9121:(y,T,c)=>{c.d(T,{o:()=>d});var r=c(5861),n=c(1410),g=c(6347),_=c(8645),f=c(8372),l=c(3729),L=c(7165),P=c(463),B=c(5083),E=c(3040),p=c(4064),S=c(5879);let d=(()=>{class h{constructor(t,s,i,e){this.graphqlService=t,this.globalsService=s,this.profileService=i,this.preferencesService=e,this.scriptInstalledList=[],this.listInputsSubject=new _.x,this.ffuid="",this.cache={},this.allScriptCache={},this.lastRequestTime=0,this.profileSubscription=this.globalsService.profileObservable.subscribe(a=>{this.ffuid=(null==a?void 0:a.user.ffuid)||""})}createCacheKey(t,s){return t+s+this.ffuid}getData(t,s=l.D7.FORUM,i=!1){var e=this;return(0,r.Z)(function*(){var a;const m=e.createCacheKey(t,s);if(Date.now()-e.lastRequestTime>18e5&&e.clearCache(!0),i){if(e.scriptList)return{scriptList:e.scriptList,scriptSettings:[],scriptInstalledList:[],scriptRankedList:[],scriptPermissions:e.scriptPermissions}}else if(e.cache.hasOwnProperty(m))return e.cache[m];const o=yield e.graphqlService.query({query:e.scriptList?E.m:E.uD,variables:{id:t,type:s}});e.scriptList?(o.data.scriptRankedList=e.scriptRankedList,o.data.scriptPermissions=e.scriptPermissions):(e.lastRequestTime=Date.now(),e.scriptList=o.data.scriptList,e.parseScriptList(),e.scriptRankedList=o.data.scriptRankedList,e.scriptPermissions=o.data.scriptPermissions),e.scriptInstalledList=o.data.scriptInstalledList=o.data.scriptInstalledList.filter(v=>e.scriptList.findIndex($=>$.scriptId===v)>-1);const I=s===l.D7.FORUM&&!(null!==(a=e.globalsService.forum)&&void 0!==a&&a.admin);return o.data.scriptList=e.filterType(e.scriptList,t,s,I?e.scriptPermissions:void 0,e.scriptRankedList),e.cache[m]=o.data,i?{scriptList:e.scriptList,scriptSettings:[],scriptInstalledList:[],scriptRankedList:[],scriptPermissions:e.scriptPermissions}:e.cache[m]})()}parseScriptList(){var t;this.scriptList=null===(t=this.scriptList)||void 0===t?void 0:t.map(s=>(this.parseScript(s),s))}parseScript(t){t.parentIdList=t.parentNameList=[],t.childIdList=t.childIdList||[],t.childNameList=t.childNameList||[];try{t.parentIdList=t.deps.filter(i=>i!==t.scriptId);for(const i of t.parentIdList.keys()){var s;let e=null===(s=this.scriptList)||void 0===s?void 0:s.find(a=>a.scriptId===t.parentIdList[i]);if(e){if(t.parentNameList.push(e.name),e.childIdList){if(e.childIdList.indexOf(t.scriptId)>-1)continue}else e.childIdList=[];e.childIdList.push(t.scriptId),e.childNameList||(e.childNameList=[]),e.childNameList.push(t.name)}else t.parentIdList.splice(i,1)}}catch(i){}}filterType(t,s,i,e,a){let I,v,m=null===i?[l.AV.FORUM,l.AV.USER,l.AV.ALL]:i===l.D7.FORUM?[l.AV.FORUM,l.AV.ALL]:[l.AV.USER,l.AV.ALL],o=-1,$=-1;const C=this.profileService.hasAtLeastOnePermission([B.c.ADMIN]);return t.filter(u=>!(0===u.js.length||(u.originalName||(u.originalName=u.name),e&&($=e.findIndex(b=>b.scriptId===u.scriptId),$<0||!(e[$].manage.includes(this.ffuid)||e[$].edit.includes(this.ffuid)&&this.scriptInstalledList.includes(u.scriptId)))))&&(v=!1,u.rank=1e3,a&&(o=a.findIndex(b=>b.scriptId===u.scriptId),o>-1&&(u.rank=a[o].scriptRank)),u.hidden_script&&(v=u.forum===this.ffuid||C,I=u.originalName.match(/^whitelist\[([^\]]*)]/i),I&&(u.name===u.originalName&&(u.name=u.name.replace(I[0],"").trim()),v||(v=I[1].toLowerCase().split(",").includes(s)))),m.includes(u.script_type)&&(!u.hidden_script||v)))}splitTabs(t){let s={};return t.forEach(i=>{s.hasOwnProperty(i.tab)||(s[i.tab]=[]),s[i.tab].push(i)}),s}getListInputsObservable(){return this.listInputsSubject.asObservable()}pushListInputs(t){this.listInputsSubject.next(t),this.listInputs=t}get listInputs(){return this.listInputsData}set listInputs(t){this.listInputsData=t}getScript(t,s,i){var e=this;return(0,r.Z)(function*(){var a;const m=yield e.getData(s,i),o=yield e.getScriptPermissions();return[(yield e.getAllScripts(s,i)).find(I=>I.scriptId===t),(null===(a=m.scriptSettings.find(I=>I.scriptId===t))||void 0===a?void 0:a.settings)||"{}",m.scriptInstalledList.includes(t),o[`script${t}`]||{scriptId:t,manage:!1,edit:!1}]})()}getScriptsByAuthor(t){var s=this;return(0,r.Z)(function*(){return(yield s.getData(t,l.D7.USER,!0)).scriptList.filter(e=>e.forum===t)})()}updateInstalledScriptSettings(t,s,i,e){const a=this.createCacheKey(t,s);if(this.cache[a]){let m=this.cache[a].scriptSettings.find(o=>o.scriptId=i);m?m.settings=e:this.cache[a].scriptSettings.push({scriptId:i,settings:e})}}getAllScripts(t,s){var i=this;return(0,r.Z)(function*(){if(t||(t=i.ffuid,s=l.D7.USER),i.allScriptCache.hasOwnProperty(t))return i.allScriptCache[t];const e=yield i.getData(t,s,!0);return i.allScriptCache[t]=i.filterType(e.scriptList,t,null)})()}getScriptPermissions(){var t=this;return(0,r.Z)(function*(){const s=t.scriptPermissions||(yield t.getData(t.ffuid,l.D7.USER)).scriptPermissions;let i={};return s.forEach(e=>{e.manage.includes(t.ffuid)&&(i[`script${e.scriptId}`]={scriptId:e.scriptId,manage:!0,edit:!1}),e.edit.includes(t.ffuid)&&(i.hasOwnProperty(`script${e.scriptId}`)?i[`script${e.scriptId}`].edit=!0:i[`script${e.scriptId}`]={scriptId:e.scriptId,manage:!1,edit:!0})}),i})()}updateScript(t,s){if(!this.scriptList)return;const i=this.scriptList.findIndex(e=>e.scriptId===s);if(i){const e=this.scriptList[i].parentIdList.filter(a=>!t.deps.includes(a));for(const a of e){const m=this.scriptList.find(o=>o.scriptId===a);m&&this.removeChildFromParent(m,a)}Object.assign(this.scriptList[i],t),this.scriptList[i].originalName=t.name,this.parseScript(this.scriptList[i]),this.clearCache(!1)}}removeScript(t){if(!this.scriptList)return;const s=this.scriptList.findIndex(i=>i.scriptId===t);if(s){for(const i of this.scriptList[s].childIdList){const e=this.scriptList.find(a=>a.scriptId===i);e&&this.removeChildFromParent(e,t)}this.scriptList.splice(s,1),this.clearCache(!1)}}removeChildFromParent(t,s){const i=t.childIdList.indexOf(s);t.childIdList.splice(i,1),t.childNameList.splice(i,1)}clearCache(t=!0){this.cache={},this.allScriptCache={},t&&(this.scriptList=void 0,this.scriptPermissions=void 0)}get settingsOptions(){return this.preferencesService.getItem(L.Ye.SCRIPT_SETTINGS_OPTIONS)||p.iK}set settingsOptions(t){this.preferencesService.setItem(L.Ye.SCRIPT_SETTINGS_OPTIONS,t)}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return h.\u0275fac=function(t){return new(t||h)(S.LFG(g.J),S.LFG(n.d),S.LFG(f.H),S.LFG(P.y))},h.\u0275prov=S.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()}}]);