"use strict";(self.webpackChunkboard=self.webpackChunkboard||[]).push([[993],{8621:(v,P,a)=>{a.d(P,{L:()=>R});var s=a(4650),n=a(5044);let d=(()=>{class p{constructor(){this.dependences={[n.B2.LOGIN]:null,[n.B2.HOME]:null,[n.B2.SETTINGS]:n.B2.HOME,[n.B2.SCRIPT]:n.B2.HOME,[n.B2.SCRIPT_FORUM]:n.B2.SCRIPT,[n.B2.SCRIPT_USER]:n.B2.SCRIPT,[n.B2.SCRIPT_SETTINGS]:[n.B2.SCRIPT_USER,n.B2.SCRIPT_FORUM],[n.B2.SCRIPT_DEV]:n.B2.SCRIPT,[n.B2.SCRIPT_DEV_SETTINGS]:n.B2.SCRIPT_DEV,[n.B2.UPLOAD]:n.B2.HOME,[n.B2.ADMIN]:n.B2.HOME},this.names={[n.B2.LOGIN]:"Login",[n.B2.HOME]:"Home",[n.B2.SETTINGS]:"Notifiche",[n.B2.SCRIPT]:"Script",[n.B2.SCRIPT_FORUM]:"Forum",[n.B2.SCRIPT_USER]:"Utenti",[n.B2.SCRIPT_SETTINGS]:"Impostazioni",[n.B2.SCRIPT_DEV]:"Sviluppo",[n.B2.SCRIPT_DEV_SETTINGS]:"Impostazioni",[n.B2.UPLOAD]:"Upload",[n.B2.ADMIN]:"Amministrazione"}}createPathList(o,m=[]){const y=(e,c)=>{e.unshift({name:this.names[c]||"",path:c})},t=e=>this.dependences.hasOwnProperty(e)?this.dependences[e]instanceof Array?this.dependences[e].includes(m[0])?m.shift():this.dependences[e][0]:this.dependences[e]:null;let r=[{name:this.names[o]||"",path:""}],i=t(o);for(;i;)y(r,i),i=t(i);return r}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275prov=s.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();var S=a(9631),u=a(6895);function g(p,L){if(1&p&&s._UZ(0,"a",8),2&p){const o=s.oxw().$implicit;s.Q6J("routerLink",o.path)("innerText",o.name)}}function l(p,L){if(1&p&&s._UZ(0,"span",9),2&p){const o=s.oxw().$implicit;s.Q6J("innerText",o.name)}}const _=function(p){return{active:p}};function D(p,L){if(1&p&&(s.TgZ(0,"li",5),s.YNc(1,g,1,2,"a",6),s.YNc(2,l,1,1,"ng-template",null,7,s.W1O),s.qZA()),2&p){const o=L.last,m=s.MAs(3);s.Q6J("ngClass",s.VKq(4,_,o)),s.uIk("aria-current",o?"page":null),s.xp6(1),s.Q6J("ngIf",!o)("ngIfElse",m)}}let R=(()=>{class p{constructor(o,m){this.breadcrumbService=o,this.router=m,this.pageTitle="",this.url="",this.nodes=[],this.breadcrumbs=[]}ngOnInit(){this.url||(this.url=this.router.url),this.breadcrumbs=this.breadcrumbService.createPathList(this.url,this.nodes)}}return p.\u0275fac=function(o){return new(o||p)(s.Y36(d),s.Y36(S.F0))},p.\u0275cmp=s.Xpm({type:p,selectors:[["app-breadcrumb"]],inputs:{pageTitle:"pageTitle",url:"url",nodes:"nodes"},decls:5,vars:2,consts:[[1,"container-fluid","px-md-1","d-flex","flex-column","flex-md-row","align-items-md-center"],[1,"h3","fw-light","mb-0","lh-1","fv-small-caps","pb-1",3,"innerText"],["aria-label","breadcrumb",1,"ms-md-auto","mt-1"],[1,"breadcrumb","mb-0","justify-content-md-end"],["class","breadcrumb-item",3,"ngClass",4,"ngFor","ngForOf"],[1,"breadcrumb-item",3,"ngClass"],[3,"routerLink","innerText",4,"ngIf","ngIfElse"],["lastItem",""],[3,"routerLink","innerText"],[3,"innerText"]],template:function(o,m){1&o&&(s.TgZ(0,"div",0),s._UZ(1,"h2",1),s.TgZ(2,"nav",2)(3,"ol",3),s.YNc(4,D,4,6,"li",4),s.qZA()()()),2&o&&(s.xp6(1),s.Q6J("innerText",m.pageTitle),s.xp6(3),s.Q6J("ngForOf",m.breadcrumbs))},dependencies:[u.mk,u.sg,u.O5,S.yS],styles:[".container-fluid[_ngcontent-%COMP%]{margin-bottom:.75rem}@media (min-width: 960px){.container-fluid[_ngcontent-%COMP%]{margin-top:.5rem}}"]}),p})()},5531:(v,P,a)=>{a.d(P,{w:()=>S});var s=a(6895),n=a(9631),d=a(4650);let S=(()=>{class u{}return u.\u0275fac=function(l){return new(l||u)},u.\u0275mod=d.oAB({type:u}),u.\u0275inj=d.cJS({imports:[s.ez,n.Bz]}),u})()},2381:(v,P,a)=>{a.d(P,{y:()=>S});var s=a(5044),n=a(4650),d=a(5700);let S=(()=>{class u{constructor(l){this.cookieConsentService=l,this.storage=null}getItem(l){return null===this.storage&&(this.storage=this.data),this.storage[l]}get data(){const l=localStorage.getItem(s.dR.PREFERENCES);if(!l)return{};try{return JSON.parse(l)}catch{return{}}}setItem(l,_){null===this.storage&&(this.storage=this.data),_?this.storage[l]=_:delete this.storage[l],this.cookieConsentService.choice?.preferences&&localStorage.setItem(s.dR.PREFERENCES,JSON.stringify(this.storage))}resetItemsOnProfileChange(){const l=this.getItem(s.Ye.UPLOAD);l&&(l.lastPath=[],this.setItem(s.Ye.UPLOAD,l))}}return u.\u0275fac=function(l){return new(l||u)(n.LFG(d.C))},u.\u0275prov=n.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},3590:(v,P,a)=>{a.d(P,{HF:()=>g,Ry:()=>u,in:()=>l,m:()=>n,n8:()=>d,t6:()=>_,uD:()=>s,xt:()=>S});const s="\nquery FullScript($id: String!, $type: ScriptTargetTypeEnum!) {\n    scriptList {\n        scriptId,\n        script_type,\n        forum,\n        name,\n        sdesc,\n        public_link,\n        preview,\n        tab,\n        js,\n        js_beta,\n        js_admin,\n        js_pos,\n        webhook,\n        libs,\n        deps,\n        settings_schema,\n        settings_default,\n        html_head,\n        hidden_script,\n        old_layout,\n        new_layout,\n        responsive_layout,\n        mobile,\n        demo,\n        wh_settings,\n        wh_manage,\n    }\n    scriptSettings(targetId: $id, targetType: $type) {\n        scriptId,\n        settings,\n    }\n    scriptInstalledList(targetId: $id, targetType: $type)\n    scriptRankedList {\n        scriptId\n        scriptRank\n    }\n    scriptPermissions {\n        scriptId\n        manage\n        edit\n    }\n}",n="\nquery Script($id: String!, $type: ScriptTargetTypeEnum!) {\n    scriptSettings(targetId: $id, targetType: $type) {\n        scriptId,\n        settings,\n    }\n    scriptInstalledList(targetId: $id, targetType: $type)\n}",d="\nquery ScriptStats {\n    scriptStats {\n        scriptId\n        entities {\n            targetId\n            targetType\n        }\n    }\n}",S="\nmutation DelCache($scriptId: Int!) {\n    delCache(id: $scriptId)\n}",u="\nmutation ScriptUpsert($scriptDetails: ScriptDetails!, $scriptId: Int) {\n    scriptUpsert(scriptDetails: $scriptDetails, scriptId: $scriptId)\n}",g="\nmutation DelScript($scriptId: Int!) {\n    delScript(scriptId: $scriptId)\n}",l="\nmutation ScriptManage(\n    $targetId: String!,\n    $targetType: ScriptTargetTypeEnum!,\n    $scriptId: Int!,\n    $action: ScriptManageActionEnum!\n) {\n    scriptManage(\n        targetId: $targetId,\n        targetType: $targetType,\n        scriptId: $scriptId,\n        action: $action\n    )\n}",_="\nmutation ScriptSettings(\n    $targetId: String!,\n    $targetType: ScriptTargetTypeEnum!,\n    $scriptId: Int!,\n    $settings: String!\n) {\n    scriptSettings(\n        targetId: $targetId,\n        targetType: $targetType,\n        scriptId: $scriptId,\n        settings: $settings\n    )\n}"},7163:(v,P,a)=>{a.d(P,{o:()=>o});var s=a(5861),n=a(7579),d=a(2300),S=a(5044),u=a(608),g=a(3590),l=a(5946),_=a(4650),D=a(5395),R=a(3138),p=a(5681),L=a(2381);let o=(()=>{class m{constructor(t,r,i,e){this.graphqlService=t,this.globalsService=r,this.profileService=i,this.preferencesService=e,this.scriptInstalledList=[],this.listInputsSubject=new n.x,this.ffuid="",this.cache={},this.allScriptCache={},this.lastRequestTime=0,this.profileSubscription=this.globalsService.profileObservable.subscribe(c=>{this.ffuid=c?.user.ffuid||""})}createCacheKey(t,r){return t+r+this.ffuid}getData(t,r=d.D7.FORUM,i=!1){var e=this;return(0,s.Z)(function*(){const c=e.createCacheKey(t,r);if(Date.now()-e.lastRequestTime>18e5&&e.clearCache(!0),i){if(e.scriptList)return{scriptList:e.scriptList,scriptSettings:[],scriptInstalledList:[],scriptRankedList:[],scriptPermissions:e.scriptPermissions}}else if(e.cache.hasOwnProperty(c))return e.cache[c];const h=yield e.graphqlService.query({query:e.scriptList?g.m:g.uD,variables:{id:t,type:r}});return e.scriptList?(h.data.scriptRankedList=e.scriptRankedList,h.data.scriptPermissions=e.scriptPermissions):(e.lastRequestTime=Date.now(),e.scriptList=h.data.scriptList,e.parseScriptList(),e.scriptRankedList=h.data.scriptRankedList,e.scriptPermissions=h.data.scriptPermissions),e.scriptInstalledList=h.data.scriptInstalledList=h.data.scriptInstalledList.filter(E=>e.scriptList.findIndex(T=>T.scriptId===E)>-1),h.data.scriptList=e.filterType(e.scriptList,t,r,r!==d.D7.FORUM||e.globalsService.forum?.admin?void 0:e.scriptPermissions,e.scriptRankedList),e.cache[c]=h.data,i?{scriptList:e.scriptList,scriptSettings:[],scriptInstalledList:[],scriptRankedList:[],scriptPermissions:e.scriptPermissions}:e.cache[c]})()}parseScriptList(){this.scriptList=this.scriptList?.map(t=>(this.parseScript(t),t))}parseScript(t){t.parentIdList=t.parentNameList=[],t.childIdList=t.childIdList||[],t.childNameList=t.childNameList||[];try{t.parentIdList=t.deps.filter(r=>r!==t.scriptId);for(const r of t.parentIdList.keys()){let i=this.scriptList?.find(e=>e.scriptId===t.parentIdList[r]);if(i){if(t.parentNameList.push(i.name),i.childIdList){if(i.childIdList.indexOf(t.scriptId)>-1)continue}else i.childIdList=[];i.childIdList.push(t.scriptId),i.childNameList||(i.childNameList=[]),i.childNameList.push(t.name)}else t.parentIdList.splice(r,1)}}catch{}}filterType(t,r,i,e,c){let E,T,h=null===i?[d.AV.FORUM,d.AV.USER,d.AV.ALL]:i===d.D7.FORUM?[d.AV.FORUM,d.AV.ALL]:[d.AV.USER,d.AV.ALL],I=-1,C=-1;const M=this.profileService.hasAtLeastOnePermission([u.c.ADMIN]);return t.filter(f=>!(0===f.js.length||(f.originalName||(f.originalName=f.name),e&&(C=e.findIndex(O=>O.scriptId===f.scriptId),C<0||!(e[C].manage.includes(this.ffuid)||e[C].edit.includes(this.ffuid)&&this.scriptInstalledList.includes(f.scriptId)))))&&(T=!1,f.rank=1e3,c&&(I=c.findIndex(O=>O.scriptId===f.scriptId),I>-1&&(f.rank=c[I].scriptRank)),f.hidden_script&&(T=f.forum===this.ffuid||M,E=f.originalName.match(/^whitelist\[([^\]]*)]/i),E&&(f.name===f.originalName&&(f.name=f.name.replace(E[0],"").trim()),T||(T=E[1].toLowerCase().split(",").includes(r)))),h.includes(f.script_type)&&(!f.hidden_script||T)))}splitTabs(t){let r={};return t.forEach(i=>{r.hasOwnProperty(i.tab)||(r[i.tab]=[]),r[i.tab].push(i)}),r}getListInputsObservable(){return this.listInputsSubject.asObservable()}pushListInputs(t){this.listInputsSubject.next(t),this.listInputs=t}get listInputs(){return this.listInputsData}set listInputs(t){this.listInputsData=t}getScript(t,r,i){var e=this;return(0,s.Z)(function*(){const c=yield e.getData(r,i),h=yield e.getScriptPermissions();return[(yield e.getAllScripts(r,i)).find(I=>I.scriptId===t),c.scriptSettings.find(I=>I.scriptId===t)?.settings||"{}",c.scriptInstalledList.includes(t),h[`script${t}`]||{scriptId:t,manage:!1,edit:!1}]})()}getScriptsByAuthor(t){var r=this;return(0,s.Z)(function*(){return(yield r.getData(t,d.D7.USER,!0)).scriptList.filter(e=>e.forum===t)})()}updateInstalledScriptSettings(t,r,i,e){const c=this.createCacheKey(t,r);if(this.cache[c]){let h=this.cache[c].scriptSettings.find(I=>I.scriptId=i);h?h.settings=e:this.cache[c].scriptSettings.push({scriptId:i,settings:e})}}getAllScripts(t,r){var i=this;return(0,s.Z)(function*(){if(t||(t=i.ffuid,r=d.D7.USER),i.allScriptCache.hasOwnProperty(t))return i.allScriptCache[t];const e=yield i.getData(t,r,!0);return i.allScriptCache[t]=i.filterType(e.scriptList,t,null)})()}getScriptPermissions(){var t=this;return(0,s.Z)(function*(){const r=t.scriptPermissions||(yield t.getData(t.ffuid,d.D7.USER)).scriptPermissions;let i={};return r.forEach(e=>{e.manage.includes(t.ffuid)&&(i[`script${e.scriptId}`]={scriptId:e.scriptId,manage:!0,edit:!1}),e.edit.includes(t.ffuid)&&(i.hasOwnProperty(`script${e.scriptId}`)?i[`script${e.scriptId}`].edit=!0:i[`script${e.scriptId}`]={scriptId:e.scriptId,manage:!1,edit:!0})}),i})()}updateScript(t,r){if(!this.scriptList)return;const i=this.scriptList.findIndex(e=>e.scriptId===r);if(i){const e=this.scriptList[i].parentIdList.filter(c=>!t.deps.includes(c));for(const c of e){const h=this.scriptList.find(I=>I.scriptId===c);h&&this.removeChildFromParent(h,c)}Object.assign(this.scriptList[i],t),this.scriptList[i].originalName=t.name,this.parseScript(this.scriptList[i]),this.clearCache(!1)}}removeScript(t){if(!this.scriptList)return;const r=this.scriptList.findIndex(i=>i.scriptId===t);if(r){for(const i of this.scriptList[r].childIdList){const e=this.scriptList.find(c=>c.scriptId===i);e&&this.removeChildFromParent(e,t)}this.scriptList.splice(r,1),this.clearCache(!1)}}removeChildFromParent(t,r){const i=t.childIdList.indexOf(r);t.childIdList.splice(i,1),t.childNameList.splice(i,1)}clearCache(t=!0){this.cache={},this.allScriptCache={},t&&(this.scriptList=void 0,this.scriptPermissions=void 0)}get settingsOptions(){return this.preferencesService.getItem(S.Ye.SCRIPT_SETTINGS_OPTIONS)||l.iK}set settingsOptions(t){this.preferencesService.setItem(S.Ye.SCRIPT_SETTINGS_OPTIONS,t)}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return m.\u0275fac=function(t){return new(t||m)(_.LFG(D.J),_.LFG(R.d),_.LFG(p.H),_.LFG(L.y))},m.\u0275prov=_.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()}}]);