(self.webpackChunkboard=self.webpackChunkboard||[]).push([[377],{9969:(Y,B,t)=>{"use strict";t.d(B,{R:()=>h});class h{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(b=>b in this).forEach(b=>this[b]=e[b]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(b=>b in this).forEach(b=>this[b]=e[b].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},2020:(Y,B,t)=>{"use strict";t.d(B,{y:()=>a});var h=t(5861);var _=t(4650);let a=(()=>{class l{constructor(){this.autoRotateSupported=function e(){return new Promise(l=>{const c=new Image;c.onload=()=>{l(1===c.width&&2===c.height)},c.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(i,v){return new Promise((u,m)=>{const T=new FileReader;T.onload=D=>{this.loadImage(D.target.result,i.type,v).then(u).catch(m)},T.readAsDataURL(i)})}loadImage(i,v,u){return this.isValidImageType(v)?this.loadBase64Image(i,u):Promise.reject(new Error("Invalid image type"))}isValidImageType(i){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(i)}loadImageFromURL(i,v){return new Promise((u,m)=>{const T=new Image;T.onerror=()=>m,T.onload=()=>{const D=document.createElement("canvas"),G=D.getContext("2d");D.width=T.width,D.height=T.height,G?.drawImage(T,0,0),this.loadBase64Image(D.toDataURL(),v).then(u)},T.crossOrigin="anonymous",T.src=i})}loadBase64Image(i,v){return new Promise((u,m)=>{const T=new Image;T.onload=()=>u({originalImage:T,originalBase64:i}),T.onerror=m,T.src=i}).then(u=>this.transformImageBase64(u,v))}transformImageBase64(i,v){var u=this;return(0,h.Z)(function*(){const m=yield u.autoRotateSupported,T=yield function b(l){switch("string"==typeof l&&(l=function S(l){const c=new DataView(function f(l){l=l.replace(/^data\:([^\;]+)\;base64,/gim,"");const c=atob(l),i=c.length,v=new Uint8Array(i);for(let u=0;u<i;u++)v[u]=c.charCodeAt(u);return v.buffer}(l));if(65496!==c.getUint16(0,!1))return-2;const i=c.byteLength;let v=2;for(;v<i;){if(c.getUint16(v+2,!1)<=8)return-1;const u=c.getUint16(v,!1);if(v+=2,65505==u){if(1165519206!==c.getUint32(v+=2,!1))return-1;const m=18761==c.getUint16(v+=6,!1);v+=c.getUint32(v+4,m);const T=c.getUint16(v,m);v+=2;for(let D=0;D<T;D++)if(274==c.getUint16(v+12*D,m))return c.getUint16(v+12*D+8,m)}else{if(65280!=(65280&u))break;v+=c.getUint16(v,!1)}}return-1}(l)),l){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(m?-1:i.originalBase64);return i.originalImage&&i.originalImage.complete?u.transformLoadedImage({original:{base64:i.originalBase64,image:i.originalImage,size:{width:i.originalImage.naturalWidth,height:i.originalImage.naturalHeight}},exifTransform:T},v):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(i,v){var u=this;return(0,h.Z)(function*(){const m=v.canvasRotation+i.exifTransform.rotate,T={width:i.original.image.naturalWidth,height:i.original.image.naturalHeight};if(0===m&&!i.exifTransform.flip&&!v.containWithinAspectRatio)return{original:{base64:i.original.base64,image:i.original.image,size:{...T}},transformed:{base64:i.original.base64,image:i.original.image,size:{...T}},exifTransform:i.exifTransform};const D=u.getTransformedSize(T,i.exifTransform,v),G=document.createElement("canvas");G.width=D.width,G.height=D.height;const C=G.getContext("2d");C?.setTransform(i.exifTransform.flip?-1:1,0,0,1,G.width/2,G.height/2),C?.rotate(Math.PI*(m/2)),C?.drawImage(i.original.image,-T.width/2,-T.height/2);const x=G.toDataURL(),s=yield u.loadImageFromBase64(x);return{original:{base64:i.original.base64,image:i.original.image,size:{...T}},transformed:{base64:x,image:s,size:{width:s.width,height:s.height}},exifTransform:i.exifTransform}})()}loadImageFromBase64(i){return new Promise((v,u)=>{const m=new Image;m.onload=()=>v(m),m.onerror=u,m.src=i})}getTransformedSize(i,v,u){const m=u.canvasRotation+v.rotate;if(u.containWithinAspectRatio){if(m%2){const D=i.height/u.aspectRatio;return{width:Math.max(i.height,i.width*u.aspectRatio),height:Math.max(i.width,D)}}{const D=i.width/u.aspectRatio;return{width:Math.max(i.width,i.height*u.aspectRatio),height:Math.max(i.height,D)}}}return m%2?{height:i.width,width:i.height}:{width:i.width,height:i.height}}}return l.\u0275fac=function(i){return new(i||l)},l.\u0275prov=_.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()},8896:(Y,B,t)=>{"use strict";function h(U){const e=U.split(","),b=e[0].replace("data:","").replace(";base64",""),S=atob(e[1]),f=new ArrayBuffer(S.length),_=new Uint8Array(f);for(let a=0;a<S.length;a+=1)_[a]=S.charCodeAt(a);return new Blob([f],{type:b})}t.d(B,{L:()=>h})},3098:(Y,B,t)=>{"use strict";t.d(B,{B:()=>le});var h=t(5861),U=t(1309),e=t(4650),b=t(4968),S=t(3905),f=t(3848),_=t(1460),a=t(4323),l=t(6986),c=t(575),i=(()=>{return(A=i||(i={})).UNSUPPORTED="unsupported",A.OVERSIZED="oversized",A.REMOTE_URL_RESPONSE="remote-url-response",i;var A})(),v=t(7693),u=t(3207),m=t(146),T=t(3612),D=t(6378),G=t(9383),C=t(4573),x=t(6895),s=t(4006),E=t(4029),O=t(8279),M=t(3450),P=t(8212);const F=["fileInput"];function J(A,Z){1&A&&(e.O4$(),e.TgZ(0,"svg",31),e._UZ(1,"path",32)(2,"path",33),e.qZA())}const k=function(){return["text-primary"]};function q(A,Z){1&A&&e._UZ(0,"app-logo",34),2&A&&e.Q6J("svgClass",e.DdM(2,k))("responsive",!1)}function ee(A,Z){1&A&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&A&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.DESKTOP"),e.oJD)}function ae(A,Z){1&A&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&A&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.TOUCH"),e.oJD)}const oe=function(A){return{"fw-bold fs-md-lg":A}},fe=function(A){return{"text-decoration-underline":A}};function y(A,Z){if(1&A){const r=e.EpF();e.TgZ(0,"div",35),e.YNc(1,ee,2,3,"span",36),e.YNc(2,ae,2,3,"span",36),e.TgZ(3,"span",37),e.NdJ("click",function(n){e.CHM(r);const I=e.oxw(2),L=e.MAs(23);return e.KtG(I.toggleRemoteUrlForm(n,L))}),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&A){const r=e.oxw(2);e.Q6J("ngClass",e.VKq(7,oe,!r.isWidget)),e.xp6(1),e.Q6J("ngIf",!r.touchDevice),e.xp6(1),e.Q6J("ngIf",r.touchDevice),e.xp6(1),e.Q6J("ngClass",e.VKq(9,fe,r.isWidget)),e.xp6(1),e.Oqu(e.lcZ(5,5,"COMPONENTS.UPLOADER.DESCRIPTION.REMOTE_URL"))}}function o(A,Z){1&A&&e.GkF(0)}function d(A,Z){if(1&A){const r=e.EpF();e.TgZ(0,"div",39),e.YNc(1,o,1,0,"ng-container",17),e.TgZ(2,"button",40),e.NdJ("click",function(n){e.CHM(r);const I=e.oxw(2);return e.KtG(I.handleRemoteUrlUpload(n))}),e.O4$(),e.TgZ(3,"svg",41),e._UZ(4,"path",42),e.qZA()(),e.kcU(),e.TgZ(5,"button",43),e.NdJ("click",function(n){e.CHM(r);const I=e.oxw(2);return e.KtG(I.toggleRemoteUrlForm(n))}),e.O4$(),e.TgZ(6,"svg",41),e._UZ(7,"path",44),e.qZA()()()}if(2&A){const r=e.oxw(2),p=e.MAs(34);e.xp6(1),e.Q6J("ngTemplateOutlet",p),e.xp6(1),e.Q6J("disabled",0===r.remoteUrl.length||!r.isRemoteUrlValid)}}function g(A,Z){if(1&A&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"em",45),e.ALo(5,"arrayJoin"),e.BQk()),2&A){const r=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"COMPONENTS.UPLOADER.PATH.LONG")," "),e.xp6(2),e.Q6J("innerText",r.currentFolderPath.length?e.xi3(5,4,r.currentFolderPath,"/"):"root")}}function R(A,Z){if(1&A&&(e._UZ(0,"div",50),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&A){const r=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,r.currentFolderPath,0,-1),"/"))}}function w(A,Z){if(1&A&&(e.TgZ(0,"div",46)(1,"div",47),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,R,3,8,"div",48),e._UZ(5,"div",49),e.ALo(6,"arrayJoin"),e.ALo(7,"slice"),e.qZA()),2&A){const r=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,3,"COMPONENTS.UPLOADER.PATH.SHORT")),e.xp6(2),e.Q6J("ngIf",r.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(r.currentFolderPath.length>1?"/":"")+(r.currentFolderPath.length?e.xi3(6,5,e.xi3(7,8,r.currentFolderPath,r.currentFolderPath.length-1),"/"):"root"))}}const K=function(){return{bottom:0,left:0}};function H(A,Z){if(1&A){const r=e.EpF();e.ynx(0),e.TgZ(1,"a",51),e.NdJ("click",function(){e.CHM(r);const n=e.oxw(2);return e.KtG(n.openInfoModal.emit())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",52),e.NdJ("click",function(){e.CHM(r),e.oxw(2);const n=e.MAs(7);return e.KtG(n.open())}),e._uU(5,"settings"),e.qZA(),e.TgZ(6,"div",53),e.NdJ("click",function(n){e.CHM(r);const I=e.oxw(2),L=e.MAs(23);return e.KtG(I.toggleRemoteUrlForm(n,L))}),e._uU(7,"add_link"),e.qZA(),e.BQk()}2&A&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,K)),e.xp6(1),e.Oqu(e.lcZ(3,2,"COMPONENTS.UPLOADER.INFO")))}const N=function(A,Z,r){return{"cursor-pointer":A,"py-4 px-3 px-sm-4":Z,"p-2 pb-3":r}},Q=function(A,Z,r){return{"my-2":A,"mb-2":Z,"mw-100 mt-1":r}};function z(A,Z){if(1&A){const r=e.EpF();e.ynx(0),e.TgZ(1,"div",22,23),e.NdJ("dragenter",function(){e.CHM(r);const n=e.MAs(2),I=e.oxw();return e.KtG(I.setDragOverEvent(n))})("drop",function(n){e.CHM(r);const I=e.oxw();return e.KtG(I.handleDropEvent(n))})("click",function(){e.CHM(r);const n=e.oxw(),I=e.MAs(2);return e.KtG(!n.isWaitingRemoteUrl&&I.click())}),e.YNc(3,J,3,0,"svg",24),e.YNc(4,q,1,3,"ng-template",null,25,e.W1O),e.YNc(6,y,6,11,"div",26),e.YNc(7,d,8,2,"div",27),e.TgZ(8,"div",28),e.YNc(9,g,6,7,"ng-container",3),e.YNc(10,w,8,11,"ng-template",null,29,e.W1O),e.qZA()(),e.YNc(12,H,8,5,"ng-container",30),e.BQk()}if(2&A){const r=e.MAs(5),p=e.MAs(11),n=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(9,N,!n.loading&&!n.isWaitingRemoteUrl,!n.isWidget,n.isWidget)),e.xp6(2),e.Q6J("ngIf",!n.isWidget)("ngIfElse",r),e.xp6(3),e.Q6J("ngIf",!n.isWidget||!n.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngIf",n.isWidget&&n.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngClass",e.kEZ(13,Q,!n.isWidget&&!n.touchDevice,!n.isWidget&&n.touchDevice,n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.isWidget)("ngIfElse",p),e.xp6(3),e.Q6J("ngIf",!n.isWidget)}}const $=function(A,Z){return{"p-4":A,"p-2":Z}};function ie(A,Z){if(1&A&&(e.TgZ(0,"div",54),e.O4$(),e.TgZ(1,"svg",55),e._UZ(2,"path",56),e.qZA(),e.kcU(),e._UZ(3,"app-loader",57),e.TgZ(4,"div",58),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&A){const r=e.oxw();e.Q6J("ngClass",e.WLB(6,$,!r.isWidget,r.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",r.loadingMessage),e.xp6(2),e.Oqu(e.lcZ(6,4,"COMPONENTS.UPLOADER.LOADING.SUBTEXT"))}}function te(A,Z){1&A&&e.GkF(0)}const W=function(A){return{"fs-reset":A}};function ne(A,Z){if(1&A){const r=e.EpF();e.TgZ(0,"input",59,60),e.NdJ("ngModelChange",function(n){e.CHM(r);const I=e.oxw();return e.KtG(I.remoteUrl=n)})("ngModelChange",function(){e.CHM(r);const n=e.MAs(1),I=e.oxw();return e.KtG(I.isRemoteUrlValid=!n.invalid)}),e.ALo(2,"translate"),e.qZA()}if(2&A){const r=e.oxw();e.Q6J("placeholder",e.lcZ(2,4,"COMPONENTS.UPLOADER.REMOTE_URL_INPUT_PLACEHOLDER"))("ngClass",e.VKq(6,W,r.isWidget))("ngModel",r.remoteUrl)("pattern","^https?://[^.]+\\.(.+)")}}const X=function(A,Z){return{uploading:A,"widget flex-grow-1 min-w-0":Z}};let le=(()=>{class A{constructor(r,p,n,I,L,j,se,ce,he){this.postMessageService=r,this.uploadService=p,this.uploadObservablesService=n,this.uploaderService=I,this.toastService=L,this.renderer=j,this.ngZone=se,this.translateService=ce,this.proxyService=he,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="",this.touchDevice=_.eX,this.isWaitingRemoteUrl=!1,this.remoteUrl="",this.isRemoteUrlValid=!1,this.dragOverEvent=!1,this.checkingFileMessage="",this.options=this.uploaderService.uploaderOptions;const ue=this.uploadService.preferences.uploader;ue.checkImage.active||(this.options.compress=!1),ue.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){var r=this;return(0,h.Z)(function*(){r.handleClipboardPasteEvent(),r.handleExternalUpload(),r.checkingFileMessage=r.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CHECK"),r.loadingMessage=r.checkingFileMessage})()}handleClipboardPasteEvent(){var r=this;this.clipboardPasteEventSubscription=(0,b.R)(document.body,"paste").subscribe(function(){var p=(0,h.Z)(function*(n){if(r.isWidget&&r.isWaitingRemoteUrl||!r.canUpload())return;const I=Array.from((n.clipboardData||n.originalEvent.clipboardData).items);let L=[];for(const j of I)if(0===j.type.indexOf("image")){const se=j.getAsFile();se&&L.push(se)}L.length>0?yield r.preUpload(L):r.reset()});return function(n){return p.apply(this,arguments)}}())}handleExternalUpload(){var r=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var p=(0,h.Z)(function*(n){if(n){if(!r.canUpload())return;yield r.preUpload([n.file],n.options)}else r.fileInputRef.nativeElement.click()});return function(n){return p.apply(this,arguments)}}())}handleSelectionEvent(r){var p=this;return(0,h.Z)(function*(){if(!p.canUpload())return;const n=r.target;if(n.files&&n.files.length){const I=Array.from(n.files);return n.value="",p.preUpload(I)}p.reset()})()}handleDropEvent(r){var p=this;return(0,h.Z)(function*(){if(r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation(),!p.canUpload())return;const n=r.dataTransfer?.files?Array.from(r.dataTransfer.files):[];if(n.length)return p.preUpload(n);p.reset()})()}handleRemoteUrlUpload(r,p){var n=this;return(0,h.Z)(function*(){if(!n.canUpload())return;const I=n.remoteUrl;n.loadingMessage=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.GETTING_REMOTE_FILE"),n.toggleRemoteUrlForm(r,p);const L=(0,f.Tb)(I);if(!L.ext||-1===l.O8.findIndex(se=>-1!==se.ext.indexOf(L.ext)))return n.handleErrors([L.name],[]),void n.reset();const j=yield n.proxyService.get(I);return j?n.preUpload([new File([j],L.name,{type:j.type,lastModified:Date.now()})]):(n.toastService.show({content:"Errore nel recupero dell'immagine dall'url!",level:U.m.ERROR}),n.reset(),void n.postMessageService.send(a.l.UPLOAD_ERROR,{filename:L.name,error:i.REMOTE_URL_RESPONSE}))})()}saveOptions(r=!0){this.uploaderService.uploaderOptions=this.options,r&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(r){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(r,"dragover",p=>{p.preventDefault()})}))}canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage=this.checkingFileMessage,this.postMessageService.send(a.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(r,p){var n=this;return(0,h.Z)(function*(){const I=[...n.currentFolderPath];let L=[],j=[],se=[],ce=[];p?p.allowOverwrite=p.allowOverwrite||!1:(p=n.uploaderService.uploaderOptions).allowOverwrite=!1;for(let V=0;V<r.length;V++){let re=p.compress?yield n.uploaderService.compressFileIfNeeded(r[V],p.imageDimensions):r[V];if(re=yield n.uploaderService.orientFileIfNeeded(re),re){const pe=(0,f.Tb)(re.name),ge=l.O8.find(me=>-1!==me.ext.indexOf(pe.ext));if(!ge){se.push(re.name);continue}if(re.size>ge.maxSize){ce.push(re.name);continue}L.push({file:{name:re.name,size:re.size,time:0,url:"",ext:pe.ext,filename:pe.filename,isImage:(0,f.Or)(pe.ext),embedUrl:"",type:c.VC.FILE},progress:0,completed:!1}),j.push(re)}}if(n.handleErrors(se,ce),0===j.length)return void n.reset();const he=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.UPLOADING",{total:j.length}),ue=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CREATING_PACKAGE",{total:j.length});n.uploadObservablesService.pushUploadingFileQueue(L);for(let V=0;V<j.length;++V){n.loadingMessage=ue;const re=yield n.uploadService.getHostToken(I,j[V].name);L[V].progress+=20,n.loadingMessage=he.replace("{{current}}",`${V+1}`),yield(0,S.z)(n.uploaderService.upload(j[V],L[V],re,p.allowOverwrite))}n.uploadObservablesService.pushUploadingFileQueue([]);const de=L.filter(V=>!V.error).map(V=>V.file);de.length>0&&(n.fileUploadedEvent.emit({list:de,rewrite:p.allowOverwrite,destPath:I}),n.postMessageService.send(a.l.UPLOAD_SUCCESS,{fileList:de.map(V=>({filename:V.name,isImage:V.isImage,url:V.url}))}),p.openLinkModalAfterUpload&&n.uploadObservablesService.pushAction({name:c.In.FILE_SHOW_LINKS,payload:{entities:(0,f.jL)(de)}})),n.reset()})()}handleErrors(r,p){if(0!==r.length||0!==p.length){if(!this.isWidget)return void this.toastService.show({content:this.createToastMessage(r,p),level:U.m.ERROR});[[i.UNSUPPORTED,r],[i.OVERSIZED,p]].forEach(n=>{n[1].forEach(I=>{this.postMessageService.send(a.l.UPLOAD_ERROR,{filename:I,error:n[0]})})})}}createToastMessage(r,p){let n=[];return r.length&&n.push(r.length>1?`I file <strong>${r.join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${r[0]}</strong> ha un formato non supportato!`),p.length&&n.push(p.length>1?`I file <strong>${p.join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${p[0]}</strong> \xe8 troppo pesante!`),n.join("<br><br>")}toggleRemoteUrlForm(r,p){r.stopPropagation(),this.isWidget||(this.isWaitingRemoteUrl?p?.close():p?.open()),this.isWaitingRemoteUrl=!this.isWaitingRemoteUrl,this.remoteUrl=""}ngOnDestroy(){this.startExternalUploadSubscription?.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return A.\u0275fac=function(r){return new(r||A)(e.Y36(v.F),e.Y36(u.C),e.Y36(m.r),e.Y36(T.q),e.Y36(D.k),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(G.sK),e.Y36(C.y))},A.\u0275cmp=e.Xpm({type:A,selectors:[["app-uploader"]],viewQuery:function(r,p){if(1&r&&e.Gf(F,5),2&r){let n;e.iGM(n=e.CRH())&&(p.fileInputRef=n.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:35,vars:37,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],[3,"title"],["optionsModal",""],[3,"innerHtml"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto",3,"innerHTML"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto",3,"innerHTML"],["size","md",3,"title","disableCloseButton","hidden"],["remoteUrlModal",""],[1,"mb-2",3,"innerHTML"],[4,"ngTemplateOutlet"],["footer",""],["type","button",1,"btn","btn-secondary",3,"innerText","click"],["type","button",1,"btn","btn-primary",3,"disabled","innerText","click"],["remoteUrlInput",""],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],["class","description text-center",3,"ngClass",4,"ngIf"],["class","input-group input-group-sm remote-url-form justify-content-center mb-1",4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"description","text-center",3,"ngClass"],[3,"innerHTML",4,"ngIf"],[1,"ms-1","remote-url-btn","fst-italic","cursor-pointer",3,"ngClass","click"],[3,"innerHTML"],[1,"input-group","input-group-sm","remote-url-form","justify-content-center","mb-1"],[1,"input-group-text","bg-light",3,"disabled","click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 16 16"],["d","M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"],[1,"input-group-text","bg-light",3,"click"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","options-icon",3,"click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","remote-url-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"],["type","text","required","",1,"form-control",3,"placeholder","ngClass","ngModel","pattern","ngModelChange"],["input","ngModel"]],template:function(r,p){if(1&r){const n=e.EpF();e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(L){return p.handleSelectionEvent(L)}),e.qZA(),e.YNc(3,z,13,17,"ng-container",3),e.YNc(4,ie,7,9,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6),e.ALo(8,"translate"),e._UZ(9,"div",7),e.ALo(10,"translate"),e.TgZ(11,"ul",8)(12,"li")(13,"div",9)(14,"input",10),e.NdJ("ngModelChange",function(L){return p.options.compress=L})("ngModelChange",function(){return p.saveOptions()}),e.qZA(),e._UZ(15,"label",11),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"li")(18,"div",9)(19,"input",12),e.NdJ("ngModelChange",function(L){return p.options.openLinkModalAfterUpload=L})("ngModelChange",function(){return p.saveOptions()}),e.qZA(),e._UZ(20,"label",13),e.ALo(21,"translate"),e.qZA()()()(),e.TgZ(22,"app-modal",14,15),e.NdJ("hidden",function(){return p.isWaitingRemoteUrl=!1}),e.ALo(24,"translate"),e._UZ(25,"p",16),e.ALo(26,"translate"),e.YNc(27,te,1,0,"ng-container",17),e.ynx(28,18),e.TgZ(29,"button",19),e.NdJ("click",function(L){e.CHM(n);const j=e.MAs(23);return e.KtG(p.toggleRemoteUrlForm(L,j))}),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",20),e.NdJ("click",function(L){e.CHM(n);const j=e.MAs(23);return e.KtG(p.handleRemoteUrlUpload(L,j))}),e.ALo(32,"translate"),e.qZA(),e.BQk(),e.qZA(),e.YNc(33,ne,3,8,"ng-template",null,21,e.W1O)}if(2&r){const n=e.MAs(5),I=e.MAs(34);e.Q6J("ngClass",e.WLB(34,X,p.isUploading,p.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",p.loading||p.isUploading),e.xp6(2),e.Q6J("ngIf",!p.isUploading)("ngIfElse",n),e.xp6(3),e.Q6J("title",e.lcZ(8,18,"COMPONENTS.UPLOADER.SETTINGS_MODAL.TITLE")),e.xp6(3),e.Q6J("innerHtml",e.lcZ(10,20,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.DESCRIPTION"),e.oJD),e.xp6(5),e.Q6J("ngModel",p.options.compress),e.xp6(1),e.Q6J("innerHTML",e.lcZ(16,22,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.COMPRESS_SWITCH"),e.oJD),e.xp6(4),e.Q6J("ngModel",p.options.openLinkModalAfterUpload),e.xp6(1),e.Q6J("innerHTML",e.lcZ(21,24,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.SHOW_LINK_SWITCH"),e.oJD),e.xp6(2),e.Q6J("title",e.lcZ(24,26,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.TITLE"))("disableCloseButton",!0),e.xp6(3),e.Q6J("innerHTML",e.lcZ(26,28,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.CONTENT"),e.oJD),e.xp6(2),e.Q6J("ngTemplateOutlet",I),e.xp6(2),e.Q6J("innerText",e.lcZ(30,30,"SHARED.CANCEL")),e.xp6(2),e.Q6J("disabled",0===p.remoteUrl.length||!p.isRemoteUrlValid)("innerText",e.lcZ(32,32,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.UPLOAD_BTN"))}},dependencies:[x.mk,x.O5,x.tP,x.PC,s.Fj,s.Wl,s.JJ,s.Q7,s.c5,s.On,E.R,O.R,M.z,P.J,x.OU,G.X$],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864FE;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:350px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{top:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{opacity:1}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{right:5px}.uploader[_ngcontent-%COMP%]   .remote-url-icon[_ngcontent-%COMP%]{right:30px}.upload-area.cursor-pointer[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo):not(.description), .upload-area.cursor-pointer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.remote-url-btn){pointer-events:none}.remote-url-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:300px}.remote-url-form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:.5}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),A})()},1197:(Y,B,t)=>{"use strict";t.d(B,{M:()=>l});var h=t(8694),U=t(6895),e=t(4006),b=t(6818),S=t(1043),f=t(582),_=t(9383),a=t(4650);let l=(()=>{class c{}return c.\u0275fac=function(v){return new(v||c)},c.\u0275mod=a.oAB({type:c}),c.\u0275inj=a.cJS({imports:[h.r,U.ez,e.u5,b.q,S.h,f.z,_.aw.forChild()]}),c})()},8694:(Y,B,t)=>{"use strict";t.d(B,{r:()=>e});var h=t(6895),U=t(4650);let e=(()=>{class b{}return b.\u0275fac=function(f){return new(f||b)},b.\u0275mod=U.oAB({type:b}),b.\u0275inj=U.cJS({imports:[h.ez]}),b})()},8212:(Y,B,t)=>{"use strict";t.d(B,{J:()=>U});var h=t(4650);let U=(()=>{class e{transform(S,f){return S.join(f)}}return e.\u0275fac=function(S){return new(S||e)},e.\u0275pipe=h.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},575:(Y,B,t)=>{"use strict";t.d(B,{In:()=>h,Ky:()=>S,VC:()=>U,c5:()=>b,gG:()=>e});var h=(()=>{return(f=h||(h={})).FILE_SHOW_LINKS="fileLinks",f.FILE_EDIT="fileEdit",f.DELETE="delete",f.RENAME="rename",f.MOVE="move",h;var f})(),U=(()=>{return(f=U||(U={})).FILE="file",f.FOLDER="folder",U;var f})(),e=(()=>{return(f=e||(e={})).FILENAME="filename",f.SIZE="size",f.TIME="time",f.EXTENSION="ext",e;var f})(),b=(()=>{return(f=b||(b={})).GRID="grid",f.LIST="list",b;var f})(),S=(()=>{return(f=S||(S={})).W_768_I_1="(max-width: 767.98px)",f.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",f.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",f.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",f.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",f.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",f.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",f.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",f.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",f.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",f.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",f.W_3738_I_10="(min-width: 3424px)",S;var f})()},6986:(Y,B,t)=>{"use strict";t.d(B,{C7:()=>b,Mi:()=>S,O8:()=>U,er:()=>f,p0:()=>e,xt:()=>_});var h=t(575);const U=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(a=>(a.maxSize*=1048576,a)),e={lastPath:[],layout:{asc:!0,orderBy:h.gG.FILENAME,type:h.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},b="https://upload.forumfree.net/api/",S=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,f=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,_={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},4573:(Y,B,t)=>{"use strict";t.d(B,{y:()=>i});var h=t(5861),U=t(7824),e=t(9808),b=t(5698),S=t(3900),f=t(9646),_=t(262),a=t(608),l=t(4650),c=t(529);let i=(()=>{class v{constructor(m){this.http=m,this.proxyUrl="https://script.forumfree.it/i/proxy"}get(m){var T=this;return(0,h.Z)(function*(){const D=T.sendRequest(m);return yield(0,e.n)(D)})()}sendRequest(m){return this.getUrlContent(m).pipe((0,b.q)(1),(0,S.w)(T=>(0,f.of)(T)),(0,_.K)(()=>this.getUrlContentWithProxy(m)))}getUrlContent(m){return this.http.get(m,{responseType:"blob"})}getUrlContentWithProxy(m){return this.http.get(this.proxyUrl,{headers:{[U._.HeaderKeys.TOKEN_TYPE]:a.s.ACCESS,"x-remote-url":m},responseType:"blob"}).pipe((0,b.q)(1),(0,_.K)(()=>(0,f.of)(void 0)))}}return v.\u0275fac=function(m){return new(m||v)(l.LFG(c.eN))},v.\u0275prov=l.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},3124:(Y,B,t)=>{"use strict";t.d(B,{B:()=>b});var h=t(575),U=t(4650),e=t(3138);let b=(()=>{class S{constructor(_){this.globalsService=_,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(a=>{this.ffuid=a?a.user.ffuid:""})}getItem(_){const a=this.createKey(_);if(this.cache.hasOwnProperty(a))return this.cache[a]}setItem(_,a){this.cache[this.createKey(_)]=a}removeItem(_){const a=this.createKey(_);if(this.cache.hasOwnProperty(a)){if(this.cache[a].folders.length)for(const l of this.cache[a].folders)this.removeItem([..._,l.name]);return delete this.cache[a],!0}return!1}getEntities(_,a){let l={};const c=this.createKey(_);if(!this.cache.hasOwnProperty(c))return l;for(const i of a){const v=(i.type===h.VC.FILE?this.cache[c].files:this.cache[c].folders).find(u=>u.name===i.name);v&&(l[v.name]=v)}return l}addEntities(_,a,l=h.VC.FILE){const c=this.createKey(_);return!!this.cache.hasOwnProperty(c)&&(Array.isArray(a)||(a=[a]),l===h.VC.FILE?this.cache[c].files.unshift(...a):this.cache[c].folders.unshift(...a),!0)}removeEntities(_,a,l=h.VC.FILE){if(Array.isArray(a)||(a=[a]),l===h.VC.FOLDER)for(const u of a)this.removeItem([..._,u]);const c=this.createKey(_);if(!this.cache.hasOwnProperty(c))return[];const i=l===h.VC.FILE?"files":"folders";let v=[];for(const u of a){const m=this.cache[c][i].findIndex(T=>T.name===u);m>-1&&(this.cache[c][i].splice(m,1),v.push(u))}return v}refactorFolderContent(_,a){const l=this.createKey(_);if(!this.cache.hasOwnProperty(l))return!1;a.endsWith("/")||(a+="/");for(const c of this.cache[l].folders)c.url=a+c.name;for(const c of this.cache[l].files)c.url=c.embedUrl=a+c.name,c.time=Date.now();return!0}createKey(_){return`${this.ffuid}/${_.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return S.\u0275fac=function(_){return new(_||S)(U.LFG(e.d))},S.\u0275prov=U.Yz7({token:S,factory:S.\u0275fac,providedIn:"root"}),S})()},146:(Y,B,t)=>{"use strict";t.d(B,{r:()=>S});var h=t(7579),U=t(1135),e=t(4650),b=t(8745);let S=(()=>{class f{constructor(a){this.uploadPreferencesService=a,this.selectedFileListArray=[],this.actionSubject=new h.x,this.uploadingFileQueueSubject=new h.x,this.uploadingFileErrorSubject=new h.x,this.currentFolderPathSubject=new h.x,this.layoutOptionsSubject=new h.x,this.renameEntitySubject=new h.x,this.entityPendingSubject=new h.x,this.deleteFileSubject=new h.x,this.uploadedFileSubject=new h.x,this.draggedFileListSubject=new h.x,this.startUploadSubject=new h.x,this.startMoveSubject=new h.x,this.selectedFileListSubject=new U.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(a){this.actionSubject.next(a)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(a){this.uploadPreferencesService.layoutOptions=a,this.layoutOptionsSubject.next(a)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(a){this.uploadPreferencesService.lastFolderPath=a,this.currentFolderPathSubject.next(a)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(a){this.uploadingFileQueueSubject.next(a)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(a){this.uploadingFileErrorSubject.next(a)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(a){this.renameEntitySubject.next(a)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(a){this.entityPendingSubject.next(a)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(a){this.deleteFileSubject.next(a)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(a){this.uploadedFileSubject.next(a)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(a){this.draggedFileListSubject.next(a)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(a){this.startUploadSubject.next(a)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(a){this.startMoveSubject.next(a)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(a){if(Array.isArray(a)||(a=[a]),0===a.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let l=!1;for(const c of a){const i=this.selectedFileListArray.findIndex(v=>v.name===c.name);c.selected?-1===i&&(this.selectedFileListArray.push({name:c.name}),l=!0):i>-1&&(this.selectedFileListArray.splice(i,1),l=!0)}l&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return f.\u0275fac=function(a){return new(a||f)(e.LFG(b.p))},f.\u0275prov=e.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},8745:(Y,B,t)=>{"use strict";t.d(B,{p:()=>f});var h=t(5044),U=t(6986),e=t(4650),b=t(2381),S=t(6161);let f=(()=>{class _{constructor(l,c){this.preferencesService=l,this.urlQueryParamsService=c;const i=this.urlQueryParamsService.getAndDeleteParam(h.RT.UPLOAD_PATH);i&&(this.lastFolderPath=i.split("/").filter(v=>v.length>0))}get preferences(){return this.preferencesService.getItem(h.Ye.UPLOAD)||U.p0}set preferences(l){this.preferencesService.setItem(h.Ye.UPLOAD,l)}get lastFolderPath(){return(this.preferences.lastPath||U.p0.lastPath).filter(l=>l.length>0)}set lastFolderPath(l){const c=this.preferences;c.lastPath=l,this.preferences=c}get layoutOptions(){const l=U.p0.layout,c=this.preferences.layout;return c&&0===Object.keys(l).filter(i=>!c.hasOwnProperty(i)).length?c:l}set layoutOptions(l){const c=this.preferences;c.layout=l,this.preferences=c}get uploader(){const l=this.preferences.uploader||U.p0.uploader;return!l.checkImage.active&&Date.now()-l.checkImage.time>6048e5&&(l.checkImage.active=!0,this.uploader=l),l.hasOwnProperty("showLinkModal")||(l.showLinkModal=!1),l}set uploader(l){const c=this.preferences;c.uploader=l,this.preferences=c}}return _.\u0275fac=function(l){return new(l||_)(e.LFG(b.y),e.LFG(S.J))},_.\u0275prov=e.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},3207:(Y,B,t)=>{"use strict";t.d(B,{C:()=>x});var h=t(5861),U=t(7824),e=t(3905),b=t(575),S=t(3848),v=t(6986),u=t(1042),m=t(4650),T=t(5395),D=t(3124),G=t(8745),C=t(529);let x=(()=>{class s{constructor(O,M,P,F){this.graphqlService=O,this.uploadCacheService=M,this.uploadPreferencesService=P,this.http=F}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(U._.HeaderKeys.UUID,(0,u.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(U._.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(U._.HeaderKeys.UUID)||""}getFileList(O,M){var P=this;return(0,h.Z)(function*(){const F=P.uploadCacheService.getItem(O);if(F)return F;const J=(yield P.graphqlService.query({query:"\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",variables:{scope:M,target:O.join("/")}})).data.uploadEntitiesListToken,k=yield P.sendRequest(J),ee={files:k.files.map(ae=>{const oe=(0,S.Tb)(ae.url);return{...ae,time:1e3*ae.time,filename:oe.filename,ext:oe.ext,isImage:(0,S.Or)(oe.ext),embedUrl:`${ae.url}?t=${ae.time}`,type:b.VC.FILE}}),folders:k.folders.map(ae=>({...ae,type:b.VC.FOLDER}))};return P.uploadCacheService.setItem(O,ee),ee})()}createDirectory(O,M){var P=this;return(0,h.Z)(function*(){const F=(yield P.graphqlService.mutate({mutation:"\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",variables:{scope:M,target:O.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield P.sendRequest(F)})()}moveRenameEntity(O,M,P,F,J){var k=this;return(0,h.Z)(function*(){F||(F=P);const q=(yield k.graphqlService.mutate({mutation:"\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",variables:{scope:J,source:(O.length?`${O.join("/")}/`:"")+P,target:(M.length?`${M.join("/")}/`:"")+F}})).data.uploadEntitiesMoveToken,ee=yield k.sendRequest(q);return{...ee,time:1e3*ee.time}})()}deleteEntity(O,M,P){var F=this;return(0,h.Z)(function*(){const J=(yield F.graphqlService.mutate({mutation:"\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",variables:{scope:P,target:(O.length?`${O.join("/")}/`:"")+M}})).data.uploadEntitiesDeleteToken;return yield F.sendRequest(J),!0})()}getHostToken(O,M,P){var F=this;return(0,h.Z)(function*(){return(yield F.graphqlService.query({query:"\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",variables:{scope:P,target:(O.length?`${O.join("/")}/`:"")+M}})).data.uploadEntitiesHostToken})()}sendRequest(O){var M=this;return(0,h.Z)(function*(){return(yield(0,e.z)(M.http.post(v.C7,JSON.stringify({payload:O}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(O,M){var P=this;return(0,h.Z)(function*(){return yield P.graphqlService.subscribe({query:"\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}",variables:{scope:M}},F=>{if(!F.data?.uploadEntities)return;const J=JSON.parse(F.data.uploadEntities.eventMessage);!J.payload.customHeaders||!J.payload.customHeaders.hasOwnProperty(U._.HeaderKeys.UUID)||J.payload.customHeaders[U._.HeaderKeys.UUID]===P.getGqlIdHeader()||O({type:F.data.uploadEntities.eventType,message:J})})})()}getBlobFromUrl(O){var M=this;return(0,h.Z)(function*(){return yield(0,e.z)(M.http.get(O,{responseType:"blob"})).catch(()=>{})})()}}return s.\u0275fac=function(O){return new(O||s)(m.LFG(T.J),m.LFG(D.B),m.LFG(G.p),m.LFG(C.eN))},s.\u0275prov=m.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})()},3848:(Y,B,t)=>{"use strict";t.d(B,{$H:()=>m,JN:()=>c,Lv:()=>f,Or:()=>u,Tb:()=>b,jL:()=>v,lY:()=>_,ok:()=>D,rQ:()=>G,rc:()=>T,sT:()=>a,zO:()=>S});var h=t(5861),U=t(575),e=t(6986);function b(C){let x=C;if(C.indexOf("/")>-1){const M=C.split("/");x=M[M.length-1]}const s=x.replace(/\?.*$/,"").split("."),E=s.length>1?s[s.length-1].toLowerCase():"",O=decodeURIComponent(s.slice(0,-1).join("."));return{ext:E,filename:O,name:E?`${O}.${E}`:""}}function S(C,x={}){const s=b(C),E=Date.now();return{name:s.name,size:0,time:E,url:C,ext:s.ext,filename:s.filename,isImage:u(s.ext),embedUrl:`${C}?t=${E}`,type:U.VC.FILE,...x}}function f(C){let x=C;x.endsWith("/")&&(x=x.slice(0,-1));const s=x.split("/");return{name:decodeURIComponent(s[s.length-1])}}function _(C){return{name:f(C).name,url:C,type:U.VC.FOLDER}}function a(C){return l.apply(this,arguments)}function l(){return(l=(0,h.Z)(function*(C){const x=new FileReader,s=new Promise(E=>x.addEventListener("load",()=>E(x.result)));return x.readAsDataURL(C),s})).apply(this,arguments)}function c(C){return i.apply(this,arguments)}function i(){return(i=(0,h.Z)(function*(C){const x=new DataView(yield C.arrayBuffer());if(2303741511===x.getUint32(0)&&218765834===x.getUint32(4)){if(-1===[4,6].indexOf(x.getUint8(25)))return!1;const E=Object.assign(new Image,{src:yield a(C)});yield new Promise(P=>E.addEventListener("load",()=>P(!0)));const O=Object.assign(document.createElement("canvas"),{width:E.width,height:E.height}).getContext("2d");if(!O)return!1;O.imageSmoothingEnabled=!1,O.drawImage(E,0,0);const M=O?.getImageData(0,0,E.width,E.height);if(M)for(let P=0;P<M.data.length;P+=4)if(M.data[P+3]<255)return!0}return!1})).apply(this,arguments)}function v(C){return C.map(x=>({name:x.name,ext:x.ext,type:U.VC.FILE,url:x.url,embedUrl:x.embedUrl,isImage:x.isImage}))}function u(C,x=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(C)&&!x.includes(C)}function m(C){return u(C,["gif","svg"])}function T(C,x,s,E=[],O=""){let M={...e.xt};const P=C.trim();M.invalidLength=0===P.length;const F=(P+O).replace(/\s{2,}/g," ");return M.alreadyUsed=x!==P&&E.includes(F),M.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(C),M.invalidCharacter=!(s===U.VC.FILE?e.Mi.test(C):e.er.test(C)),M}function D(C,x){return C.join("/")===x.join("/")}function G(C){let x=[],s=[];for(const E of C)E.type===U.VC.FILE?x.push(E):s.push(E);return{[U.VC.FILE]:x,[U.VC.FOLDER]:s}}},3612:(Y,B,t)=>{"use strict";t.d(B,{q:()=>G});var h=t(5861),U=t(8896),e=t(6730),b=t.n(e),S=t(9969),f=t(3848),_=t(529),a=t(7579),l=t(7445),c=t(2722),i=t(6986);class v{static findApp1Marker(x){const s=new DataView(x),E=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let O=0;O<x.byteLength-2;O+=2){const M=s.getUint16(O);if(65505===M)return{offset:O,size:s.getUint16(O+2),little:18761==s.getUint16(O+8,!1)};if(E.has(M))break}}static stripAndReturnExif(x){return(0,h.Z)(function*(){const s=yield x.arrayBuffer(),E=v.findApp1Marker(s);return E?{file:new File([s.slice(0,E.offset),s.slice(E.offset+E.size+2)],x.name,{type:x.type,lastModified:x.lastModified}),exif:s.slice(E.offset,E.offset+E.size)}:{file:x}})()}static checkImageOrientation(x){const s=new DataView(x);if(1165519206!=s.getUint32(4,!1))return-1;const E=18761==s.getUint16(10,!1);let O=10;O+=s.getUint32(O+4,E);const M=s.getUint16(O,E);O+=2;for(let P=0;P<M;P++)if(274==s.getUint16(O+12*P,E))return s.getUint16(O+12*P+8,E);return-1}}var u=t(4650),m=t(146),T=t(2020),D=t(4573);let G=(()=>{class C{constructor(s,E,O,M){this.http=s,this.uploadObservablesService=E,this.loadImageService=O,this.proxyService=M,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return{...this.uploaderOptionsObject}}set uploaderOptions(s){this.uploaderOptionsObject={...s}}compressFileIfNeeded(s,E){return(0,h.Z)(function*(){let O=["image/png","image/jpeg"],M={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};E&&(O.push("image/webp"),M.width=E.width,M.height=E.height,M.resize="cover",M.strict=!1);const P=s.type.toLowerCase();return s.size<=4e6&&void 0===E||-1===O.indexOf(s.type.toLowerCase())?s:("image/png"===P&&(yield(0,f.JN)(s))&&(M.convertSize=1/0),new Promise((F,J)=>{new(b())(s,{...M,success:k=>{const q=k instanceof Blob?new File([k],s.name,{type:s.type,lastModified:s.lastModified}):s;F(q)},error:J})}))})()}orientFileIfNeeded(s){var E=this;return(0,h.Z)(function*(){if(-1===["image/jpeg"].indexOf(s.type.toLowerCase()))return s;const M=yield v.stripAndReturnExif(s);if(s=M.file,M.exif){const P=v.checkImageOrientation(M.exif);if(1!==P){let F=0;switch(P){case 3:case 4:F=180;break;case 5:case 6:F=90;break;case 7:case 8:F=270}const J=yield(0,f.sT)(s),k=yield new Promise((ee,ae)=>{const oe=new Image;oe.onload=()=>ee({originalImage:oe,originalBase64:J}),oe.onerror=ae,oe.src=J}),q=yield E.loadImageService.transformLoadedImage({original:{base64:k.originalBase64,image:k.originalImage,size:{width:k.originalImage.naturalWidth,height:k.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(P),rotate:F/90}},new S.R);s=new File([(0,U.L)(q.transformed.base64)],s.name,{type:s.type,lastModified:Date.now()})}}return s})()}upload(s,E,O,M=!1){const P=new a.x,F=new FormData;F.append("payload",O),F.append("upload",s,s.name),M&&F.append("allowOverwrite","1");const J=this.http.request(new _.aW("POST",i.C7,F,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(J.subscribe({next:k=>{if(k.type===_.dt.UploadProgress){if(!k.total||(E.progress=Math.round(50*k.loaded/k.total)+20,E.progress<70))return;(0,l.F)(1e3).pipe((0,c.R)(P.asObservable())).subscribe(()=>{if(E.progress<95){const q=Math.round(8*Math.random()+8);E.progress+q>95?E.progress=95:E.progress+=q}})}else if(k instanceof _.Zn){if(E.progress=100,E.completed=!0,k.body?.error||!k.body?.success)E.error=!0,this.uploadObservablesService.pushUploadingFileError(E);else{E.file.url=k.body.success.url,E.file.time=Date.now(),E.file.embedUrl=`${E.file.url}?t=${E.file.time}`;const q=(0,f.Tb)(E.file.url);E.file.name=q.name,E.file.filename=q.filename}P.next(),P.complete()}},error:()=>{E.error=!0,this.uploadObservablesService.pushUploadingFileError(E),P.next(),P.complete()}})),P.asObservable()}clearPendingRequests(){for(const s of this.requestSubscriptions)s.unsubscribe();this.requestSubscriptions=[]}}return C.\u0275fac=function(s){return new(s||C)(u.LFG(_.eN),u.LFG(m.r),u.LFG(T.y),u.LFG(D.y))},C.\u0275prov=u.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},6730:function(Y){Y.exports=function(){"use strict";function B(y,o){var d=Object.keys(y);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(y);o&&(g=g.filter(function(R){return Object.getOwnPropertyDescriptor(y,R).enumerable})),d.push.apply(d,g)}return d}function t(y){for(var o=1;o<arguments.length;o++){var d=null!=arguments[o]?arguments[o]:{};o%2?B(Object(d),!0).forEach(function(g){b(y,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(d)):B(Object(d)).forEach(function(g){Object.defineProperty(y,g,Object.getOwnPropertyDescriptor(d,g))})}return y}function U(y,o){for(var d=0;d<o.length;d++){var g=o[d];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(y,g.key,g)}}function b(y,o,d){return o in y?Object.defineProperty(y,o,{value:d,enumerable:!0,configurable:!0,writable:!0}):y[o]=d,y}function S(){return S=Object.assign||function(y){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(y[g]=d[g])}return y},S.apply(this,arguments)}var y,o,d,g,R,w,K,H,f={exports:{}};y=f,typeof window>"u"||(o=window,d=o.HTMLCanvasElement&&o.HTMLCanvasElement.prototype,g=o.Blob&&function(){try{return Boolean(new Blob)}catch{return!1}}(),R=g&&o.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch{return!1}}(),w=o.BlobBuilder||o.WebKitBlobBuilder||o.MozBlobBuilder||o.MSBlobBuilder,K=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,H=(g||w)&&o.atob&&o.ArrayBuffer&&o.Uint8Array&&function(N){var Q,z,$,ie,te,W,ne,X,le;if(!(Q=N.match(K)))throw new Error("invalid data URI");for(z=Q[2]?Q[1]:"text/plain"+(Q[3]||";charset=US-ASCII"),$=!!Q[4],ie=N.slice(Q[0].length),te=$?atob(ie):decodeURIComponent(ie),W=new ArrayBuffer(te.length),ne=new Uint8Array(W),X=0;X<te.length;X+=1)ne[X]=te.charCodeAt(X);return g?new Blob([R?ne:W],{type:z}):((le=new w).append(W),le.getBlob(z))},o.HTMLCanvasElement&&!d.toBlob&&(d.mozGetAsFile?d.toBlob=function(N,Q,z){var $=this;setTimeout(function(){N(z&&d.toDataURL&&H?H($.toDataURL(Q,z)):$.mozGetAsFile("blob",Q))})}:d.toDataURL&&H&&(d.toBlob=d.msToBlob?function(N,Q,z){var $=this;setTimeout(function(){N((Q&&"image/png"!==Q||z)&&d.toDataURL&&H?H($.toDataURL(Q,z)):$.msToBlob(Q))})}:function(N,Q,z){var $=this;setTimeout(function(){N(H($.toDataURL(Q,z)))})})),y.exports?y.exports=H:o.dataURLtoBlob=H);var _=f.exports,l={strict:!0,checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},i=typeof window<"u"&&typeof window.document<"u"?window:{},v=function(o){return o>0&&o<1/0},u=Array.prototype.slice;function m(y){return Array.from?Array.from(y):u.call(y)}var T=/^image\/.+$/;function D(y){return T.test(y)}var C=String.fromCharCode;var s=i.btoa;function O(y){var d,o=new DataView(y);try{var g,R,w;if(255===o.getUint8(0)&&216===o.getUint8(1))for(var K=o.byteLength,H=2;H+1<K;){if(255===o.getUint8(H)&&225===o.getUint8(H+1)){R=H;break}H+=1}if(R){var Q=R+10;if("Exif"===function x(y,o,d){var R,g="";for(d+=o,R=o;R<d;R+=1)g+=C(y.getUint8(R));return g}(o,R+4,4)){var z=o.getUint16(Q);if(((g=18761===z)||19789===z)&&42===o.getUint16(Q+2,g)){var $=o.getUint32(Q+4,g);$>=8&&(w=Q+$)}}}if(w){var te,W,ie=o.getUint16(w,g);for(W=0;W<ie;W+=1)if(274===o.getUint16(te=w+12*W+2,g)){d=o.getUint16(te+=8,g),o.setUint16(te,1,g);break}}}catch{d=1}return d}var P=/\.\d*(?:0|9){12}\d*$/;function F(y){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return P.test(y)?Math.round(y*o)/o:y}function J(y){var o=y.aspectRatio,d=y.height,g=y.width,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",w=v(g),K=v(d);if(w&&K){var H=d*o;("contain"===R||"none"===R)&&H>g||"cover"===R&&H<g?d=g/o:g=d*o}else w?d=g/o:K&&(g=d*o);return{width:g,height:d}}var k=i.ArrayBuffer,q=i.FileReader,ee=i.URL||i.webkitURL,ae=/\.\w+$/,oe=i.Compressor;return function(){function y(o,d){(function h(y,o){if(!(y instanceof o))throw new TypeError("Cannot call a class as a function")})(this,y),this.file=o,this.image=new Image,this.options=t(t({},l),d),this.aborted=!1,this.result=null,this.init()}return function e(y,o,d){return o&&U(y.prototype,o),d&&U(y,d),y}(y,[{key:"init",value:function(){var d=this,g=this.file,R=this.options;if(function(o){return!(typeof Blob>"u")&&(o instanceof Blob||"[object Blob]"===Object.prototype.toString.call(o))}(g)){var w=g.type;if(D(w))if(ee&&q)if(k||(R.checkOrientation=!1),ee&&!R.checkOrientation)this.load({url:ee.createObjectURL(g)});else{var K=new q,H=R.checkOrientation&&"image/jpeg"===w;this.reader=K,K.onload=function(N){var z=N.target.result,$={};if(H){var ie=O(z);ie>1||!ee?($.url=function E(y,o){for(var d=[],R=new Uint8Array(y);R.length>0;)d.push(C.apply(null,m(R.subarray(0,8192)))),R=R.subarray(8192);return"data:".concat(o,";base64,").concat(s(d.join("")))}(z,w),ie>1&&S($,function M(y){var o=0,d=1,g=1;switch(y){case 2:d=-1;break;case 3:o=-180;break;case 4:g=-1;break;case 5:o=90,g=-1;break;case 6:o=90;break;case 7:o=90,d=-1;break;case 8:o=-90}return{rotate:o,scaleX:d,scaleY:g}}(ie))):$.url=ee.createObjectURL(g)}else $.url=z;d.load($)},K.onabort=function(){d.fail(new Error("Aborted to read the image with FileReader."))},K.onerror=function(){d.fail(new Error("Failed to read the image with FileReader."))},K.onloadend=function(){d.reader=null},H?K.readAsArrayBuffer(g):K.readAsDataURL(g)}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(d){var g=this,R=this.file,w=this.image;w.onload=function(){g.draw(t(t({},d),{},{naturalWidth:w.naturalWidth,naturalHeight:w.naturalHeight}))},w.onabort=function(){g.fail(new Error("Aborted to load the image."))},w.onerror=function(){g.fail(new Error("Failed to load the image."))},i.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(i.navigator.userAgent)&&(w.crossOrigin="anonymous"),w.alt=R.name,w.src=d.url}},{key:"draw",value:function(d){var g=this,R=d.naturalWidth,w=d.naturalHeight,K=d.rotate,H=void 0===K?0:K,N=d.scaleX,Q=void 0===N?1:N,z=d.scaleY,$=void 0===z?1:z,ie=this.file,te=this.image,W=this.options,ne=document.createElement("canvas"),X=ne.getContext("2d"),le=Math.abs(H)%180==90,A=("contain"===W.resize||"cover"===W.resize)&&v(W.width)&&v(W.height),Z=Math.max(W.maxWidth,0)||1/0,r=Math.max(W.maxHeight,0)||1/0,p=Math.max(W.minWidth,0)||0,n=Math.max(W.minHeight,0)||0,I=R/w,L=W.width,j=W.height;if(le){var se=[r,Z];Z=se[0],r=se[1];var ce=[n,p];p=ce[0],n=ce[1];var he=[j,L];L=he[0],j=he[1]}A&&(I=L/j);var ue=J({aspectRatio:I,width:Z,height:r},"contain");Z=ue.width,r=ue.height;var de=J({aspectRatio:I,width:p,height:n},"cover");if(p=de.width,n=de.height,A){var V=J({aspectRatio:I,width:L,height:j},W.resize);L=V.width,j=V.height}else{var re=J({aspectRatio:I,width:L,height:j}),pe=re.width;L=void 0===pe?R:pe;var ge=re.height;j=void 0===ge?w:ge}var me=-(L=Math.floor(F(Math.min(Math.max(L,p),Z))))/2,Me=-(j=Math.floor(F(Math.min(Math.max(j,n),r))))/2,Te=L,Ce=j,ve=[];if(A){var _e,Ee,ye=J({aspectRatio:I,width:R,height:w},{contain:"cover",cover:"contain"}[W.resize]);ve.push((R-(_e=ye.width))/2,(w-(Ee=ye.height))/2,_e,Ee)}if(ve.push(me,Me,Te,Ce),le){var be=[j,L];L=be[0],j=be[1]}ne.width=L,ne.height=j,D(W.mimeType)||(W.mimeType=ie.type);var xe="transparent";if(ie.size>W.convertSize&&W.convertTypes.indexOf(W.mimeType)>=0&&(W.mimeType="image/jpeg"),"image/jpeg"===W.mimeType&&(xe="#fff"),X.fillStyle=xe,X.fillRect(0,0,L,j),W.beforeDraw&&W.beforeDraw.call(this,X,ne),!this.aborted&&(X.save(),X.translate(L/2,j/2),X.rotate(H*Math.PI/180),X.scale(Q,$),X.drawImage.apply(X,[te].concat(ve)),X.restore(),W.drew&&W.drew.call(this,X,ne),!this.aborted)){var Ue=function(Pe){g.aborted||g.done({naturalWidth:R,naturalHeight:w,result:Pe})};ne.toBlob?ne.toBlob(Ue,W.mimeType,W.quality):Ue(_(ne.toDataURL(W.mimeType,W.quality)))}}},{key:"done",value:function(d){var g=d.naturalWidth,R=d.naturalHeight,w=d.result,K=this.file,N=this.options;if(ee&&!N.checkOrientation&&ee.revokeObjectURL(this.image.src),w)if(N.strict&&w.size>K.size&&N.mimeType===K.type&&!(N.width>g||N.height>R||N.minWidth>g||N.minHeight>R||N.maxWidth<g||N.maxHeight<R))w=K;else{var Q=new Date;w.lastModified=Q.getTime(),w.lastModifiedDate=Q,w.name=K.name,w.name&&w.type!==K.type&&(w.name=w.name.replace(ae,function G(y){var o=D(y)?y.substr(6):"";return"jpeg"===o&&(o="jpg"),".".concat(o)}(w.type)))}else w=K;this.result=w,N.success&&N.success.call(this,w)}},{key:"fail",value:function(d){var g=this.options;if(!g.error)throw d;g.error.call(this,d)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=oe,y}},{key:"setDefaults",value:function(d){S(l,d)}}]),y}()}()},7445:(Y,B,t)=>{"use strict";t.d(B,{F:()=>e});var h=t(4986),U=t(5963);function e(b=0,S=h.z){return b<0&&(b=0),(0,U.H)(b,b,S)}},1042:(Y,B,t)=>{"use strict";t.d(B,{Z:()=>v});var h,U=new Uint8Array(16);function e(){if(!h&&!(h=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(U)}const b=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,f=function S(u){return"string"==typeof u&&b.test(u)};for(var _=[],a=0;a<256;++a)_.push((a+256).toString(16).substr(1));const v=function i(u,m,T){var D=(u=u||{}).random||(u.rng||e)();if(D[6]=15&D[6]|64,D[8]=63&D[8]|128,m){T=T||0;for(var G=0;G<16;++G)m[T+G]=D[G];return m}return function l(u){var m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=(_[u[m+0]]+_[u[m+1]]+_[u[m+2]]+_[u[m+3]]+"-"+_[u[m+4]]+_[u[m+5]]+"-"+_[u[m+6]]+_[u[m+7]]+"-"+_[u[m+8]]+_[u[m+9]]+"-"+_[u[m+10]]+_[u[m+11]]+_[u[m+12]]+_[u[m+13]]+_[u[m+14]]+_[u[m+15]]).toLowerCase();if(!f(T))throw TypeError("Stringified UUID is invalid");return T}(D)}}}]);