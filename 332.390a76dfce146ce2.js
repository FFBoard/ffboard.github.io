"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[332],{6742:(E,C,o)=>{o.r(C),o.d(C,{AdminPanelModule:()=>X});var e=o(9212),T=o(3285),c=o(1413),p=o(2721),u=o(1410),P=o(4020),m=o(6814),v=o(5661),b=o(342),g=o(7429),h=o(2457),r=o(6223),f=o(8726);const S=["app-admin-panel-graphql",""];function L(i,a){1&i&&e._uU(0," Token copiato! ")}function q(i,a){1&i&&e._uU(0," Copia il token ")}function _(i,a){if(1&i&&e.YNc(0,L,1,0)(1,q,1,0),2&i){const s=e.oxw();e.um2(0,s.tokenCopied||s.touchDevice?0:1)}}let U=(()=>{var i;class a{constructor(t,n,l,d,A){var y;this.graphqlService=t,this.endpointsService=n,this.titleCasePipe=l,this.globalsService=d,this.toastService=A,this.touchDevice=P.b1,this.graphqlRequestLogger={enabled:!1,list:[]},this.localFormSchema={},this.localFormModel={},this.pendingRequest=!1,this.apollo={url:""},this.tokenCopied=!1,this.localFormType=p.jQ.GRAPHQL,this.graphqlToken=(null===(y=this.graphqlService.params)||void 0===y?void 0:y.token)||"",this.graphqlRequestLogger.enabled=this.graphqlService.loggerEnabled,this.graphqlRequestLogger.list=this.graphqlService.requestLogs;const w=(0,p.EF)([10,10]);this.popperOptions=ee=>(0,p.F_)([w],ee)}ngOnInit(){this.createLocalFormSchema(),this.setApolloUrl()}setApolloUrl(){this.apollo=(0,c.Z)((0,c.Z)({},this.apollo),{},{url:this.graphqlService.urlSandbox(this.graphqlToken).toString()})}createLocalFormSchema(){const t={type:"object",properties:{localEnv:{type:"object",description:"L'url base per le richieste locali \xe8 [i]".concat(this.endpointsService.getBaseLocalUrl(),"[/i]"),oneOf:Object.entries(this.endpointsService.getAllLocalPaths()).map(n=>({title:this.titleCasePipe.transform(n[0]),widget:{formlyConfig:{props:{fieldsetTemplate:!0}}},properties:{[n[0]]:{default:n[0],widget:{formlyConfig:{props:{type:"hidden"}}}},endpointType:{default:n[0],widget:{formlyConfig:{props:{type:"hidden"}}}},paths:{type:"object",properties:Object.fromEntries(Object.entries(n[1]).map(l=>[l[0],{type:"string",title:"Path per le richieste [i]".concat(l[0],"[/i]:"),default:l[1]}]))},enabled:{type:"checkbox",title:"Utilizza l'ambiente locale per queste richieste",default:this.endpointsService.getLocalEnv(n[0])}}}))}}};this.localFormSchema=(0,c.Z)({},t)}onLocalEnvFormChange(){const t=this.localFormModel.localEnv.endpointType;t!==this.localFormType?(this.localFormType=this.localFormModel.localEnv.endpointType,this.localFormModel.localEnv.enabled=this.endpointsService.getLocalEnv(this.localFormType),this.localFormModel.localEnv.paths=(0,c.Z)({},this.endpointsService.getLocalPaths(this.localFormType)),this.localFormModel=(0,c.Z)({},this.localFormModel)):this.localFormModel.localEnv.enabled!==this.endpointsService.getLocalEnv(t)&&this.onLocalEnvFormSubmit()}onLocalEnvFormSubmit(){const t=this.localFormModel.localEnv;this.updateLocalEnv(t.endpointType,t.enabled,t.paths)&&(this.localFormModel.localEnv.enabled=!0,this.localFormModel=(0,c.Z)({},this.localFormModel)),t.endpointType===p.jQ.GRAPHQL&&(this.saveAdminSettings(),this.setApolloUrl()),this.toastService.show({content:"Impostazioni dell'<strong>ambiente locale</strong> aggionate!",delay:5e3})}updateLocalEnv(t,n,l){return n!==this.endpointsService.getLocalEnv(t)?(this.endpointsService.setLocalEnv(t,n),!1):(this.endpointsService.setLocalEnv(t,!0),this.endpointsService.setLocalPaths(t,l),!0)}saveAdminSettings(){this.graphqlService.loggerEnabled=this.graphqlRequestLogger.enabled,this.globalsService.adminSettings=(0,c.Z)((0,c.Z)({},this.globalsService.adminSettings||{}),{graphql:{useLocalEnv:this.endpointsService.getLocalEnv(p.jQ.GRAPHQL),urlHttpLocalEnv:this.endpointsService.getLocalPaths(p.jQ.GRAPHQL)[p.PB.HTTP],urlWsLocalEnv:this.endpointsService.getLocalPaths(p.jQ.GRAPHQL)[p.PB.WS],loggerEnabled:this.graphqlRequestLogger.enabled}})}}return(i=a).\u0275fac=function(t){return new(t||i)(e.Y36(p.Jk),e.Y36(p.oz),e.Y36(m.rS),e.Y36(u.d),e.Y36(v.k))},i.\u0275cmp=e.Xpm({type:i,selectors:[["","app-admin-panel-graphql",""]],features:[e._Bn([m.rS])],attrs:S,decls:36,vars:12,consts:[[1,"h6","px-md-1","container-fluid"],[1,"flat-container","p-3"],[1,"mb-4","d-flex","align-items-end"],[1,"flex-grow-1","me-3"],["for","profile-token",1,"fs-sm"],["type","text","id","profile-token","disabled","",1,"form-control",3,"value"],["placement","top-end",1,"d-block","ms-auto","btn","btn-primary",3,"cdkCopyToClipboard","ngbTooltip","popperOptions","triggers","click","hidden"],[1,"material-icons","d-block"],["tooltipContent",""],[1,"px-3","pt-2","rounded","mb-4","position-relative"],[1,"legend-reset","fs-reset","px-2","mb-0"],[1,"position-absolute","px-3","bg-white","local-form-submit"],[1,"btn","btn-success","d-flex","align-items-center",3,"click"],[1,"material-icons-outlined"],["app-custom-form","",3,"schema","model","enableModelChangeEvent","modelChangeEvent","submitEvent"],["localEnvForm",""],[1,"px-3","pb-3","rounded","mb-4","pt-2"],[1,"form-check","form-switch","mb-3"],["type","checkbox","role","switch","id","enable-logs",1,"form-check-input",3,"ngModel","ngModelChange"],["for","enable-logs",1,"form-check-label"],[1,"logs-wrapper"],[3,"object"],[1,"d-flex","justify-content-end"],[1,"d-block"],["target","_blank",3,"href"]],template:function(t,n){if(1&t){const l=e.EpF();e.TgZ(0,"div",0),e._uU(1,"Endpoints"),e.qZA(),e.TgZ(2,"div",1)(3,"div",2)(4,"div",3)(5,"label",4),e._uU(6,"Token attuale:"),e.qZA(),e._UZ(7,"input",5),e.qZA(),e.TgZ(8,"button",6),e.NdJ("click",function(){return n.tokenCopied=!0})("hidden",function(){return n.tokenCopied=!1}),e.TgZ(9,"span",7),e._uU(10,"content_copy"),e.qZA()(),e.YNc(11,_,2,1,"ng-template",null,8,e.W1O),e.qZA(),e.TgZ(13,"fieldset",9)(14,"legend",10),e._uU(15,"Ambiente locale"),e.qZA(),e.TgZ(16,"div",11)(17,"button",12),e.NdJ("click",function(){e.CHM(l);const A=e.MAs(21);return e.KtG(A.submit())}),e.TgZ(18,"span",13),e._uU(19,"check_circle"),e.qZA()()(),e.TgZ(20,"div",14,15),e.NdJ("modelChangeEvent",function(){return n.onLocalEnvFormChange()})("submitEvent",function(){return n.onLocalEnvFormSubmit()}),e.qZA()(),e.TgZ(22,"fieldset",16)(23,"legend",10),e._uU(24),e.qZA(),e.TgZ(25,"div",17)(26,"input",18),e.NdJ("ngModelChange",function(A){return n.graphqlRequestLogger.enabled=A})("ngModelChange",function(){return n.saveAdminSettings()}),e.qZA(),e.TgZ(27,"label",19),e._uU(28,"Abilita il salvataggio dei log"),e.qZA()(),e.TgZ(29,"div",20),e._UZ(30,"app-custom-pre",21),e.qZA()(),e.TgZ(31,"div",22)(32,"small",23),e._uU(33,"Vai alla "),e.TgZ(34,"a",24),e._uU(35,"sandbox"),e.qZA()()()()}if(2&t){const l=e.MAs(12);e.xp6(7),e.Q6J("value",n.graphqlToken),e.xp6(),e.Q6J("cdkCopyToClipboard",n.graphqlToken)("ngbTooltip",l)("popperOptions",n.popperOptions)("triggers",n.touchDevice?"click":"hover"),e.xp6(12),e.Q6J("schema",n.localFormSchema)("model",n.localFormModel)("enableModelChangeEvent",!0),e.xp6(4),e.hij(" Log delle richieste (#",n.graphqlRequestLogger.list.length,") "),e.xp6(2),e.Q6J("ngModel",n.graphqlRequestLogger.enabled),e.xp6(4),e.Q6J("object",n.graphqlRequestLogger.list),e.xp6(4),e.Q6J("href",n.apollo.url,e.LSH)}},dependencies:[b.i3,g.d,h.s,r.Wl,r.JJ,r.On,f._L],styles:["fieldset[_ngcontent-%COMP%]{border:1px dashed var(--bs-gray-500)}.logs-wrapper[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.local-form-submit[_ngcontent-%COMP%]{top:-.75rem;right:1rem;transform:translateY(-50%)}"]}),a})();var Z=o(5861),F=o(1378),J=o(8055),N=o(6988),R=o(6245),G=o(7165),M=o(4190);const Q=["cacheModal"],I=["deletionModal"];function k(i,a){if(1&i&&e._UZ(0,"option",15),2&i){const s=a.$implicit;e.Q6J("ngValue",s.id)("innerText",s.name)}}const O=i=>({disabled:i}),j=(i,a)=>[i,a];let B=(()=>{var i;class a{constructor(t,n){this.scriptListService=t,this.toastService=n,this.scriptList=[],this.scriptSettingsPath=G.B2.SCRIPT_DEV_SETTINGS,this.pendingRequest=!1}ngOnInit(){var t=this;return(0,Z.Z)(function*(){t.scriptList=(yield t.scriptListService.getAllScripts()).sort((n,l)=>n.name>l.name?1:l.name>n.name?-1:0)})()}findScriptName(t){var n;return(null===(n=this.scriptList.find(l=>l.id===t))||void 0===n?void 0:n.name)||""}openCacheModal(){this.pendingRequest?this.toastService.advice(F.V.REQUEST_PENDING):(this.cacheScriptId=this.selectedScriptId,this.cacheModalRef.open())}openDeletionModal(){this.pendingRequest?this.toastService.advice(F.V.REQUEST_PENDING):(this.deletionScriptId=this.selectedScriptId,this.deletionModalRef.open())}setPendingRequest(t){this.pendingRequest=!!t}}return(i=a).\u0275fac=function(t){return new(t||i)(e.Y36(R.o),e.Y36(v.k))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-admin-panel-script"]],viewQuery:function(t,n){if(1&t&&(e.Gf(Q,5),e.Gf(I,5)),2&t){let l;e.iGM(l=e.CRH())&&(n.cacheModalRef=l.first),e.iGM(l=e.CRH())&&(n.deletionModalRef=l.first)}},decls:17,vars:20,consts:[[1,"h6","px-md-1","container-fluid"],[1,"flat-container","p-3"],[1,"mb-2"],["for","script-select",1,"fs-sm"],["id","script-select",1,"form-select",3,"disabled","ngModel","ngModelChange"],["selected","",3,"ngValue"],[3,"ngValue","innerText",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","flex-wrap"],[1,"btn","btn-indigo","mx-2","mt-3",3,"disabled","innerText","click"],[1,"btn","btn-primary","mx-2","mt-3",3,"ngClass","innerText","routerLink"],[1,"btn","btn-danger","mx-2","mt-3",3,"disabled","innerText","click"],[3,"scriptId","scriptName","cachePendingEvent"],["cacheModal",""],[3,"scriptName","scriptId","deletionPendingEvent"],["deletionModal",""],[3,"ngValue","innerText"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._uU(1,"Script"),e.qZA(),e.TgZ(2,"div",1)(3,"div",2)(4,"label",3),e._uU(5,"Seleziona lo script da amministrare:"),e.qZA(),e.TgZ(6,"select",4),e.NdJ("ngModelChange",function(d){return n.selectedScriptId=d}),e._UZ(7,"option",5),e.YNc(8,k,1,2,"option",6),e.qZA()(),e.TgZ(9,"div",7)(10,"button",8),e.NdJ("click",function(){return n.openCacheModal()}),e.qZA(),e._UZ(11,"a",9),e.TgZ(12,"button",10),e.NdJ("click",function(){return n.openDeletionModal()}),e.qZA()()(),e.TgZ(13,"app-script-dev-cache",11,12),e.NdJ("cachePendingEvent",function(d){return n.setPendingRequest(d)}),e.qZA(),e.TgZ(15,"app-script-dev-deletion",13,14),e.NdJ("deletionPendingEvent",function(d){return n.setPendingRequest(d)}),e.qZA()),2&t&&(e.xp6(6),e.Q6J("disabled",0===n.scriptList.length)("ngModel",n.selectedScriptId),e.xp6(),e.Q6J("ngValue",void 0),e.xp6(),e.Q6J("ngForOf",n.scriptList),e.xp6(2),e.Q6J("disabled",!n.selectedScriptId||n.pendingRequest)("innerText","Cache"),e.xp6(),e.Q6J("ngClass",e.VKq(15,O,!n.selectedScriptId))("innerText","Impostazioni")("routerLink",e.WLB(17,j,n.scriptSettingsPath,n.selectedScriptId)),e.xp6(),e.Q6J("disabled",!n.selectedScriptId||n.pendingRequest)("innerText","Cancella"),e.xp6(),e.Q6J("scriptId",n.cacheScriptId)("scriptName",n.cacheScriptId?n.findScriptName(n.cacheScriptId):""),e.xp6(2),e.Q6J("scriptName",n.deletionScriptId?n.findScriptName(n.deletionScriptId):"")("scriptId",n.deletionScriptId))},dependencies:[m.mk,m.sg,r.YN,r.Kr,r.EJ,r.JJ,r.On,M.rH,J.s,N.F]}),a})();var x=o(6779),D=o(8418);let Y=(()=>{var i;class a{constructor(){this.userService=(0,e.f3M)(D.K),this.loginAsService=(0,e.f3M)(x.D),this.globlasService=(0,e.f3M)(u.d),this.loading=!1,this.schema={type:"object",properties:{loginAs:{type:"forum-users",title:"Utente con cui accedere:",widget:{formlyConfig:{props:{multiple:!1,selectDomain:!0}}}}}},this.model={loginAs:this.loginAsService.profile?[this.loginAsService.profile.ffuid]:this.loginAsService.lastSelectedFFUid?[this.loginAsService.lastSelectedFFUid]:[]}}setSelectedUser(){var t=this;return(0,Z.Z)(function*(){t.loginAsService.lastSelectedFFUid=t.model.loginAs[0],t.loginAsService.lastSelectedFFUid||t.logout()})()}get canLogin(){var t,n;return void 0!==this.loginAsService.lastSelectedFFUid&&!this.loading&&(null===(t=this.loginAsService.profile)||void 0===t?void 0:t.ffuid)!==this.loginAsService.lastSelectedFFUid&&(null===(n=this.globlasService.credentials)||void 0===n?void 0:n.user.ffuid)!==this.loginAsService.lastSelectedFFUid}get canLogout(){return this.loginAsService.isActive&&!this.loading}login(){var t=this;return(0,Z.Z)(function*(){if(!t.canLogin)return;t.loading=!0;const n=yield t.userService.getDetailsFromUids([t.loginAsService.lastSelectedFFUid]);t.loginAsService.connect({ffuid:n[0].uid,nickname:n[0].nickname}),t.loading=!1})()}logout(){this.canLogout&&this.loginAsService.disconnect()}}return(i=a).\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-admin-panel-login-as"]],decls:10,vars:5,consts:[[1,"h6","px-md-1","container-fluid"],[1,"flat-container","p-3"],["app-custom-form","",3,"schema","model","enableModelChangeEvent","modelChangeEvent"],["userForm",""],[1,"d-flex","justify-content-end"],[1,"btn","btn-primary",3,"disabled","click"],[1,"btn","btn-danger","ms-2",3,"disabled","click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._uU(1,"Login come utente"),e.qZA(),e.TgZ(2,"div",1)(3,"div",2,3),e.NdJ("modelChangeEvent",function(){return n.setSelectedUser()}),e.qZA(),e.TgZ(5,"div",4)(6,"button",5),e.NdJ("click",function(){return n.login()}),e._uU(7,"Login"),e.qZA(),e.TgZ(8,"button",6),e.NdJ("click",function(){return n.logout()}),e._uU(9,"Disconnetti"),e.qZA()()()),2&t&&(e.xp6(3),e.Q6J("schema",n.schema)("model",n.model)("enableModelChangeEvent",!0),e.xp6(3),e.Q6J("disabled",!n.canLogin),e.xp6(2),e.Q6J("disabled",!n.canLogout))},dependencies:[g.d],encapsulation:2}),a})(),$=(()=>{var i;class a{}return(i=a).\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["ng-component"]],decls:6,vars:0,consts:[["pageTitle","Pannello di amministrazione"],[1,"d-grid","page-container"],["app-admin-panel-graphql",""],[1,"d-grid","page-group"]],template:function(t,n){1&t&&(e._UZ(0,"app-breadcrumb",0),e.TgZ(1,"div",1),e._UZ(2,"div",2),e.TgZ(3,"div",3),e._UZ(4,"app-admin-panel-script")(5,"app-admin-panel-login-as"),e.qZA()())},dependencies:[T.L,U,B,Y],styles:[".page-container[_ngcontent-%COMP%], .page-group[_ngcontent-%COMP%]{gap:1rem}.page-group[_ngcontent-%COMP%]{grid-template-rows:auto 1fr}@media (min-width: 960px){.page-container[_ngcontent-%COMP%], .page-group[_ngcontent-%COMP%]{gap:1.5rem}}@media (min-width: 1500px){.page-container[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}"]}),a})();var H=o(9090),V=o(6687),z=o(9537),K=o(232);const W=[{path:"",component:$}];let X=(()=>{var i;class a{}return(i=a).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[H.w,b.Iq,m.ez,V.I,r.u5,M.Bz.forChild(W),z.U,K.a]}),a})()},8418:(E,C,o)=>{o.d(C,{K:()=>P});var e=o(5861),T=o(1410),c=o(2721),u=o(9212);let P=(()=>{var m;class v extends c.KD{constructor(g,h,r){super(g,r),this.graphqlService=g,this.globalsService=h,this.requestsService=r,this.searchByNameCache={}}searchUserByName(g,h){var r=this;return(0,e.Z)(function*(){var f;h||(h=(0,c.vV)((null===(f=r.globalsService.credentials)||void 0===f?void 0:f.site.domain)||c.ig.FORUMFREE));const S="".concat(h).concat(g);if((0,c.o8)(r.searchByNameCache,S))return r.searchByNameCache[S];const L=yield r.graphqlService.query({query:"\nquery UserSearchByName($name: String!, $cid: String) {\n    userSearchByName(name: $name, cid: $cid) {\n        uid\n        nickname\n        avatar\n    }\n}",variables:{name:g,cid:h}});return r.searchByNameCache[S]=L.data.userSearchByName})()}}return(m=v).\u0275fac=function(g){return new(g||m)(u.LFG(c.Jk),u.LFG(T.d),u.LFG(c.r8))},m.\u0275prov=u.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),v})()}}]);