"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[577],{3285:(q,M,c)=>{c.d(M,{L:()=>E});var J=c(9300),l=c(7165),d=c(9212);let h=(()=>{var u;class T{constructor(){this.dependencies={[l.B2.LOGIN]:null,[l.B2.HOME]:null,[l.B2.SETTINGS]:l.B2.HOME,[l.B2.SCRIPT]:l.B2.HOME,[l.B2.SCRIPT_FORUM]:l.B2.SCRIPT,[l.B2.SCRIPT_USER]:l.B2.SCRIPT,[l.B2.SCRIPT_SETTINGS]:[l.B2.SCRIPT_USER,l.B2.SCRIPT_FORUM],[l.B2.SCRIPT_SANDBOX]:[l.B2.SCRIPT_USER,l.B2.SCRIPT_FORUM],[l.B2.SCRIPT_DEV]:l.B2.SCRIPT,[l.B2.SCRIPT_DEV_SETTINGS]:l.B2.SCRIPT_DEV,[l.B2.UPLOAD]:l.B2.HOME,[l.B2.ADMIN]:l.B2.HOME,[l.B2.STATS]:l.B2.HOME,[l.B2.STATS_UPLOAD]:l.B2.STATS},this.names={[l.B2.LOGIN]:"Login",[l.B2.HOME]:"Home",[l.B2.SETTINGS]:"Notifiche",[l.B2.SCRIPT]:"Script",[l.B2.SCRIPT_FORUM]:"Forum",[l.B2.SCRIPT_USER]:"Utenti",[l.B2.SCRIPT_SETTINGS]:"Impostazioni",[l.B2.SCRIPT_SANDBOX]:"Altro",[l.B2.SCRIPT_DEV]:"Sviluppo",[l.B2.SCRIPT_DEV_SETTINGS]:"Impostazioni",[l.B2.UPLOAD]:"Upload",[l.B2.ADMIN]:"Amministrazione",[l.B2.STATS]:"Statistiche",[l.B2.STATS_UPLOAD]:"Upload"}}createPathList(S,U=[]){const w=(y,N)=>{y.unshift({name:this.names[N]||"",path:N})},B=y=>(0,J.o8)(this.dependencies,y)?this.dependencies[y]instanceof Array?this.dependencies[y].includes(U[0])?U.shift():this.dependencies[y][0]:this.dependencies[y]:null,A=[{name:this.names[S]||"",path:""}];let z=B(S);for(;z;)w(A,z),z=B(z);return A}}return(u=T).\u0275fac=function(S){return new(S||u)},u.\u0275prov=d.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),T})();var b=c(4190),C=c(6814);function x(u,T){if(1&u&&d._UZ(0,"a",8),2&u){const v=d.oxw().$implicit;d.Q6J("routerLink",v.path)("innerText",v.name)}}function Z(u,T){if(1&u&&d._UZ(0,"span",9),2&u){const v=d.oxw().$implicit;d.Q6J("innerText",v.name)}}const t=u=>({active:u});function R(u,T){if(1&u&&(d.TgZ(0,"li",5),d.YNc(1,x,1,2,"a",6)(2,Z,1,1,"ng-template",null,7,d.W1O),d.qZA()),2&u){const v=T.last,S=d.MAs(3);d.Q6J("ngClass",d.VKq(4,t,v)),d.uIk("aria-current",v?"page":null),d.xp6(),d.Q6J("ngIf",!v)("ngIfElse",S)}}const P=u=>({"hide-nav":u}),Q=u=>({"d-none d-md-block":u});let E=(()=>{var u;class T{constructor(S,U){this.breadcrumbService=S,this.router=U,this.pageTitle="",this.url="",this.nodes=[],this.hideNavOnSmallScreen=!1,this.breadcrumbs=[]}ngOnInit(){this.url||(this.url=this.router.url),this.breadcrumbs=this.breadcrumbService.createPathList(this.url,this.nodes)}}return(u=T).\u0275fac=function(S){return new(S||u)(d.Y36(h),d.Y36(b.F0))},u.\u0275cmp=d.Xpm({type:u,selectors:[["app-breadcrumb"]],inputs:{pageTitle:"pageTitle",url:"url",nodes:"nodes",hideNavOnSmallScreen:"hideNavOnSmallScreen"},decls:5,vars:8,consts:[[1,"container-fluid","px-md-1","d-flex","flex-column","flex-md-row","align-items-md-center",3,"ngClass"],[1,"h3","fw-light","mb-0","lh-1","fv-small-caps","pb-1",3,"innerText"],["aria-label","breadcrumb",1,"ms-md-auto","mt-1","flex-shrink-0",3,"ngClass"],[1,"breadcrumb","mb-0","justify-content-md-end"],["class","breadcrumb-item",3,"ngClass",4,"ngFor","ngForOf"],[1,"breadcrumb-item",3,"ngClass"],[3,"routerLink","innerText",4,"ngIf","ngIfElse"],["lastItem",""],[3,"routerLink","innerText"],[3,"innerText"]],template:function(S,U){1&S&&(d.TgZ(0,"div",0),d._UZ(1,"h2",1),d.TgZ(2,"nav",2)(3,"ol",3),d.YNc(4,R,4,6,"li",4),d.qZA()()()),2&S&&(d.Q6J("ngClass",d.VKq(4,P,U.hideNavOnSmallScreen)),d.xp6(),d.Q6J("innerText",U.pageTitle),d.xp6(),d.Q6J("ngClass",d.VKq(6,Q,U.hideNavOnSmallScreen)),d.xp6(2),d.Q6J("ngForOf",U.breadcrumbs))},dependencies:[C.mk,C.sg,C.O5,b.rH],styles:[".container-fluid[_ngcontent-%COMP%]:not(.hide-nav){margin-bottom:.75rem}.container-fluid.hide-nav[_ngcontent-%COMP%]{margin-bottom:.5rem}@media (min-width: 768px){.container-fluid.hide-nav[_ngcontent-%COMP%]{margin-bottom:.75rem}}@media (min-width: 960px){.container-fluid[_ngcontent-%COMP%]{margin-top:.5rem}}"]}),T})()},9090:(q,M,c)=>{c.d(M,{w:()=>h});var J=c(6814),l=c(4190),d=c(9212);let h=(()=>{var b;class C{}return(b=C).\u0275fac=function(Z){return new(Z||b)},b.\u0275mod=d.oAB({type:b}),b.\u0275inj=d.cJS({imports:[J.ez,l.Bz]}),C})()},5577:(q,M,c)=>{c.r(M),c.d(M,{UploadModule:()=>Se});var J=c(9090),l=c(6814),d=c(6687),h=c(7905),b=c(4041),C=c(6223),x=c(8726),Z=c(8635),t=c(9212);let R=(()=>{var n;class s{}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[l.ez]}),s})();var P=c(4190),Q=c(3038);let E=(()=>{var n;class s{}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[l.ez,Q.G]}),s})();var u=c(5861),T=c(9300),v=c(4020),S=c(8645),U=c(5571),w=c(5362);let B=(()=>{var n;class s{constructor(e){this.graphqlService=e,this.dayCache={}}getAvailableDateRange(){var e=this;return(0,u.Z)(function*(){return(yield e.graphqlService.query({query:U.He})).data.uploadHistoryAvailableDateRange})()}getRangeData(e){var a=this;return(0,u.Z)(function*(){const i=[],r=e.filter(g=>!(0,T.o8)(a.dayCache,g)||(i.push(a.dayCache[g]),!1));if(r.length>0){const g=yield a.sendDataRequest(r);for(const[f,p]of Object.values(g).entries())a.dayCache[r[f]]={date:new Date(r[f]),periodActiveUsers:p.periodActiveUsers,periodTopTotalFileCount:JSON.parse(p.periodTopTotalFileCount),periodTopTotalSize:JSON.parse(p.periodTopTotalSize),storageUsed:JSON.parse(p.storageUsed),toDateActiveUsers:p.toDateActiveUsers,toDateTopTotalFileCount:JSON.parse(p.toDateTopTotalFileCount),toDateTopTotalSize:JSON.parse(p.toDateTopTotalSize)},i.push(a.dayCache[r[f]])}return i})()}sendDataRequest(e){var a=this;return(0,u.Z)(function*(){const i=w.IO(e.map((r,g)=>({operation:{name:"uploadHistory",alias:"uploadHistory".concat(g)},variables:{["date".concat(g)]:{name:"date",type:"String!",value:r}},fields:["storageUsed","periodActiveUsers","periodTopTotalSize","periodTopTotalFileCount","toDateActiveUsers","toDateTopTotalSize","toDateTopTotalFileCount"]})));return(yield a.graphqlService.query({query:i.query,variables:i.variables})).data})()}}return(n=s).\u0275fac=function(e){return new(e||n)(t.LFG(T.Jk))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),s})();const A="upload-stats";var z=c(658),y=c(3285),N=c(9473),tt=c(7429);function et(n,s){if(1&n){const o=t.EpF();t.ynx(0),t.TgZ(1,"div",1),t._uU(2,"Statistiche giornaliere"),t.qZA(),t.TgZ(3,"div",2)(4,"div",3,4),t.NdJ("modelChangeEvent",function(a){t.CHM(o);const i=t.MAs(5),r=t.oxw();return t.KtG(i.form.valid&&r.modelChange(a))}),t.qZA()(),t.BQk()}if(2&n){const o=t.oxw();t.xp6(4),t.Q6J("schema",o.formlySchema)("model",o.formlyModel)("enableModelChangeEvent",!0)}}let at=(()=>{var n;class s{constructor(){this.modelChangeEvent=new t.vpe,this.formlyModel={}}ngOnInit(){this.formlySchema={type:"object",properties:{range:{type:"datepicker-range",title:"Periodo da visualizzare:",widget:{formlyConfig:{props:{minDate:this.availableRange.start,maxDate:this.availableRange.end,startDate:-7,endDate:-1,maxLength:30}}}},useRangeAsGlobal:{type:"boolean",title:"Usa la data di fine periodo per le statistiche globali",default:!1}}}}modelChange(e){this.modelChangeEvent.emit(e)}}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-upload-datepicker"]],inputs:{availableRange:"availableRange"},outputs:{modelChangeEvent:"modelChangeEvent"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"fv-small-caps","mb-2"],[1,"flat-container","px-3","pt-3","pb-0"],["app-custom-form","",3,"schema","model","enableModelChangeEvent","modelChangeEvent"],["customForm",""]],template:function(e,a){1&e&&t.YNc(0,et,6,3,"ng-container",0),2&e&&t.Q6J("ngIf",a.formlySchema)},dependencies:[l.O5,tt.d],styles:["[_nghost-%COMP%]{display:block;margin:1rem 0}@media (min-width: 960px){[_nghost-%COMP%]{display:block;margin:1.5rem 0}}"]}),s})();var L=c(1088),I=c(8863);function nt(n,s){if(1&n&&t._UZ(0,"div",4),2&n){const o=t.oxw(2);t.Q6J("innerText",o.statTitle)("ngClass",o.hideTitleOnSmallScreen?"d-none d-sm-block":void 0)}}function ot(n,s){if(1&n&&(t.TgZ(0,"div",2),t.YNc(1,nt,1,2,"div",3),t.Hsn(2,1),t.qZA()),2&n){const o=t.oxw();t.xp6(),t.Q6J("ngIf",o.statTitle)}}const it=["*",[["","title",""]]],st=["*","[title]"];let k=(()=>{var n;class s{constructor(){this.statTitle="",this.hasTitle=!0,this.hideTitleOnSmallScreen=!1}}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-stat-container"]],inputs:{statTitle:"statTitle",hasTitle:"hasTitle",hideTitleOnSmallScreen:"hideTitleOnSmallScreen"},ngContentSelectors:st,decls:3,vars:1,consts:[[1,"d-flex","flex-column","flat-container","px-3","pb-3","h-100"],["class","d-flex mb-1 ps-md-1 justify-content-center align-items-center",4,"ngIf"],[1,"d-flex","mb-1","ps-md-1","justify-content-center","align-items-center"],["class","fv-small-caps fs-xl fw-500 text-nowrap",3,"innerText","ngClass",4,"ngIf"],[1,"fv-small-caps","fs-xl","fw-500","text-nowrap",3,"innerText","ngClass"]],template:function(e,a){1&e&&(t.F$t(it),t.TgZ(0,"div",0),t.YNc(1,ot,3,1,"div",1),t.Hsn(2),t.qZA()),2&e&&(t.xp6(),t.Q6J("ngIf",a.hasTitle))},dependencies:[l.mk,l.O5],styles:["[_nghost-%COMP%]{display:block;height:100%}.flat-container[_ngcontent-%COMP%]{padding-top:.75rem}"]}),s})();const lt=[[["","header",""]],[["","statValue",""]]],rt=["[header]","[statValue]"];let G=(()=>{var n;class s{constructor(){this.value="",this.description="",this.color="default",this.colorClasses={green:"text-success",blue:"text-primary",indigo:"text-indigo",red:"text-danger",default:"text-reset"}}}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-stat-summary-container"]],inputs:{value:"value",description:"description",color:"color"},ngContentSelectors:rt,decls:6,vars:3,consts:[[1,"flat-container","p-3","d-flex","flex-column","justify-content-center","align-items-center","h-100","position-relative"],[1,"h2","fw-normal","lh-1","text-center","d-flex","align-items-center",3,"ngClass"],[1,"desc","text-muted","fs-xs","text-uppercase","text-center",3,"innerText"]],template:function(e,a){1&e&&(t.F$t(lt),t.TgZ(0,"div",0),t.Hsn(1),t.TgZ(2,"div",1),t._uU(3),t.Hsn(4,1),t.qZA(),t._UZ(5,"div",2),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngClass",a.colorClasses[a.color]),t.xp6(),t.hij(" ",a.value," "),t.xp6(2),t.Q6J("innerText",a.description))},dependencies:[l.mk],styles:["[_nghost-%COMP%]{display:block;height:100%}.desc[_ngcontent-%COMP%]{letter-spacing:.2em}"]}),s})();var Y=c(9010),H=c(2641);let j=(()=>{var n;class s{transform(e){return(0,H.o)(e)}}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275pipe=t.Yjl({name:"localeString",type:n,pure:!0}),s})();function ct(n,s){1&n&&t.GkF(0)}function pt(n,s){1&n&&t.GkF(0)}function dt(n,s){1&n&&t.GkF(0)}function ut(n,s){1&n&&(t.ynx(0),t.TgZ(1,"th",8),t._uU(2,"Unit\xe0"),t.qZA(),t.TgZ(3,"th",8),t._uU(4,"%"),t.qZA(),t.BQk())}function gt(n,s){1&n&&t.GkF(0)}function mt(n,s){1&n&&t.GkF(0)}function ht(n,s){1&n&&t.GkF(0)}function Tt(n,s){if(1&n&&(t.TgZ(0,"tr"),t._UZ(1,"td",9)(2,"td",9),t.ALo(3,"formatBytes"),t._UZ(4,"td",9)(5,"td",9),t.ALo(6,"localeString"),t._UZ(7,"td",9)(8,"td",9),t.ALo(9,"formatBytes"),t._UZ(10,"td",9),t.ALo(11,"formatBytes"),t._UZ(12,"td",9),t.qZA()),2&n){const o=s.$implicit;t.xp6(),t.Q6J("innerText",o.ext),t.xp6(),t.Q6J("innerText",t.lcZ(3,8,o.size.abs)),t.xp6(2),t.Q6J("innerText",o.size.perc),t.xp6(),t.Q6J("innerText",t.lcZ(6,10,o.count.abs)),t.xp6(2),t.Q6J("innerText",o.count.perc),t.xp6(),t.Q6J("innerText",t.lcZ(9,12,o.avgSize.abs)),t.xp6(2),t.Q6J("innerText",t.lcZ(11,14,o.avgSize.max)),t.xp6(2),t.Q6J("innerText",o.avgSize.perc)}}function ft(n,s){1&n&&t.GkF(0)}function _t(n,s){1&n&&(t.O4$(),t.TgZ(0,"svg",13),t._UZ(1,"path",14)(2,"path",15)(3,"path",16),t.qZA())}function Ct(n,s){1&n&&(t.O4$(),t.TgZ(0,"svg",13),t._UZ(1,"path",14)(2,"path",15)(3,"path",17),t.qZA())}function vt(n,s){if(1&n&&(t.ynx(0),t.YNc(1,ft,1,0,"ng-container",10)(2,_t,4,0,"svg",11)(3,Ct,4,0,"ng-template",null,12,t.W1O),t.BQk()),2&n){const o=t.MAs(4),e=t.oxw(2);t.xp6(),t.Q6J("ngIf",e.tableSortCriteria.asc),t.xp6(),t.Q6J("ngIf",e.tableSortCriteria.asc)("ngIfElse",o)}}function St(n,s){if(1&n&&t.YNc(0,vt,5,3,"ng-container",10),2&n){const o=s.$implicit,e=t.oxw();t.Q6J("ngIf",o===e.tableSortCriteria.type)}}const bt=()=>({$implicit:"ext"}),xt=()=>({$implicit:"size-abs"}),Ut=()=>({$implicit:"count-abs"}),yt=()=>[],Ot=()=>({$implicit:"avgSize-abs"}),Zt=()=>({$implicit:"avgSize-max"}),At=()=>({$implicit:"avgSize-perc"});let V=(()=>{var n;class s{constructor(){this.storageData=[],this.totalSize=1,this.totalFileCount=1,this.tableContent=[],this.tableSortCriteria={type:"",asc:!1}}ngOnChanges(e){e.storageData&&(this.tableSortCriteria={type:"",asc:!1},this.setTableContent(),this.sortTableContent(this.tableContent,"size-abs"))}setTableContent(){this.tableContent=this.storageData.map(e=>{var a;const i=e.count?e.size/e.count:0,r=(null===(a=this.supportedFiles.find(g=>g.ext.includes(e.ext)))||void 0===a?void 0:a.maxSize)||0;return{ext:e.ext,size:{abs:e.size,perc:this.totalSize?(0,h.rp)(e.size/this.totalSize):0},count:{abs:e.count,perc:this.totalFileCount?(0,h.rp)(e.count/this.totalFileCount):0},avgSize:{abs:i,max:r,perc:r&&i?(0,h.rp)(i/r):0}}})}sortTableContent(e,a){if(this.tableSortCriteria.type===a)return this.tableSortCriteria.asc=!this.tableSortCriteria.asc,void e.reverse();this.tableSortCriteria.type=a;const i=a.split("-"),r=i.slice(1);let g=!1,f=e[0][i[0]];for(const p of r)f=f[p];g=!isNaN(Number(f)),this.tableSortCriteria.asc=!g,e.sort((p,_)=>{let m=p[i[0]],D=_[i[0]];for(const O of r)m=m[O],D=D[O];return g?D-m:m.localeCompare(D)})}}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-upload-stat-file-table"]],inputs:{storageData:"storageData",totalSize:"totalSize",totalFileCount:"totalFileCount",supportedFiles:"supportedFiles"},features:[t.TTD],decls:35,vars:21,consts:[[1,"table","table-striped","table-bordered","text-center","mb-0"],["scope","col","rowspan","2",1,"align-middle","cursor-pointer",3,"click"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["scope","col","colspan","2",1,"cursor-pointer",3,"click"],["scope","col","colspan","3",1,"cursor-pointer",3,"click"],[4,"ngFor","ngForOf"],["scope","col",1,"cursor-pointer",3,"click"],["sortIcon",""],["scope","col"],[3,"innerText"],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16","class","ms-2",4,"ngIf","ngIfElse"],["desc",""],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"ms-2"],["d","M12.438 1.668V7H11.39V2.684h-.051l-1.211.859v-.969l1.262-.906h1.046z"],["fill-rule","evenodd","d","M11.36 14.098c-1.137 0-1.708-.657-1.762-1.278h1.004c.058.223.343.45.773.45.824 0 1.164-.829 1.133-1.856h-.059c-.148.39-.57.742-1.261.742-.91 0-1.72-.613-1.72-1.758 0-1.148.848-1.835 1.973-1.835 1.09 0 2.063.636 2.063 2.687 0 1.867-.723 2.848-2.145 2.848zm.062-2.735c.504 0 .933-.336.933-.972 0-.633-.398-1.008-.94-1.008-.52 0-.927.375-.927 1 0 .64.418.98.934.98z"],["d","M4.5 2.5a.5.5 0 0 0-1 0v9.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L4.5 12.293V2.5z"],["d","M4.5 13.5a.5.5 0 0 1-1 0V3.707L2.354 4.854a.5.5 0 1 1-.708-.708l2-1.999.007-.007a.498.498 0 0 1 .7.006l2 2a.5.5 0 1 1-.707.708L4.5 3.707V13.5z"]],template:function(e,a){if(1&e&&(t.TgZ(0,"table",0)(1,"thead")(2,"tr")(3,"th",1),t.NdJ("click",function(){return a.sortTableContent(a.tableContent,"ext")}),t.TgZ(4,"span"),t._uU(5,"Tipo"),t.qZA(),t.YNc(6,ct,1,0,"ng-container",2),t.qZA(),t.TgZ(7,"th",3),t.NdJ("click",function(){return a.sortTableContent(a.tableContent,"size-abs")}),t.TgZ(8,"span"),t._uU(9,"Spazio"),t.qZA(),t.YNc(10,pt,1,0,"ng-container",2),t.qZA(),t.TgZ(11,"th",3),t.NdJ("click",function(){return a.sortTableContent(a.tableContent,"count-abs")}),t.TgZ(12,"span"),t._uU(13,"Numero"),t.qZA(),t.YNc(14,dt,1,0,"ng-container",2),t.qZA(),t.TgZ(15,"th",4),t.NdJ("click",function(){return a.sortTableContent(a.tableContent,"avgSize-abs")}),t._uU(16,"Peso medio"),t.qZA()(),t.TgZ(17,"tr"),t.YNc(18,ut,5,0,"ng-container",5),t.TgZ(19,"th",6),t.NdJ("click",function(){return a.sortTableContent(a.tableContent,"avgSize-abs")}),t.TgZ(20,"span"),t._uU(21,"Unit\xe0"),t.qZA(),t.YNc(22,gt,1,0,"ng-container",2),t.qZA(),t.TgZ(23,"th",6),t.NdJ("click",function(){return a.sortTableContent(a.tableContent,"avgSize-max")}),t.TgZ(24,"span"),t._uU(25,"Max"),t.qZA(),t.YNc(26,mt,1,0,"ng-container",2),t.qZA(),t.TgZ(27,"th",6),t.NdJ("click",function(){return a.sortTableContent(a.tableContent,"avgSize-perc")}),t.TgZ(28,"span"),t._uU(29,"%"),t.qZA(),t.YNc(30,ht,1,0,"ng-container",2),t.qZA()()(),t.TgZ(31,"tbody"),t.YNc(32,Tt,13,16,"tr",5),t.qZA()(),t.YNc(33,St,1,1,"ng-template",null,7,t.W1O)),2&e){const i=t.MAs(34);t.xp6(6),t.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",t.DdM(14,bt)),t.xp6(4),t.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",t.DdM(15,xt)),t.xp6(4),t.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",t.DdM(16,Ut)),t.xp6(4),t.Q6J("ngForOf",t.DdM(17,yt).constructor(2)),t.xp6(4),t.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",t.DdM(18,Ot)),t.xp6(4),t.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",t.DdM(19,Zt)),t.xp6(4),t.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",t.DdM(20,At)),t.xp6(2),t.Q6J("ngForOf",a.tableContent)}},dependencies:[l.sg,l.O5,l.tP,Y.b,j],styles:["td[_ngcontent-%COMP%]{white-space:nowrap}@media (min-width: 768px){.table[_ngcontent-%COMP%]{table-layout:fixed}}"]}),s})();var Dt=c(8418),Mt=c(7827),zt=c(7357);function Ft(n,s){if(1&n&&(t.TgZ(0,"div",8),t._UZ(1,"img",9),t.ALo(2,"uploadsreplace"),t.qZA()),2&n){const o=t.oxw();t.xp6(),t.s9C("alt",o.subject.title),t.Q6J("lazyLoad",t.lcZ(2,4,o.subject.image))("offset",100)("errorImage","/assets/default_avatar.png")}}function Jt(n,s){if(1&n&&t._UZ(0,"div",10),2&n){const o=t.oxw();t.Q6J("innerHTML",o.subject.titleSuffix,t.oJD)}}function Nt(n,s){if(1&n&&t._UZ(0,"div",11),2&n){const o=t.oxw();t.Q6J("innerHTML",o.subject.desc,t.oJD)}}const It=(n,s)=>({"border-bottom":n,"ps-1":s});let Pt=(()=>{var n;class s{constructor(){this.isLast=!1,this.titleClickEvent=new t.vpe}}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-stat-table-entity"]],inputs:{subject:"subject",value:"value",isLast:"isLast"},outputs:{titleClickEvent:"titleClickEvent"},decls:8,vars:11,consts:[["class","image rounded-circle me-3 border flex-shrink-0",4,"ngIf"],[1,"d-flex","flex-grow-1","align-items-center","py-3","min-w-0",3,"ngClass"],[1,"me-auto","pe-3","d-flex","flex-column","flex-grow-1","align-items-start","min-w-0"],[1,"d-flex","min-w-0","mw-100","fw-bold","align-items-center","cursor-pointer",3,"click"],[1,"text-truncate","mw-100","pe-none",3,"innerHTML"],["class","ms-1 pe-none",3,"innerHTML",4,"ngIf"],["class","text-muted fs-xs",3,"innerHTML",4,"ngIf"],[1,"pe-1","flex-shrink-0",3,"innerHTML"],[1,"image","rounded-circle","me-3","border","flex-shrink-0"],["src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D",1,"rounded-circle","image-cover",3,"lazyLoad","offset","errorImage","alt"],[1,"ms-1","pe-none",3,"innerHTML"],[1,"text-muted","fs-xs",3,"innerHTML"]],template:function(e,a){1&e&&(t.YNc(0,Ft,3,6,"div",0),t.TgZ(1,"div",1)(2,"div",2)(3,"a",3),t.NdJ("click",function(r){return a.titleClickEvent.emit(r)}),t._UZ(4,"div",4),t.YNc(5,Jt,1,1,"div",5),t.qZA(),t.YNc(6,Nt,1,1,"div",6),t.qZA(),t._UZ(7,"div",7),t.qZA()),2&e&&(t.Q6J("ngIf",a.subject.image),t.xp6(),t.Q6J("ngClass",t.WLB(8,It,!a.isLast,!a.subject.image)),t.xp6(2),t.uIk("href",a.subject.link||void 0,t.LSH)("target",a.subject.link?"_blank":void 0),t.xp6(),t.Q6J("innerHTML",a.subject.title,t.oJD),t.xp6(),t.Q6J("ngIf",a.subject.titleSuffix),t.xp6(),t.Q6J("ngIf",a.subject.desc),t.xp6(),t.Q6J("innerHTML",a.value,t.oJD))},dependencies:[l.mk,l.O5,Mt.z1,zt.g],styles:["[_nghost-%COMP%]{display:flex;align-items:center}.image[_ngcontent-%COMP%]{width:50px;height:50px}"]}),s})();function Qt(n,s){if(1&n&&(t.TgZ(0,"li"),t._UZ(1,"app-stat-table-entity",3),t.qZA()),2&n){const o=s.$implicit,e=s.last;t.xp6(),t.Q6J("subject",o.subject)("value",o.value)("isLast",e)}}function Bt(n,s){if(1&n&&(t.TgZ(0,"ul",1),t.YNc(1,Qt,2,3,"li",2),t.qZA()),2&n){const o=t.oxw();t.xp6(),t.Q6J("ngForOf",o.data)}}let Lt=(()=>{var n;class s{constructor(){this.data=[]}}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-stat-table"]],inputs:{data:"data"},decls:1,vars:1,consts:[["class","list-unstyled mb-0",4,"ngIf"],[1,"list-unstyled","mb-0"],[4,"ngFor","ngForOf"],[3,"subject","value","isLast"]],template:function(e,a){1&e&&t.YNc(0,Bt,2,1,"ul",0),2&e&&t.Q6J("ngIf",a.data.length>0)},dependencies:[l.sg,l.O5,Pt],encapsulation:2}),s})();var K=c(8595);function Rt(n,s){if(1&n&&(t.TgZ(0,"option",16),t._uU(1),t.qZA()),2&n){const o=s.$implicit,e=t.oxw(3);t.Q6J("value",o)("selected",e.daySelectValue===o),t.xp6(),t.Oqu(o)}}function Et(n,s){if(1&n){const o=t.EpF();t.TgZ(0,"select",14),t.NdJ("ngModelChange",function(a){t.CHM(o);const i=t.oxw(2);return t.KtG(i.daySelectValue=a)})("ngModelChange",function(){t.CHM(o);const a=t.oxw(2);return t.KtG(a.setData(a.daySelectValue,a.activeTab))}),t.YNc(1,Rt,2,3,"option",15),t.qZA()}if(2&n){const o=t.oxw(2);t.Q6J("ngModel",o.daySelectValue),t.xp6(),t.Q6J("ngForOf",o.days)}}function wt(n,s){1&n&&t.GkF(0)}function kt(n,s){if(1&n&&t.YNc(0,wt,1,0,"ng-container",17),2&n){t.oxw(2);const o=t.MAs(2);t.Q6J("ngTemplateOutlet",o)}}function Yt(n,s){1&n&&t.GkF(0)}function Ht(n,s){if(1&n&&t.YNc(0,Yt,1,0,"ng-container",17),2&n){t.oxw(2);const o=t.MAs(2);t.Q6J("ngTemplateOutlet",o)}}function jt(n,s){if(1&n){const o=t.EpF();t.TgZ(0,"app-stat-container",2),t.ynx(1,3),t.TgZ(2,"div",4),t.YNc(3,Et,2,2,"select",5),t.TgZ(4,"div",6),t.NdJ("click",function(){t.CHM(o);const a=t.MAs(12);return t.KtG(a.select("file"))}),t.TgZ(5,"div",7),t._uU(6,"insert_drive_file"),t.qZA()(),t.TgZ(7,"div",8),t.NdJ("click",function(){t.CHM(o);const a=t.MAs(12);return t.KtG(a.select("size"))}),t.TgZ(8,"div",7),t._uU(9,"storage"),t.qZA()()(),t.BQk(),t.ynx(10),t.TgZ(11,"ul",9,10),t.NdJ("activeIdChange",function(a){t.CHM(o);const i=t.oxw();return t.KtG(i.activeTab=a)})("hidden",function(a){t.CHM(o);const i=t.oxw();return t.KtG(i.onHidden(a))}),t.TgZ(13,"li",11),t.YNc(14,kt,1,1,"ng-template",12),t.qZA(),t.TgZ(15,"li",11),t.YNc(16,Ht,1,1,"ng-template",12),t.qZA()(),t._UZ(17,"div",13),t.BQk(),t.qZA()}if(2&n){const o=t.MAs(12),e=t.oxw();t.Q6J("statTitle","Top utenti - "+("file"===e.activeTab?"File":"Spazio"))("hideTitleOnSmallScreen",e.days.length>1),t.xp6(3),t.Q6J("ngIf",e.days.length>1),t.xp6(),t.Q6J("ngClass","file"===e.activeTab?"blue":"outline-blue")("disableOnTouchDevice",!0),t.xp6(3),t.Q6J("ngClass","size"===e.activeTab?"blue":"outline-blue")("disableOnTouchDevice",!0),t.xp6(4),t.Q6J("activeId",e.activeTab)("destroyOnHide",!1),t.xp6(2),t.Q6J("ngbNavItem","file"),t.xp6(2),t.Q6J("ngbNavItem","size"),t.xp6(2),t.Q6J("ngbNavOutlet",o)}}const qt=n=>({"pe-2":n});function Gt(n,s){if(1&n&&t._UZ(0,"app-stat-table",20),2&n){const o=t.oxw(2);t.Q6J("ngClass",t.VKq(2,qt,!o.touchDevice))("data",o.listContent[o.activeDay][o.activeContent])}}function Vt(n,s){1&n&&t._UZ(0,"app-loader",21)}function Kt(n,s){if(1&n&&t.YNc(0,Gt,1,4,"app-stat-table",18)(1,Vt,1,0,"ng-template",null,19,t.W1O),2&n){const o=t.MAs(2),e=t.oxw();t.Q6J("ngIf",!e.loading)("ngIfElse",o)}}let X=(()=>{var n;class s{constructor(e){this.userService=e,this.touchDevice=v.b1,this.activeTab="file",this.activeDay="",this.activeContent="file",this.daySelectValue="",this.days=[],this.loading=!0,this.listContent={}}ngOnChanges(e){var a=this;return(0,u.Z)(function*(){var i;e.data&&null!==(i=a.data)&&void 0!==i&&i.length&&(a.days=a.data.map(r=>r.day),a.daySelectValue=a.days[0],yield a.setData(a.days[0],"file"))})()}setData(e,a){var i=this;return(0,u.Z)(function*(){if(!i.data)return;const r=i.data.find(g=>g.day===e);if(r&&(i.activeDay=e,i.activeTab=a,i.activeContent=a,!(0,T.o8)(i.listContent,e))){i.loading=!0;const g=yield i.userService.getDetailsFromUids([...Object.keys(r.size),...Object.keys(r.file)]);i.listContent[e]={size:Object.entries(r.size).reduce((f,p)=>{const _=g.find(m=>m.uid===p[0]);return _&&f.push({value:(0,I.t)(p[1]),subject:i.createTableSubject(_)}),f},[]),file:Object.entries(r.file).reduce((f,p)=>{const _=g.find(m=>m.uid===p[0]);return _&&f.push({value:(0,H.o)(p[1]),subject:i.createTableSubject(_)}),f},[])},i.loading=!1}})()}createTableSubject(e){const a=e.uid.substring(2),i=e.uid.substring(0,2);return{title:e.nickname,image:e.avatar,desc:"ID: ".concat(a),link:"".concat((0,T.A)(i),"/?act=Profile&MID=").concat(a)}}onHidden(e){this.activeContent="file"===e?"size":"file"}}return(n=s).\u0275fac=function(e){return new(e||n)(t.Y36(Dt.K))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-upload-stat-top-users"]],inputs:{data:"data"},features:[t.TTD],decls:3,vars:1,consts:[[3,"statTitle","hideTitleOnSmallScreen",4,"ngIf"],["navContent",""],[3,"statTitle","hideTitleOnSmallScreen"],["title",""],[1,"ms-auto","d-flex"],["class","form-select form-select-sm me-2",3,"ngModel","ngModelChange",4,"ngIf"],["appTippy","Top per numero di file",1,"flat-icon","me-2","cursor-pointer",3,"ngClass","disableOnTouchDevice","click"],[1,"material-icons-outlined"],["appTippy","Top per spazio occupato",1,"flat-icon","cursor-pointer",3,"ngClass","disableOnTouchDevice","click"],["ngbNav","",3,"activeId","destroyOnHide","activeIdChange","hidden"],["topUsersNav","ngbNav"],[3,"ngbNavItem"],["ngbNavContent",""],[1,"mt-2",3,"ngbNavOutlet"],[1,"form-select","form-select-sm","me-2",3,"ngModel","ngModelChange"],[3,"value","selected",4,"ngFor","ngForOf"],[3,"value","selected"],[4,"ngTemplateOutlet"],["class","d-block list",3,"ngClass","data",4,"ngIf","ngIfElse"],["loader",""],[1,"d-block","list",3,"ngClass","data"],["message","Recupero utenti",1,"d-block","mt-3"]],template:function(e,a){1&e&&t.YNc(0,jt,18,12,"app-stat-container",0)(1,Kt,3,2,"ng-template",null,1,t.W1O),2&e&&t.Q6J("ngIf",a.data)},dependencies:[l.mk,l.sg,l.O5,l.tP,C.YN,C.Kr,C.EJ,C.JJ,C.On,N.R,x.uN,x.Pz,x.nv,x.Is,x.Dy,k,Lt,K.$],styles:["[_nghost-%COMP%]{display:block;height:100%}.list[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}"]}),s})();const Xt=n=>({"pe-2":n});let $t=(()=>{var n;class s{constructor(e,a,i,r){this.dateAdapterService=e,this.dateFormatterService=a,this.breakpointObserver=i,this.eChartsService=r,this.chartLoading=!0,this.data=[],this.touchDevice=v.b1,this.loadingOptions=(0,h.MO)(),this.totalSize=0,this.totalFileCount=0,this.totalUsers=0,this.totalSizeChartOptions=null,this.lineChartOptions=null,this.lineChartTitle="",this.lineChartType="size",this.lineChartDetails="splitted",this.usersChartOptions=null,this.topUsersPerDay=[],this.storageUsedInPeriod=[],this.xAxisLabels=[],this.storageSeries={total:[{name:"Spazio giornaliero",data:[]}],splitted:[]},this.fileCountSeries={total:[{name:"File giornalieri",data:[]}],splitted:[]},this.avgFileSizeSeries={total:[{name:"Peso medio",data:[]}],splitted:[]},this.usersSeries={name:"Utenti giornalieri",data:[]},this.smallDevice=!0,this.smallDevice=this.breakpointObserver.isMatched([L.u3.XSmall])}ngOnChanges(e){e.data&&e.data.currentValue.length&&(this.setLabelsAndTopUsers(),this.setLineChartsData(),this.setLineChartsOptions(),this.setTotalSizeChartOptions())}setLabelsAndTopUsers(){const e=[];this.xAxisLabels=this.data.slice(1).map(a=>{const i=this.dateFormatterService.formatShort(this.dateAdapterService.fromModel(a.date));return e.unshift({day:i,size:a.periodTopTotalSize,file:a.periodTopTotalFileCount}),i}),this.topUsersPerDay=e}setLineChartsData(){this.totalUsers=0,this.usersSeries.data=[],this.storageSeries.total[0].data=[],this.fileCountSeries.total[0].data=[],this.avgFileSizeSeries.total[0].data=[];const e={},a={},i={},r={};for(const[p,_]of this.data.slice(1).entries()){this.usersSeries.data.push(_.periodActiveUsers),this.totalUsers+=_.periodActiveUsers,this.storageSeries.total[0].data.push(0),this.fileCountSeries.total[0].data.push(0),this.avgFileSizeSeries.total[0].data.push(0);for(const[m,D]of Object.entries(_.storageUsed)){var g,f;if(!isNaN(Number(m)))continue;(0,T.o8)(r,m)||(r[m]={ext:m,count:0,size:0}),(0,T.o8)(e,m)||(e[m]={name:m,data:[],total:0});const O=D.size-((null===(g=this.data[p].storageUsed[m])||void 0===g?void 0:g.size)||0);e[m].data.push(Math.round(O/1048576)),e[m].total+=O,r[m].size+=O,this.storageSeries.total[0].data[p]+=Math.round(O/1048576),(0,T.o8)(a,m)||(a[m]={name:m,data:[],total:0});const F=D.count-((null===(f=this.data[p].storageUsed[m])||void 0===f?void 0:f.count)||0);a[m].data.push(F),a[m].total+=F,r[m].count+=F,this.fileCountSeries.total[0].data[p]+=F,(0,T.o8)(i,m)||(i[m]={name:m,data:[],total:0});const W=F?Math.round(100*O/F/1048576)/100:0;i[m].data.push(W),i[m].total+=W}this.avgFileSizeSeries.total[0].data[p]=this.storageSeries.total[0].data[p]/this.fileCountSeries.total[0].data[p]}this.storageSeries.splitted=Object.values(e).filter(p=>!p.data.every(_=>0===_)).sort((p,_)=>_.total-p.total),this.fileCountSeries.splitted=Object.values(a).filter(p=>!p.data.every(_=>0===_)).sort((p,_)=>_.total-p.total),this.avgFileSizeSeries.splitted=Object.values(i).filter(p=>!p.data.every(_=>0===_)).sort((p,_)=>_.total-p.total),this.storageUsedInPeriod=Object.values(r)}setLineChartsOptions(){this.lineChartOptions=this.getLineChartOption(),this.usersChartOptions=(0,h._k)([this.xAxisLabels],[this.usersSeries])}setTotalSizeChartOptions(){this.totalSize=(0,h.HN)(this.storageUsedInPeriod,"size"),this.totalFileCount=(0,h.HN)(this.storageUsedInPeriod,"count");const e=this.storageUsedInPeriod.sort((a,i)=>i.size-a.size).slice(0,4).map(a=>({name:a.ext,value:a.size}));e.push({name:"altre",value:this.totalSize-(0,h.HN)(e,"value")}),this.totalSizeChartOptions=(0,h.TF)(e,"Spazio occupato",(0,I.t)(this.totalSize),I.t,this.smallDevice)}getLineChartOption(){let e;switch(this.lineChartType){case"size":e=this.storageSeries,this.lineChartTitle="Spazio giornaliero (MB)";break;case"file":e=this.fileCountSeries,this.lineChartTitle="File giornalieri";break;default:e=this.avgFileSizeSeries,this.lineChartTitle="Peso medio (MB)"}return(0,h._k)([this.xAxisLabels],e[this.lineChartDetails])}addChartToResizeEvent(e){this.eChartsService.addInstanceToResizeEvent(e,A)}}return(n=s).\u0275fac=function(e){return new(e||n)(t.Y36(T.z3),t.Y36(T.KN),t.Y36(L.Yg),t.Y36(T.H8))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-upload-daily-stats"]],inputs:{chartLoading:"chartLoading",data:"data",supportedFiles:"supportedFiles"},features:[t.TTD],decls:46,vars:39,consts:[[1,"grid","charts-container","list-unstyled","mb-0"],[1,"g-col-3","g-col-xl-10","g-col-xxxl-4","g-row-xxxl-3"],["statTitle","Spazio occupato nel periodo"],["echarts","",1,"d-block",3,"options","autoResize","loading","loadingOpts","chartInit"],[1,"g-col-3","g-col-xl-7","g-col-xxxl-4","g-row-xl-3"],["statTitle","Utenti giornalieri"],["title",""],[1,"ms-auto","fs-sm"],[1,"g-col-3","g-col-md-1","g-col-xl-3","g-col-xxxl-2"],["description","File caricati","color","green",3,"value"],["description","Spazio occupato","color","blue",3,"value"],["description","Peso medio","color","red",3,"value"],[1,"g-col-3","g-col-xl-10","g-col-xxl-6","g-col-xxxl-7"],[3,"statTitle","hideTitleOnSmallScreen"],[1,"ms-auto","d-flex"],[1,"form-select","form-select-sm","me-2",3,"ngModel","ngModelChange"],["value","size",3,"selected"],["value","file"],["value","avg"],[1,"form-select","form-select-sm",3,"ngModel","ngModelChange"],["value","splitted",3,"selected"],["value","total"],["echarts","",1,"d-block","mt-3",3,"options","autoResize","loading","loadingOpts","chartInit"],[1,"g-col-3","g-col-xl-10","g-col-xxl-4","g-col-xxxl-3"],[3,"data"],[1,"g-col-3","g-col-xl-10"],[3,"hasTitle"],[1,"pt-1","overflow-auto","table-container",3,"ngClass"],[3,"supportedFiles","storageData","totalSize","totalFileCount"]],template:function(e,a){1&e&&(t.TgZ(0,"ul",0)(1,"li",1)(2,"app-stat-container",2),t.ynx(3),t.TgZ(4,"div",3),t.NdJ("chartInit",function(r){return a.addChartToResizeEvent(r)}),t.qZA(),t.BQk(),t.qZA()(),t.TgZ(5,"li",4)(6,"app-stat-container",5),t.ynx(7,6),t.TgZ(8,"div",7),t._uU(9),t.ALo(10,"localeString"),t.qZA(),t.BQk(),t.ynx(11),t.TgZ(12,"div",3),t.NdJ("chartInit",function(r){return a.addChartToResizeEvent(r)}),t.qZA(),t.BQk(),t.qZA()(),t.TgZ(13,"li",8),t._UZ(14,"app-stat-summary-container",9),t.ALo(15,"localeString"),t.qZA(),t.TgZ(16,"li",8),t._UZ(17,"app-stat-summary-container",10),t.ALo(18,"formatBytes"),t.qZA(),t.TgZ(19,"li",8),t._UZ(20,"app-stat-summary-container",11),t.ALo(21,"formatBytes"),t.qZA(),t.TgZ(22,"li",12)(23,"app-stat-container",13),t.ynx(24,6),t.TgZ(25,"div",14)(26,"select",15),t.NdJ("ngModelChange",function(r){return a.lineChartType=r})("ngModelChange",function(){return a.lineChartOptions=a.getLineChartOption()}),t.TgZ(27,"option",16),t._uU(28,"Spazio (MB)"),t.qZA(),t.TgZ(29,"option",17),t._uU(30,"File"),t.qZA(),t.TgZ(31,"option",18),t._uU(32,"Peso medio (MB)"),t.qZA()(),t.TgZ(33,"select",19),t.NdJ("ngModelChange",function(r){return a.lineChartDetails=r})("ngModelChange",function(){return a.lineChartOptions=a.getLineChartOption()}),t.TgZ(34,"option",20),t._uU(35,"Singolo"),t.qZA(),t.TgZ(36,"option",21),t._uU(37,"Totale"),t.qZA()()(),t.BQk(),t.ynx(38),t.TgZ(39,"div",22),t.NdJ("chartInit",function(r){return a.addChartToResizeEvent(r)}),t.qZA(),t.BQk(),t.qZA()(),t.TgZ(40,"li",23),t._UZ(41,"app-upload-stat-top-users",24),t.qZA(),t.TgZ(42,"li",25)(43,"app-stat-container",26)(44,"div",27),t._UZ(45,"app-upload-stat-file-table",28),t.qZA()()()()),2&e&&(t.xp6(4),t.Q6J("options",a.totalSizeChartOptions)("autoResize",!1)("loading",a.chartLoading)("loadingOpts",a.loadingOptions),t.xp6(5),t.hij("Totale: ",t.lcZ(10,29,a.totalUsers),""),t.xp6(3),t.Q6J("options",a.usersChartOptions)("autoResize",!1)("loading",a.chartLoading)("loadingOpts",a.loadingOptions),t.xp6(2),t.Q6J("value",t.lcZ(15,31,a.totalFileCount)),t.xp6(3),t.Q6J("value",t.lcZ(18,33,a.totalSize)),t.xp6(3),t.Q6J("value",t.lcZ(21,35,a.totalSize/a.totalFileCount)),t.xp6(3),t.Q6J("statTitle",a.lineChartTitle)("hideTitleOnSmallScreen",!0),t.xp6(3),t.Q6J("ngModel",a.lineChartType),t.xp6(),t.Q6J("selected",!0),t.xp6(6),t.Q6J("ngModel",a.lineChartDetails),t.xp6(),t.Q6J("selected",!0),t.xp6(5),t.Q6J("options",a.lineChartOptions)("autoResize",!1)("loading",a.chartLoading)("loadingOpts",a.loadingOptions),t.xp6(2),t.Q6J("data",a.topUsersPerDay),t.xp6(2),t.Q6J("hasTitle",!1),t.xp6(),t.Q6J("ngClass",t.VKq(37,Xt,!a.touchDevice)),t.xp6(),t.Q6J("supportedFiles",a.supportedFiles)("storageData",a.storageUsedInPeriod)("totalSize",a.totalSize)("totalFileCount",a.totalFileCount))},dependencies:[l.mk,C.YN,C.Kr,C.EJ,C.JJ,C.On,Z._w,k,G,V,X,Y.b,j],styles:[".charts-container[_ngcontent-%COMP%]{--bs-columns: 3}.charts-container[_ngcontent-%COMP%]   [echarts][_ngcontent-%COMP%]{height:300px}.charts-container[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{min-width:0}.table-container[_ngcontent-%COMP%]{height:300px}@media (min-width: 1200px){.charts-container[_ngcontent-%COMP%]{--bs-columns: 10}}"]}),s})();var $=c(1413);function te(n,s){if(1&n&&(t._UZ(0,"div",1),t.ALo(1,"date")),2&n){const o=t.oxw();t.Q6J("ngClass",o.trend.value<0?"alert-danger":"alert-success")("innerText",(o.trend.value>0?"+"+o.trend.value:o.trend.value)+"%")("appTippy","Rispetto al "+t.xi3(1,3,o.trend.date,"dd/MM/YY"))}}let ee=(()=>{var n;class s{}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-stat-trend"]],inputs:{trend:"trend"},decls:1,vars:1,consts:[["class","position-absolute alert border-0 px-1 py-0 trend fs-xs cursor-pointer",3,"ngClass","innerText","appTippy",4,"ngIf"],[1,"position-absolute","alert","border-0","px-1","py-0","trend","fs-xs","cursor-pointer",3,"ngClass","innerText","appTippy"]],template:function(e,a){1&e&&t.YNc(0,te,2,6,"div",0),2&e&&t.Q6J("ngIf",a.trend)},dependencies:[l.mk,l.O5,K.$,l.uU],styles:[".trend[_ngcontent-%COMP%]{top:.5rem;right:.5rem}"]}),s})();const ae=n=>({"pe-2":n});let ne=(()=>{var n;class s{constructor(e,a,i,r){this.eChartsService=e,this.breakpointObserver=a,this.dateAdapterService=i,this.dateFormatterService=r,this.chartLoading=!0,this.touchDevice=v.b1,this.smallDevice=!0,this.loadingOptions=(0,h.MO)(),this.totalSizeChartOptions=null,this.totalFileCountChartOptions=null,this.totalFileCount=0,this.totalSize=0,this.filesPerUser=0,this.sizePerUser=0,this.storageUsedAsArray={current:[],trend:[]},this.smallDevice=this.breakpointObserver.isMatched([L.u3.XSmall])}ngOnChanges(e){var a=this;return(0,u.Z)(function*(){e.data&&a.data&&(a.setStorageUsedAsArray(),a.setTotalSizeChart(),a.setTotalFileCountChart(),a.setSummaries(),a.setTopUsers())})()}setStorageUsedAsArray(){this.storageUsedAsArray.current=Object.entries(this.data.storageUsed).filter(e=>isNaN(Number(e[0]))).map(e=>({ext:e[0],count:e[1].count,size:e[1].size})),this.storageUsedAsArray.trend=Object.entries(this.trendData.storageUsed).filter(e=>isNaN(Number(e[0]))).map(e=>({ext:e[0],count:e[1].count,size:e[1].size}))}setSummaries(){this.filesPerUser=Math.round(this.totalFileCount/this.data.toDateActiveUsers);const e=Math.round((0,h.HN)(this.storageUsedAsArray.trend,"count")/this.trendData.toDateActiveUsers);this.filesPerUserTrend={value:(0,h.rp)((this.filesPerUser-e)/e),date:this.trendData.date},this.sizePerUser=this.totalSize/this.data.toDateActiveUsers;const a=Math.round((0,h.HN)(this.storageUsedAsArray.trend,"size")/this.trendData.toDateActiveUsers);this.sizePerUserTrend={value:(0,h.rp)((this.sizePerUser-a)/a),date:this.trendData.date}}setTotalSizeChart(){this.totalSize=(0,h.HN)(this.storageUsedAsArray.current,"size");const e=this.storageUsedAsArray.current.sort((a,i)=>i.size-a.size).slice(0,4).map(a=>({name:a.ext,value:a.size}));e.push({name:"altre",value:this.totalSize-(0,h.HN)(e,"value")}),this.totalSizeChartOptions=(0,h.TF)(e,"Spazio occupato",(0,I.t)(this.totalSize),I.t,this.smallDevice)}setTotalFileCountChart(){this.totalFileCount=(0,h.HN)(this.storageUsedAsArray.current,"count");const e=this.storageUsedAsArray.current.sort((a,i)=>a.count-i.count).slice(-4);e.unshift({ext:"altre",count:this.totalFileCount-(0,h.HN)(e,"count"),size:0}),this.totalFileCountChartOptions=function Wt(n,s,o){return{toolbox:(0,h.tZ)(),tooltip:(0,$.Z)((0,$.Z)({},h.dB),{},{trigger:"axis",axisPointer:{type:"shadow"},textStyle:{color:"inherit"},valueFormatter:e=>(0,H.o)(e)}),legend:{show:!1},grid:{left:"3%",right:"4%",bottom:"3%",top:30,containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01],axisLabel:{show:!1}},yAxis:{type:"category",data:n,axisTick:{show:!1},axisLabel:{margin:15}},series:[{name:"Numero di file",type:"bar",data:o,itemStyle:{borderRadius:[0,5,5,0]},label:{position:"inside",show:!0,formatter:e=>"".concat(Math.round(100*e.value/s*100)/100,"%")}}]}}(e.map(a=>a.ext),this.totalFileCount,e.map(a=>a.count))}setTopUsers(){const e=this.dateFormatterService.formatShort(this.dateAdapterService.fromModel(this.data.date));this.topUsersData=[{size:this.data.toDateTopTotalSize,file:this.data.toDateTopTotalFileCount,day:e}]}addChartToResizeEvent(e){this.eChartsService.addInstanceToResizeEvent(e,A)}}return(n=s).\u0275fac=function(e){return new(e||n)(t.Y36(T.H8),t.Y36(L.Yg),t.Y36(T.z3),t.Y36(T.KN))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-upload-total-stats"]],inputs:{chartLoading:"chartLoading",data:"data",trendData:"trendData",supportedFiles:"supportedFiles"},features:[t.TTD],decls:31,vars:29,consts:[[1,"grid","charts-container","list-unstyled","mb-0"],[1,"g-col-3","g-col-md-1","g-col-xl-3","g-col-xxxl-2"],["description","Utenti totali","color","green",3,"value"],[1,"g-col-3","g-col-md-1","g-col-xl-3","g-col-xxxl-2","g-row-start-xl-2"],["description","File per utente","color","blue",3,"value"],["header",""],[3,"trend"],[1,"g-col-3","g-col-md-1","g-col-xl-3","g-col-xxxl-2","g-row-start-xl-3"],["description","Spazio per utente","color","indigo",3,"value"],[1,"g-col-3","g-col-xl-7","g-col-xxxl-4","g-row-3"],["statTitle","Spazio occupato"],["echarts","",1,"d-block",3,"options","autoResize","loading","loadingOpts","chartInit"],[1,"g-col-3","g-col-xl-10","g-col-xxl-6","g-col-xxxl-4","g-row-xxxl-3"],["statTitle","File caricati"],["title",""],[1,"ms-auto","fs-sm"],[1,"g-col-3","g-col-xl-10","g-col-xxl-4","g-col-xxxl-3"],[3,"data"],[1,"g-col-3","g-col-xl-10","g-col-xxxl-7"],[3,"hasTitle"],[1,"pt-1","overflow-auto","table-container",3,"ngClass"],[3,"supportedFiles","storageData","totalSize","totalFileCount"]],template:function(e,a){1&e&&(t.TgZ(0,"ul",0)(1,"li",1),t._UZ(2,"app-stat-summary-container",2),t.ALo(3,"localeString"),t.qZA(),t.TgZ(4,"li",3)(5,"app-stat-summary-container",4),t.ynx(6,5),t._UZ(7,"app-stat-trend",6),t.BQk(),t.qZA()(),t.TgZ(8,"li",7)(9,"app-stat-summary-container",8),t.ALo(10,"formatBytes"),t.ynx(11,5),t._UZ(12,"app-stat-trend",6),t.BQk(),t.qZA()(),t.TgZ(13,"li",9)(14,"app-stat-container",10),t.ynx(15),t.TgZ(16,"div",11),t.NdJ("chartInit",function(r){return a.addChartToResizeEvent(r)}),t.qZA(),t.BQk(),t.qZA()(),t.TgZ(17,"li",12)(18,"app-stat-container",13),t.ynx(19,14),t.TgZ(20,"div",15),t._uU(21),t.ALo(22,"localeString"),t.qZA(),t.BQk(),t.ynx(23),t.TgZ(24,"div",11),t.NdJ("chartInit",function(r){return a.addChartToResizeEvent(r)}),t.qZA(),t.BQk(),t.qZA()(),t.TgZ(25,"li",16),t._UZ(26,"app-upload-stat-top-users",17),t.qZA(),t.TgZ(27,"li",18)(28,"app-stat-container",19)(29,"div",20),t._UZ(30,"app-upload-stat-file-table",21),t.qZA()()()()),2&e&&(t.xp6(2),t.Q6J("value",t.lcZ(3,21,a.data.toDateActiveUsers)),t.xp6(3),t.Q6J("value",a.filesPerUser),t.xp6(2),t.Q6J("trend",a.filesPerUserTrend),t.xp6(2),t.Q6J("value",t.lcZ(10,23,a.sizePerUser)),t.xp6(3),t.Q6J("trend",a.sizePerUserTrend),t.xp6(4),t.Q6J("options",a.totalSizeChartOptions)("autoResize",!1)("loading",a.chartLoading)("loadingOpts",a.loadingOptions),t.xp6(5),t.hij("Totale: ",t.lcZ(22,25,a.totalFileCount),""),t.xp6(3),t.Q6J("options",a.totalFileCountChartOptions)("autoResize",!1)("loading",a.chartLoading)("loadingOpts",a.loadingOptions),t.xp6(2),t.Q6J("data",a.topUsersData),t.xp6(2),t.Q6J("hasTitle",!1),t.xp6(),t.Q6J("ngClass",t.VKq(27,ae,!a.touchDevice)),t.xp6(),t.Q6J("supportedFiles",a.supportedFiles)("storageData",a.storageUsedAsArray.current)("totalSize",a.totalSize)("totalFileCount",a.totalFileCount))},dependencies:[l.mk,Z._w,k,G,ee,V,X,Y.b,j],styles:[".table-container[_ngcontent-%COMP%]{min-height:100%}",".charts-container[_ngcontent-%COMP%]{--bs-columns: 3}.charts-container[_ngcontent-%COMP%]   [echarts][_ngcontent-%COMP%]{height:300px}.charts-container[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{min-width:0}.table-container[_ngcontent-%COMP%]{height:300px}@media (min-width: 1200px){.charts-container[_ngcontent-%COMP%]{--bs-columns: 10}}"]}),s})();const oe=n=>({"touch-device":n});function ie(n,s){if(1&n){const o=t.EpF();t.ynx(0),t.TgZ(1,"div",3),t._UZ(2,"app-upload-total-stats",4),t.TgZ(3,"app-upload-datepicker",5),t.NdJ("modelChangeEvent",function(a){t.CHM(o);const i=t.oxw();return t.KtG(i.rangeChangeEvent(a))}),t.qZA(),t._UZ(4,"app-upload-daily-stats",6),t.qZA(),t.BQk()}if(2&n){const o=t.oxw();t.xp6(),t.Q6J("ngClass",t.VKq(9,oe,o.touchDevice)),t.xp6(),t.Q6J("supportedFiles",o.supportedFiles)("data",o.globalStatsData.current)("trendData",o.globalStatsData.trend)("chartLoading",o.loading),t.xp6(),t.Q6J("availableRange",o.availableRange),t.xp6(),t.Q6J("supportedFiles",o.supportedFiles)("data",o.data)("chartLoading",o.loading)}}function se(n,s){1&n&&t._UZ(0,"app-loader",7)}let le=(()=>{var n;class s{constructor(e,a,i,r,g){this.uploadService=e,this.uploadStatsService=a,this.dateAdapterService=i,this.ngbCalendar=r,this.eChartsService=g,this.touchDevice=v.b1,this.loading=!0,this.supportedFiles=[],this.componentDestroyed=new S.x,this.eChartsService.setResizeChartEvent(this.componentDestroyed,A)}ngOnInit(){var e=this;return(0,u.Z)(function*(){const[a,i]=yield Promise.all([e.uploadStatsService.getAvailableDateRange(),e.uploadService.getFileLimits()]);e.supportedFiles=i,e.availableRange={start:e.dateAdapterService.fromModel(new Date(a.start)),end:e.dateAdapterService.fromModel(new Date(a.end))};const r=e.ngbCalendar.getToday(),g=e.dateAdapterService.toModel(e.ngbCalendar.getPrev(r,"d",365)).toISOString(),f=yield e.getData([...e.rangeToStringArray(r,8),g]);e.todayData=f[f.length-1],e.oneYearFromTodayData=f[0],e.globalStatsData={current:e.todayData,trend:e.oneYearFromTodayData,useRange:!1},e.data=f.slice(1),e.loading=!1})()}rangeToStringArray(e,a){return[...Array(a+1)].map((i,r)=>{const g=this.ngbCalendar.getPrev(e,"d",r);return g.before(this.availableRange.start)||g.after(this.availableRange.end)?null:this.dateAdapterService.toModel(g).toISOString()}).filter(i=>null!==i)}getData(e){var a=this;return(0,u.Z)(function*(){return(yield a.uploadStatsService.getRangeData(e)).sort((r,g)=>r.date.getTime()-g.date.getTime())})()}rangeChangeEvent(e){var a=this;return(0,u.Z)(function*(){if(!e.range.start||!e.range.end)return;const i=a.dateAdapterService.toModel(e.range.start),r=a.dateAdapterService.toModel(e.range.end),g=i.getTime(),f=r.getTime();if(!a.data||g!==a.data[1].date.getTime()||f!==a.data[a.data.length-1].date.getTime()){a.loading=!0;const p=Math.round((f-g)/864e5);a.data=yield a.getData(a.rangeToStringArray(e.range.end,p+1)),a.loading=!1}if(e.useRangeAsGlobal!==a.globalStatsData.useRange||a.globalStatsData.useRange)if(a.globalStatsData.useRange=e.useRangeAsGlobal,a.globalStatsData.useRange){a.globalStatsData.current=a.data[a.data.length-1];const p=a.ngbCalendar.getPrev(e.range.end,"d",364);a.globalStatsData.trend=(yield a.getData([a.dateAdapterService.toModel(p.after(a.availableRange.start)?p:a.availableRange.start).toISOString()]))[0]}else a.globalStatsData.current=a.todayData,a.globalStatsData.trend=a.oneYearFromTodayData})()}ngOnDestroy(){this.componentDestroyed.next(),this.componentDestroyed.complete(),this.eChartsService.clearResizeInstances(A)}}return(n=s).\u0275fac=function(e){return new(e||n)(t.Y36(z.C),t.Y36(B),t.Y36(T.z3),t.Y36(x.vL),t.Y36(T.H8))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],decls:4,vars:2,consts:[["pageTitle","Statistiche Upload"],[4,"ngIf","ngIfElse"],["loader",""],[1,"overflow-hidden","page-container",3,"ngClass"],[3,"supportedFiles","data","trendData","chartLoading"],[3,"availableRange","modelChangeEvent"],[3,"supportedFiles","data","chartLoading"],["message","Recupero dei dati",1,"d-block","mt-5"]],template:function(e,a){if(1&e&&(t._UZ(0,"app-breadcrumb",0),t.YNc(1,ie,5,11,"ng-container",1)(2,se,1,0,"ng-template",null,2,t.W1O)),2&e){const i=t.MAs(3);t.xp6(),t.Q6J("ngIf",a.data)("ngIfElse",i)}},dependencies:[y.L,l.mk,l.O5,N.R,at,$t,ne],styles:[".page-container[_ngcontent-%COMP%]{margin-bottom:-10px;padding-bottom:10px}@media (min-width: 960px){.page-container[_ngcontent-%COMP%]:not(.touch-device){margin:-10px;padding:10px}}"]}),s})();var re=c(7230),ce=c(5644),pe=c(4970),de=c(5273),ue=c(6165),ge=c(8646),me=c(9763),he=c(3665),Te=c(5230),fe=c(583),_e=c(1970),Ce=c(5399);re.D([pe.N,de.N,ue.N,ge.N,me.N,he.N,Te.N,fe.N,_e.N,Ce.N]);const ve=[{path:"",component:le}];let Se=(()=>{var n;class s{}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[J.w,l.ez,d.I,b.C,C.u5,h.q,x.Oz,Z.Ns.forRoot({echarts:ce}),R,P.Bz.forChild(ve),h.qp,h.Gw,h.h2,E,Q.G,P.Bz]}),s})()}}]);