(self.webpackChunkboard=self.webpackChunkboard||[]).push([[620],{9969:(Y,j,t)=>{"use strict";t.d(j,{R:()=>g});class g{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(U=>U in this).forEach(U=>this[U]=e[U]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(U=>U in this).forEach(U=>this[U]=e[U].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},2020:(Y,j,t)=>{"use strict";t.d(j,{y:()=>_});var g=t(5861);var C=t(4650);let _=(()=>{class f{constructor(){this.autoRotateSupported=function e(){return new Promise(f=>{const O=new Image;O.onload=()=>{f(1===O.width&&2===O.height)},O.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(i,x){return new Promise((l,M)=>{const s=new FileReader;s.onload=p=>{this.loadImage(p.target.result,i.type,x).then(l).catch(M)},s.readAsDataURL(i)})}loadImage(i,x,l){return this.isValidImageType(x)?this.loadBase64Image(i,l):Promise.reject(new Error("Invalid image type"))}isValidImageType(i){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(i)}loadImageFromURL(i,x){return new Promise((l,M)=>{const s=new Image;s.onerror=()=>M,s.onload=()=>{const p=document.createElement("canvas"),D=p.getContext("2d");p.width=s.width,p.height=s.height,D?.drawImage(s,0,0),this.loadBase64Image(p.toDataURL(),x).then(l)},s.crossOrigin="anonymous",s.src=i})}loadBase64Image(i,x){return new Promise((l,M)=>{const s=new Image;s.onload=()=>l({originalImage:s,originalBase64:i}),s.onerror=M,s.src=i}).then(l=>this.transformImageBase64(l,x))}transformImageBase64(i,x){var l=this;return(0,g.Z)(function*(){const M=yield l.autoRotateSupported,s=yield function U(f){switch("string"==typeof f&&(f=function B(f){const O=new DataView(function h(f){f=f.replace(/^data\:([^\;]+)\;base64,/gim,"");const O=atob(f),i=O.length,x=new Uint8Array(i);for(let l=0;l<i;l++)x[l]=O.charCodeAt(l);return x.buffer}(f));if(65496!==O.getUint16(0,!1))return-2;const i=O.byteLength;let x=2;for(;x<i;){if(O.getUint16(x+2,!1)<=8)return-1;const l=O.getUint16(x,!1);if(x+=2,65505==l){if(1165519206!==O.getUint32(x+=2,!1))return-1;const M=18761==O.getUint16(x+=6,!1);x+=O.getUint32(x+4,M);const s=O.getUint16(x,M);x+=2;for(let p=0;p<s;p++)if(274==O.getUint16(x+12*p,M))return O.getUint16(x+12*p+8,M)}else{if(65280!=(65280&l))break;x+=O.getUint16(x,!1)}}return-1}(f)),f){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(M?-1:i.originalBase64);return i.originalImage&&i.originalImage.complete?l.transformLoadedImage({original:{base64:i.originalBase64,image:i.originalImage,size:{width:i.originalImage.naturalWidth,height:i.originalImage.naturalHeight}},exifTransform:s},x):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(i,x){var l=this;return(0,g.Z)(function*(){const M=x.canvasRotation+i.exifTransform.rotate,s={width:i.original.image.naturalWidth,height:i.original.image.naturalHeight};if(0===M&&!i.exifTransform.flip&&!x.containWithinAspectRatio)return{original:{base64:i.original.base64,image:i.original.image,size:{...s}},transformed:{base64:i.original.base64,image:i.original.image,size:{...s}},exifTransform:i.exifTransform};const p=l.getTransformedSize(s,i.exifTransform,x),D=document.createElement("canvas");D.width=p.width,D.height=p.height;const F=D.getContext("2d");F?.setTransform(i.exifTransform.flip?-1:1,0,0,1,D.width/2,D.height/2),F?.rotate(Math.PI*(M/2)),F?.drawImage(i.original.image,-s.width/2,-s.height/2);const v=D.toDataURL(),m=yield l.loadImageFromBase64(v);return{original:{base64:i.original.base64,image:i.original.image,size:{...s}},transformed:{base64:v,image:m,size:{width:m.width,height:m.height}},exifTransform:i.exifTransform}})()}loadImageFromBase64(i){return new Promise((x,l)=>{const M=new Image;M.onload=()=>x(M),M.onerror=l,M.src=i})}getTransformedSize(i,x,l){const M=l.canvasRotation+x.rotate;if(l.containWithinAspectRatio){if(M%2){const p=i.height/l.aspectRatio;return{width:Math.max(i.height,i.width*l.aspectRatio),height:Math.max(i.width,p)}}{const p=i.width/l.aspectRatio;return{width:Math.max(i.width,i.height*l.aspectRatio),height:Math.max(i.height,p)}}}return M%2?{height:i.width,width:i.height}:{width:i.width,height:i.height}}}return f.\u0275fac=function(i){return new(i||f)},f.\u0275prov=C.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},8896:(Y,j,t)=>{"use strict";function g(S){const e=S.split(","),U=e[0].replace("data:","").replace(";base64",""),B=atob(e[1]),h=new ArrayBuffer(B.length),C=new Uint8Array(h);for(let _=0;_<B.length;_+=1)C[_]=B.charCodeAt(_);return new Blob([h],{type:U})}t.d(j,{L:()=>g})},1891:(Y,j,t)=>{"use strict";t.d(j,{B:()=>K});var g=t(5861),S=t(1309),e=t(4650),U=t(4968),B=t(3905),h=t(3848),C=t(1460),_=t(4323),f=t(6986),O=t(575),i=t(7693),x=t(7320),l=t(146),M=t(3612),s=t(6378),p=t(6895),D=t(433),F=t(4029),v=t(8279),m=t(3450),P=t(8212);const k=["fileInput"];function A(d,w){1&d&&(e.O4$(),e.TgZ(0,"svg",23),e._UZ(1,"path",24)(2,"path",25),e.qZA())}const b=function(){return["text-primary"]};function L(d,w){1&d&&e._UZ(0,"app-logo",26),2&d&&e.Q6J("svgClass",e.DdM(2,b))("responsive",!1)}function E(d,w){1&d&&(e.TgZ(0,"span"),e._uU(1,"Trascina i file da caricare oppure c"),e.qZA())}function Q(d,w){1&d&&(e.TgZ(0,"span"),e._uU(1,"C"),e.qZA())}function N(d,w){if(1&d&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2,"I file verranno caricati nella cartella "),e.qZA(),e._UZ(3,"em",27),e.ALo(4,"arrayJoin"),e.BQk()),2&d){const a=e.oxw(2);e.xp6(3),e.Q6J("innerText",a.currentFolderPath.length?e.xi3(4,1,a.currentFolderPath,"/"):"root")}}function J(d,w){if(1&d&&(e._UZ(0,"div",32),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&d){const a=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,a.currentFolderPath,0,-1),"/"))}}function X(d,w){if(1&d&&(e.TgZ(0,"div",28)(1,"div",29),e._uU(2,"Cartella:"),e.qZA(),e.YNc(3,J,3,8,"div",30),e._UZ(4,"div",31),e.ALo(5,"arrayJoin"),e.ALo(6,"slice"),e.qZA()),2&d){const a=e.oxw(2);e.xp6(3),e.Q6J("ngIf",a.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(a.currentFolderPath.length>1?"/":"")+(a.currentFolderPath.length?e.xi3(5,2,e.xi3(6,5,a.currentFolderPath,a.currentFolderPath.length-1),"/"):"root"))}}const ee=function(){return{bottom:0,left:0}};function ae(d,w){if(1&d){const a=e.EpF();e.ynx(0),e.TgZ(1,"a",33),e.NdJ("click",function(){e.CHM(a);const n=e.oxw(2);return e.KtG(n.openInfoModal.emit())}),e._uU(2,"Informazioni"),e.qZA(),e.TgZ(3,"div",34),e.NdJ("click",function(){e.CHM(a),e.oxw(2);const n=e.MAs(7);return e.KtG(n.open())}),e._uU(4,"settings"),e.qZA(),e.BQk()}2&d&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(1,ee)))}const y=function(d,w,a){return{"cursor-pointer":d,"p-4":w,"p-2":a}},r=function(d,w){return{"fw-bold fs-lg":d,small:w}},o=function(d,w,a){return{"my-2":d,"mb-2":w,"mw-100":a}};function c(d,w){if(1&d){const a=e.EpF();e.ynx(0),e.TgZ(1,"div",15,16),e.NdJ("dragenter",function(){e.CHM(a);const n=e.MAs(2),W=e.oxw();return e.KtG(W.setDragOverEvent(n))})("drop",function(n){e.CHM(a);const W=e.oxw();return e.KtG(W.handleDropEvent(n))})("click",function(){e.CHM(a),e.oxw();const n=e.MAs(2);return e.KtG(n.click())}),e.YNc(3,A,3,0,"svg",17),e.YNc(4,L,1,3,"ng-template",null,18,e.W1O),e.TgZ(6,"div",19),e.YNc(7,E,2,0,"span",20),e.YNc(8,Q,2,0,"span",20),e.TgZ(9,"span"),e._uU(10,"licca per scegliere da memoria"),e.qZA()(),e.TgZ(11,"div",21),e.YNc(12,N,5,4,"ng-container",3),e.YNc(13,X,7,8,"ng-template",null,22,e.W1O),e.qZA()(),e.YNc(15,ae,5,2,"ng-container",20),e.BQk()}if(2&d){const a=e.MAs(5),u=e.MAs(14),n=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(10,y,!n.loading,!n.isWidget,n.isWidget)),e.xp6(2),e.Q6J("ngIf",!n.isWidget)("ngIfElse",a),e.xp6(3),e.Q6J("ngClass",e.WLB(14,r,!n.isWidget,n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.touchDevice),e.xp6(1),e.Q6J("ngIf",n.touchDevice),e.xp6(3),e.Q6J("ngClass",e.kEZ(17,o,!n.isWidget&&!n.touchDevice,!n.isWidget&&n.touchDevice,n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.isWidget)("ngIfElse",u),e.xp6(3),e.Q6J("ngIf",!n.isWidget)}}const R=function(d,w){return{"p-4":d,"p-2":w}};function T(d,w){if(1&d&&(e.TgZ(0,"div",35),e.O4$(),e.TgZ(1,"svg",36),e._UZ(2,"path",37),e.qZA(),e.kcU(),e._UZ(3,"app-loader",38),e.TgZ(4,"div",39),e._uU(5,"Attendi il completamento dell'upload per caricare altre immagini."),e.qZA()()),2&d){const a=e.oxw();e.Q6J("ngClass",e.WLB(3,R,!a.isWidget,a.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",a.loadingMessage)}}const H=function(d,w){return{uploading:d,"widget flex-grow-1":w}};let K=(()=>{class d{constructor(a,u,n,W,I,$,z){this.postMessageService=a,this.uploadService=u,this.uploadObservablesService=n,this.uploaderService=W,this.toastService=I,this.renderer=$,this.ngZone=z,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="Controllo dei file in corso",this.touchDevice=C.eX,this.dragOverEvent=!1,this.options=this.uploaderService.uploaderOptions;const te=this.uploadService.preferences.uploader;te.checkImage.active||(this.options.compress=!1),te.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){this.handleClipboardPasteEvent(),this.handleExternalUpload()}handleClipboardPasteEvent(){var a=this;this.clipboardPasteEventSubscription=(0,U.R)(document.body,"paste").subscribe(function(){var u=(0,g.Z)(function*(n){if(!a.canUpload)return;const W=Array.from((n.clipboardData||n.originalEvent.clipboardData).items);let I=[];for(const $ of W)if(0===$.type.indexOf("image")){const z=$.getAsFile();z&&I.push(z)}I.length>0?yield a.preUpload(I):a.reset()});return function(n){return u.apply(this,arguments)}}())}handleExternalUpload(){var a=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var u=(0,g.Z)(function*(n){if(n){if(!a.canUpload)return;yield a.preUpload([n.file],n.options)}else a.fileInputRef.nativeElement.click()});return function(n){return u.apply(this,arguments)}}())}handleSelectionEvent(a){var u=this;return(0,g.Z)(function*(){if(!u.canUpload)return;const n=a.target;if(n.files&&n.files.length){const W=Array.from(n.files);return n.value="",u.preUpload(W)}u.reset()})()}handleDropEvent(a){var u=this;return(0,g.Z)(function*(){if(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),!u.canUpload)return;const n=a.dataTransfer?.files?Array.from(a.dataTransfer.files):[];if(n.length)return u.preUpload(n);u.reset()})()}saveOptions(a=!0){this.uploaderService.uploaderOptions=this.options,a&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(a){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(a,"dragover",u=>{u.preventDefault()})}))}get canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage="Controllo dei file da caricare",this.postMessageService.send(_.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(a,u){var n=this;return(0,g.Z)(function*(){const W=[...n.currentFolderPath];let I=[],$=[],z=[],te=[];u?u.allowOverwrite=u.allowOverwrite||!1:(u=n.uploaderService.uploaderOptions).allowOverwrite=!1;for(let Z=0;Z<a.length;Z++){let G=u.compress?yield n.uploaderService.compressFileIfNeeded(a[Z],u.imageDimensions):a[Z];if(G=yield n.uploaderService.orientFileIfNeeded(G),G){const ne=(0,h.Tb)(G.name),ie=f.O8.find(V=>-1!==V.ext.indexOf(ne.ext));if(!ie){z.push(G);continue}if(G.size>ie.maxSize){te.push(G);continue}I.push({file:{name:G.name,size:G.size,time:0,url:"",ext:ne.ext,filename:ne.filename,isImage:(0,h.Or)(ne.ext),embedUrl:""},progress:0,completed:!1}),$.push(G)}}if((z.length||te.length)&&(n.toastService.show({content:n.createToastMessage(z,te),level:S.m.ERROR}),[["UNSUPPORTED",z],["OVERSIZED",te]].forEach(Z=>{Z[1].forEach(G=>{n.postMessageService.send(_.l.UPLOAD_ERROR,{filename:G.name,error:Z[0]})})})),0===$.length)return void n.reset();const oe=`Caricamento file {{fileNumber}} di ${$.length} in corso`;n.uploadObservablesService.pushUploadingFileQueue(I);for(let Z=0;Z<$.length;++Z){n.loadingMessage="Creazione del pacchetto da inviare";const G=yield n.uploadService.getHostToken(W,$[Z].name);I[Z].progress+=20,n.loadingMessage=oe.replace("{{fileNumber}}",`${Z+1}`),yield(0,B.z)(n.uploaderService.upload($[Z],I[Z],G,u.allowOverwrite))}n.uploadObservablesService.pushUploadingFileQueue([]);const re=I.filter(Z=>!Z.error).map(Z=>Z.file);re.length>0&&(n.fileUploadedEvent.emit({fileList:re,rewrite:u.allowOverwrite,paths:W}),n.postMessageService.send(_.l.UPLOAD_SUCCESS,{fileList:re.map(Z=>({filename:Z.name,isImage:Z.isImage,url:Z.url}))}),u.openLinkModalAfterUpload&&n.uploadObservablesService.pushAction({name:O.In.FILE_SHOW_LINKS,payload:{entities:(0,h.jL)(re)}})),n.reset()})()}createToastMessage(a,u){let n=[];return a.length&&n.push(a.length>1?`I file <strong>${a.map(W=>W.name).join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${a[0].name}</strong> ha un formato non supportato!`),u.length&&n.push(u.length>1?`I file <strong>${u.map(W=>W.name).join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${u[0].name}</strong> \xe8 troppo pesante!`),n.join("<br><br>")}ngOnDestroy(){this.startExternalUploadSubscription?.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return d.\u0275fac=function(a){return new(a||d)(e.Y36(i.F),e.Y36(x.C),e.Y36(l.r),e.Y36(M.q),e.Y36(s.k),e.Y36(e.Qsj),e.Y36(e.R0b))},d.\u0275cmp=e.Xpm({type:d,selectors:[["app-uploader"]],viewQuery:function(a,u){if(1&a&&e.Gf(k,5),2&a){let n;e.iGM(n=e.CRH())&&(u.fileInputRef=n.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:30,vars:10,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],["title","Opzioni di caricamento"],["optionsModal",""],[1,"mb-1"],[1,"mb-3"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto"],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],[1,"description","text-center",3,"ngClass"],[4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","mb-3","py-1",3,"svgClass","responsive"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","options-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"]],template:function(a,u){if(1&a&&(e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(W){return u.handleSelectionEvent(W)}),e.qZA(),e.YNc(3,c,16,21,"ng-container",3),e.YNc(4,T,6,6,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6)(8,"p",7),e._uU(9,"Tramite questo modal \xe8 possibile gestire le opzioni di caricamento al momento disponibili:"),e.qZA(),e.TgZ(10,"ul",8)(11,"li")(12,"em"),e._uU(13,"caricamento veloce"),e.qZA(),e._uU(14,": abilitando questa opzione, l'immagine da caricare verr\xe0 adattata per terminare l'operazione di upload nel minor tempo possibile. "),e.qZA(),e.TgZ(15,"li")(16,"em"),e._uU(17,"mostra link dopo l'upload"),e.qZA(),e._uU(18,": abilitando questa opzione, una volta terminato il caricamento verr\xe0 aperto il modal contenente i link utili dei file caricati. "),e.qZA()(),e.TgZ(19,"ul",9)(20,"li")(21,"div",10)(22,"input",11),e.NdJ("ngModelChange",function(W){return u.options.compress=W})("ngModelChange",function(){return u.saveOptions()}),e.qZA(),e.TgZ(23,"label",12),e._uU(24,"Caricamento veloce"),e.qZA()()(),e.TgZ(25,"li")(26,"div",10)(27,"input",13),e.NdJ("ngModelChange",function(W){return u.options.openLinkModalAfterUpload=W})("ngModelChange",function(){return u.saveOptions()}),e.qZA(),e.TgZ(28,"label",14),e._uU(29,"Mostra link dopo l'upload"),e.qZA()()()()()),2&a){const n=e.MAs(5);e.Q6J("ngClass",e.WLB(7,H,u.isUploading,u.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",u.loading||u.isUploading),e.xp6(2),e.Q6J("ngIf",!u.isUploading)("ngIfElse",n),e.xp6(19),e.Q6J("ngModel",u.options.compress),e.xp6(5),e.Q6J("ngModel",u.options.openLinkModalAfterUpload)}},dependencies:[p.mk,p.O5,p.PC,D.Wl,D.JJ,D.On,F.R,v.R,m.z,P.J,p.OU],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864FE;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:400px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.options-icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{top:5px;right:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]:hover{opacity:1}.upload-area[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo){pointer-events:none}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),d})()},1197:(Y,j,t)=>{"use strict";t.d(j,{M:()=>_});var g=t(8694),S=t(6895),e=t(433),U=t(6818),B=t(1043),h=t(582),C=t(4650);let _=(()=>{class f{}return f.\u0275fac=function(i){return new(i||f)},f.\u0275mod=C.oAB({type:f}),f.\u0275inj=C.cJS({imports:[g.r,S.ez,e.u5,U.q,B.h,h.z]}),f})()},8694:(Y,j,t)=>{"use strict";t.d(j,{r:()=>e});var g=t(6895),S=t(4650);let e=(()=>{class U{}return U.\u0275fac=function(h){return new(h||U)},U.\u0275mod=S.oAB({type:U}),U.\u0275inj=S.cJS({imports:[g.ez]}),U})()},8212:(Y,j,t)=>{"use strict";t.d(j,{J:()=>S});var g=t(4650);let S=(()=>{class e{transform(B,h){return B.join(h)}}return e.\u0275fac=function(B){return new(B||e)},e.\u0275pipe=g.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},575:(Y,j,t)=>{"use strict";t.d(j,{In:()=>g,Ky:()=>B,VC:()=>S,c5:()=>U,gG:()=>e});var g=(()=>{return(h=g||(g={})).FILE_SHOW_LINKS="fileLinks",h.FILE_EDIT="fileEdit",h.DELETE="delete",h.RENAME="rename",h.MOVE="move",g;var h})(),S=(()=>{return(h=S||(S={})).FILE="file",h.FOLDER="folder",S;var h})(),e=(()=>{return(h=e||(e={})).FILENAME="filename",h.SIZE="size",h.TIME="time",h.EXTENSION="ext",e;var h})(),U=(()=>{return(h=U||(U={})).GRID="grid",h.LIST="list",U;var h})(),B=(()=>{return(h=B||(B={})).W_768_I_1="(max-width: 767.98px)",h.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",h.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",h.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",h.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",h.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",h.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",h.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",h.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",h.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",h.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",h.W_3738_I_10="(min-width: 3424px)",B;var h})()},6986:(Y,j,t)=>{"use strict";t.d(j,{C7:()=>U,Mi:()=>B,O8:()=>S,er:()=>h,p0:()=>e,xt:()=>C});var g=t(575);const S=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(_=>(_.maxSize*=1048576,_)),e={lastPath:[],layout:{asc:!0,orderBy:g.gG.FILENAME,type:g.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},U="https://upload.forumfree.net/api/",B=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,h=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,C={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},146:(Y,j,t)=>{"use strict";t.d(j,{r:()=>B});var g=t(7579),S=t(1135),e=t(4650),U=t(8745);let B=(()=>{class h{constructor(_){this.uploadPreferencesService=_,this.selectedFileListArray=[],this.actionSubject=new g.x,this.uploadingFileQueueSubject=new g.x,this.uploadingFileErrorSubject=new g.x,this.currentFolderPathSubject=new g.x,this.layoutOptionsSubject=new g.x,this.renameFileSubject=new g.x,this.entityPendingSubject=new g.x,this.deleteFileSubject=new g.x,this.uploadedFileSubject=new g.x,this.draggedFileListSubject=new g.x,this.startUploadSubject=new g.x,this.selectedFileListSubject=new S.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(_){this.actionSubject.next(_)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(_){this.uploadPreferencesService.layoutOptions=_,this.layoutOptionsSubject.next(_)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(_){this.uploadPreferencesService.lastFolderPath=_,this.currentFolderPathSubject.next(_)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(_){this.uploadingFileQueueSubject.next(_)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(_){this.uploadingFileErrorSubject.next(_)}get renameFileObservable(){return this.renameFileSubject.asObservable()}pushRenameFile(_){this.renameFileSubject.next(_)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(_){this.entityPendingSubject.next(_)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(_){this.deleteFileSubject.next(_)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(_){this.uploadedFileSubject.next(_)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(_){this.draggedFileListSubject.next(_)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(_){this.startUploadSubject.next(_)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(_){if(Array.isArray(_)||(_=[_]),0===_.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let f=!1;for(const O of _){const i=this.selectedFileListArray.findIndex(x=>x.name===O.name);O.selected?-1===i&&(this.selectedFileListArray.push({name:O.name}),f=!0):i>-1&&(this.selectedFileListArray.splice(i,1),f=!0)}f&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return h.\u0275fac=function(_){return new(_||h)(e.LFG(U.p))},h.\u0275prov=e.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},8745:(Y,j,t)=>{"use strict";t.d(j,{p:()=>h});var g=t(5044),S=t(6986),e=t(4650),U=t(2381),B=t(6161);let h=(()=>{class C{constructor(f,O){this.preferencesService=f,this.urlQueryParamsService=O;const i=this.urlQueryParamsService.getAndDeleteParam(g.RT.UPLOAD_PATH);i&&(this.lastFolderPath=i.split("/").filter(x=>x.length>0))}get preferences(){return this.preferencesService.getItem(g.Ye.UPLOAD)||S.p0}set preferences(f){this.preferencesService.setItem(g.Ye.UPLOAD,f)}get lastFolderPath(){return(this.preferences.lastPath||S.p0.lastPath).filter(f=>f.length>0)}set lastFolderPath(f){const O=this.preferences;O.lastPath=f,this.preferences=O}get layoutOptions(){const f=S.p0.layout,O=this.preferences.layout;return O&&0===Object.keys(f).filter(i=>!O.hasOwnProperty(i)).length?O:f}set layoutOptions(f){const O=this.preferences;O.layout=f,this.preferences=O}get uploader(){const f=this.preferences.uploader||S.p0.uploader;return!f.checkImage.active&&Date.now()-f.checkImage.time>6048e5&&(f.checkImage.active=!0,this.uploader=f),f.hasOwnProperty("showLinkModal")||(f.showLinkModal=!1),f}set uploader(f){const O=this.preferences;O.uploader=f,this.preferences=O}}return C.\u0275fac=function(f){return new(f||C)(e.LFG(U.y),e.LFG(B.J))},C.\u0275prov=e.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},7320:(Y,j,t)=>{"use strict";t.d(j,{C:()=>m});var g=t(5861),S=t(7824),e=t(3905),U=t(3848),i=t(6986),x=t(1042),l=t(4650),M=t(5395),s=t(575),p=t(3138);let D=(()=>{class P{constructor(A){this.globalsService=A,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(b=>{this.ffuid=b?b.user.ffuid:""})}getItem(A){const b=this.createKey(A);if(this.cache.hasOwnProperty(b))return this.cache[b]}setItem(A,b){this.cache[this.createKey(A)]=b}removeItem(A){const b=this.createKey(A);if(this.cache.hasOwnProperty(b)){if(this.cache[b].folders.length)for(const L of this.cache[b].folders)this.removeItem([...A,L.name]);return delete this.cache[b],!0}return!1}addEntities(A,b,L=s.VC.FILE){const E=this.createKey(A);return!!this.cache.hasOwnProperty(E)&&(Array.isArray(b)||(b=[b]),L===s.VC.FILE?this.cache[E].files.unshift(...b):this.cache[E].folders.unshift(...b),!0)}removeEntities(A,b,L=s.VC.FILE){const E=this.createKey(A);if(!this.cache.hasOwnProperty(E))return!1;const Q=L===s.VC.FILE?"files":"folders";Array.isArray(b)||(b=[b]);let N=!1;for(const J of b){const X=this.cache[E][Q].findIndex(ee=>ee.name===J);X>-1&&(this.cache[E][Q].splice(X,1),N=!0)}return N}refactorFolderContent(A,b){const L=this.createKey(A);if(!this.cache.hasOwnProperty(L))return!1;b.endsWith("/")||(b+="/");for(const E of this.cache[L].folders)E.url=b+E.name;for(const E of this.cache[L].files)E.url=E.embedUrl=b+E.name,E.time=Date.now();return!0}createKey(A){return`${this.ffuid}/${A.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return P.\u0275fac=function(A){return new(A||P)(l.LFG(p.d))},P.\u0275prov=l.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),P})();var F=t(8745),v=t(529);let m=(()=>{class P{constructor(A,b,L,E){this.graphqlService=A,this.uploadCacheService=b,this.uploadPreferencesService=L,this.http=E}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(S._.HeaderKeys.UUID,(0,x.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(S._.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(S._.HeaderKeys.UUID)||""}getFileList(A,b){var L=this;return(0,g.Z)(function*(){const E=L.uploadCacheService.getItem(A);if(E)return E;const Q=(yield L.graphqlService.query({query:"\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",variables:{scope:b,target:A.join("/")}})).data.uploadEntitiesListToken,N=yield L.sendRequest(Q),X={files:N.files.map(ee=>{const ae=(0,U.Tb)(ee.url);return{...ee,time:1e3*ee.time,filename:ae.filename,ext:ae.ext,isImage:(0,U.Or)(ae.ext),embedUrl:`${ee.url}?t=${ee.time}`}}),folders:N.folders};return L.uploadCacheService.setItem(A,X),X})()}createDirectory(A,b){var L=this;return(0,g.Z)(function*(){const E=(yield L.graphqlService.mutate({mutation:"\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",variables:{scope:b,target:A.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield L.sendRequest(E)})()}moveRenameEntity(A,b,L,E,Q){var N=this;return(0,g.Z)(function*(){E||(E=L);const J=(yield N.graphqlService.mutate({mutation:"\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",variables:{scope:Q,source:(A.length?`${A.join("/")}/`:"")+L,target:(b.length?`${b.join("/")}/`:"")+E}})).data.uploadEntitiesMoveToken;return yield N.sendRequest(J)})()}deleteEntity(A,b,L){var E=this;return(0,g.Z)(function*(){const Q=(yield E.graphqlService.mutate({mutation:"\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",variables:{scope:L,target:(A.length?`${A.join("/")}/`:"")+b}})).data.uploadEntitiesDeleteToken;return yield E.sendRequest(Q),!0})()}getHostToken(A,b,L){var E=this;return(0,g.Z)(function*(){return(yield E.graphqlService.query({query:"\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",variables:{scope:L,target:(A.length?`${A.join("/")}/`:"")+b}})).data.uploadEntitiesHostToken})()}sendRequest(A){var b=this;return(0,g.Z)(function*(){return(yield(0,e.z)(b.http.post(i.C7,JSON.stringify({payload:A}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(A,b){var L=this;return(0,g.Z)(function*(){return yield L.graphqlService.subscribe({query:"\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}",variables:{scope:b}},E=>{if(!E.data?.uploadEntities)return;const Q=JSON.parse(E.data.uploadEntities.eventMessage);if(!Q.payload.customHeaders||!Q.payload.customHeaders.hasOwnProperty(S._.HeaderKeys.UUID)||Q.payload.customHeaders[S._.HeaderKeys.UUID]===L.getGqlIdHeader())return;const N=(Q.payload.content.source||"").split("/"),J=(Q.payload.content.target||"").split("/"),X=J[J.length-1].indexOf(".")>-1;let ee;try{ee=JSON.parse(Q.output).success||""}catch{return}A({type:E.data.uploadEntities.eventType,sourceName:N[N.length-1],sourcePaths:N.slice(0,-1),targetName:J[J.length-1],targetPaths:J.slice(0,-1),isFile:X,output:ee})})})()}getBlobFromUrl(A){var b=this;return(0,g.Z)(function*(){return yield(0,e.z)(b.http.get(A,{responseType:"blob"})).catch(()=>{})})()}}return P.\u0275fac=function(A){return new(A||P)(l.LFG(M.J),l.LFG(D),l.LFG(F.p),l.LFG(v.eN))},P.\u0275prov=l.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),P})()},3848:(Y,j,t)=>{"use strict";t.d(j,{$H:()=>l,JN:()=>f,Lv:()=>h,Or:()=>x,Tb:()=>U,jL:()=>i,rc:()=>M,sT:()=>C,zO:()=>B});var g=t(5861),S=t(575),e=t(6986);function U(s){let p=s;if(s.indexOf("/")>-1){const m=s.split("/");p=m[m.length-1]}const D=p.split("."),F=D[D.length-1].toLowerCase(),v=decodeURIComponent(D.slice(0,-1).join("."));return{ext:F,filename:v,name:`${v}.${F}`}}function B(s){const p=U(s),D=Date.now();return{name:p.name,size:0,time:D,url:s,ext:p.ext,filename:p.filename,isImage:x(p.ext),embedUrl:`${s}?t=${D}`}}function h(s){let p=s;p.endsWith("/")&&(p=p.slice(0,-1));const D=p.split("/");return{name:decodeURIComponent(D[D.length-1])}}function C(s){return _.apply(this,arguments)}function _(){return(_=(0,g.Z)(function*(s){const p=new FileReader,D=new Promise(F=>p.addEventListener("load",()=>F(p.result)));return p.readAsDataURL(s),D})).apply(this,arguments)}function f(s){return O.apply(this,arguments)}function O(){return(O=(0,g.Z)(function*(s){const p=new DataView(yield s.arrayBuffer());if(2303741511===p.getUint32(0)&&218765834===p.getUint32(4)){if(-1===[4,6].indexOf(p.getUint8(25)))return!1;const F=Object.assign(new Image,{src:yield C(s)});yield new Promise(P=>F.addEventListener("load",()=>P(!0)));const v=Object.assign(document.createElement("canvas"),{width:F.width,height:F.height}).getContext("2d");if(!v)return!1;v.imageSmoothingEnabled=!1,v.drawImage(F,0,0);const m=v?.getImageData(0,0,F.width,F.height);if(m)for(let P=0;P<m.data.length;P+=4)if(m.data[P+3]<255)return!0}return!1})).apply(this,arguments)}function i(s){return s.map(p=>({name:p.name,ext:p.ext,type:S.VC.FILE,url:p.url,embedUrl:p.embedUrl,isImage:p.isImage}))}function x(s,p=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(s)&&!p.includes(s)}function l(s){return x(s,["gif","svg"])}function M(s,p,D,F=[],v=""){let m={...e.xt};const P=s.trim();m.invalidLength=0===P.length;const k=(P+v).replace(/\s{2,}/g," ");return m.alreadyUsed=p!==P&&F.includes(k),m.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(s),m.invalidCharacter=!(D===S.VC.FILE?e.Mi.test(s):e.er.test(s)),m}},3612:(Y,j,t)=>{"use strict";t.d(j,{q:()=>p});var g=t(5861),S=t(8896),e=t(6730),U=t.n(e),B=t(9969),h=t(3848),C=t(529),_=t(7579),f=t(7445),O=t(2722),i=t(6986);class x{static findApp1Marker(F){const v=new DataView(F),m=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let P=0;P<F.byteLength-2;P+=2){const k=v.getUint16(P);if(65505===k)return{offset:P,size:v.getUint16(P+2),little:18761==v.getUint16(P+8,!1)};if(m.has(k))break}}static stripAndReturnExif(F){return(0,g.Z)(function*(){const v=yield F.arrayBuffer(),m=x.findApp1Marker(v);return m?{file:new File([v.slice(0,m.offset),v.slice(m.offset+m.size+2)],F.name,{type:F.type,lastModified:F.lastModified}),exif:v.slice(m.offset,m.offset+m.size)}:{file:F}})()}static checkImageOrientation(F){const v=new DataView(F);if(1165519206!=v.getUint32(4,!1))return-1;const m=18761==v.getUint16(10,!1);let P=10;P+=v.getUint32(P+4,m);const k=v.getUint16(P,m);P+=2;for(let A=0;A<k;A++)if(274==v.getUint16(P+12*A,m))return v.getUint16(P+12*A+8,m);return-1}}var l=t(4650),M=t(146),s=t(2020);let p=(()=>{class D{constructor(v,m,P){this.http=v,this.uploadObservablesService=m,this.loadImageService=P,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return{...this.uploaderOptionsObject}}set uploaderOptions(v){this.uploaderOptionsObject={...v}}compressFileIfNeeded(v,m){return(0,g.Z)(function*(){let P=["image/png","image/jpeg"],k={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};m&&(P.push("image/webp"),k.width=m.width,k.height=m.height,k.resize="cover",k.strict=!1);const A=v.type.toLowerCase();return v.size<=4e6&&void 0===m||-1===P.indexOf(v.type.toLowerCase())?v:("image/png"===A&&(yield(0,h.JN)(v))&&(k.convertSize=1/0),new Promise((b,L)=>{new(U())(v,{...k,success:E=>{const Q=E instanceof Blob?new File([E],v.name,{type:v.type,lastModified:v.lastModified}):v;b(Q)},error:L})}))})()}orientFileIfNeeded(v){var m=this;return(0,g.Z)(function*(){if(-1===["image/jpeg"].indexOf(v.type.toLowerCase()))return v;const k=yield x.stripAndReturnExif(v);if(v=k.file,k.exif){const A=x.checkImageOrientation(k.exif);if(1!==A){let b=0;switch(A){case 3:case 4:b=180;break;case 5:case 6:b=90;break;case 7:case 8:b=270}const L=yield(0,h.sT)(v),E=yield new Promise((N,J)=>{const X=new Image;X.onload=()=>N({originalImage:X,originalBase64:L}),X.onerror=J,X.src=L}),Q=yield m.loadImageService.transformLoadedImage({original:{base64:E.originalBase64,image:E.originalImage,size:{width:E.originalImage.naturalWidth,height:E.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(A),rotate:b/90}},new B.R);v=new File([(0,S.L)(Q.transformed.base64)],v.name,{type:v.type,lastModified:Date.now()})}}return v})()}upload(v,m,P,k=!1){const A=new _.x,b=new FormData;b.append("payload",P),b.append("upload",v,v.name),k&&b.append("allowOverwrite","1");const L=this.http.request(new C.aW("POST",i.C7,b,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(L.subscribe({next:E=>{if(E.type===C.dt.UploadProgress){if(!E.total||(m.progress=Math.round(50*E.loaded/E.total)+20,m.progress<70))return;(0,f.F)(1e3).pipe((0,O.R)(A.asObservable())).subscribe(()=>{if(m.progress<95){const Q=Math.round(8*Math.random()+8);m.progress+Q>95?m.progress=95:m.progress+=Q}})}else if(E instanceof C.Zn){if(m.progress=100,m.completed=!0,E.body?.error||!E.body?.success)m.error=!0,this.uploadObservablesService.pushUploadingFileError(m);else{m.file.url=E.body.success.url,m.file.time=Date.now(),m.file.embedUrl=`${m.file.url}?t=${m.file.time}`;const Q=(0,h.Tb)(m.file.url);m.file.name=Q.name,m.file.filename=Q.filename}A.next(),A.complete()}},error:()=>{m.error=!0,this.uploadObservablesService.pushUploadingFileError(m),A.next(),A.complete()}})),A.asObservable()}clearPendingRequests(){for(const v of this.requestSubscriptions)v.unsubscribe();this.requestSubscriptions=[]}}return D.\u0275fac=function(v){return new(v||D)(l.LFG(C.eN),l.LFG(M.r),l.LFG(s.y))},D.\u0275prov=l.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})()},6730:function(Y){Y.exports=function(){"use strict";function j(y,r){var o=Object.keys(y);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(y);r&&(c=c.filter(function(R){return Object.getOwnPropertyDescriptor(y,R).enumerable})),o.push.apply(o,c)}return o}function t(y){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?j(Object(o),!0).forEach(function(c){U(y,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(o)):j(Object(o)).forEach(function(c){Object.defineProperty(y,c,Object.getOwnPropertyDescriptor(o,c))})}return y}function S(y,r){for(var o=0;o<r.length;o++){var c=r[o];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(y,c.key,c)}}function U(y,r,o){return r in y?Object.defineProperty(y,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):y[r]=o,y}function B(){return B=Object.assign||function(y){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(y[c]=o[c])}return y},B.apply(this,arguments)}var y,r,o,c,R,T,H,K,h={exports:{}};y=h,typeof window>"u"||(r=window,o=r.HTMLCanvasElement&&r.HTMLCanvasElement.prototype,c=r.Blob&&function(){try{return Boolean(new Blob)}catch{return!1}}(),R=c&&r.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch{return!1}}(),T=r.BlobBuilder||r.WebKitBlobBuilder||r.MozBlobBuilder||r.MSBlobBuilder,H=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,K=(c||T)&&r.atob&&r.ArrayBuffer&&r.Uint8Array&&function(d){var w,a,u,n,W,I,$,z,te;if(!(w=d.match(H)))throw new Error("invalid data URI");for(a=w[2]?w[1]:"text/plain"+(w[3]||";charset=US-ASCII"),u=!!w[4],n=d.slice(w[0].length),W=u?atob(n):decodeURIComponent(n),I=new ArrayBuffer(W.length),$=new Uint8Array(I),z=0;z<W.length;z+=1)$[z]=W.charCodeAt(z);return c?new Blob([R?$:I],{type:a}):((te=new T).append(I),te.getBlob(a))},r.HTMLCanvasElement&&!o.toBlob&&(o.mozGetAsFile?o.toBlob=function(d,w,a){var u=this;setTimeout(function(){d(a&&o.toDataURL&&K?K(u.toDataURL(w,a)):u.mozGetAsFile("blob",w))})}:o.toDataURL&&K&&(o.toBlob=o.msToBlob?function(d,w,a){var u=this;setTimeout(function(){d((w&&"image/png"!==w||a)&&o.toDataURL&&K?K(u.toDataURL(w,a)):u.msToBlob(w))})}:function(d,w,a){var u=this;setTimeout(function(){d(K(u.toDataURL(w,a)))})})),y.exports?y.exports=K:r.dataURLtoBlob=K);var C=h.exports,f={strict:!0,checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},i=typeof window<"u"&&typeof window.document<"u"?window:{},x=function(r){return r>0&&r<1/0},l=Array.prototype.slice;function M(y){return Array.from?Array.from(y):l.call(y)}var s=/^image\/.+$/;function p(y){return s.test(y)}var F=String.fromCharCode;var m=i.btoa;function k(y){var o,r=new DataView(y);try{var c,R,T;if(255===r.getUint8(0)&&216===r.getUint8(1))for(var H=r.byteLength,K=2;K+1<H;){if(255===r.getUint8(K)&&225===r.getUint8(K+1)){R=K;break}K+=1}if(R){var w=R+10;if("Exif"===function v(y,r,o){var R,c="";for(o+=r,R=r;R<o;R+=1)c+=F(y.getUint8(R));return c}(r,R+4,4)){var a=r.getUint16(w);if(((c=18761===a)||19789===a)&&42===r.getUint16(w+2,c)){var u=r.getUint32(w+4,c);u>=8&&(T=w+u)}}}if(T){var W,I,n=r.getUint16(T,c);for(I=0;I<n;I+=1)if(274===r.getUint16(W=T+12*I+2,c)){o=r.getUint16(W+=8,c),r.setUint16(W,1,c);break}}}catch{o=1}return o}var b=/\.\d*(?:0|9){12}\d*$/;function L(y){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return b.test(y)?Math.round(y*r)/r:y}function E(y){var r=y.aspectRatio,o=y.height,c=y.width,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",T=x(c),H=x(o);if(T&&H){var K=o*r;("contain"===R||"none"===R)&&K>c||"cover"===R&&K<c?o=c/r:c=o*r}else T?o=c/r:H&&(c=o*r);return{width:c,height:o}}var Q=i.ArrayBuffer,N=i.FileReader,J=i.URL||i.webkitURL,X=/\.\w+$/,ee=i.Compressor;return function(){function y(r,o){(function g(y,r){if(!(y instanceof r))throw new TypeError("Cannot call a class as a function")})(this,y),this.file=r,this.image=new Image,this.options=t(t({},f),o),this.aborted=!1,this.result=null,this.init()}return function e(y,r,o){return r&&S(y.prototype,r),o&&S(y,o),y}(y,[{key:"init",value:function(){var o=this,c=this.file,R=this.options;if(function(r){return!(typeof Blob>"u")&&(r instanceof Blob||"[object Blob]"===Object.prototype.toString.call(r))}(c)){var T=c.type;if(p(T))if(J&&N)if(Q||(R.checkOrientation=!1),J&&!R.checkOrientation)this.load({url:J.createObjectURL(c)});else{var H=new N,K=R.checkOrientation&&"image/jpeg"===T;this.reader=H,H.onload=function(d){var a=d.target.result,u={};if(K){var n=k(a);n>1||!J?(u.url=function P(y,r){for(var o=[],R=new Uint8Array(y);R.length>0;)o.push(F.apply(null,M(R.subarray(0,8192)))),R=R.subarray(8192);return"data:".concat(r,";base64,").concat(m(o.join("")))}(a,T),n>1&&B(u,function A(y){var r=0,o=1,c=1;switch(y){case 2:o=-1;break;case 3:r=-180;break;case 4:c=-1;break;case 5:r=90,c=-1;break;case 6:r=90;break;case 7:r=90,o=-1;break;case 8:r=-90}return{rotate:r,scaleX:o,scaleY:c}}(n))):u.url=J.createObjectURL(c)}else u.url=a;o.load(u)},H.onabort=function(){o.fail(new Error("Aborted to read the image with FileReader."))},H.onerror=function(){o.fail(new Error("Failed to read the image with FileReader."))},H.onloadend=function(){o.reader=null},K?H.readAsArrayBuffer(c):H.readAsDataURL(c)}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(o){var c=this,R=this.file,T=this.image;T.onload=function(){c.draw(t(t({},o),{},{naturalWidth:T.naturalWidth,naturalHeight:T.naturalHeight}))},T.onabort=function(){c.fail(new Error("Aborted to load the image."))},T.onerror=function(){c.fail(new Error("Failed to load the image."))},i.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(i.navigator.userAgent)&&(T.crossOrigin="anonymous"),T.alt=R.name,T.src=o.url}},{key:"draw",value:function(o){var c=this,R=o.naturalWidth,T=o.naturalHeight,H=o.rotate,K=void 0===H?0:H,d=o.scaleX,w=void 0===d?1:d,a=o.scaleY,u=void 0===a?1:a,n=this.file,W=this.image,I=this.options,$=document.createElement("canvas"),z=$.getContext("2d"),te=Math.abs(K)%180==90,oe=("contain"===I.resize||"cover"===I.resize)&&x(I.width)&&x(I.height),re=Math.max(I.maxWidth,0)||1/0,Z=Math.max(I.maxHeight,0)||1/0,G=Math.max(I.minWidth,0)||0,ne=Math.max(I.minHeight,0)||0,ie=R/T,V=I.width,q=I.height;if(te){var ue=[Z,re];re=ue[0],Z=ue[1];var de=[ne,G];G=de[0],ne=de[1];var pe=[q,V];V=pe[0],q=pe[1]}oe&&(ie=V/q);var he=E({aspectRatio:ie,width:re,height:Z},"contain");re=he.width,Z=he.height;var fe=E({aspectRatio:ie,width:G,height:ne},"cover");if(G=fe.width,ne=fe.height,oe){var ge=E({aspectRatio:ie,width:V,height:q},I.resize);V=ge.width,q=ge.height}else{var me=E({aspectRatio:ie,width:V,height:q}),ve=me.width;V=void 0===ve?R:ve;var _e=me.height;q=void 0===_e?T:_e}var Ue=-(V=Math.floor(L(Math.min(Math.max(V,G),re))))/2,Me=-(q=Math.floor(L(Math.min(Math.max(q,ne),Z))))/2,we=V,Ce=q,se=[];if(oe){var le,ce,Ee=E({aspectRatio:ie,width:R,height:T},{contain:"cover",cover:"contain"}[I.resize]);se.push((R-(le=Ee.width))/2,(T-(ce=Ee.height))/2,le,ce)}if(se.push(Ue,Me,we,Ce),te){var ye=[q,V];V=ye[0],q=ye[1]}$.width=V,$.height=q,p(I.mimeType)||(I.mimeType=n.type);var xe="transparent";if(n.size>I.convertSize&&I.convertTypes.indexOf(I.mimeType)>=0&&(I.mimeType="image/jpeg"),"image/jpeg"===I.mimeType&&(xe="#fff"),z.fillStyle=xe,z.fillRect(0,0,V,q),I.beforeDraw&&I.beforeDraw.call(this,z,$),!this.aborted&&(z.save(),z.translate(V/2,q/2),z.rotate(K*Math.PI/180),z.scale(w,u),z.drawImage.apply(z,[W].concat(se)),z.restore(),I.drew&&I.drew.call(this,z,$),!this.aborted)){var Oe=function(Pe){c.aborted||c.done({naturalWidth:R,naturalHeight:T,result:Pe})};$.toBlob?$.toBlob(Oe,I.mimeType,I.quality):Oe(C($.toDataURL(I.mimeType,I.quality)))}}},{key:"done",value:function(o){var c=o.naturalWidth,R=o.naturalHeight,T=o.result,H=this.file,d=this.options;if(J&&!d.checkOrientation&&J.revokeObjectURL(this.image.src),T)if(d.strict&&T.size>H.size&&d.mimeType===H.type&&!(d.width>c||d.height>R||d.minWidth>c||d.minHeight>R||d.maxWidth<c||d.maxHeight<R))T=H;else{var w=new Date;T.lastModified=w.getTime(),T.lastModifiedDate=w,T.name=H.name,T.name&&T.type!==H.type&&(T.name=T.name.replace(X,function D(y){var r=p(y)?y.substr(6):"";return"jpeg"===r&&(r="jpg"),".".concat(r)}(T.type)))}else T=H;this.result=T,d.success&&d.success.call(this,T)}},{key:"fail",value:function(o){var c=this.options;if(!c.error)throw o;c.error.call(this,o)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ee,y}},{key:"setDefaults",value:function(o){B(f,o)}}]),y}()}()},7445:(Y,j,t)=>{"use strict";t.d(j,{F:()=>e});var g=t(4986),S=t(5963);function e(U=0,B=g.z){return U<0&&(U=0),(0,S.H)(U,U,B)}},1042:(Y,j,t)=>{"use strict";t.d(j,{Z:()=>x});var g,S=new Uint8Array(16);function e(){if(!g&&!(g=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(S)}const U=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,h=function B(l){return"string"==typeof l&&U.test(l)};for(var C=[],_=0;_<256;++_)C.push((_+256).toString(16).substr(1));const x=function i(l,M,s){var p=(l=l||{}).random||(l.rng||e)();if(p[6]=15&p[6]|64,p[8]=63&p[8]|128,M){s=s||0;for(var D=0;D<16;++D)M[s+D]=p[D];return M}return function f(l){var M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(C[l[M+0]]+C[l[M+1]]+C[l[M+2]]+C[l[M+3]]+"-"+C[l[M+4]]+C[l[M+5]]+"-"+C[l[M+6]]+C[l[M+7]]+"-"+C[l[M+8]]+C[l[M+9]]+"-"+C[l[M+10]]+C[l[M+11]]+C[l[M+12]]+C[l[M+13]]+C[l[M+14]]+C[l[M+15]]).toLowerCase();if(!h(s))throw TypeError("Stringified UUID is invalid");return s}(p)}}}]);