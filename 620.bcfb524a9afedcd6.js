(self.webpackChunkboard=self.webpackChunkboard||[]).push([[620],{9969:(V,B,t)=>{"use strict";t.d(B,{R:()=>h});class h{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(O=>O in this).forEach(O=>this[O]=e[O]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(O=>O in this).forEach(O=>this[O]=e[O].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},2020:(V,B,t)=>{"use strict";t.d(B,{y:()=>n});var h=t(5861);var _=t(4650);let n=(()=>{class l{constructor(){this.autoRotateSupported=function e(){return new Promise(l=>{const f=new Image;f.onload=()=>{l(1===f.width&&2===f.height)},f.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(r,E){return new Promise((d,b)=>{const P=new FileReader;P.onload=L=>{this.loadImage(L.target.result,r.type,E).then(d).catch(b)},P.readAsDataURL(r)})}loadImage(r,E,d){return this.isValidImageType(E)?this.loadBase64Image(r,d):Promise.reject(new Error("Invalid image type"))}isValidImageType(r){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(r)}loadImageFromURL(r,E){return new Promise((d,b)=>{const P=new Image;P.onerror=()=>b,P.onload=()=>{const L=document.createElement("canvas"),Q=L.getContext("2d");L.width=P.width,L.height=P.height,Q?.drawImage(P,0,0),this.loadBase64Image(L.toDataURL(),E).then(d)},P.crossOrigin="anonymous",P.src=r})}loadBase64Image(r,E){return new Promise((d,b)=>{const P=new Image;P.onload=()=>d({originalImage:P,originalBase64:r}),P.onerror=b,P.src=r}).then(d=>this.transformImageBase64(d,E))}transformImageBase64(r,E){var d=this;return(0,h.Z)(function*(){const b=yield d.autoRotateSupported,P=yield function O(l){switch("string"==typeof l&&(l=function w(l){const f=new DataView(function v(l){l=l.replace(/^data\:([^\;]+)\;base64,/gim,"");const f=atob(l),r=f.length,E=new Uint8Array(r);for(let d=0;d<r;d++)E[d]=f.charCodeAt(d);return E.buffer}(l));if(65496!==f.getUint16(0,!1))return-2;const r=f.byteLength;let E=2;for(;E<r;){if(f.getUint16(E+2,!1)<=8)return-1;const d=f.getUint16(E,!1);if(E+=2,65505==d){if(1165519206!==f.getUint32(E+=2,!1))return-1;const b=18761==f.getUint16(E+=6,!1);E+=f.getUint32(E+4,b);const P=f.getUint16(E,b);E+=2;for(let L=0;L<P;L++)if(274==f.getUint16(E+12*L,b))return f.getUint16(E+12*L+8,b)}else{if(65280!=(65280&d))break;E+=f.getUint16(E,!1)}}return-1}(l)),l){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(b?-1:r.originalBase64);return r.originalImage&&r.originalImage.complete?d.transformLoadedImage({original:{base64:r.originalBase64,image:r.originalImage,size:{width:r.originalImage.naturalWidth,height:r.originalImage.naturalHeight}},exifTransform:P},E):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(r,E){var d=this;return(0,h.Z)(function*(){const b=E.canvasRotation+r.exifTransform.rotate,P={width:r.original.image.naturalWidth,height:r.original.image.naturalHeight};if(0===b&&!r.exifTransform.flip&&!E.containWithinAspectRatio)return{original:{base64:r.original.base64,image:r.original.image,size:{...P}},transformed:{base64:r.original.base64,image:r.original.image,size:{...P}},exifTransform:r.exifTransform};const L=d.getTransformedSize(P,r.exifTransform,E),Q=document.createElement("canvas");Q.width=L.width,Q.height=L.height;const A=Q.getContext("2d");A?.setTransform(r.exifTransform.flip?-1:1,0,0,1,Q.width/2,Q.height/2),A?.rotate(Math.PI*(b/2)),A?.drawImage(r.original.image,-P.width/2,-P.height/2);const a=Q.toDataURL(),u=yield d.loadImageFromBase64(a);return{original:{base64:r.original.base64,image:r.original.image,size:{...P}},transformed:{base64:a,image:u,size:{width:u.width,height:u.height}},exifTransform:r.exifTransform}})()}loadImageFromBase64(r){return new Promise((E,d)=>{const b=new Image;b.onload=()=>E(b),b.onerror=d,b.src=r})}getTransformedSize(r,E,d){const b=d.canvasRotation+E.rotate;if(d.containWithinAspectRatio){if(b%2){const L=r.height/d.aspectRatio;return{width:Math.max(r.height,r.width*d.aspectRatio),height:Math.max(r.width,L)}}{const L=r.width/d.aspectRatio;return{width:Math.max(r.width,r.height*d.aspectRatio),height:Math.max(r.height,L)}}}return b%2?{height:r.width,width:r.height}:{width:r.width,height:r.height}}}return l.\u0275fac=function(r){return new(r||l)},l.\u0275prov=_.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()},8896:(V,B,t)=>{"use strict";function h(U){const e=U.split(","),O=e[0].replace("data:","").replace(";base64",""),w=atob(e[1]),v=new ArrayBuffer(w.length),_=new Uint8Array(v);for(let n=0;n<w.length;n+=1)_[n]=w.charCodeAt(n);return new Blob([v],{type:O})}t.d(B,{L:()=>h})},1891:(V,B,t)=>{"use strict";t.d(B,{B:()=>k});var h=t(5861),U=t(1309),e=t(4650),O=t(4968),w=t(3905),v=t(3848),_=t(1460),n=t(4323),l=t(6986),f=t(575),r=t(7693),E=t(3207),d=t(146),b=t(3612),P=t(6378),L=t(6895),Q=t(433),A=t(4029),a=t(8279),u=t(3450),T=t(8212);const x=["fileInput"];function M(m,C){1&m&&(e.O4$(),e.TgZ(0,"svg",23),e._UZ(1,"path",24)(2,"path",25),e.qZA())}const D=function(){return["text-primary"]};function j(m,C){1&m&&e._UZ(0,"app-logo",26),2&m&&e.Q6J("svgClass",e.DdM(2,D))("responsive",!1)}function W(m,C){1&m&&(e.TgZ(0,"span"),e._uU(1,"Trascina i file da caricare oppure c"),e.qZA())}function J(m,C){1&m&&(e.TgZ(0,"span"),e._uU(1,"C"),e.qZA())}function ne(m,C){if(1&m&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2,"I file verranno caricati nella cartella "),e.qZA(),e._UZ(3,"em",27),e.ALo(4,"arrayJoin"),e.BQk()),2&m){const s=e.oxw(2);e.xp6(3),e.Q6J("innerText",s.currentFolderPath.length?e.xi3(4,1,s.currentFolderPath,"/"):"root")}}function N(m,C){if(1&m&&(e._UZ(0,"div",32),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&m){const s=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,s.currentFolderPath,0,-1),"/"))}}function Y(m,C){if(1&m&&(e.TgZ(0,"div",28)(1,"div",29),e._uU(2,"Cartella:"),e.qZA(),e.YNc(3,N,3,8,"div",30),e._UZ(4,"div",31),e.ALo(5,"arrayJoin"),e.ALo(6,"slice"),e.qZA()),2&m){const s=e.oxw(2);e.xp6(3),e.Q6J("ngIf",s.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(s.currentFolderPath.length>1?"/":"")+(s.currentFolderPath.length?e.xi3(5,2,e.xi3(6,5,s.currentFolderPath,s.currentFolderPath.length-1),"/"):"root"))}}const ie=function(){return{bottom:0,left:0}};function oe(m,C){if(1&m){const s=e.EpF();e.ynx(0),e.TgZ(1,"a",33),e.NdJ("click",function(){e.CHM(s);const o=e.oxw(2);return e.KtG(o.openInfoModal.emit())}),e._uU(2,"Informazioni"),e.qZA(),e.TgZ(3,"div",34),e.NdJ("click",function(){e.CHM(s),e.oxw(2);const o=e.MAs(7);return e.KtG(o.open())}),e._uU(4,"settings"),e.qZA(),e.BQk()}2&m&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(1,ie)))}const y=function(m,C,s){return{"cursor-pointer":m,"p-4":C,"p-2 pb-3":s}},i=function(m,C){return{"fw-bold fs-lg":m,small:C}},c=function(m,C,s){return{"my-2":m,"mb-2":C,"mw-100":s}};function p(m,C){if(1&m){const s=e.EpF();e.ynx(0),e.TgZ(1,"div",15,16),e.NdJ("dragenter",function(){e.CHM(s);const o=e.MAs(2),F=e.oxw();return e.KtG(F.setDragOverEvent(o))})("drop",function(o){e.CHM(s);const F=e.oxw();return e.KtG(F.handleDropEvent(o))})("click",function(){e.CHM(s),e.oxw();const o=e.MAs(2);return e.KtG(o.click())}),e.YNc(3,M,3,0,"svg",17),e.YNc(4,j,1,3,"ng-template",null,18,e.W1O),e.TgZ(6,"div",19),e.YNc(7,W,2,0,"span",20),e.YNc(8,J,2,0,"span",20),e.TgZ(9,"span"),e._uU(10,"licca per scegliere da memoria"),e.qZA()(),e.TgZ(11,"div",21),e.YNc(12,ne,5,4,"ng-container",3),e.YNc(13,Y,7,8,"ng-template",null,22,e.W1O),e.qZA()(),e.YNc(15,oe,5,2,"ng-container",20),e.BQk()}if(2&m){const s=e.MAs(5),g=e.MAs(14),o=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(10,y,!o.loading,!o.isWidget,o.isWidget)),e.xp6(2),e.Q6J("ngIf",!o.isWidget)("ngIfElse",s),e.xp6(3),e.Q6J("ngClass",e.WLB(14,i,!o.isWidget,o.isWidget)),e.xp6(1),e.Q6J("ngIf",!o.touchDevice),e.xp6(1),e.Q6J("ngIf",o.touchDevice),e.xp6(3),e.Q6J("ngClass",e.kEZ(17,c,!o.isWidget&&!o.touchDevice,!o.isWidget&&o.touchDevice,o.isWidget)),e.xp6(1),e.Q6J("ngIf",!o.isWidget)("ngIfElse",g),e.xp6(3),e.Q6J("ngIf",!o.isWidget)}}const R=function(m,C){return{"p-4":m,"p-2":C}};function S(m,C){if(1&m&&(e.TgZ(0,"div",35),e.O4$(),e.TgZ(1,"svg",36),e._UZ(2,"path",37),e.qZA(),e.kcU(),e._UZ(3,"app-loader",38),e.TgZ(4,"div",39),e._uU(5,"Attendi il completamento dell'upload per caricare altre immagini."),e.qZA()()),2&m){const s=e.oxw();e.Q6J("ngClass",e.WLB(3,R,!s.isWidget,s.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",s.loadingMessage)}}const z=function(m,C){return{uploading:m,"widget flex-grow-1":C}};let k=(()=>{class m{constructor(s,g,o,F,I,H,K){this.postMessageService=s,this.uploadService=g,this.uploadObservablesService=o,this.uploaderService=F,this.toastService=I,this.renderer=H,this.ngZone=K,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="Controllo dei file in corso",this.touchDevice=_.eX,this.dragOverEvent=!1,this.options=this.uploaderService.uploaderOptions;const q=this.uploadService.preferences.uploader;q.checkImage.active||(this.options.compress=!1),q.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){this.handleClipboardPasteEvent(),this.handleExternalUpload()}handleClipboardPasteEvent(){var s=this;this.clipboardPasteEventSubscription=(0,O.R)(document.body,"paste").subscribe(function(){var g=(0,h.Z)(function*(o){if(!s.canUpload)return;const F=Array.from((o.clipboardData||o.originalEvent.clipboardData).items);let I=[];for(const H of F)if(0===H.type.indexOf("image")){const K=H.getAsFile();K&&I.push(K)}I.length>0?yield s.preUpload(I):s.reset()});return function(o){return g.apply(this,arguments)}}())}handleExternalUpload(){var s=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var g=(0,h.Z)(function*(o){if(o){if(!s.canUpload)return;yield s.preUpload([o.file],o.options)}else s.fileInputRef.nativeElement.click()});return function(o){return g.apply(this,arguments)}}())}handleSelectionEvent(s){var g=this;return(0,h.Z)(function*(){if(!g.canUpload)return;const o=s.target;if(o.files&&o.files.length){const F=Array.from(o.files);return o.value="",g.preUpload(F)}g.reset()})()}handleDropEvent(s){var g=this;return(0,h.Z)(function*(){if(s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation(),!g.canUpload)return;const o=s.dataTransfer?.files?Array.from(s.dataTransfer.files):[];if(o.length)return g.preUpload(o);g.reset()})()}saveOptions(s=!0){this.uploaderService.uploaderOptions=this.options,s&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(s){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(s,"dragover",g=>{g.preventDefault()})}))}get canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage="Controllo dei file da caricare",this.postMessageService.send(n.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(s,g){var o=this;return(0,h.Z)(function*(){const F=[...o.currentFolderPath];let I=[],H=[],K=[],q=[];g?g.allowOverwrite=g.allowOverwrite||!1:(g=o.uploaderService.uploaderOptions).allowOverwrite=!1;for(let Z=0;Z<s.length;Z++){let $=g.compress?yield o.uploaderService.compressFileIfNeeded(s[Z],g.imageDimensions):s[Z];if($=yield o.uploaderService.orientFileIfNeeded($),$){const te=(0,v.Tb)($.name),re=l.O8.find(G=>-1!==G.ext.indexOf(te.ext));if(!re){K.push($);continue}if($.size>re.maxSize){q.push($);continue}I.push({file:{name:$.name,size:$.size,time:0,url:"",ext:te.ext,filename:te.filename,isImage:(0,v.Or)(te.ext),embedUrl:"",type:f.VC.FILE},progress:0,completed:!1}),H.push($)}}if((K.length||q.length)&&(o.toastService.show({content:o.createToastMessage(K,q),level:U.m.ERROR}),[["UNSUPPORTED",K],["OVERSIZED",q]].forEach(Z=>{Z[1].forEach($=>{o.postMessageService.send(n.l.UPLOAD_ERROR,{filename:$.name,error:Z[0]})})})),0===H.length)return void o.reset();const ae=`Caricamento file {{fileNumber}} di ${H.length} in corso`;o.uploadObservablesService.pushUploadingFileQueue(I);for(let Z=0;Z<H.length;++Z){o.loadingMessage="Creazione del pacchetto da inviare";const $=yield o.uploadService.getHostToken(F,H[Z].name);I[Z].progress+=20,o.loadingMessage=ae.replace("{{fileNumber}}",`${Z+1}`),yield(0,w.z)(o.uploaderService.upload(H[Z],I[Z],$,g.allowOverwrite))}o.uploadObservablesService.pushUploadingFileQueue([]);const ee=I.filter(Z=>!Z.error).map(Z=>Z.file);ee.length>0&&(o.fileUploadedEvent.emit({list:ee,rewrite:g.allowOverwrite,destPath:F}),o.postMessageService.send(n.l.UPLOAD_SUCCESS,{fileList:ee.map(Z=>({filename:Z.name,isImage:Z.isImage,url:Z.url}))}),g.openLinkModalAfterUpload&&o.uploadObservablesService.pushAction({name:f.In.FILE_SHOW_LINKS,payload:{entities:(0,v.jL)(ee)}})),o.reset()})()}createToastMessage(s,g){let o=[];return s.length&&o.push(s.length>1?`I file <strong>${s.map(F=>F.name).join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${s[0].name}</strong> ha un formato non supportato!`),g.length&&o.push(g.length>1?`I file <strong>${g.map(F=>F.name).join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${g[0].name}</strong> \xe8 troppo pesante!`),o.join("<br><br>")}ngOnDestroy(){this.startExternalUploadSubscription?.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return m.\u0275fac=function(s){return new(s||m)(e.Y36(r.F),e.Y36(E.C),e.Y36(d.r),e.Y36(b.q),e.Y36(P.k),e.Y36(e.Qsj),e.Y36(e.R0b))},m.\u0275cmp=e.Xpm({type:m,selectors:[["app-uploader"]],viewQuery:function(s,g){if(1&s&&e.Gf(x,5),2&s){let o;e.iGM(o=e.CRH())&&(g.fileInputRef=o.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:30,vars:10,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],["title","Opzioni di caricamento"],["optionsModal",""],[1,"mb-1"],[1,"mb-3"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto"],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],[1,"description","text-center",3,"ngClass"],[4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","options-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"]],template:function(s,g){if(1&s&&(e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(F){return g.handleSelectionEvent(F)}),e.qZA(),e.YNc(3,p,16,21,"ng-container",3),e.YNc(4,S,6,6,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6)(8,"p",7),e._uU(9,"Tramite questo modal \xe8 possibile gestire le opzioni di caricamento al momento disponibili:"),e.qZA(),e.TgZ(10,"ul",8)(11,"li")(12,"em"),e._uU(13,"caricamento veloce"),e.qZA(),e._uU(14,": abilitando questa opzione, l'immagine da caricare verr\xe0 adattata per terminare l'operazione di upload nel minor tempo possibile. "),e.qZA(),e.TgZ(15,"li")(16,"em"),e._uU(17,"mostra link dopo l'upload"),e.qZA(),e._uU(18,": abilitando questa opzione, una volta terminato il caricamento verr\xe0 aperto il modal contenente i link utili dei file caricati. "),e.qZA()(),e.TgZ(19,"ul",9)(20,"li")(21,"div",10)(22,"input",11),e.NdJ("ngModelChange",function(F){return g.options.compress=F})("ngModelChange",function(){return g.saveOptions()}),e.qZA(),e.TgZ(23,"label",12),e._uU(24,"Caricamento veloce"),e.qZA()()(),e.TgZ(25,"li")(26,"div",10)(27,"input",13),e.NdJ("ngModelChange",function(F){return g.options.openLinkModalAfterUpload=F})("ngModelChange",function(){return g.saveOptions()}),e.qZA(),e.TgZ(28,"label",14),e._uU(29,"Mostra link dopo l'upload"),e.qZA()()()()()),2&s){const o=e.MAs(5);e.Q6J("ngClass",e.WLB(7,z,g.isUploading,g.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",g.loading||g.isUploading),e.xp6(2),e.Q6J("ngIf",!g.isUploading)("ngIfElse",o),e.xp6(19),e.Q6J("ngModel",g.options.compress),e.xp6(5),e.Q6J("ngModel",g.options.openLinkModalAfterUpload)}},dependencies:[L.mk,L.O5,L.PC,Q.Wl,Q.JJ,Q.On,A.R,a.R,u.z,T.J,L.OU],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864FE;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:400px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.options-icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{top:5px;right:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]:hover{opacity:1}.upload-area[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo){pointer-events:none}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),m})()},1197:(V,B,t)=>{"use strict";t.d(B,{M:()=>n});var h=t(8694),U=t(6895),e=t(433),O=t(6818),w=t(1043),v=t(582),_=t(4650);let n=(()=>{class l{}return l.\u0275fac=function(r){return new(r||l)},l.\u0275mod=_.oAB({type:l}),l.\u0275inj=_.cJS({imports:[h.r,U.ez,e.u5,O.q,w.h,v.z]}),l})()},8694:(V,B,t)=>{"use strict";t.d(B,{r:()=>e});var h=t(6895),U=t(4650);let e=(()=>{class O{}return O.\u0275fac=function(v){return new(v||O)},O.\u0275mod=U.oAB({type:O}),O.\u0275inj=U.cJS({imports:[h.ez]}),O})()},8212:(V,B,t)=>{"use strict";t.d(B,{J:()=>U});var h=t(4650);let U=(()=>{class e{transform(w,v){return w.join(v)}}return e.\u0275fac=function(w){return new(w||e)},e.\u0275pipe=h.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},575:(V,B,t)=>{"use strict";t.d(B,{In:()=>h,Ky:()=>w,VC:()=>U,c5:()=>O,gG:()=>e});var h=(()=>{return(v=h||(h={})).FILE_SHOW_LINKS="fileLinks",v.FILE_EDIT="fileEdit",v.DELETE="delete",v.RENAME="rename",v.MOVE="move",h;var v})(),U=(()=>{return(v=U||(U={})).FILE="file",v.FOLDER="folder",U;var v})(),e=(()=>{return(v=e||(e={})).FILENAME="filename",v.SIZE="size",v.TIME="time",v.EXTENSION="ext",e;var v})(),O=(()=>{return(v=O||(O={})).GRID="grid",v.LIST="list",O;var v})(),w=(()=>{return(v=w||(w={})).W_768_I_1="(max-width: 767.98px)",v.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",v.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",v.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",v.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",v.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",v.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",v.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",v.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",v.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",v.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",v.W_3738_I_10="(min-width: 3424px)",w;var v})()},6986:(V,B,t)=>{"use strict";t.d(B,{C7:()=>O,Mi:()=>w,O8:()=>U,er:()=>v,p0:()=>e,xt:()=>_});var h=t(575);const U=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(n=>(n.maxSize*=1048576,n)),e={lastPath:[],layout:{asc:!0,orderBy:h.gG.FILENAME,type:h.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},O="https://upload.forumfree.net/api/",w=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,v=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,_={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},3124:(V,B,t)=>{"use strict";t.d(B,{B:()=>O});var h=t(575),U=t(4650),e=t(3138);let O=(()=>{class w{constructor(_){this.globalsService=_,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(n=>{this.ffuid=n?n.user.ffuid:""})}getItem(_){const n=this.createKey(_);if(this.cache.hasOwnProperty(n))return this.cache[n]}setItem(_,n){this.cache[this.createKey(_)]=n}removeItem(_){const n=this.createKey(_);if(this.cache.hasOwnProperty(n)){if(this.cache[n].folders.length)for(const l of this.cache[n].folders)this.removeItem([..._,l.name]);return delete this.cache[n],!0}return!1}getEntities(_,n){let l={};const f=this.createKey(_);if(!this.cache.hasOwnProperty(f))return l;for(const r of n){const E=(r.type===h.VC.FILE?this.cache[f].files:this.cache[f].folders).find(d=>d.name===r.name);E&&(l[E.name]=E)}return l}addEntities(_,n,l=h.VC.FILE){const f=this.createKey(_);return!!this.cache.hasOwnProperty(f)&&(Array.isArray(n)||(n=[n]),l===h.VC.FILE?this.cache[f].files.unshift(...n):this.cache[f].folders.unshift(...n),!0)}removeEntities(_,n,l=h.VC.FILE){if(Array.isArray(n)||(n=[n]),l===h.VC.FOLDER)for(const d of n)this.removeItem([..._,d]);const f=this.createKey(_);if(!this.cache.hasOwnProperty(f))return[];const r=l===h.VC.FILE?"files":"folders";let E=[];for(const d of n){const b=this.cache[f][r].findIndex(P=>P.name===d);b>-1&&(this.cache[f][r].splice(b,1),E.push(d))}return E}refactorFolderContent(_,n){const l=this.createKey(_);if(!this.cache.hasOwnProperty(l))return!1;n.endsWith("/")||(n+="/");for(const f of this.cache[l].folders)f.url=n+f.name;for(const f of this.cache[l].files)f.url=f.embedUrl=n+f.name,f.time=Date.now();return!0}createKey(_){return`${this.ffuid}/${_.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return w.\u0275fac=function(_){return new(_||w)(U.LFG(e.d))},w.\u0275prov=U.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"}),w})()},146:(V,B,t)=>{"use strict";t.d(B,{r:()=>w});var h=t(7579),U=t(1135),e=t(4650),O=t(8745);let w=(()=>{class v{constructor(n){this.uploadPreferencesService=n,this.selectedFileListArray=[],this.actionSubject=new h.x,this.uploadingFileQueueSubject=new h.x,this.uploadingFileErrorSubject=new h.x,this.currentFolderPathSubject=new h.x,this.layoutOptionsSubject=new h.x,this.renameEntitySubject=new h.x,this.entityPendingSubject=new h.x,this.deleteFileSubject=new h.x,this.uploadedFileSubject=new h.x,this.draggedFileListSubject=new h.x,this.startUploadSubject=new h.x,this.startMoveSubject=new h.x,this.selectedFileListSubject=new U.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(n){this.actionSubject.next(n)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(n){this.uploadPreferencesService.layoutOptions=n,this.layoutOptionsSubject.next(n)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(n){this.uploadPreferencesService.lastFolderPath=n,this.currentFolderPathSubject.next(n)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(n){this.uploadingFileQueueSubject.next(n)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(n){this.uploadingFileErrorSubject.next(n)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(n){this.renameEntitySubject.next(n)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(n){this.entityPendingSubject.next(n)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(n){this.deleteFileSubject.next(n)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(n){this.uploadedFileSubject.next(n)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(n){this.draggedFileListSubject.next(n)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(n){this.startUploadSubject.next(n)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(n){this.startMoveSubject.next(n)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(n){if(Array.isArray(n)||(n=[n]),0===n.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let l=!1;for(const f of n){const r=this.selectedFileListArray.findIndex(E=>E.name===f.name);f.selected?-1===r&&(this.selectedFileListArray.push({name:f.name}),l=!0):r>-1&&(this.selectedFileListArray.splice(r,1),l=!0)}l&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return v.\u0275fac=function(n){return new(n||v)(e.LFG(O.p))},v.\u0275prov=e.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},8745:(V,B,t)=>{"use strict";t.d(B,{p:()=>v});var h=t(5044),U=t(6986),e=t(4650),O=t(2381),w=t(6161);let v=(()=>{class _{constructor(l,f){this.preferencesService=l,this.urlQueryParamsService=f;const r=this.urlQueryParamsService.getAndDeleteParam(h.RT.UPLOAD_PATH);r&&(this.lastFolderPath=r.split("/").filter(E=>E.length>0))}get preferences(){return this.preferencesService.getItem(h.Ye.UPLOAD)||U.p0}set preferences(l){this.preferencesService.setItem(h.Ye.UPLOAD,l)}get lastFolderPath(){return(this.preferences.lastPath||U.p0.lastPath).filter(l=>l.length>0)}set lastFolderPath(l){const f=this.preferences;f.lastPath=l,this.preferences=f}get layoutOptions(){const l=U.p0.layout,f=this.preferences.layout;return f&&0===Object.keys(l).filter(r=>!f.hasOwnProperty(r)).length?f:l}set layoutOptions(l){const f=this.preferences;f.layout=l,this.preferences=f}get uploader(){const l=this.preferences.uploader||U.p0.uploader;return!l.checkImage.active&&Date.now()-l.checkImage.time>6048e5&&(l.checkImage.active=!0,this.uploader=l),l.hasOwnProperty("showLinkModal")||(l.showLinkModal=!1),l}set uploader(l){const f=this.preferences;f.uploader=l,this.preferences=f}}return _.\u0275fac=function(l){return new(l||_)(e.LFG(O.y),e.LFG(w.J))},_.\u0275prov=e.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},3207:(V,B,t)=>{"use strict";t.d(B,{C:()=>a});var h=t(5861),U=t(7824),e=t(3905),O=t(575),w=t(3848),E=t(6986),d=t(1042),b=t(4650),P=t(5395),L=t(3124),Q=t(8745),A=t(529);let a=(()=>{class u{constructor(x,M,D,j){this.graphqlService=x,this.uploadCacheService=M,this.uploadPreferencesService=D,this.http=j}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(U._.HeaderKeys.UUID,(0,d.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(U._.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(U._.HeaderKeys.UUID)||""}getFileList(x,M){var D=this;return(0,h.Z)(function*(){const j=D.uploadCacheService.getItem(x);if(j)return j;const W=(yield D.graphqlService.query({query:"\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",variables:{scope:M,target:x.join("/")}})).data.uploadEntitiesListToken,J=yield D.sendRequest(W),N={files:J.files.map(Y=>{const ie=(0,w.Tb)(Y.url);return{...Y,time:1e3*Y.time,filename:ie.filename,ext:ie.ext,isImage:(0,w.Or)(ie.ext),embedUrl:`${Y.url}?t=${Y.time}`,type:O.VC.FILE}}),folders:J.folders.map(Y=>({...Y,type:O.VC.FOLDER}))};return D.uploadCacheService.setItem(x,N),N})()}createDirectory(x,M){var D=this;return(0,h.Z)(function*(){const j=(yield D.graphqlService.mutate({mutation:"\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",variables:{scope:M,target:x.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield D.sendRequest(j)})()}moveRenameEntity(x,M,D,j,W){var J=this;return(0,h.Z)(function*(){j||(j=D);const ne=(yield J.graphqlService.mutate({mutation:"\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",variables:{scope:W,source:(x.length?`${x.join("/")}/`:"")+D,target:(M.length?`${M.join("/")}/`:"")+j}})).data.uploadEntitiesMoveToken,N=yield J.sendRequest(ne);return{...N,time:1e3*N.time}})()}deleteEntity(x,M,D){var j=this;return(0,h.Z)(function*(){const W=(yield j.graphqlService.mutate({mutation:"\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",variables:{scope:D,target:(x.length?`${x.join("/")}/`:"")+M}})).data.uploadEntitiesDeleteToken;return yield j.sendRequest(W),!0})()}getHostToken(x,M,D){var j=this;return(0,h.Z)(function*(){return(yield j.graphqlService.query({query:"\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",variables:{scope:D,target:(x.length?`${x.join("/")}/`:"")+M}})).data.uploadEntitiesHostToken})()}sendRequest(x){var M=this;return(0,h.Z)(function*(){return(yield(0,e.z)(M.http.post(E.C7,JSON.stringify({payload:x}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(x,M){var D=this;return(0,h.Z)(function*(){return yield D.graphqlService.subscribe({query:"\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}",variables:{scope:M}},j=>{if(!j.data?.uploadEntities)return;const W=JSON.parse(j.data.uploadEntities.eventMessage);!W.payload.customHeaders||!W.payload.customHeaders.hasOwnProperty(U._.HeaderKeys.UUID)||W.payload.customHeaders[U._.HeaderKeys.UUID]===D.getGqlIdHeader()||x({type:j.data.uploadEntities.eventType,message:W})})})()}getBlobFromUrl(x){var M=this;return(0,h.Z)(function*(){return yield(0,e.z)(M.http.get(x,{responseType:"blob"})).catch(()=>{})})()}}return u.\u0275fac=function(x){return new(x||u)(b.LFG(P.J),b.LFG(L.B),b.LFG(Q.p),b.LFG(A.eN))},u.\u0275prov=b.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},3848:(V,B,t)=>{"use strict";t.d(B,{$H:()=>b,JN:()=>f,Lv:()=>v,Or:()=>d,Tb:()=>O,jL:()=>E,lY:()=>_,ok:()=>L,rQ:()=>Q,rc:()=>P,sT:()=>n,zO:()=>w});var h=t(5861),U=t(575),e=t(6986);function O(A){let a=A;if(A.indexOf("/")>-1){const M=A.split("/");a=M[M.length-1]}const u=a.split("."),T=u[u.length-1].toLowerCase(),x=decodeURIComponent(u.slice(0,-1).join("."));return{ext:T,filename:x,name:`${x}.${T}`}}function w(A,a={}){const u=O(A),T=Date.now();return{name:u.name,size:0,time:T,url:A,ext:u.ext,filename:u.filename,isImage:d(u.ext),embedUrl:`${A}?t=${T}`,type:U.VC.FILE,...a}}function v(A){let a=A;a.endsWith("/")&&(a=a.slice(0,-1));const u=a.split("/");return{name:decodeURIComponent(u[u.length-1])}}function _(A){return{name:v(A).name,url:A,type:U.VC.FOLDER}}function n(A){return l.apply(this,arguments)}function l(){return(l=(0,h.Z)(function*(A){const a=new FileReader,u=new Promise(T=>a.addEventListener("load",()=>T(a.result)));return a.readAsDataURL(A),u})).apply(this,arguments)}function f(A){return r.apply(this,arguments)}function r(){return(r=(0,h.Z)(function*(A){const a=new DataView(yield A.arrayBuffer());if(2303741511===a.getUint32(0)&&218765834===a.getUint32(4)){if(-1===[4,6].indexOf(a.getUint8(25)))return!1;const T=Object.assign(new Image,{src:yield n(A)});yield new Promise(D=>T.addEventListener("load",()=>D(!0)));const x=Object.assign(document.createElement("canvas"),{width:T.width,height:T.height}).getContext("2d");if(!x)return!1;x.imageSmoothingEnabled=!1,x.drawImage(T,0,0);const M=x?.getImageData(0,0,T.width,T.height);if(M)for(let D=0;D<M.data.length;D+=4)if(M.data[D+3]<255)return!0}return!1})).apply(this,arguments)}function E(A){return A.map(a=>({name:a.name,ext:a.ext,type:U.VC.FILE,url:a.url,embedUrl:a.embedUrl,isImage:a.isImage}))}function d(A,a=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(A)&&!a.includes(A)}function b(A){return d(A,["gif","svg"])}function P(A,a,u,T=[],x=""){let M={...e.xt};const D=A.trim();M.invalidLength=0===D.length;const j=(D+x).replace(/\s{2,}/g," ");return M.alreadyUsed=a!==D&&T.includes(j),M.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(A),M.invalidCharacter=!(u===U.VC.FILE?e.Mi.test(A):e.er.test(A)),M}function L(A,a){return A.join("/")===a.join("/")}function Q(A){let a=[],u=[];for(const T of A)T.type===U.VC.FILE?a.push(T):u.push(T);return{[U.VC.FILE]:a,[U.VC.FOLDER]:u}}},3612:(V,B,t)=>{"use strict";t.d(B,{q:()=>L});var h=t(5861),U=t(8896),e=t(6730),O=t.n(e),w=t(9969),v=t(3848),_=t(529),n=t(7579),l=t(7445),f=t(2722),r=t(6986);class E{static findApp1Marker(A){const a=new DataView(A),u=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let T=0;T<A.byteLength-2;T+=2){const x=a.getUint16(T);if(65505===x)return{offset:T,size:a.getUint16(T+2),little:18761==a.getUint16(T+8,!1)};if(u.has(x))break}}static stripAndReturnExif(A){return(0,h.Z)(function*(){const a=yield A.arrayBuffer(),u=E.findApp1Marker(a);return u?{file:new File([a.slice(0,u.offset),a.slice(u.offset+u.size+2)],A.name,{type:A.type,lastModified:A.lastModified}),exif:a.slice(u.offset,u.offset+u.size)}:{file:A}})()}static checkImageOrientation(A){const a=new DataView(A);if(1165519206!=a.getUint32(4,!1))return-1;const u=18761==a.getUint16(10,!1);let T=10;T+=a.getUint32(T+4,u);const x=a.getUint16(T,u);T+=2;for(let M=0;M<x;M++)if(274==a.getUint16(T+12*M,u))return a.getUint16(T+12*M+8,u);return-1}}var d=t(4650),b=t(146),P=t(2020);let L=(()=>{class Q{constructor(a,u,T){this.http=a,this.uploadObservablesService=u,this.loadImageService=T,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return{...this.uploaderOptionsObject}}set uploaderOptions(a){this.uploaderOptionsObject={...a}}compressFileIfNeeded(a,u){return(0,h.Z)(function*(){let T=["image/png","image/jpeg"],x={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};u&&(T.push("image/webp"),x.width=u.width,x.height=u.height,x.resize="cover",x.strict=!1);const M=a.type.toLowerCase();return a.size<=4e6&&void 0===u||-1===T.indexOf(a.type.toLowerCase())?a:("image/png"===M&&(yield(0,v.JN)(a))&&(x.convertSize=1/0),new Promise((D,j)=>{new(O())(a,{...x,success:W=>{const J=W instanceof Blob?new File([W],a.name,{type:a.type,lastModified:a.lastModified}):a;D(J)},error:j})}))})()}orientFileIfNeeded(a){var u=this;return(0,h.Z)(function*(){if(-1===["image/jpeg"].indexOf(a.type.toLowerCase()))return a;const x=yield E.stripAndReturnExif(a);if(a=x.file,x.exif){const M=E.checkImageOrientation(x.exif);if(1!==M){let D=0;switch(M){case 3:case 4:D=180;break;case 5:case 6:D=90;break;case 7:case 8:D=270}const j=yield(0,v.sT)(a),W=yield new Promise((ne,N)=>{const Y=new Image;Y.onload=()=>ne({originalImage:Y,originalBase64:j}),Y.onerror=N,Y.src=j}),J=yield u.loadImageService.transformLoadedImage({original:{base64:W.originalBase64,image:W.originalImage,size:{width:W.originalImage.naturalWidth,height:W.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(M),rotate:D/90}},new w.R);a=new File([(0,U.L)(J.transformed.base64)],a.name,{type:a.type,lastModified:Date.now()})}}return a})()}upload(a,u,T,x=!1){const M=new n.x,D=new FormData;D.append("payload",T),D.append("upload",a,a.name),x&&D.append("allowOverwrite","1");const j=this.http.request(new _.aW("POST",r.C7,D,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(j.subscribe({next:W=>{if(W.type===_.dt.UploadProgress){if(!W.total||(u.progress=Math.round(50*W.loaded/W.total)+20,u.progress<70))return;(0,l.F)(1e3).pipe((0,f.R)(M.asObservable())).subscribe(()=>{if(u.progress<95){const J=Math.round(8*Math.random()+8);u.progress+J>95?u.progress=95:u.progress+=J}})}else if(W instanceof _.Zn){if(u.progress=100,u.completed=!0,W.body?.error||!W.body?.success)u.error=!0,this.uploadObservablesService.pushUploadingFileError(u);else{u.file.url=W.body.success.url,u.file.time=Date.now(),u.file.embedUrl=`${u.file.url}?t=${u.file.time}`;const J=(0,v.Tb)(u.file.url);u.file.name=J.name,u.file.filename=J.filename}M.next(),M.complete()}},error:()=>{u.error=!0,this.uploadObservablesService.pushUploadingFileError(u),M.next(),M.complete()}})),M.asObservable()}clearPendingRequests(){for(const a of this.requestSubscriptions)a.unsubscribe();this.requestSubscriptions=[]}}return Q.\u0275fac=function(a){return new(a||Q)(d.LFG(_.eN),d.LFG(b.r),d.LFG(P.y))},Q.\u0275prov=d.Yz7({token:Q,factory:Q.\u0275fac,providedIn:"root"}),Q})()},6730:function(V){V.exports=function(){"use strict";function B(y,i){var c=Object.keys(y);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(y);i&&(p=p.filter(function(R){return Object.getOwnPropertyDescriptor(y,R).enumerable})),c.push.apply(c,p)}return c}function t(y){for(var i=1;i<arguments.length;i++){var c=null!=arguments[i]?arguments[i]:{};i%2?B(Object(c),!0).forEach(function(p){O(y,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(c)):B(Object(c)).forEach(function(p){Object.defineProperty(y,p,Object.getOwnPropertyDescriptor(c,p))})}return y}function U(y,i){for(var c=0;c<i.length;c++){var p=i[c];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}function O(y,i,c){return i in y?Object.defineProperty(y,i,{value:c,enumerable:!0,configurable:!0,writable:!0}):y[i]=c,y}function w(){return w=Object.assign||function(y){for(var i=1;i<arguments.length;i++){var c=arguments[i];for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(y[p]=c[p])}return y},w.apply(this,arguments)}var y,i,c,p,R,S,z,k,v={exports:{}};y=v,typeof window>"u"||(i=window,c=i.HTMLCanvasElement&&i.HTMLCanvasElement.prototype,p=i.Blob&&function(){try{return Boolean(new Blob)}catch{return!1}}(),R=p&&i.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch{return!1}}(),S=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder,z=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,k=(p||S)&&i.atob&&i.ArrayBuffer&&i.Uint8Array&&function(m){var C,s,g,o,F,I,H,K,q;if(!(C=m.match(z)))throw new Error("invalid data URI");for(s=C[2]?C[1]:"text/plain"+(C[3]||";charset=US-ASCII"),g=!!C[4],o=m.slice(C[0].length),F=g?atob(o):decodeURIComponent(o),I=new ArrayBuffer(F.length),H=new Uint8Array(I),K=0;K<F.length;K+=1)H[K]=F.charCodeAt(K);return p?new Blob([R?H:I],{type:s}):((q=new S).append(I),q.getBlob(s))},i.HTMLCanvasElement&&!c.toBlob&&(c.mozGetAsFile?c.toBlob=function(m,C,s){var g=this;setTimeout(function(){m(s&&c.toDataURL&&k?k(g.toDataURL(C,s)):g.mozGetAsFile("blob",C))})}:c.toDataURL&&k&&(c.toBlob=c.msToBlob?function(m,C,s){var g=this;setTimeout(function(){m((C&&"image/png"!==C||s)&&c.toDataURL&&k?k(g.toDataURL(C,s)):g.msToBlob(C))})}:function(m,C,s){var g=this;setTimeout(function(){m(k(g.toDataURL(C,s)))})})),y.exports?y.exports=k:i.dataURLtoBlob=k);var _=v.exports,l={strict:!0,checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},r=typeof window<"u"&&typeof window.document<"u"?window:{},E=function(i){return i>0&&i<1/0},d=Array.prototype.slice;function b(y){return Array.from?Array.from(y):d.call(y)}var P=/^image\/.+$/;function L(y){return P.test(y)}var A=String.fromCharCode;var u=r.btoa;function x(y){var c,i=new DataView(y);try{var p,R,S;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var z=i.byteLength,k=2;k+1<z;){if(255===i.getUint8(k)&&225===i.getUint8(k+1)){R=k;break}k+=1}if(R){var C=R+10;if("Exif"===function a(y,i,c){var R,p="";for(c+=i,R=i;R<c;R+=1)p+=A(y.getUint8(R));return p}(i,R+4,4)){var s=i.getUint16(C);if(((p=18761===s)||19789===s)&&42===i.getUint16(C+2,p)){var g=i.getUint32(C+4,p);g>=8&&(S=C+g)}}}if(S){var F,I,o=i.getUint16(S,p);for(I=0;I<o;I+=1)if(274===i.getUint16(F=S+12*I+2,p)){c=i.getUint16(F+=8,p),i.setUint16(F,1,p);break}}}catch{c=1}return c}var D=/\.\d*(?:0|9){12}\d*$/;function j(y){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return D.test(y)?Math.round(y*i)/i:y}function W(y){var i=y.aspectRatio,c=y.height,p=y.width,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",S=E(p),z=E(c);if(S&&z){var k=c*i;("contain"===R||"none"===R)&&k>p||"cover"===R&&k<p?c=p/i:p=c*i}else S?c=p/i:z&&(p=c*i);return{width:p,height:c}}var J=r.ArrayBuffer,ne=r.FileReader,N=r.URL||r.webkitURL,Y=/\.\w+$/,ie=r.Compressor;return function(){function y(i,c){(function h(y,i){if(!(y instanceof i))throw new TypeError("Cannot call a class as a function")})(this,y),this.file=i,this.image=new Image,this.options=t(t({},l),c),this.aborted=!1,this.result=null,this.init()}return function e(y,i,c){return i&&U(y.prototype,i),c&&U(y,c),y}(y,[{key:"init",value:function(){var c=this,p=this.file,R=this.options;if(function(i){return!(typeof Blob>"u")&&(i instanceof Blob||"[object Blob]"===Object.prototype.toString.call(i))}(p)){var S=p.type;if(L(S))if(N&&ne)if(J||(R.checkOrientation=!1),N&&!R.checkOrientation)this.load({url:N.createObjectURL(p)});else{var z=new ne,k=R.checkOrientation&&"image/jpeg"===S;this.reader=z,z.onload=function(m){var s=m.target.result,g={};if(k){var o=x(s);o>1||!N?(g.url=function T(y,i){for(var c=[],R=new Uint8Array(y);R.length>0;)c.push(A.apply(null,b(R.subarray(0,8192)))),R=R.subarray(8192);return"data:".concat(i,";base64,").concat(u(c.join("")))}(s,S),o>1&&w(g,function M(y){var i=0,c=1,p=1;switch(y){case 2:c=-1;break;case 3:i=-180;break;case 4:p=-1;break;case 5:i=90,p=-1;break;case 6:i=90;break;case 7:i=90,c=-1;break;case 8:i=-90}return{rotate:i,scaleX:c,scaleY:p}}(o))):g.url=N.createObjectURL(p)}else g.url=s;c.load(g)},z.onabort=function(){c.fail(new Error("Aborted to read the image with FileReader."))},z.onerror=function(){c.fail(new Error("Failed to read the image with FileReader."))},z.onloadend=function(){c.reader=null},k?z.readAsArrayBuffer(p):z.readAsDataURL(p)}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(c){var p=this,R=this.file,S=this.image;S.onload=function(){p.draw(t(t({},c),{},{naturalWidth:S.naturalWidth,naturalHeight:S.naturalHeight}))},S.onabort=function(){p.fail(new Error("Aborted to load the image."))},S.onerror=function(){p.fail(new Error("Failed to load the image."))},r.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(r.navigator.userAgent)&&(S.crossOrigin="anonymous"),S.alt=R.name,S.src=c.url}},{key:"draw",value:function(c){var p=this,R=c.naturalWidth,S=c.naturalHeight,z=c.rotate,k=void 0===z?0:z,m=c.scaleX,C=void 0===m?1:m,s=c.scaleY,g=void 0===s?1:s,o=this.file,F=this.image,I=this.options,H=document.createElement("canvas"),K=H.getContext("2d"),q=Math.abs(k)%180==90,ae=("contain"===I.resize||"cover"===I.resize)&&E(I.width)&&E(I.height),ee=Math.max(I.maxWidth,0)||1/0,Z=Math.max(I.maxHeight,0)||1/0,$=Math.max(I.minWidth,0)||0,te=Math.max(I.minHeight,0)||0,re=R/S,G=I.width,X=I.height;if(q){var ue=[Z,ee];ee=ue[0],Z=ue[1];var de=[te,$];$=de[0],te=de[1];var pe=[X,G];G=pe[0],X=pe[1]}ae&&(re=G/X);var he=W({aspectRatio:re,width:ee,height:Z},"contain");ee=he.width,Z=he.height;var fe=W({aspectRatio:re,width:$,height:te},"cover");if($=fe.width,te=fe.height,ae){var ge=W({aspectRatio:re,width:G,height:X},I.resize);G=ge.width,X=ge.height}else{var me=W({aspectRatio:re,width:G,height:X}),ve=me.width;G=void 0===ve?R:ve;var _e=me.height;X=void 0===_e?S:_e}var Ue=-(G=Math.floor(j(Math.min(Math.max(G,$),ee))))/2,Me=-(X=Math.floor(j(Math.min(Math.max(X,te),Z))))/2,Ce=G,we=X,se=[];if(ae){var le,ce,ye=W({aspectRatio:re,width:R,height:S},{contain:"cover",cover:"contain"}[I.resize]);se.push((R-(le=ye.width))/2,(S-(ce=ye.height))/2,le,ce)}if(se.push(Ue,Me,Ce,we),q){var Ae=[X,G];G=Ae[0],X=Ae[1]}H.width=G,H.height=X,L(I.mimeType)||(I.mimeType=o.type);var Oe="transparent";if(o.size>I.convertSize&&I.convertTypes.indexOf(I.mimeType)>=0&&(I.mimeType="image/jpeg"),"image/jpeg"===I.mimeType&&(Oe="#fff"),K.fillStyle=Oe,K.fillRect(0,0,G,X),I.beforeDraw&&I.beforeDraw.call(this,K,H),!this.aborted&&(K.save(),K.translate(G/2,X/2),K.rotate(k*Math.PI/180),K.scale(C,g),K.drawImage.apply(K,[F].concat(se)),K.restore(),I.drew&&I.drew.call(this,K,H),!this.aborted)){var xe=function(Pe){p.aborted||p.done({naturalWidth:R,naturalHeight:S,result:Pe})};H.toBlob?H.toBlob(xe,I.mimeType,I.quality):xe(_(H.toDataURL(I.mimeType,I.quality)))}}},{key:"done",value:function(c){var p=c.naturalWidth,R=c.naturalHeight,S=c.result,z=this.file,m=this.options;if(N&&!m.checkOrientation&&N.revokeObjectURL(this.image.src),S)if(m.strict&&S.size>z.size&&m.mimeType===z.type&&!(m.width>p||m.height>R||m.minWidth>p||m.minHeight>R||m.maxWidth<p||m.maxHeight<R))S=z;else{var C=new Date;S.lastModified=C.getTime(),S.lastModifiedDate=C,S.name=z.name,S.name&&S.type!==z.type&&(S.name=S.name.replace(Y,function Q(y){var i=L(y)?y.substr(6):"";return"jpeg"===i&&(i="jpg"),".".concat(i)}(S.type)))}else S=z;this.result=S,m.success&&m.success.call(this,S)}},{key:"fail",value:function(c){var p=this.options;if(!p.error)throw c;p.error.call(this,c)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ie,y}},{key:"setDefaults",value:function(c){w(l,c)}}]),y}()}()},7445:(V,B,t)=>{"use strict";t.d(B,{F:()=>e});var h=t(4986),U=t(5963);function e(O=0,w=h.z){return O<0&&(O=0),(0,U.H)(O,O,w)}},1042:(V,B,t)=>{"use strict";t.d(B,{Z:()=>E});var h,U=new Uint8Array(16);function e(){if(!h&&!(h=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(U)}const O=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,v=function w(d){return"string"==typeof d&&O.test(d)};for(var _=[],n=0;n<256;++n)_.push((n+256).toString(16).substr(1));const E=function r(d,b,P){var L=(d=d||{}).random||(d.rng||e)();if(L[6]=15&L[6]|64,L[8]=63&L[8]|128,b){P=P||0;for(var Q=0;Q<16;++Q)b[P+Q]=L[Q];return b}return function l(d){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=(_[d[b+0]]+_[d[b+1]]+_[d[b+2]]+_[d[b+3]]+"-"+_[d[b+4]]+_[d[b+5]]+"-"+_[d[b+6]]+_[d[b+7]]+"-"+_[d[b+8]]+_[d[b+9]]+"-"+_[d[b+10]]+_[d[b+11]]+_[d[b+12]]+_[d[b+13]]+_[d[b+14]]+_[d[b+15]]).toLowerCase();if(!v(P))throw TypeError("Stringified UUID is invalid");return P}(L)}}}]);