(self.webpackChunkboard=self.webpackChunkboard||[]).push([[377],{9969:(X,F,t)=>{"use strict";t.d(F,{R:()=>h});class h{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(b=>b in this).forEach(b=>this[b]=e[b]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(b=>b in this).forEach(b=>this[b]=e[b].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},2020:(X,F,t)=>{"use strict";t.d(F,{y:()=>i});var h=t(5861);var _=t(4650);let i=(()=>{class c{constructor(){this.autoRotateSupported=function e(){return new Promise(c=>{const u=new Image;u.onload=()=>{c(1===u.width&&2===u.height)},u.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(r,v){return new Promise((d,m)=>{const T=new FileReader;T.onload=w=>{this.loadImage(w.target.result,r.type,v).then(d).catch(m)},T.readAsDataURL(r)})}loadImage(r,v,d){return this.isValidImageType(v)?this.loadBase64Image(r,d):Promise.reject(new Error("Invalid image type"))}isValidImageType(r){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(r)}loadImageFromURL(r,v){return new Promise((d,m)=>{const T=new Image;T.onerror=()=>m,T.onload=()=>{const w=document.createElement("canvas"),G=w.getContext("2d");w.width=T.width,w.height=T.height,G?.drawImage(T,0,0),this.loadBase64Image(w.toDataURL(),v).then(d)},T.crossOrigin="anonymous",T.src=r})}loadBase64Image(r,v){return new Promise((d,m)=>{const T=new Image;T.onload=()=>d({originalImage:T,originalBase64:r}),T.onerror=m,T.src=r}).then(d=>this.transformImageBase64(d,v))}transformImageBase64(r,v){var d=this;return(0,h.Z)(function*(){const m=yield d.autoRotateSupported,T=yield function b(c){switch("string"==typeof c&&(c=function S(c){const u=new DataView(function f(c){c=c.replace(/^data\:([^\;]+)\;base64,/gim,"");const u=atob(c),r=u.length,v=new Uint8Array(r);for(let d=0;d<r;d++)v[d]=u.charCodeAt(d);return v.buffer}(c));if(65496!==u.getUint16(0,!1))return-2;const r=u.byteLength;let v=2;for(;v<r;){if(u.getUint16(v+2,!1)<=8)return-1;const d=u.getUint16(v,!1);if(v+=2,65505==d){if(1165519206!==u.getUint32(v+=2,!1))return-1;const m=18761==u.getUint16(v+=6,!1);v+=u.getUint32(v+4,m);const T=u.getUint16(v,m);v+=2;for(let w=0;w<T;w++)if(274==u.getUint16(v+12*w,m))return u.getUint16(v+12*w+8,m)}else{if(65280!=(65280&d))break;v+=u.getUint16(v,!1)}}return-1}(c)),c){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(m?-1:r.originalBase64);return r.originalImage&&r.originalImage.complete?d.transformLoadedImage({original:{base64:r.originalBase64,image:r.originalImage,size:{width:r.originalImage.naturalWidth,height:r.originalImage.naturalHeight}},exifTransform:T},v):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(r,v){var d=this;return(0,h.Z)(function*(){const m=v.canvasRotation+r.exifTransform.rotate,T={width:r.original.image.naturalWidth,height:r.original.image.naturalHeight};if(0===m&&!r.exifTransform.flip&&!v.containWithinAspectRatio)return{original:{base64:r.original.base64,image:r.original.image,size:{...T}},transformed:{base64:r.original.base64,image:r.original.image,size:{...T}},exifTransform:r.exifTransform};const w=d.getTransformedSize(T,r.exifTransform,v),G=document.createElement("canvas");G.width=w.width,G.height=w.height;const C=G.getContext("2d");C?.setTransform(r.exifTransform.flip?-1:1,0,0,1,G.width/2,G.height/2),C?.rotate(Math.PI*(m/2)),C?.drawImage(r.original.image,-T.width/2,-T.height/2);const x=G.toDataURL(),s=yield d.loadImageFromBase64(x);return{original:{base64:r.original.base64,image:r.original.image,size:{...T}},transformed:{base64:x,image:s,size:{width:s.width,height:s.height}},exifTransform:r.exifTransform}})()}loadImageFromBase64(r){return new Promise((v,d)=>{const m=new Image;m.onload=()=>v(m),m.onerror=d,m.src=r})}getTransformedSize(r,v,d){const m=d.canvasRotation+v.rotate;if(d.containWithinAspectRatio){if(m%2){const w=r.height/d.aspectRatio;return{width:Math.max(r.height,r.width*d.aspectRatio),height:Math.max(r.width,w)}}{const w=r.width/d.aspectRatio;return{width:Math.max(r.width,r.height*d.aspectRatio),height:Math.max(r.height,w)}}}return m%2?{height:r.width,width:r.height}:{width:r.width,height:r.height}}}return c.\u0275fac=function(r){return new(r||c)},c.\u0275prov=_.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},8896:(X,F,t)=>{"use strict";function h(U){const e=U.split(","),b=e[0].replace("data:","").replace(";base64",""),S=atob(e[1]),f=new ArrayBuffer(S.length),_=new Uint8Array(f);for(let i=0;i<S.length;i+=1)_[i]=S.charCodeAt(i);return new Blob([f],{type:b})}t.d(F,{L:()=>h})},3098:(X,F,t)=>{"use strict";t.d(F,{B:()=>q});var h=t(5861),U=t(1309),e=t(4650),b=t(4968),S=t(3905),f=t(3848),_=t(1460),i=t(4323),c=t(6986),u=t(575),r=(()=>{return(A=r||(r={})).UNSUPPORTED="unsupported",A.OVERSIZED="oversized",A.REMOTE_URL_RESPONSE="remote-url-response",r;var A})(),v=t(7693),d=t(3207),m=t(146),T=t(3612),w=t(6378),G=t(9383),C=t(4573),x=t(6895),s=t(4006),E=t(4029),O=t(8279),M=t(3450),P=t(8212);const R=["fileInput"];function J(A,Q){1&A&&(e.O4$(),e.TgZ(0,"svg",31),e._UZ(1,"path",32)(2,"path",33),e.qZA())}const k=function(){return["text-primary"]};function ee(A,Q){1&A&&e._UZ(0,"app-logo",34),2&A&&e.Q6J("svgClass",e.DdM(2,k))("responsive",!1)}function te(A,Q){1&A&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&A&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.DESKTOP"),e.oJD)}function oe(A,Q){1&A&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&A&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.TOUCH"),e.oJD)}const se=function(A){return{"fw-bold fs-md-lg":A}},fe=function(A){return{"text-decoration-underline":A}};function y(A,Q){if(1&A){const n=e.EpF();e.TgZ(0,"div",35),e.YNc(1,te,2,3,"span",36),e.YNc(2,oe,2,3,"span",36),e.TgZ(3,"span",37),e.NdJ("click",function(a){e.CHM(n);const I=e.oxw(2),W=e.MAs(23);return e.KtG(I.toggleRemoteUrlForm(a,W))}),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&A){const n=e.oxw(2);e.Q6J("ngClass",e.VKq(7,se,!n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.touchDevice),e.xp6(1),e.Q6J("ngIf",n.touchDevice),e.xp6(1),e.Q6J("ngClass",e.VKq(9,fe,n.isWidget)),e.xp6(1),e.Oqu(e.lcZ(5,5,"COMPONENTS.UPLOADER.DESCRIPTION.REMOTE_URL"))}}function o(A,Q){1&A&&e.GkF(0)}function p(A,Q){if(1&A){const n=e.EpF();e.TgZ(0,"div",39),e.YNc(1,o,1,0,"ng-container",17),e.TgZ(2,"button",40),e.NdJ("click",function(a){e.CHM(n);const I=e.oxw(2);return e.KtG(I.handleRemoteUrlUpload(a))}),e.TgZ(3,"span",41),e._uU(4,"check"),e.qZA()(),e.TgZ(5,"button",42),e.NdJ("click",function(a){e.CHM(n);const I=e.oxw(2);return e.KtG(I.toggleRemoteUrlForm(a))}),e.TgZ(6,"span",41),e._uU(7,"clear"),e.qZA()()()}if(2&A){const n=e.oxw(2),l=e.MAs(34);e.xp6(1),e.Q6J("ngTemplateOutlet",l),e.xp6(1),e.Q6J("disabled",0===n.remoteUrl.length||!n.isRemoteUrlValid)}}function g(A,Q){if(1&A&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"em",43),e.ALo(5,"arrayJoin"),e.BQk()),2&A){const n=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"COMPONENTS.UPLOADER.PATH.LONG")," "),e.xp6(2),e.Q6J("innerText",n.currentFolderPath.length?e.xi3(5,4,n.currentFolderPath,"/"):"root")}}function D(A,Q){if(1&A&&(e._UZ(0,"div",48),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&A){const n=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,n.currentFolderPath,0,-1),"/"))}}function L(A,Q){if(1&A&&(e.TgZ(0,"div",44)(1,"div",45),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,D,3,8,"div",46),e._UZ(5,"div",47),e.ALo(6,"arrayJoin"),e.ALo(7,"slice"),e.qZA()),2&A){const n=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,3,"COMPONENTS.UPLOADER.PATH.SHORT")),e.xp6(2),e.Q6J("ngIf",n.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(n.currentFolderPath.length>1?"/":"")+(n.currentFolderPath.length?e.xi3(6,5,e.xi3(7,8,n.currentFolderPath,n.currentFolderPath.length-1),"/"):"root"))}}const K=function(){return{bottom:0,left:0}};function H(A,Q){if(1&A){const n=e.EpF();e.ynx(0),e.TgZ(1,"a",49),e.NdJ("click",function(){e.CHM(n);const a=e.oxw(2);return e.KtG(a.openInfoModal.emit())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",50),e.NdJ("click",function(){e.CHM(n),e.oxw(2);const a=e.MAs(7);return e.KtG(a.open())}),e._uU(5,"settings"),e.qZA(),e.TgZ(6,"div",51),e.NdJ("click",function(a){e.CHM(n);const I=e.oxw(2),W=e.MAs(23);return e.KtG(I.toggleRemoteUrlForm(a,W))}),e._uU(7,"add_link"),e.qZA(),e.BQk()}2&A&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,K)),e.xp6(1),e.Oqu(e.lcZ(3,2,"COMPONENTS.UPLOADER.INFO")))}const j=function(A,Q,n){return{"cursor-pointer":A,"py-4 px-3 px-sm-4":Q,"p-2 pb-3":n}},Z=function(A,Q,n){return{"my-2":A,"mb-2":Q,"mw-100 mt-1":n}};function $(A,Q){if(1&A){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",22,23),e.NdJ("dragenter",function(){e.CHM(n);const a=e.MAs(2),I=e.oxw();return e.KtG(I.setDragOverEvent(a))})("drop",function(a){e.CHM(n);const I=e.oxw();return e.KtG(I.handleDropEvent(a))})("click",function(){e.CHM(n);const a=e.oxw(),I=e.MAs(2);return e.KtG(!a.isWaitingRemoteUrl&&I.click())}),e.YNc(3,J,3,0,"svg",24),e.YNc(4,ee,1,3,"ng-template",null,25,e.W1O),e.YNc(6,y,6,11,"div",26),e.YNc(7,p,8,2,"div",27),e.TgZ(8,"div",28),e.YNc(9,g,6,7,"ng-container",3),e.YNc(10,L,8,11,"ng-template",null,29,e.W1O),e.qZA()(),e.YNc(12,H,8,5,"ng-container",30),e.BQk()}if(2&A){const n=e.MAs(5),l=e.MAs(11),a=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(9,j,!a.loading&&!a.isWaitingRemoteUrl,!a.isWidget,a.isWidget)),e.xp6(2),e.Q6J("ngIf",!a.isWidget)("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",!a.isWidget||!a.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngIf",a.isWidget&&a.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngClass",e.kEZ(13,Z,!a.isWidget&&!a.touchDevice,!a.isWidget&&a.touchDevice,a.isWidget)),e.xp6(1),e.Q6J("ngIf",!a.isWidget)("ngIfElse",l),e.xp6(3),e.Q6J("ngIf",!a.isWidget)}}const V=function(A,Q){return{"p-4":A,"p-2":Q}};function ae(A,Q){if(1&A&&(e.TgZ(0,"div",52),e.O4$(),e.TgZ(1,"svg",53),e._UZ(2,"path",54),e.qZA(),e.kcU(),e._UZ(3,"app-loader",55),e.TgZ(4,"div",56),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&A){const n=e.oxw();e.Q6J("ngClass",e.WLB(6,V,!n.isWidget,n.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",n.loadingMessage),e.xp6(2),e.Oqu(e.lcZ(6,4,"COMPONENTS.UPLOADER.LOADING.SUBTEXT"))}}function ne(A,Q){1&A&&e.GkF(0)}function B(A,Q){if(1&A){const n=e.EpF();e.TgZ(0,"input",57,58),e.NdJ("ngModelChange",function(a){e.CHM(n);const I=e.oxw();return e.KtG(I.remoteUrl=a)})("ngModelChange",function(){e.CHM(n);const a=e.MAs(1),I=e.oxw();return e.KtG(I.isRemoteUrlValid=!a.invalid)}),e.ALo(2,"translate"),e.qZA()}if(2&A){const n=e.oxw();e.Q6J("placeholder",e.lcZ(2,3,"COMPONENTS.UPLOADER.REMOTE_URL_INPUT_PLACEHOLDER"))("ngModel",n.remoteUrl)("pattern","^https?://[^.]+\\.(.+)")}}const re=function(A,Q){return{uploading:A,"widget flex-grow-1 min-w-0":Q}};let q=(()=>{class A{constructor(n,l,a,I,W,N,z,le,pe){this.postMessageService=n,this.uploadService=l,this.uploadObservablesService=a,this.uploaderService=I,this.toastService=W,this.renderer=N,this.ngZone=z,this.translateService=le,this.proxyService=pe,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="",this.touchDevice=_.eX,this.isWaitingRemoteUrl=!1,this.remoteUrl="",this.isRemoteUrlValid=!1,this.dragOverEvent=!1,this.checkingFileMessage="",this.options=this.uploaderService.uploaderOptions;const ce=this.uploadService.preferences.uploader;ce.checkImage.active||(this.options.compress=!1),ce.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){var n=this;return(0,h.Z)(function*(){n.handleClipboardPasteEvent(),n.handleExternalUpload(),n.checkingFileMessage=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CHECK"),n.loadingMessage=n.checkingFileMessage})()}handleClipboardPasteEvent(){var n=this;this.clipboardPasteEventSubscription=(0,b.R)(document.body,"paste").subscribe(function(){var l=(0,h.Z)(function*(a){if(n.isWidget&&n.isWaitingRemoteUrl||!n.canUpload)return;const I=Array.from((a.clipboardData||a.originalEvent.clipboardData).items);let W=[];for(const N of I)if(0===N.type.indexOf("image")){const z=N.getAsFile();z&&W.push(z)}W.length>0?yield n.preUpload(W):n.reset()});return function(a){return l.apply(this,arguments)}}())}handleExternalUpload(){var n=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var l=(0,h.Z)(function*(a){if(a){if(!n.canUpload)return;yield n.preUpload([a.file],a.options)}else n.fileInputRef.nativeElement.click()});return function(a){return l.apply(this,arguments)}}())}handleSelectionEvent(n){var l=this;return(0,h.Z)(function*(){if(!l.canUpload)return;const a=n.target;if(a.files&&a.files.length){const I=Array.from(a.files);return a.value="",l.preUpload(I)}l.reset()})()}handleDropEvent(n){var l=this;return(0,h.Z)(function*(){if(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!l.canUpload)return;const a=n.dataTransfer?.files?Array.from(n.dataTransfer.files):[];if(a.length)return l.preUpload(a);l.reset()})()}handleRemoteUrlUpload(n){var l=this;return(0,h.Z)(function*(){if(!l.canUpload)return;const a=l.remoteUrl;l.loadingMessage=l.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.GETTING_REMOTE_FILE"),l.toggleRemoteUrlForm(n);const I=(0,f.Tb)(a);if(!I.ext||-1===c.O8.findIndex(N=>-1!==N.ext.indexOf(I.ext)))return l.handleErrors([I.name],[]),void l.reset();const W=yield l.proxyService.get(a);return W?l.preUpload([new File([W],I.name,{type:W.type,lastModified:Date.now()})]):(l.toastService.show({content:"Errore nel recupero dell'immagine dall'url!",level:U.m.ERROR}),l.reset(),void l.postMessageService.send(i.l.UPLOAD_ERROR,{filename:I.name,error:r.REMOTE_URL_RESPONSE}))})()}saveOptions(n=!0){this.uploaderService.uploaderOptions=this.options,n&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(n){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(n,"dragover",l=>{l.preventDefault()})}))}get canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage=this.checkingFileMessage,this.postMessageService.send(i.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(n,l){var a=this;return(0,h.Z)(function*(){const I=[...a.currentFolderPath];let W=[],N=[],z=[],le=[];l?l.allowOverwrite=l.allowOverwrite||!1:(l=a.uploaderService.uploaderOptions).allowOverwrite=!1;for(let Y=0;Y<n.length;Y++){let ie=l.compress?yield a.uploaderService.compressFileIfNeeded(n[Y],l.imageDimensions):n[Y];if(ie=yield a.uploaderService.orientFileIfNeeded(ie),ie){const de=(0,f.Tb)(ie.name),he=c.O8.find(ge=>-1!==ge.ext.indexOf(de.ext));if(!he){z.push(ie.name);continue}if(ie.size>he.maxSize){le.push(ie.name);continue}W.push({file:{name:ie.name,size:ie.size,time:0,url:"",ext:de.ext,filename:de.filename,isImage:(0,f.Or)(de.ext),embedUrl:"",type:u.VC.FILE},progress:0,completed:!1}),N.push(ie)}}if(a.handleErrors(z,le),0===N.length)return void a.reset();const pe=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.UPLOADING",{total:N.length}),ce=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CREATING_PACKAGE",{total:N.length});a.uploadObservablesService.pushUploadingFileQueue(W);for(let Y=0;Y<N.length;++Y){a.loadingMessage=ce;const ie=yield a.uploadService.getHostToken(I,N[Y].name);W[Y].progress+=20,a.loadingMessage=pe.replace("{{current}}",`${Y+1}`),yield(0,S.z)(a.uploaderService.upload(N[Y],W[Y],ie,l.allowOverwrite))}a.uploadObservablesService.pushUploadingFileQueue([]);const ue=W.filter(Y=>!Y.error).map(Y=>Y.file);ue.length>0&&(a.fileUploadedEvent.emit({list:ue,rewrite:l.allowOverwrite,destPath:I}),a.postMessageService.send(i.l.UPLOAD_SUCCESS,{fileList:ue.map(Y=>({filename:Y.name,isImage:Y.isImage,url:Y.url}))}),l.openLinkModalAfterUpload&&a.uploadObservablesService.pushAction({name:u.In.FILE_SHOW_LINKS,payload:{entities:(0,f.jL)(ue)}})),a.reset()})()}handleErrors(n,l){if(0!==n.length||0!==l.length){if(!this.isWidget)return void this.toastService.show({content:this.createToastMessage(n,l),level:U.m.ERROR});[[r.UNSUPPORTED,n],[r.OVERSIZED,l]].forEach(a=>{a[1].forEach(I=>{this.postMessageService.send(i.l.UPLOAD_ERROR,{filename:I,error:a[0]})})})}}createToastMessage(n,l){let a=[];return n.length&&a.push(n.length>1?`I file <strong>${n.join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${n[0]}</strong> ha un formato non supportato!`),l.length&&a.push(l.length>1?`I file <strong>${l.join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${l[0]}</strong> \xe8 troppo pesante!`),a.join("<br><br>")}toggleRemoteUrlForm(n,l){n.stopPropagation(),this.isWidget?this.isWaitingRemoteUrl=!this.isWaitingRemoteUrl:l?.open(),this.remoteUrl=""}ngOnDestroy(){this.startExternalUploadSubscription?.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return A.\u0275fac=function(n){return new(n||A)(e.Y36(v.F),e.Y36(d.C),e.Y36(m.r),e.Y36(T.q),e.Y36(w.k),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(G.sK),e.Y36(C.y))},A.\u0275cmp=e.Xpm({type:A,selectors:[["app-uploader"]],viewQuery:function(n,l){if(1&n&&e.Gf(R,5),2&n){let a;e.iGM(a=e.CRH())&&(l.fileInputRef=a.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:35,vars:37,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],[3,"title"],["optionsModal",""],[3,"innerHtml"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto",3,"innerHTML"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto",3,"innerHTML"],["size","md",3,"title","disableCloseButton"],["remoteUrlModal",""],[1,"mb-2",3,"innerHTML"],[4,"ngTemplateOutlet"],["footer",""],["type","button",1,"btn","btn-secondary",3,"innerText","click"],["type","button",1,"btn","btn-primary",3,"disabled","innerText","click"],["remoteUrlInput",""],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],["class","description text-center",3,"ngClass",4,"ngIf"],["class","input-group input-group-sm remote-url-form justify-content-center mb-1",4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"description","text-center",3,"ngClass"],[3,"innerHTML",4,"ngIf"],[1,"ms-1","remote-url-btn","fst-italic","cursor-pointer",3,"ngClass","click"],[3,"innerHTML"],[1,"input-group","input-group-sm","remote-url-form","justify-content-center","mb-1"],[1,"input-group-text","bg-light",3,"disabled","click"],[1,"material-icons-outlined","icon-small"],[1,"input-group-text","bg-light",3,"click"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","options-icon",3,"click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","remote-url-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"],["type","text","required","",1,"form-control",3,"placeholder","ngModel","pattern","ngModelChange"],["input","ngModel"]],template:function(n,l){if(1&n){const a=e.EpF();e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(W){return l.handleSelectionEvent(W)}),e.qZA(),e.YNc(3,$,13,17,"ng-container",3),e.YNc(4,ae,7,9,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6),e.ALo(8,"translate"),e._UZ(9,"div",7),e.ALo(10,"translate"),e.TgZ(11,"ul",8)(12,"li")(13,"div",9)(14,"input",10),e.NdJ("ngModelChange",function(W){return l.options.compress=W})("ngModelChange",function(){return l.saveOptions()}),e.qZA(),e._UZ(15,"label",11),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"li")(18,"div",9)(19,"input",12),e.NdJ("ngModelChange",function(W){return l.options.openLinkModalAfterUpload=W})("ngModelChange",function(){return l.saveOptions()}),e.qZA(),e._UZ(20,"label",13),e.ALo(21,"translate"),e.qZA()()()(),e.TgZ(22,"app-modal",14,15),e.ALo(24,"translate"),e._UZ(25,"p",16),e.ALo(26,"translate"),e.YNc(27,ne,1,0,"ng-container",17),e.ynx(28,18),e.TgZ(29,"button",19),e.NdJ("click",function(){e.CHM(a);const W=e.MAs(23);return e.KtG(W.close("Close click"))}),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",20),e.NdJ("click",function(W){return e.CHM(a),e.MAs(23).close("Upload click"),e.KtG(l.handleRemoteUrlUpload(W))}),e.ALo(32,"translate"),e.qZA(),e.BQk(),e.qZA(),e.YNc(33,B,3,5,"ng-template",null,21,e.W1O)}if(2&n){const a=e.MAs(5),I=e.MAs(34);e.Q6J("ngClass",e.WLB(34,re,l.isUploading,l.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",l.loading||l.isUploading),e.xp6(2),e.Q6J("ngIf",!l.isUploading)("ngIfElse",a),e.xp6(3),e.Q6J("title",e.lcZ(8,18,"COMPONENTS.UPLOADER.SETTINGS_MODAL.TITLE")),e.xp6(3),e.Q6J("innerHtml",e.lcZ(10,20,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.DESCRIPTION"),e.oJD),e.xp6(5),e.Q6J("ngModel",l.options.compress),e.xp6(1),e.Q6J("innerHTML",e.lcZ(16,22,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.COMPRESS_SWITCH"),e.oJD),e.xp6(4),e.Q6J("ngModel",l.options.openLinkModalAfterUpload),e.xp6(1),e.Q6J("innerHTML",e.lcZ(21,24,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.SHOW_LINK_SWITCH"),e.oJD),e.xp6(2),e.Q6J("title",e.lcZ(24,26,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.TITLE"))("disableCloseButton",!0),e.xp6(3),e.Q6J("innerHTML",e.lcZ(26,28,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.CONTENT"),e.oJD),e.xp6(2),e.Q6J("ngTemplateOutlet",I),e.xp6(2),e.Q6J("innerText",e.lcZ(30,30,"SHARED.CANCEL")),e.xp6(2),e.Q6J("disabled",0===l.remoteUrl.length||!l.isRemoteUrlValid)("innerText",e.lcZ(32,32,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.UPLOAD_BTN"))}},dependencies:[x.mk,x.O5,x.tP,x.PC,s.Fj,s.Wl,s.JJ,s.Q7,s.c5,s.On,E.R,O.R,M.z,P.J,x.OU,G.X$],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864FE;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:350px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{top:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{opacity:1}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{right:5px}.uploader[_ngcontent-%COMP%]   .remote-url-icon[_ngcontent-%COMP%]{right:30px}.upload-area.cursor-pointer[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo):not(.description), .upload-area.cursor-pointer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.remote-url-btn){pointer-events:none}.remote-url-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:300px}.remote-url-form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:.5}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),A})()},1197:(X,F,t)=>{"use strict";t.d(F,{M:()=>c});var h=t(8694),U=t(6895),e=t(4006),b=t(6818),S=t(1043),f=t(582),_=t(9383),i=t(4650);let c=(()=>{class u{}return u.\u0275fac=function(v){return new(v||u)},u.\u0275mod=i.oAB({type:u}),u.\u0275inj=i.cJS({imports:[h.r,U.ez,e.u5,b.q,S.h,f.z,_.aw.forChild()]}),u})()},8694:(X,F,t)=>{"use strict";t.d(F,{r:()=>e});var h=t(6895),U=t(4650);let e=(()=>{class b{}return b.\u0275fac=function(f){return new(f||b)},b.\u0275mod=U.oAB({type:b}),b.\u0275inj=U.cJS({imports:[h.ez]}),b})()},8212:(X,F,t)=>{"use strict";t.d(F,{J:()=>U});var h=t(4650);let U=(()=>{class e{transform(S,f){return S.join(f)}}return e.\u0275fac=function(S){return new(S||e)},e.\u0275pipe=h.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},575:(X,F,t)=>{"use strict";t.d(F,{In:()=>h,Ky:()=>S,VC:()=>U,c5:()=>b,gG:()=>e});var h=(()=>{return(f=h||(h={})).FILE_SHOW_LINKS="fileLinks",f.FILE_EDIT="fileEdit",f.DELETE="delete",f.RENAME="rename",f.MOVE="move",h;var f})(),U=(()=>{return(f=U||(U={})).FILE="file",f.FOLDER="folder",U;var f})(),e=(()=>{return(f=e||(e={})).FILENAME="filename",f.SIZE="size",f.TIME="time",f.EXTENSION="ext",e;var f})(),b=(()=>{return(f=b||(b={})).GRID="grid",f.LIST="list",b;var f})(),S=(()=>{return(f=S||(S={})).W_768_I_1="(max-width: 767.98px)",f.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",f.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",f.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",f.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",f.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",f.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",f.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",f.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",f.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",f.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",f.W_3738_I_10="(min-width: 3424px)",S;var f})()},6986:(X,F,t)=>{"use strict";t.d(F,{C7:()=>b,Mi:()=>S,O8:()=>U,er:()=>f,p0:()=>e,xt:()=>_});var h=t(575);const U=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(i=>(i.maxSize*=1048576,i)),e={lastPath:[],layout:{asc:!0,orderBy:h.gG.FILENAME,type:h.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},b="https://upload.forumfree.net/api/",S=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,f=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,_={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},4573:(X,F,t)=>{"use strict";t.d(F,{y:()=>r});var h=t(5861),U=t(7824),e=t(9808),b=t(5698),S=t(3900),f=t(9646),_=t(262),i=t(608),c=t(4650),u=t(529);let r=(()=>{class v{constructor(m){this.http=m,this.proxyUrl="https://script.forumfree.it/i/proxy"}get(m){var T=this;return(0,h.Z)(function*(){const w=T.sendRequest(m);return yield(0,e.n)(w)})()}sendRequest(m){return this.getUrlContent(m).pipe((0,b.q)(1),(0,S.w)(T=>(0,f.of)(T)),(0,_.K)(()=>this.getUrlContentWithProxy(m)))}getUrlContent(m){return this.http.get(m,{responseType:"blob"})}getUrlContentWithProxy(m){return this.http.get(this.proxyUrl,{headers:{[U._.HeaderKeys.TOKEN_TYPE]:i.s.ACCESS,"x-remote-url":m},responseType:"blob"}).pipe((0,b.q)(1),(0,_.K)(()=>(0,f.of)(void 0)))}}return v.\u0275fac=function(m){return new(m||v)(c.LFG(u.eN))},v.\u0275prov=c.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},3124:(X,F,t)=>{"use strict";t.d(F,{B:()=>b});var h=t(575),U=t(4650),e=t(3138);let b=(()=>{class S{constructor(_){this.globalsService=_,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(i=>{this.ffuid=i?i.user.ffuid:""})}getItem(_){const i=this.createKey(_);if(this.cache.hasOwnProperty(i))return this.cache[i]}setItem(_,i){this.cache[this.createKey(_)]=i}removeItem(_){const i=this.createKey(_);if(this.cache.hasOwnProperty(i)){if(this.cache[i].folders.length)for(const c of this.cache[i].folders)this.removeItem([..._,c.name]);return delete this.cache[i],!0}return!1}getEntities(_,i){let c={};const u=this.createKey(_);if(!this.cache.hasOwnProperty(u))return c;for(const r of i){const v=(r.type===h.VC.FILE?this.cache[u].files:this.cache[u].folders).find(d=>d.name===r.name);v&&(c[v.name]=v)}return c}addEntities(_,i,c=h.VC.FILE){const u=this.createKey(_);return!!this.cache.hasOwnProperty(u)&&(Array.isArray(i)||(i=[i]),c===h.VC.FILE?this.cache[u].files.unshift(...i):this.cache[u].folders.unshift(...i),!0)}removeEntities(_,i,c=h.VC.FILE){if(Array.isArray(i)||(i=[i]),c===h.VC.FOLDER)for(const d of i)this.removeItem([..._,d]);const u=this.createKey(_);if(!this.cache.hasOwnProperty(u))return[];const r=c===h.VC.FILE?"files":"folders";let v=[];for(const d of i){const m=this.cache[u][r].findIndex(T=>T.name===d);m>-1&&(this.cache[u][r].splice(m,1),v.push(d))}return v}refactorFolderContent(_,i){const c=this.createKey(_);if(!this.cache.hasOwnProperty(c))return!1;i.endsWith("/")||(i+="/");for(const u of this.cache[c].folders)u.url=i+u.name;for(const u of this.cache[c].files)u.url=u.embedUrl=i+u.name,u.time=Date.now();return!0}createKey(_){return`${this.ffuid}/${_.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return S.\u0275fac=function(_){return new(_||S)(U.LFG(e.d))},S.\u0275prov=U.Yz7({token:S,factory:S.\u0275fac,providedIn:"root"}),S})()},146:(X,F,t)=>{"use strict";t.d(F,{r:()=>S});var h=t(7579),U=t(1135),e=t(4650),b=t(8745);let S=(()=>{class f{constructor(i){this.uploadPreferencesService=i,this.selectedFileListArray=[],this.actionSubject=new h.x,this.uploadingFileQueueSubject=new h.x,this.uploadingFileErrorSubject=new h.x,this.currentFolderPathSubject=new h.x,this.layoutOptionsSubject=new h.x,this.renameEntitySubject=new h.x,this.entityPendingSubject=new h.x,this.deleteFileSubject=new h.x,this.uploadedFileSubject=new h.x,this.draggedFileListSubject=new h.x,this.startUploadSubject=new h.x,this.startMoveSubject=new h.x,this.selectedFileListSubject=new U.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(i){this.actionSubject.next(i)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(i){this.uploadPreferencesService.layoutOptions=i,this.layoutOptionsSubject.next(i)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(i){this.uploadPreferencesService.lastFolderPath=i,this.currentFolderPathSubject.next(i)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(i){this.uploadingFileQueueSubject.next(i)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(i){this.uploadingFileErrorSubject.next(i)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(i){this.renameEntitySubject.next(i)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(i){this.entityPendingSubject.next(i)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(i){this.deleteFileSubject.next(i)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(i){this.uploadedFileSubject.next(i)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(i){this.draggedFileListSubject.next(i)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(i){this.startUploadSubject.next(i)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(i){this.startMoveSubject.next(i)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(i){if(Array.isArray(i)||(i=[i]),0===i.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let c=!1;for(const u of i){const r=this.selectedFileListArray.findIndex(v=>v.name===u.name);u.selected?-1===r&&(this.selectedFileListArray.push({name:u.name}),c=!0):r>-1&&(this.selectedFileListArray.splice(r,1),c=!0)}c&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return f.\u0275fac=function(i){return new(i||f)(e.LFG(b.p))},f.\u0275prov=e.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},8745:(X,F,t)=>{"use strict";t.d(F,{p:()=>f});var h=t(5044),U=t(6986),e=t(4650),b=t(2381),S=t(6161);let f=(()=>{class _{constructor(c,u){this.preferencesService=c,this.urlQueryParamsService=u;const r=this.urlQueryParamsService.getAndDeleteParam(h.RT.UPLOAD_PATH);r&&(this.lastFolderPath=r.split("/").filter(v=>v.length>0))}get preferences(){return this.preferencesService.getItem(h.Ye.UPLOAD)||U.p0}set preferences(c){this.preferencesService.setItem(h.Ye.UPLOAD,c)}get lastFolderPath(){return(this.preferences.lastPath||U.p0.lastPath).filter(c=>c.length>0)}set lastFolderPath(c){const u=this.preferences;u.lastPath=c,this.preferences=u}get layoutOptions(){const c=U.p0.layout,u=this.preferences.layout;return u&&0===Object.keys(c).filter(r=>!u.hasOwnProperty(r)).length?u:c}set layoutOptions(c){const u=this.preferences;u.layout=c,this.preferences=u}get uploader(){const c=this.preferences.uploader||U.p0.uploader;return!c.checkImage.active&&Date.now()-c.checkImage.time>6048e5&&(c.checkImage.active=!0,this.uploader=c),c.hasOwnProperty("showLinkModal")||(c.showLinkModal=!1),c}set uploader(c){const u=this.preferences;u.uploader=c,this.preferences=u}}return _.\u0275fac=function(c){return new(c||_)(e.LFG(b.y),e.LFG(S.J))},_.\u0275prov=e.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},3207:(X,F,t)=>{"use strict";t.d(F,{C:()=>x});var h=t(5861),U=t(7824),e=t(3905),b=t(575),S=t(3848),v=t(6986),d=t(1042),m=t(4650),T=t(5395),w=t(3124),G=t(8745),C=t(529);let x=(()=>{class s{constructor(O,M,P,R){this.graphqlService=O,this.uploadCacheService=M,this.uploadPreferencesService=P,this.http=R}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(U._.HeaderKeys.UUID,(0,d.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(U._.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(U._.HeaderKeys.UUID)||""}getFileList(O,M){var P=this;return(0,h.Z)(function*(){const R=P.uploadCacheService.getItem(O);if(R)return R;const J=(yield P.graphqlService.query({query:"\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",variables:{scope:M,target:O.join("/")}})).data.uploadEntitiesListToken,k=yield P.sendRequest(J),te={files:k.files.map(oe=>{const se=(0,S.Tb)(oe.url);return{...oe,time:1e3*oe.time,filename:se.filename,ext:se.ext,isImage:(0,S.Or)(se.ext),embedUrl:`${oe.url}?t=${oe.time}`,type:b.VC.FILE}}),folders:k.folders.map(oe=>({...oe,type:b.VC.FOLDER}))};return P.uploadCacheService.setItem(O,te),te})()}createDirectory(O,M){var P=this;return(0,h.Z)(function*(){const R=(yield P.graphqlService.mutate({mutation:"\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",variables:{scope:M,target:O.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield P.sendRequest(R)})()}moveRenameEntity(O,M,P,R,J){var k=this;return(0,h.Z)(function*(){R||(R=P);const ee=(yield k.graphqlService.mutate({mutation:"\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",variables:{scope:J,source:(O.length?`${O.join("/")}/`:"")+P,target:(M.length?`${M.join("/")}/`:"")+R}})).data.uploadEntitiesMoveToken,te=yield k.sendRequest(ee);return{...te,time:1e3*te.time}})()}deleteEntity(O,M,P){var R=this;return(0,h.Z)(function*(){const J=(yield R.graphqlService.mutate({mutation:"\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",variables:{scope:P,target:(O.length?`${O.join("/")}/`:"")+M}})).data.uploadEntitiesDeleteToken;return yield R.sendRequest(J),!0})()}getHostToken(O,M,P){var R=this;return(0,h.Z)(function*(){return(yield R.graphqlService.query({query:"\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",variables:{scope:P,target:(O.length?`${O.join("/")}/`:"")+M}})).data.uploadEntitiesHostToken})()}sendRequest(O){var M=this;return(0,h.Z)(function*(){return(yield(0,e.z)(M.http.post(v.C7,JSON.stringify({payload:O}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(O,M){var P=this;return(0,h.Z)(function*(){return yield P.graphqlService.subscribe({query:"\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}",variables:{scope:M}},R=>{if(!R.data?.uploadEntities)return;const J=JSON.parse(R.data.uploadEntities.eventMessage);!J.payload.customHeaders||!J.payload.customHeaders.hasOwnProperty(U._.HeaderKeys.UUID)||J.payload.customHeaders[U._.HeaderKeys.UUID]===P.getGqlIdHeader()||O({type:R.data.uploadEntities.eventType,message:J})})})()}getBlobFromUrl(O){var M=this;return(0,h.Z)(function*(){return yield(0,e.z)(M.http.get(O,{responseType:"blob"})).catch(()=>{})})()}}return s.\u0275fac=function(O){return new(O||s)(m.LFG(T.J),m.LFG(w.B),m.LFG(G.p),m.LFG(C.eN))},s.\u0275prov=m.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})()},3848:(X,F,t)=>{"use strict";t.d(F,{$H:()=>m,JN:()=>u,Lv:()=>f,Or:()=>d,Tb:()=>b,jL:()=>v,lY:()=>_,ok:()=>w,rQ:()=>G,rc:()=>T,sT:()=>i,zO:()=>S});var h=t(5861),U=t(575),e=t(6986);function b(C){let x=C;if(C.indexOf("/")>-1){const M=C.split("/");x=M[M.length-1]}const s=x.replace(/\?.*$/,"").split("."),E=s.length>1?s[s.length-1].toLowerCase():"",O=decodeURIComponent(s.slice(0,-1).join("."));return{ext:E,filename:O,name:E?`${O}.${E}`:""}}function S(C,x={}){const s=b(C),E=Date.now();return{name:s.name,size:0,time:E,url:C,ext:s.ext,filename:s.filename,isImage:d(s.ext),embedUrl:`${C}?t=${E}`,type:U.VC.FILE,...x}}function f(C){let x=C;x.endsWith("/")&&(x=x.slice(0,-1));const s=x.split("/");return{name:decodeURIComponent(s[s.length-1])}}function _(C){return{name:f(C).name,url:C,type:U.VC.FOLDER}}function i(C){return c.apply(this,arguments)}function c(){return(c=(0,h.Z)(function*(C){const x=new FileReader,s=new Promise(E=>x.addEventListener("load",()=>E(x.result)));return x.readAsDataURL(C),s})).apply(this,arguments)}function u(C){return r.apply(this,arguments)}function r(){return(r=(0,h.Z)(function*(C){const x=new DataView(yield C.arrayBuffer());if(2303741511===x.getUint32(0)&&218765834===x.getUint32(4)){if(-1===[4,6].indexOf(x.getUint8(25)))return!1;const E=Object.assign(new Image,{src:yield i(C)});yield new Promise(P=>E.addEventListener("load",()=>P(!0)));const O=Object.assign(document.createElement("canvas"),{width:E.width,height:E.height}).getContext("2d");if(!O)return!1;O.imageSmoothingEnabled=!1,O.drawImage(E,0,0);const M=O?.getImageData(0,0,E.width,E.height);if(M)for(let P=0;P<M.data.length;P+=4)if(M.data[P+3]<255)return!0}return!1})).apply(this,arguments)}function v(C){return C.map(x=>({name:x.name,ext:x.ext,type:U.VC.FILE,url:x.url,embedUrl:x.embedUrl,isImage:x.isImage}))}function d(C,x=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(C)&&!x.includes(C)}function m(C){return d(C,["gif","svg"])}function T(C,x,s,E=[],O=""){let M={...e.xt};const P=C.trim();M.invalidLength=0===P.length;const R=(P+O).replace(/\s{2,}/g," ");return M.alreadyUsed=x!==P&&E.includes(R),M.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(C),M.invalidCharacter=!(s===U.VC.FILE?e.Mi.test(C):e.er.test(C)),M}function w(C,x){return C.join("/")===x.join("/")}function G(C){let x=[],s=[];for(const E of C)E.type===U.VC.FILE?x.push(E):s.push(E);return{[U.VC.FILE]:x,[U.VC.FOLDER]:s}}},3612:(X,F,t)=>{"use strict";t.d(F,{q:()=>G});var h=t(5861),U=t(8896),e=t(6730),b=t.n(e),S=t(9969),f=t(3848),_=t(529),i=t(7579),c=t(7445),u=t(2722),r=t(6986);class v{static findApp1Marker(x){const s=new DataView(x),E=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let O=0;O<x.byteLength-2;O+=2){const M=s.getUint16(O);if(65505===M)return{offset:O,size:s.getUint16(O+2),little:18761==s.getUint16(O+8,!1)};if(E.has(M))break}}static stripAndReturnExif(x){return(0,h.Z)(function*(){const s=yield x.arrayBuffer(),E=v.findApp1Marker(s);return E?{file:new File([s.slice(0,E.offset),s.slice(E.offset+E.size+2)],x.name,{type:x.type,lastModified:x.lastModified}),exif:s.slice(E.offset,E.offset+E.size)}:{file:x}})()}static checkImageOrientation(x){const s=new DataView(x);if(1165519206!=s.getUint32(4,!1))return-1;const E=18761==s.getUint16(10,!1);let O=10;O+=s.getUint32(O+4,E);const M=s.getUint16(O,E);O+=2;for(let P=0;P<M;P++)if(274==s.getUint16(O+12*P,E))return s.getUint16(O+12*P+8,E);return-1}}var d=t(4650),m=t(146),T=t(2020),w=t(4573);let G=(()=>{class C{constructor(s,E,O,M){this.http=s,this.uploadObservablesService=E,this.loadImageService=O,this.proxyService=M,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return{...this.uploaderOptionsObject}}set uploaderOptions(s){this.uploaderOptionsObject={...s}}compressFileIfNeeded(s,E){return(0,h.Z)(function*(){let O=["image/png","image/jpeg"],M={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};E&&(O.push("image/webp"),M.width=E.width,M.height=E.height,M.resize="cover",M.strict=!1);const P=s.type.toLowerCase();return s.size<=4e6&&void 0===E||-1===O.indexOf(s.type.toLowerCase())?s:("image/png"===P&&(yield(0,f.JN)(s))&&(M.convertSize=1/0),new Promise((R,J)=>{new(b())(s,{...M,success:k=>{const ee=k instanceof Blob?new File([k],s.name,{type:s.type,lastModified:s.lastModified}):s;R(ee)},error:J})}))})()}orientFileIfNeeded(s){var E=this;return(0,h.Z)(function*(){if(-1===["image/jpeg"].indexOf(s.type.toLowerCase()))return s;const M=yield v.stripAndReturnExif(s);if(s=M.file,M.exif){const P=v.checkImageOrientation(M.exif);if(1!==P){let R=0;switch(P){case 3:case 4:R=180;break;case 5:case 6:R=90;break;case 7:case 8:R=270}const J=yield(0,f.sT)(s),k=yield new Promise((te,oe)=>{const se=new Image;se.onload=()=>te({originalImage:se,originalBase64:J}),se.onerror=oe,se.src=J}),ee=yield E.loadImageService.transformLoadedImage({original:{base64:k.originalBase64,image:k.originalImage,size:{width:k.originalImage.naturalWidth,height:k.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(P),rotate:R/90}},new S.R);s=new File([(0,U.L)(ee.transformed.base64)],s.name,{type:s.type,lastModified:Date.now()})}}return s})()}upload(s,E,O,M=!1){const P=new i.x,R=new FormData;R.append("payload",O),R.append("upload",s,s.name),M&&R.append("allowOverwrite","1");const J=this.http.request(new _.aW("POST",r.C7,R,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(J.subscribe({next:k=>{if(k.type===_.dt.UploadProgress){if(!k.total||(E.progress=Math.round(50*k.loaded/k.total)+20,E.progress<70))return;(0,c.F)(1e3).pipe((0,u.R)(P.asObservable())).subscribe(()=>{if(E.progress<95){const ee=Math.round(8*Math.random()+8);E.progress+ee>95?E.progress=95:E.progress+=ee}})}else if(k instanceof _.Zn){if(E.progress=100,E.completed=!0,k.body?.error||!k.body?.success)E.error=!0,this.uploadObservablesService.pushUploadingFileError(E);else{E.file.url=k.body.success.url,E.file.time=Date.now(),E.file.embedUrl=`${E.file.url}?t=${E.file.time}`;const ee=(0,f.Tb)(E.file.url);E.file.name=ee.name,E.file.filename=ee.filename}P.next(),P.complete()}},error:()=>{E.error=!0,this.uploadObservablesService.pushUploadingFileError(E),P.next(),P.complete()}})),P.asObservable()}clearPendingRequests(){for(const s of this.requestSubscriptions)s.unsubscribe();this.requestSubscriptions=[]}}return C.\u0275fac=function(s){return new(s||C)(d.LFG(_.eN),d.LFG(m.r),d.LFG(T.y),d.LFG(w.y))},C.\u0275prov=d.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},6730:function(X){X.exports=function(){"use strict";function F(y,o){var p=Object.keys(y);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(y);o&&(g=g.filter(function(D){return Object.getOwnPropertyDescriptor(y,D).enumerable})),p.push.apply(p,g)}return p}function t(y){for(var o=1;o<arguments.length;o++){var p=null!=arguments[o]?arguments[o]:{};o%2?F(Object(p),!0).forEach(function(g){b(y,g,p[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(p)):F(Object(p)).forEach(function(g){Object.defineProperty(y,g,Object.getOwnPropertyDescriptor(p,g))})}return y}function U(y,o){for(var p=0;p<o.length;p++){var g=o[p];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(y,g.key,g)}}function b(y,o,p){return o in y?Object.defineProperty(y,o,{value:p,enumerable:!0,configurable:!0,writable:!0}):y[o]=p,y}function S(){return S=Object.assign||function(y){for(var o=1;o<arguments.length;o++){var p=arguments[o];for(var g in p)Object.prototype.hasOwnProperty.call(p,g)&&(y[g]=p[g])}return y},S.apply(this,arguments)}var y,o,p,g,D,L,K,H,f={exports:{}};y=f,typeof window>"u"||(o=window,p=o.HTMLCanvasElement&&o.HTMLCanvasElement.prototype,g=o.Blob&&function(){try{return Boolean(new Blob)}catch{return!1}}(),D=g&&o.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch{return!1}}(),L=o.BlobBuilder||o.WebKitBlobBuilder||o.MozBlobBuilder||o.MSBlobBuilder,K=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,H=(g||L)&&o.atob&&o.ArrayBuffer&&o.Uint8Array&&function(j){var Z,$,V,ae,ne,B,re,q,A;if(!(Z=j.match(K)))throw new Error("invalid data URI");for($=Z[2]?Z[1]:"text/plain"+(Z[3]||";charset=US-ASCII"),V=!!Z[4],ae=j.slice(Z[0].length),ne=V?atob(ae):decodeURIComponent(ae),B=new ArrayBuffer(ne.length),re=new Uint8Array(B),q=0;q<ne.length;q+=1)re[q]=ne.charCodeAt(q);return g?new Blob([D?re:B],{type:$}):((A=new L).append(B),A.getBlob($))},o.HTMLCanvasElement&&!p.toBlob&&(p.mozGetAsFile?p.toBlob=function(j,Z,$){var V=this;setTimeout(function(){j($&&p.toDataURL&&H?H(V.toDataURL(Z,$)):V.mozGetAsFile("blob",Z))})}:p.toDataURL&&H&&(p.toBlob=p.msToBlob?function(j,Z,$){var V=this;setTimeout(function(){j((Z&&"image/png"!==Z||$)&&p.toDataURL&&H?H(V.toDataURL(Z,$)):V.msToBlob(Z))})}:function(j,Z,$){var V=this;setTimeout(function(){j(H(V.toDataURL(Z,$)))})})),y.exports?y.exports=H:o.dataURLtoBlob=H);var _=f.exports,c={strict:!0,checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},r=typeof window<"u"&&typeof window.document<"u"?window:{},v=function(o){return o>0&&o<1/0},d=Array.prototype.slice;function m(y){return Array.from?Array.from(y):d.call(y)}var T=/^image\/.+$/;function w(y){return T.test(y)}var C=String.fromCharCode;var s=r.btoa;function O(y){var p,o=new DataView(y);try{var g,D,L;if(255===o.getUint8(0)&&216===o.getUint8(1))for(var K=o.byteLength,H=2;H+1<K;){if(255===o.getUint8(H)&&225===o.getUint8(H+1)){D=H;break}H+=1}if(D){var Z=D+10;if("Exif"===function x(y,o,p){var D,g="";for(p+=o,D=o;D<p;D+=1)g+=C(y.getUint8(D));return g}(o,D+4,4)){var $=o.getUint16(Z);if(((g=18761===$)||19789===$)&&42===o.getUint16(Z+2,g)){var V=o.getUint32(Z+4,g);V>=8&&(L=Z+V)}}}if(L){var ne,B,ae=o.getUint16(L,g);for(B=0;B<ae;B+=1)if(274===o.getUint16(ne=L+12*B+2,g)){p=o.getUint16(ne+=8,g),o.setUint16(ne,1,g);break}}}catch{p=1}return p}var P=/\.\d*(?:0|9){12}\d*$/;function R(y){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return P.test(y)?Math.round(y*o)/o:y}function J(y){var o=y.aspectRatio,p=y.height,g=y.width,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",L=v(g),K=v(p);if(L&&K){var H=p*o;("contain"===D||"none"===D)&&H>g||"cover"===D&&H<g?p=g/o:g=p*o}else L?p=g/o:K&&(g=p*o);return{width:g,height:p}}var k=r.ArrayBuffer,ee=r.FileReader,te=r.URL||r.webkitURL,oe=/\.\w+$/,se=r.Compressor;return function(){function y(o,p){(function h(y,o){if(!(y instanceof o))throw new TypeError("Cannot call a class as a function")})(this,y),this.file=o,this.image=new Image,this.options=t(t({},c),p),this.aborted=!1,this.result=null,this.init()}return function e(y,o,p){return o&&U(y.prototype,o),p&&U(y,p),y}(y,[{key:"init",value:function(){var p=this,g=this.file,D=this.options;if(function(o){return!(typeof Blob>"u")&&(o instanceof Blob||"[object Blob]"===Object.prototype.toString.call(o))}(g)){var L=g.type;if(w(L))if(te&&ee)if(k||(D.checkOrientation=!1),te&&!D.checkOrientation)this.load({url:te.createObjectURL(g)});else{var K=new ee,H=D.checkOrientation&&"image/jpeg"===L;this.reader=K,K.onload=function(j){var $=j.target.result,V={};if(H){var ae=O($);ae>1||!te?(V.url=function E(y,o){for(var p=[],D=new Uint8Array(y);D.length>0;)p.push(C.apply(null,m(D.subarray(0,8192)))),D=D.subarray(8192);return"data:".concat(o,";base64,").concat(s(p.join("")))}($,L),ae>1&&S(V,function M(y){var o=0,p=1,g=1;switch(y){case 2:p=-1;break;case 3:o=-180;break;case 4:g=-1;break;case 5:o=90,g=-1;break;case 6:o=90;break;case 7:o=90,p=-1;break;case 8:o=-90}return{rotate:o,scaleX:p,scaleY:g}}(ae))):V.url=te.createObjectURL(g)}else V.url=$;p.load(V)},K.onabort=function(){p.fail(new Error("Aborted to read the image with FileReader."))},K.onerror=function(){p.fail(new Error("Failed to read the image with FileReader."))},K.onloadend=function(){p.reader=null},H?K.readAsArrayBuffer(g):K.readAsDataURL(g)}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(p){var g=this,D=this.file,L=this.image;L.onload=function(){g.draw(t(t({},p),{},{naturalWidth:L.naturalWidth,naturalHeight:L.naturalHeight}))},L.onabort=function(){g.fail(new Error("Aborted to load the image."))},L.onerror=function(){g.fail(new Error("Failed to load the image."))},r.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(r.navigator.userAgent)&&(L.crossOrigin="anonymous"),L.alt=D.name,L.src=p.url}},{key:"draw",value:function(p){var g=this,D=p.naturalWidth,L=p.naturalHeight,K=p.rotate,H=void 0===K?0:K,j=p.scaleX,Z=void 0===j?1:j,$=p.scaleY,V=void 0===$?1:$,ae=this.file,ne=this.image,B=this.options,re=document.createElement("canvas"),q=re.getContext("2d"),A=Math.abs(H)%180==90,Q=("contain"===B.resize||"cover"===B.resize)&&v(B.width)&&v(B.height),n=Math.max(B.maxWidth,0)||1/0,l=Math.max(B.maxHeight,0)||1/0,a=Math.max(B.minWidth,0)||0,I=Math.max(B.minHeight,0)||0,W=D/L,N=B.width,z=B.height;if(A){var le=[l,n];n=le[0],l=le[1];var pe=[I,a];a=pe[0],I=pe[1];var ce=[z,N];N=ce[0],z=ce[1]}Q&&(W=N/z);var ue=J({aspectRatio:W,width:n,height:l},"contain");n=ue.width,l=ue.height;var Y=J({aspectRatio:W,width:a,height:I},"cover");if(a=Y.width,I=Y.height,Q){var ie=J({aspectRatio:W,width:N,height:z},B.resize);N=ie.width,z=ie.height}else{var de=J({aspectRatio:W,width:N,height:z}),he=de.width;N=void 0===he?D:he;var ge=de.height;z=void 0===ge?L:ge}var Ue=-(N=Math.floor(R(Math.min(Math.max(N,a),n))))/2,Me=-(z=Math.floor(R(Math.min(Math.max(z,I),l))))/2,Te=N,Ce=z,me=[];if(Q){var ve,_e,Oe=J({aspectRatio:W,width:D,height:L},{contain:"cover",cover:"contain"}[B.resize]);me.push((D-(ve=Oe.width))/2,(L-(_e=Oe.height))/2,ve,_e)}if(me.push(Ue,Me,Te,Ce),A){var ye=[z,N];N=ye[0],z=ye[1]}re.width=N,re.height=z,w(B.mimeType)||(B.mimeType=ae.type);var be="transparent";if(ae.size>B.convertSize&&B.convertTypes.indexOf(B.mimeType)>=0&&(B.mimeType="image/jpeg"),"image/jpeg"===B.mimeType&&(be="#fff"),q.fillStyle=be,q.fillRect(0,0,N,z),B.beforeDraw&&B.beforeDraw.call(this,q,re),!this.aborted&&(q.save(),q.translate(N/2,z/2),q.rotate(H*Math.PI/180),q.scale(Z,V),q.drawImage.apply(q,[ne].concat(me)),q.restore(),B.drew&&B.drew.call(this,q,re),!this.aborted)){var xe=function(Pe){g.aborted||g.done({naturalWidth:D,naturalHeight:L,result:Pe})};re.toBlob?re.toBlob(xe,B.mimeType,B.quality):xe(_(re.toDataURL(B.mimeType,B.quality)))}}},{key:"done",value:function(p){var g=p.naturalWidth,D=p.naturalHeight,L=p.result,K=this.file,j=this.options;if(te&&!j.checkOrientation&&te.revokeObjectURL(this.image.src),L)if(j.strict&&L.size>K.size&&j.mimeType===K.type&&!(j.width>g||j.height>D||j.minWidth>g||j.minHeight>D||j.maxWidth<g||j.maxHeight<D))L=K;else{var Z=new Date;L.lastModified=Z.getTime(),L.lastModifiedDate=Z,L.name=K.name,L.name&&L.type!==K.type&&(L.name=L.name.replace(oe,function G(y){var o=w(y)?y.substr(6):"";return"jpeg"===o&&(o="jpg"),".".concat(o)}(L.type)))}else L=K;this.result=L,j.success&&j.success.call(this,L)}},{key:"fail",value:function(p){var g=this.options;if(!g.error)throw p;g.error.call(this,p)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=se,y}},{key:"setDefaults",value:function(p){S(c,p)}}]),y}()}()},7445:(X,F,t)=>{"use strict";t.d(F,{F:()=>e});var h=t(4986),U=t(5963);function e(b=0,S=h.z){return b<0&&(b=0),(0,U.H)(b,b,S)}},1042:(X,F,t)=>{"use strict";t.d(F,{Z:()=>v});var h,U=new Uint8Array(16);function e(){if(!h&&!(h=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(U)}const b=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,f=function S(d){return"string"==typeof d&&b.test(d)};for(var _=[],i=0;i<256;++i)_.push((i+256).toString(16).substr(1));const v=function r(d,m,T){var w=(d=d||{}).random||(d.rng||e)();if(w[6]=15&w[6]|64,w[8]=63&w[8]|128,m){T=T||0;for(var G=0;G<16;++G)m[T+G]=w[G];return m}return function c(d){var m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=(_[d[m+0]]+_[d[m+1]]+_[d[m+2]]+_[d[m+3]]+"-"+_[d[m+4]]+_[d[m+5]]+"-"+_[d[m+6]]+_[d[m+7]]+"-"+_[d[m+8]]+_[d[m+9]]+"-"+_[d[m+10]]+_[d[m+11]]+_[d[m+12]]+_[d[m+13]]+_[d[m+14]]+_[d[m+15]]).toLowerCase();if(!f(T))throw TypeError("Stringified UUID is invalid");return T}(w)}}}]);