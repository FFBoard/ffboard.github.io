"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[431],{431:(Y,S,o)=>{o.r(S),o.d(S,{ScriptSandboxModule:()=>Z});var f=o(9090),m=o(6814),h=o(8876),b=o(8109),y=o(1874),l=o(5861),p=o(7165),C=o(1410),R=o(9121),v=o(3729),T=o(137),D=o(8645),O=o(9773),g=o(2907),e=o(5879),F=o(3285),M=o(9473),I=o(7980);function U(s,c){if(1&s&&e._UZ(0,"app-loader",3),2&s){const t=e.oxw();e.Q6J("message",t.loaderMessage)}}const N=function(s){return{"d-none":s}};function B(s,c){if(1&s){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-sandbox",4),e.NdJ("loadEvent",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.sandboxLoaded())}),e.qZA(),e.BQk()}if(2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(5,N,t.sandbox.loading))("head",t.sandbox.headData)("body",t.sandbox.bodyData)("initData",t.sandbox.initData)("eventsObservable",t.sandbox.eventObservable)}}const J=[{path:"",component:(()=>{class s{constructor(t,a,n,r,d,i){this.activatedRoute=t,this.router=a,this.globalsService=n,this.scriptListService=r,this.scriptSandboxService=d,this.tokensService=i,this.loaderMessage="Recupero dei dati",this.breadcrumbUrl=p.B2.SCRIPT_SANDBOX,this.breadcrumbNodes=[],this.breadcrumbTitle="",this.isForum=!1,this.targetType=v.D7.USER,this.componentDestroyed=new D.x,this.forum=this.globalsService.forum}ngOnInit(){var t=this;return(0,l.Z)(function*(){var a;const n=t.activatedRoute.snapshot.paramMap.get("scriptId"),r=t.activatedRoute.snapshot.paramMap.get("sandboxSlug")||"";t.targetType=(null===(a=t.activatedRoute.parent)||void 0===a?void 0:a.snapshot.data.type)||v.D7.USER,t.isForum=t.targetType===v.D7.FORUM,n?(t.breadcrumbNodes=[t.isForum?p.B2.SCRIPT_FORUM:p.B2.SCRIPT_USER],t.globalsService.forumObservable.pipe((0,O.R)(t.componentDestroyed)).subscribe(function(){var d=(0,l.Z)(function*(i){t.forum=i,t.isForum&&(t.loaderMessage="Recupero dei dati",t.breadcrumbTitle="",t.sandbox=void 0,yield t.setData(n,r))});return function(i){return d.apply(this,arguments)}}()),yield t.setData(n,r)):yield t.redirect()})()}setData(t,a){var n=this;return(0,l.Z)(function*(){if(n.isForum&&!n.forum)return void(yield n.redirect());const[r,d,i,E]=yield n.scriptListService.getScript(t,n.isForum?n.forum.cid:n.globalsService.credentials.user.ffuid,n.targetType),u=null==r?void 0:r.sandboxes.find(x=>!x.inSettings&&x.slug===a);r&&i&&u&&(!n.isForum||n.forum.admin||E.edit)?(n.breadcrumbTitle=r.name+(u.name?` - ${u.name}`:""),n.loaderMessage="Caricamento della sandbox",n.setSandbox(u,d)):yield n.redirect()})()}setSandbox(t,a){var n=this;return(0,l.Z)(function*(){const r=yield n.tokensService.generateJwe(g.s9.SANDBOX),d=JSON.parse(a);n.scriptSandboxService.create(t,{token:r,script:{settings:d}}).subscribe(i=>n.sandbox=i)})()}redirect(){var t=this;return(0,l.Z)(function*(){yield t.router.navigate([t.isForum?p.B2.SCRIPT_FORUM:p.B2.SCRIPT_USER])})()}sandboxLoaded(){this.sandbox.loading=!1}ngOnDestroy(){this.componentDestroyed.next(),this.componentDestroyed.complete()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(b.gz),e.Y36(b.F0),e.Y36(C.d),e.Y36(R.o),e.Y36(T.s),e.Y36(g.H))},s.\u0275cmp=e.Xpm({type:s,selectors:[["ng-component"]],decls:3,vars:6,consts:[[1,"d-block",3,"pageTitle","url","nodes","hideNavOnSmallScreen"],[3,"message",4,"ngIf"],[4,"ngIf"],[3,"message"],[3,"ngClass","head","body","initData","eventsObservable","loadEvent"]],template:function(t,a){1&t&&(e._UZ(0,"app-breadcrumb",0),e.YNc(1,U,1,1,"app-loader",1),e.YNc(2,B,2,7,"ng-container",2)),2&t&&(e.Q6J("pageTitle",a.breadcrumbTitle)("url",a.breadcrumbUrl)("nodes",a.breadcrumbNodes)("hideNavOnSmallScreen",!0),e.xp6(1),e.Q6J("ngIf",!a.sandbox||a.sandbox.loading),e.xp6(1),e.Q6J("ngIf",a.sandbox))},dependencies:[F.L,m.mk,m.O5,M.R,I.w],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}"]}),s})()}];let Z=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[f.w,m.ez,h.q,b.Bz.forChild(J),y.i]}),s})()}}]);