(self.webpackChunkpages=self.webpackChunkpages||[]).push([[712],{9829:(q,R,t)=>{"use strict";t.d(R,{R:()=>m});class m{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(M=>M in this).forEach(M=>this[M]=e[M]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(M=>M in this).forEach(M=>this[M]=e[M].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},9582:(q,R,t)=>{"use strict";t.d(R,{y:()=>A});var m=t(1413),O=t(5861);var s=t(5879);let A=(()=>{class g{constructor(){this.autoRotateSupported=function M(){return new Promise(g=>{const x=new Image;x.onload=()=>{g(1===x.width&&2===x.height)},x.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(r,l){return new Promise((E,w)=>{const D=new FileReader;D.onload=Z=>{this.loadImage(Z.target.result,r.type,l).then(E).catch(w)},D.readAsDataURL(r)})}loadImage(r,l,E){return this.isValidImageType(l)?this.loadBase64Image(r,E):Promise.reject(new Error("Invalid image type"))}isValidImageType(r){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(r)}loadImageFromURL(r,l){return new Promise((E,w)=>{const D=new Image;D.onerror=()=>w,D.onload=()=>{const Z=document.createElement("canvas"),G=Z.getContext("2d");Z.width=D.width,Z.height=D.height,null==G||G.drawImage(D,0,0),this.loadBase64Image(Z.toDataURL(),l).then(E)},D.crossOrigin="anonymous",D.src=r})}loadBase64Image(r,l){return new Promise((E,w)=>{const D=new Image;D.onload=()=>E({originalImage:D,originalBase64:r}),D.onerror=w,D.src=r}).then(E=>this.transformImageBase64(E,l))}transformImageBase64(r,l){var E=this;return(0,O.Z)(function*(){const w=yield E.autoRotateSupported,D=yield function C(g){switch("string"==typeof g&&(g=function d(g){const x=new DataView(function U(g){g=g.replace(/^data\:([^\;]+)\;base64,/gim,"");const x=atob(g),r=x.length,l=new Uint8Array(r);for(let E=0;E<r;E++)l[E]=x.charCodeAt(E);return l.buffer}(g));if(65496!==x.getUint16(0,!1))return-2;const r=x.byteLength;let l=2;for(;l<r;){if(x.getUint16(l+2,!1)<=8)return-1;const E=x.getUint16(l,!1);if(l+=2,65505==E){if(1165519206!==x.getUint32(l+=2,!1))return-1;const w=18761==x.getUint16(l+=6,!1);l+=x.getUint32(l+4,w);const D=x.getUint16(l,w);l+=2;for(let Z=0;Z<D;Z++)if(274==x.getUint16(l+12*Z,w))return x.getUint16(l+12*Z+8,w)}else{if(65280!=(65280&E))break;l+=x.getUint16(l,!1)}}return-1}(g)),g){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(w?-1:r.originalBase64);return r.originalImage&&r.originalImage.complete?E.transformLoadedImage({original:{base64:r.originalBase64,image:r.originalImage,size:{width:r.originalImage.naturalWidth,height:r.originalImage.naturalHeight}},exifTransform:D},l):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(r,l){var E=this;return(0,O.Z)(function*(){const w=l.canvasRotation+r.exifTransform.rotate,D={width:r.original.image.naturalWidth,height:r.original.image.naturalHeight};if(0===w&&!r.exifTransform.flip&&!l.containWithinAspectRatio)return{original:{base64:r.original.base64,image:r.original.image,size:(0,m.Z)({},D)},transformed:{base64:r.original.base64,image:r.original.image,size:(0,m.Z)({},D)},exifTransform:r.exifTransform};const Z=E.getTransformedSize(D,r.exifTransform,l),G=document.createElement("canvas");G.width=Z.width,G.height=Z.height;const y=G.getContext("2d");null==y||y.setTransform(r.exifTransform.flip?-1:1,0,0,1,G.width/2,G.height/2),null==y||y.rotate(Math.PI*(w/2)),null==y||y.drawImage(r.original.image,-D.width/2,-D.height/2);const v=G.toDataURL(),f=yield E.loadImageFromBase64(v);return{original:{base64:r.original.base64,image:r.original.image,size:(0,m.Z)({},D)},transformed:{base64:v,image:f,size:{width:f.width,height:f.height}},exifTransform:r.exifTransform}})()}loadImageFromBase64(r){return new Promise((l,E)=>{const w=new Image;w.onload=()=>l(w),w.onerror=E,w.src=r})}getTransformedSize(r,l,E){const w=E.canvasRotation+l.rotate;if(E.containWithinAspectRatio){if(w%2){const Z=r.height/E.aspectRatio;return{width:Math.max(r.height,r.width*E.aspectRatio),height:Math.max(r.width,Z)}}{const Z=r.width/E.aspectRatio;return{width:Math.max(r.width,r.height*E.aspectRatio),height:Math.max(r.height,Z)}}}return w%2?{height:r.width,width:r.height}:{width:r.width,height:r.height}}}return g.\u0275fac=function(r){return new(r||g)},g.\u0275prov=s.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},3705:(q,R,t)=>{"use strict";function m(O){const e=O.split(","),M=e[0].replace("data:","").replace(";base64",""),C=atob(e[1]),d=new ArrayBuffer(C.length),U=new Uint8Array(d);for(let s=0;s<C.length;s+=1)U[s]=C.charCodeAt(s);return new Blob([d],{type:M})}t.d(R,{L:()=>m})},5851:(q,R,t)=>{"use strict";t.d(R,{B:()=>Y});var m=t(5861),O=t(1378),e=t(5879),M=t(2438),C=t(4036),d=t(9054),U=t(4020),s=t(148),A=t(9093),g=t(7621),x=t(1990),r=t(5661),l=t(5172),E=t(3845),w=t(4887),D=t(5487),Z=t(3779),G=t(9515),y=t(6814),v=t(6223),f=t(4929),c=t(554),P=t(4464),b=t(4228);const I=["fileInput"];function Q(o,F){1&o&&(e.O4$(),e.TgZ(0,"svg",31),e._UZ(1,"path",32)(2,"path",33),e.qZA())}const V=function(){return["text-primary"]};function K(o,F){1&o&&e._UZ(0,"app-logo",34),2&o&&e.Q6J("svgClass",e.DdM(2,V))("responsive",!1)}function te(o,F){1&o&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&o&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.DESKTOP"),e.oJD)}function ne(o,F){1&o&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&o&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.TOUCH"),e.oJD)}const re=function(o){return{"fw-bold fs-md-lg":o}},le=function(o){return{"text-decoration-underline":o}};function ce(o,F){if(1&o){const n=e.EpF();e.TgZ(0,"div",35),e.YNc(1,te,2,3,"span",36),e.YNc(2,ne,2,3,"span",36),e.TgZ(3,"span",37),e.NdJ("click",function(a){e.CHM(n);const L=e.oxw(2),j=e.MAs(23);return e.KtG(L.toggleRemoteUrlForm(a,j))}),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&o){const n=e.oxw(2);e.Q6J("ngClass",e.VKq(7,re,!n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.touchDevice),e.xp6(1),e.Q6J("ngIf",n.touchDevice),e.xp6(1),e.Q6J("ngClass",e.VKq(9,le,n.isWidget)),e.xp6(1),e.Oqu(e.lcZ(5,5,"COMPONENTS.UPLOADER.DESCRIPTION.REMOTE_URL"))}}function _e(o,F){1&o&&e.GkF(0)}function ve(o,F){if(1&o){const n=e.EpF();e.TgZ(0,"div",39),e.YNc(1,_e,1,0,"ng-container",17),e.TgZ(2,"button",40),e.NdJ("click",function(a){e.CHM(n);const L=e.oxw(2);return e.KtG(L.handleRemoteUrlUpload(a))}),e.O4$(),e.TgZ(3,"svg",41),e._UZ(4,"path",42),e.qZA()(),e.kcU(),e.TgZ(5,"button",43),e.NdJ("click",function(a){e.CHM(n);const L=e.oxw(2);return e.KtG(L.toggleRemoteUrlForm(a))}),e.O4$(),e.TgZ(6,"svg",41),e._UZ(7,"path",44),e.qZA()()()}if(2&o){const n=e.oxw(2),h=e.MAs(34);e.xp6(1),e.Q6J("ngTemplateOutlet",h),e.xp6(1),e.Q6J("disabled",0===n.remoteUrl.length||!n.isRemoteUrlValid)}}function Ee(o,F){if(1&o&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"em",45),e.ALo(5,"arrayJoin"),e.BQk()),2&o){const n=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"COMPONENTS.UPLOADER.PATH.LONG")," "),e.xp6(2),e.Q6J("innerText",n.currentFolderPath.length?e.xi3(5,4,n.currentFolderPath,"/"):"root")}}function _(o,F){if(1&o&&(e._UZ(0,"div",50),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&o){const n=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,n.currentFolderPath,0,-1),"/"))}}function i(o,F){if(1&o&&(e.TgZ(0,"div",46)(1,"div",47),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,_,3,8,"div",48),e._UZ(5,"div",49),e.ALo(6,"arrayJoin"),e.ALo(7,"slice"),e.qZA()),2&o){const n=e.oxw(2);e.xp6(2),e.hij(" ",e.lcZ(3,3,"COMPONENTS.UPLOADER.PATH.SHORT")," "),e.xp6(2),e.Q6J("ngIf",n.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(n.currentFolderPath.length>1?"/":"")+(n.currentFolderPath.length?e.xi3(6,5,e.xi3(7,8,n.currentFolderPath,n.currentFolderPath.length-1),"/"):"root"))}}const u=function(){return{bottom:0,left:0}};function p(o,F){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"a",51),e.NdJ("click",function(){e.CHM(n);const a=e.oxw(2);return e.KtG(a.openInfoModal.emit())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",52),e.NdJ("click",function(){e.CHM(n),e.oxw(2);const a=e.MAs(7);return e.KtG(a.open())}),e._uU(5," settings "),e.qZA(),e.TgZ(6,"div",53),e.NdJ("click",function(a){e.CHM(n);const L=e.oxw(2),j=e.MAs(23);return e.KtG(L.toggleRemoteUrlForm(a,j))}),e._uU(7," add_link "),e.qZA(),e.BQk()}2&o&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,u)),e.xp6(1),e.Oqu(e.lcZ(3,2,"COMPONENTS.UPLOADER.INFO")))}const T=function(o,F,n){return{"cursor-pointer":o,"py-4 px-3 px-sm-4":F,"p-2 pb-3":n}},S=function(o,F,n){return{"my-2":o,"mb-2":F,"mw-100 mt-1":n}};function H(o,F){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",22,23),e.NdJ("dragenter",function(){e.CHM(n);const a=e.MAs(2),L=e.oxw();return e.KtG(L.setDragOverEvent(a))})("drop",function(a){e.CHM(n);const L=e.oxw();return e.KtG(L.handleDropEvent(a))})("click",function(){e.CHM(n);const a=e.oxw(),L=e.MAs(2);return e.KtG(!a.isWaitingRemoteUrl&&L.click())}),e.YNc(3,Q,3,0,"svg",24),e.YNc(4,K,1,3,"ng-template",null,25,e.W1O),e.YNc(6,ce,6,11,"div",26),e.YNc(7,ve,8,2,"div",27),e.TgZ(8,"div",28),e.YNc(9,Ee,6,7,"ng-container",3),e.YNc(10,i,8,11,"ng-template",null,29,e.W1O),e.qZA()(),e.YNc(12,p,8,5,"ng-container",30),e.BQk()}if(2&o){const n=e.MAs(5),h=e.MAs(11),a=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(9,T,!a.loading&&!a.isWaitingRemoteUrl,!a.isWidget,a.isWidget)),e.xp6(2),e.Q6J("ngIf",!a.isWidget)("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",!a.isWidget||!a.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngIf",a.isWidget&&a.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngClass",e.kEZ(13,S,!a.isWidget&&!a.touchDevice,!a.isWidget&&a.touchDevice,a.isWidget)),e.xp6(1),e.Q6J("ngIf",!a.isWidget)("ngIfElse",h),e.xp6(3),e.Q6J("ngIf",!a.isWidget)}}const N=function(o,F){return{"p-4":o,"p-2":F}};function B(o,F){if(1&o&&(e.TgZ(0,"div",54),e.O4$(),e.TgZ(1,"svg",55),e._UZ(2,"path",56),e.qZA(),e.kcU(),e._UZ(3,"app-loader",57),e.TgZ(4,"div",58),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&o){const n=e.oxw();e.Q6J("ngClass",e.WLB(6,N,!n.isWidget,n.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",n.loadingMessage),e.xp6(2),e.hij(" ",e.lcZ(6,4,"COMPONENTS.UPLOADER.LOADING.SUBTEXT")," ")}}function W(o,F){1&o&&e.GkF(0)}const k=function(o){return{"fs-reset":o}};function z(o,F){if(1&o){const n=e.EpF();e.TgZ(0,"input",59,60),e.NdJ("ngModelChange",function(a){e.CHM(n);const L=e.oxw();return e.KtG(L.remoteUrl=a)})("ngModelChange",function(){e.CHM(n);const a=e.MAs(1),L=e.oxw();return e.KtG(L.isRemoteUrlValid=!a.invalid)}),e.ALo(2,"translate"),e.qZA()}if(2&o){const n=e.oxw();e.Q6J("placeholder",e.lcZ(2,4,"COMPONENTS.UPLOADER.REMOTE_URL_INPUT_PLACEHOLDER"))("ngClass",e.VKq(6,k,n.isWidget))("ngModel",n.remoteUrl)("pattern","^https?://[^.]+\\.(.+)")}}const ie=function(o,F){return{uploading:o,"widget flex-grow-1 min-w-0":F}};let Y=(()=>{class o{constructor(n,h,a,L,j,J,ae,se,ee){this.postMessageService=n,this.uploadService=h,this.uploadObservablesService=a,this.uploaderService=L,this.toastService=j,this.renderer=J,this.ngZone=ae,this.translateService=se,this.proxyService=ee,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="",this.touchDevice=U.eX,this.isWaitingRemoteUrl=!1,this.remoteUrl="",this.isRemoteUrlValid=!1,this.dragOverEvent=!1,this.checkingFileMessage="",this.options=this.uploaderService.uploaderOptions;const X=this.uploadService.preferences.uploader;X.checkImage.active||(this.options.compress=!1),X.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){var n=this;return(0,m.Z)(function*(){n.handleClipboardPasteEvent(),n.handleExternalUpload(),n.checkingFileMessage=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CHECK"),n.loadingMessage=n.checkingFileMessage})()}handleClipboardPasteEvent(){var n=this;this.clipboardPasteEventSubscription=(0,M.R)(document.body,"paste").subscribe(function(){var h=(0,m.Z)(function*(a){if(n.isWidget&&n.isWaitingRemoteUrl||!n.canUpload())return;const L=Array.from((a.clipboardData||a.originalEvent.clipboardData).items);let j=[];for(const J of L)if(0===J.type.indexOf("image")){const ae=J.getAsFile();ae&&j.push(ae)}j.length>0?yield n.preUpload(j):n.reset()});return function(a){return h.apply(this,arguments)}}())}handleExternalUpload(){var n=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var h=(0,m.Z)(function*(a){if(a){if(!n.canUpload())return;yield n.preUpload([a.file],a.options)}else n.fileInputRef.nativeElement.click()});return function(a){return h.apply(this,arguments)}}())}handleSelectionEvent(n){var h=this;return(0,m.Z)(function*(){if(!h.canUpload())return;const a=n.target;if(a.files&&a.files.length){const L=Array.from(a.files);return a.value="",h.preUpload(L)}h.reset()})()}handleDropEvent(n){var h=this;return(0,m.Z)(function*(){var a;if(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!h.canUpload())return;const L=null!==(a=n.dataTransfer)&&void 0!==a&&a.files?Array.from(n.dataTransfer.files):[];if(L.length)return h.preUpload(L);h.reset()})()}handleRemoteUrlUpload(n,h){var a=this;return(0,m.Z)(function*(){if(!a.isRemoteUrlValid||0===a.remoteUrl.length||!a.canUpload())return;const L=a.remoteUrl;a.loadingMessage=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.GETTING_REMOTE_FILE"),a.toggleRemoteUrlForm(n,h);const j=(0,d.Tb)(L);if(!j.ext||-1===x.O8.findIndex(ae=>-1!==ae.ext.indexOf(j.ext)))return a.handleErrors([j.name],[]),void a.reset();const J=yield a.proxyService.get(L);return J?a.preUpload([new File([J],j.name,{type:J.type,lastModified:Date.now()})]):(a.toastService.show({content:"Errore nel recupero dell'immagine dall'url!",level:O.m.ERROR}),a.postMessageService.send(s.l.UPLOAD_ERROR,{filename:j.name,error:E.S.REMOTE_URL_RESPONSE}),void a.reset())})()}saveOptions(n=!0){this.uploaderService.uploaderOptions=this.options,n&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(n){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(n,"dragover",h=>{h.preventDefault()})}))}canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage=this.checkingFileMessage,this.postMessageService.send(s.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(n,h){var a=this;return(0,m.Z)(function*(){const L=[...a.currentFolderPath];let j=[],J=[],ae=[],se=[];h?h.allowOverwrite=h.allowOverwrite||!1:(h=a.uploaderService.uploaderOptions).allowOverwrite=!1;for(let $=0;$<n.length;$++){let oe=h.compress?yield a.uploaderService.compressFileIfNeeded(n[$],h.imageDimensions):n[$];if(oe=yield a.uploaderService.orientFileIfNeeded(oe),oe){const de=(0,d.Tb)(oe.name),he=x.O8.find(me=>-1!==me.ext.indexOf(de.ext));if(!he){ae.push(oe.name);continue}if(oe.size>he.maxSize){se.push(oe.name);continue}j.push({file:{name:oe.name,size:oe.size,time:0,url:"",ext:de.ext,filename:de.filename,isImage:(0,d.Or)(de.ext),embedUrl:"",type:l.VC.FILE},progress:0,completed:!1}),J.push(oe)}}if(a.handleErrors(ae,se),0===J.length)return void a.reset();const ee=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.UPLOADING",{total:J.length}),X=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CREATING_PACKAGE",{total:J.length});a.uploadObservablesService.pushUploadingFileQueue(j);for(let $=0;$<J.length;++$){a.loadingMessage=X;const oe=yield a.uploadService.getHostToken(L,J[$].name);j[$].progress+=20,a.loadingMessage=ee.replace("{{current}}",`${$+1}`),yield(0,C.z)(a.uploaderService.upload(J[$],j[$],oe,h.allowOverwrite))}a.uploadObservablesService.pushUploadingFileQueue([]);const ue=j.filter($=>!$.error).map($=>$.file);ue.length>0&&(a.fileUploadedEvent.emit({list:ue,rewrite:h.allowOverwrite,destPath:L}),a.postMessageService.send(s.l.UPLOAD_SUCCESS,{fileList:ue.map($=>({filename:$.name,isImage:$.isImage,url:$.url}))}),h.openLinkModalAfterUpload&&a.uploadObservablesService.pushAction({name:l.In.FILE_SHOW_LINKS,payload:{entities:(0,d.jL)(ue)}})),a.reset()})()}handleErrors(n,h){if(0!==n.length||0!==h.length){if(!this.isWidget)return void this.toastService.show({content:this.createToastMessage(n,h),level:O.m.ERROR});[[E.S.UNSUPPORTED,n],[E.S.OVERSIZED,h]].forEach(a=>{a[1].forEach(L=>{this.postMessageService.send(s.l.UPLOAD_ERROR,{filename:L,error:a[0]})})})}}createToastMessage(n,h){let a=[];return n.length&&a.push(n.length>1?`I file <strong>${n.join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${n[0]}</strong> ha un formato non supportato!`),h.length&&a.push(h.length>1?`I file <strong>${h.join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${h[0]}</strong> \xe8 troppo pesante!`),a.join("<br><br>")}toggleRemoteUrlForm(n,h){n.stopPropagation(),this.isWidget||(this.isWaitingRemoteUrl?null==h||h.close():null==h||h.open()),this.resetRemoteUrlForm(!this.isWaitingRemoteUrl)}resetRemoteUrlForm(n){this.isWaitingRemoteUrl=n,this.remoteUrl=""}ngOnDestroy(){var n;null===(n=this.startExternalUploadSubscription)||void 0===n||n.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return o.\u0275fac=function(n){return new(n||o)(e.Y36(A.F),e.Y36(Z.C),e.Y36(D.r),e.Y36(w.q),e.Y36(r.k),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(G.sK),e.Y36(g.y))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-uploader"]],viewQuery:function(n,h){if(1&n&&e.Gf(I,5),2&n){let a;e.iGM(a=e.CRH())&&(h.fileInputRef=a.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:35,vars:37,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],[3,"title"],["optionsModal",""],[3,"innerHtml"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto",3,"innerHTML"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto",3,"innerHTML"],["size","md",3,"title","disableCloseButton","hidden"],["remoteUrlModal",""],[1,"mb-2",3,"innerHTML"],[4,"ngTemplateOutlet"],["footer",""],["type","button",1,"btn","btn-secondary",3,"innerText","click"],["type","button",1,"btn","btn-primary",3,"disabled","innerText","click"],["remoteUrlInput",""],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],["class","description text-center",3,"ngClass",4,"ngIf"],["class","input-group input-group-sm remote-url-form justify-content-center mb-1",4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"description","text-center",3,"ngClass"],[3,"innerHTML",4,"ngIf"],[1,"ms-1","remote-url-btn","fst-italic","cursor-pointer",3,"ngClass","click"],[3,"innerHTML"],[1,"input-group","input-group-sm","remote-url-form","justify-content-center","mb-1"],[1,"input-group-text","bg-light",3,"disabled","click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 16 16"],["d","M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"],[1,"input-group-text","bg-light",3,"click"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","options-icon",3,"click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","remote-url-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"],["type","text","required","",1,"form-control",3,"placeholder","ngClass","ngModel","pattern","ngModelChange"],["input","ngModel"]],template:function(n,h){if(1&n){const a=e.EpF();e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(j){return h.handleSelectionEvent(j)}),e.qZA(),e.YNc(3,H,13,17,"ng-container",3),e.YNc(4,B,7,9,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6),e.ALo(8,"translate"),e._UZ(9,"div",7),e.ALo(10,"translate"),e.TgZ(11,"ul",8)(12,"li")(13,"div",9)(14,"input",10),e.NdJ("ngModelChange",function(j){return h.options.compress=j})("ngModelChange",function(){return h.saveOptions()}),e.qZA(),e._UZ(15,"label",11),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"li")(18,"div",9)(19,"input",12),e.NdJ("ngModelChange",function(j){return h.options.openLinkModalAfterUpload=j})("ngModelChange",function(){return h.saveOptions()}),e.qZA(),e._UZ(20,"label",13),e.ALo(21,"translate"),e.qZA()()()(),e.TgZ(22,"app-modal",14,15),e.NdJ("hidden",function(){return h.resetRemoteUrlForm(!1)}),e.ALo(24,"translate"),e._UZ(25,"p",16),e.ALo(26,"translate"),e.YNc(27,W,1,0,"ng-container",17),e.ynx(28,18),e.TgZ(29,"button",19),e.NdJ("click",function(){e.CHM(a);const j=e.MAs(23);return e.KtG(j.close())}),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",20),e.NdJ("click",function(j){e.CHM(a);const J=e.MAs(23);return e.KtG(h.handleRemoteUrlUpload(j,J))}),e.ALo(32,"translate"),e.qZA(),e.BQk(),e.qZA(),e.YNc(33,z,3,8,"ng-template",null,21,e.W1O)}if(2&n){const a=e.MAs(5),L=e.MAs(34);e.Q6J("ngClass",e.WLB(34,ie,h.isUploading,h.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",h.loading||h.isUploading),e.xp6(2),e.Q6J("ngIf",!h.isUploading)("ngIfElse",a),e.xp6(3),e.Q6J("title",e.lcZ(8,18,"COMPONENTS.UPLOADER.SETTINGS_MODAL.TITLE")),e.xp6(3),e.Q6J("innerHtml",e.lcZ(10,20,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.DESCRIPTION"),e.oJD),e.xp6(5),e.Q6J("ngModel",h.options.compress),e.xp6(1),e.Q6J("innerHTML",e.lcZ(16,22,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.COMPRESS_SWITCH"),e.oJD),e.xp6(4),e.Q6J("ngModel",h.options.openLinkModalAfterUpload),e.xp6(1),e.Q6J("innerHTML",e.lcZ(21,24,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.SHOW_LINK_SWITCH"),e.oJD),e.xp6(2),e.Q6J("title",e.lcZ(24,26,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.TITLE"))("disableCloseButton",!0),e.xp6(3),e.Q6J("innerHTML",e.lcZ(26,28,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.CONTENT"),e.oJD),e.xp6(2),e.Q6J("ngTemplateOutlet",L),e.xp6(2),e.Q6J("innerText",e.lcZ(30,30,"SHARED.CANCEL")),e.xp6(2),e.Q6J("disabled",0===h.remoteUrl.length||!h.isRemoteUrlValid)("innerText",e.lcZ(32,32,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.UPLOAD_BTN"))}},dependencies:[y.mk,y.O5,y.tP,y.PC,v.Fj,v.Wl,v.JJ,v.Q7,v.c5,v.On,f.R,c.R,P.z,b.J,y.OU,G.X$],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864fe;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:350px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:_ngcontent-%COMP%_draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{top:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{opacity:1}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{right:5px}.uploader[_ngcontent-%COMP%]   .remote-url-icon[_ngcontent-%COMP%]{right:30px}.upload-area.cursor-pointer[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo):not(.description), .upload-area.cursor-pointer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.remote-url-btn){pointer-events:none}.remote-url-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:300px}.remote-url-form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:.5}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes _ngcontent-%COMP%_bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes _ngcontent-%COMP%_draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),o})()},529:(q,R,t)=>{"use strict";t.d(R,{M:()=>A});var m=t(4243),O=t(6814),e=t(6223),M=t(7535),C=t(2740),d=t(4610),U=t(9515),s=t(5879);let A=(()=>{class g{}return g.\u0275fac=function(r){return new(r||g)},g.\u0275mod=s.oAB({type:g}),g.\u0275inj=s.cJS({imports:[m.r,O.ez,e.u5,M.q,C.h,d.z,U.aw.forChild()]}),g})()},3845:(q,R,t)=>{"use strict";t.d(R,{S:()=>m});var m=function(O){return O.UNSUPPORTED="unsupported",O.OVERSIZED="oversized",O.REMOTE_URL_RESPONSE="remote-url-response",O.UPLOAD_FAILED="upload-failed",O}(m||{})},4243:(q,R,t)=>{"use strict";t.d(R,{r:()=>e});var m=t(6814),O=t(5879);let e=(()=>{class M{}return M.\u0275fac=function(d){return new(d||M)},M.\u0275mod=O.oAB({type:M}),M.\u0275inj=O.cJS({imports:[m.ez]}),M})()},4228:(q,R,t)=>{"use strict";t.d(R,{J:()=>O});var m=t(5879);let O=(()=>{class e{transform(C,d){return C.join(d)}}return e.\u0275fac=function(C){return new(C||e)},e.\u0275pipe=m.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},5172:(q,R,t)=>{"use strict";t.d(R,{In:()=>m,Ky:()=>C,VC:()=>O,c5:()=>M,gG:()=>e});var m=function(d){return d.FILE_SHOW_LINKS="fileLinks",d.FILE_EDIT="fileEdit",d.DELETE="delete",d.RENAME="rename",d.MOVE="move",d}(m||{}),O=function(d){return d.FILE="file",d.FOLDER="folder",d}(O||{}),e=function(d){return d.FILENAME="filename",d.SIZE="size",d.TIME="time",d.EXTENSION="ext",d}(e||{}),M=function(d){return d.GRID="grid",d.LIST="list",d}(M||{}),C=function(d){return d.W_768_I_1="(max-width: 767.98px)",d.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",d.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",d.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",d.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",d.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",d.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",d.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",d.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",d.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",d.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",d.W_3738_I_10="(min-width: 3424px)",d}(C||{})},1990:(q,R,t)=>{"use strict";t.d(R,{C7:()=>M,Mi:()=>C,O8:()=>O,er:()=>d,p0:()=>e,xt:()=>U});var m=t(5172);const O=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(s=>(s.maxSize*=1048576,s)),e={lastPath:[],layout:{asc:!0,orderBy:m.gG.FILENAME,type:m.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},M="https://upload.forumfree.net/api/",C=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,d=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,U={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},7621:(q,R,t)=>{"use strict";t.d(R,{y:()=>g});var m=t(5861),O=t(2845),e=t(708),M=t(8180),C=t(4664),d=t(2096),U=t(6306),s=t(5879),A=t(9862);let g=(()=>{class x{constructor(l,E){this.http=l,this.endpointsService=E}get(l){var E=this;return(0,m.Z)(function*(){const w=E.sendRequest(l);return yield(0,e.n)(w)})()}sendRequest(l){return this.getUrlContent(l).pipe((0,M.q)(1),(0,C.w)(E=>(0,d.of)(E)),(0,U.K)(()=>this.getUrlContentWithProxy(l)))}getUrlContent(l){return this.http.get(l,{responseType:"blob"})}getUrlContentWithProxy(l){return this.http.get(this.endpointsService.get(O.jQ.PROXY,O.ph.COMMON),{headers:{[O._o.HeaderKeys.TOKEN_TYPE]:O.s9.ACCESS,"x-remote-url":l},responseType:"blob"}).pipe((0,M.q)(1),(0,U.K)(()=>(0,d.of)(void 0)))}}return x.\u0275fac=function(l){return new(l||x)(s.LFG(A.eN),s.LFG(O.oz))},x.\u0275prov=s.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},5983:(q,R,t)=>{"use strict";t.d(R,{B:()=>M});var m=t(5172),O=t(1410),e=t(5879);let M=(()=>{class C{constructor(U){this.globalsService=U,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(s=>{this.ffuid=s?s.user.ffuid:""})}getItem(U){const s=this.createKey(U);if(this.cache.hasOwnProperty(s))return this.cache[s]}setItem(U,s){this.cache[this.createKey(U)]=s}removeItem(U){const s=this.createKey(U);if(this.cache.hasOwnProperty(s)){if(this.cache[s].folders.length)for(const A of this.cache[s].folders)this.removeItem([...U,A.name]);return delete this.cache[s],!0}return!1}getEntities(U,s){let A={};const g=this.createKey(U);if(!this.cache.hasOwnProperty(g))return A;for(const x of s){const r=(x.type===m.VC.FILE?this.cache[g].files:this.cache[g].folders).find(l=>l.name===x.name);r&&(A[r.name]=r)}return A}addEntities(U,s,A=m.VC.FILE){const g=this.createKey(U);return!!this.cache.hasOwnProperty(g)&&(Array.isArray(s)||(s=[s]),A===m.VC.FILE?this.cache[g].files.unshift(...s):this.cache[g].folders.unshift(...s),!0)}removeEntities(U,s,A=m.VC.FILE){if(Array.isArray(s)||(s=[s]),A===m.VC.FOLDER)for(const l of s)this.removeItem([...U,l]);const g=this.createKey(U);if(!this.cache.hasOwnProperty(g))return[];const x=A===m.VC.FILE?"files":"folders";let r=[];for(const l of s){const E=this.cache[g][x].findIndex(w=>w.name===l);E>-1&&(this.cache[g][x].splice(E,1),r.push(l))}return r}refactorFolderContent(U,s){const A=this.createKey(U);if(!this.cache.hasOwnProperty(A))return!1;s.endsWith("/")||(s+="/");for(const g of this.cache[A].folders)g.url=s+g.name;for(const g of this.cache[A].files)g.url=g.embedUrl=s+g.name,g.time=Date.now();return!0}createKey(U){return`${this.ffuid}/${U.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return C.\u0275fac=function(U){return new(U||C)(e.LFG(O.d))},C.\u0275prov=e.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},5487:(q,R,t)=>{"use strict";t.d(R,{r:()=>C});var m=t(8645),O=t(5619),e=t(446),M=t(5879);let C=(()=>{class d{constructor(s){this.uploadPreferencesService=s,this.selectedFileListArray=[],this.actionSubject=new m.x,this.uploadingFileQueueSubject=new m.x,this.uploadingFileErrorSubject=new m.x,this.currentFolderPathSubject=new m.x,this.layoutOptionsSubject=new m.x,this.renameEntitySubject=new m.x,this.entityPendingSubject=new m.x,this.deleteFileSubject=new m.x,this.uploadedFileSubject=new m.x,this.draggedFileListSubject=new m.x,this.startUploadSubject=new m.x,this.startMoveSubject=new m.x,this.selectedFileListSubject=new O.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(s){this.actionSubject.next(s)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(s){this.uploadPreferencesService.layoutOptions=s,this.layoutOptionsSubject.next(s)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(s){this.uploadPreferencesService.lastFolderPath=s,this.currentFolderPathSubject.next(s)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(s){this.uploadingFileQueueSubject.next(s)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(s){this.uploadingFileErrorSubject.next(s)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(s){this.renameEntitySubject.next(s)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(s){this.entityPendingSubject.next(s)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(s){this.deleteFileSubject.next(s)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(s){this.uploadedFileSubject.next(s)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(s){this.draggedFileListSubject.next(s)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(s){this.startUploadSubject.next(s)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(s){this.startMoveSubject.next(s)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(s){if(Array.isArray(s)||(s=[s]),0===s.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let A=!1;for(const g of s){const x=this.selectedFileListArray.findIndex(r=>r.name===g.name);g.selected?-1===x&&(this.selectedFileListArray.push({name:g.name}),A=!0):x>-1&&(this.selectedFileListArray.splice(x,1),A=!0)}A&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return d.\u0275fac=function(s){return new(s||d)(M.LFG(e.p))},d.\u0275prov=M.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},446:(q,R,t)=>{"use strict";t.d(R,{p:()=>d});var m=t(7165),O=t(463),e=t(1990),M=t(2986),C=t(5879);let d=(()=>{class U{constructor(A,g){this.preferencesService=A,this.urlQueryParamsService=g;const x=this.urlQueryParamsService.getAndDeleteParam(m.RT.UPLOAD_PATH);x&&(this.lastFolderPath=x.split("/").filter(r=>r.length>0))}get preferences(){return this.preferencesService.getItem(m.Ye.UPLOAD)||e.p0}set preferences(A){this.preferencesService.setItem(m.Ye.UPLOAD,A)}get lastFolderPath(){return(this.preferences.lastPath||e.p0.lastPath).filter(A=>A.length>0)}set lastFolderPath(A){const g=this.preferences;g.lastPath=A,this.preferences=g}get layoutOptions(){const A=e.p0.layout,g=this.preferences.layout;return g&&0===Object.keys(A).filter(x=>!g.hasOwnProperty(x)).length?g:A}set layoutOptions(A){const g=this.preferences;g.layout=A,this.preferences=g}get uploader(){const A=this.preferences.uploader||e.p0.uploader;return!A.checkImage.active&&Date.now()-A.checkImage.time>6048e5&&(A.checkImage.active=!0,this.uploader=A),A.hasOwnProperty("showLinkModal")||(A.showLinkModal=!1),A}set uploader(A){const g=this.preferences;g.uploader=A,this.preferences=g}}return U.\u0275fac=function(A){return new(A||U)(C.LFG(O.y),C.LFG(M.J))},U.\u0275prov=C.Yz7({token:U,factory:U.\u0275fac,providedIn:"root"}),U})()},3779:(q,R,t)=>{"use strict";t.d(R,{C:()=>y});var m=t(1413),O=t(5861),e=t(2845),M=t(4036),C=t(5172),d=t(9054),l=t(5983),E=t(1990),w=t(446),D=t(4004),Z=t(5879),G=t(9862);let y=(()=>{class v{constructor(c,P,b,I){this.graphqlService=c,this.uploadCacheService=P,this.uploadPreferencesService=b,this.http=I}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(e._o.HeaderKeys.UUID,(0,D.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(e._o.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(e._o.HeaderKeys.UUID)||""}getFileList(c,P){var b=this;return(0,O.Z)(function*(){const I=b.uploadCacheService.getItem(c);if(I)return I;const Q=(yield b.graphqlService.query({query:"\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",variables:{scope:P,target:c.join("/")}})).data.uploadEntitiesListToken,V=yield b.sendRequest(Q),te={files:V.files.map(ne=>{const re=(0,d.Tb)(ne.url);return(0,m.Z)((0,m.Z)({},ne),{time:1e3*ne.time,filename:re.filename,ext:re.ext,isImage:(0,d.Or)(re.ext),embedUrl:`${ne.url}?t=${ne.time}`,type:C.VC.FILE})}),folders:V.folders.map(ne=>(0,m.Z)((0,m.Z)({},ne),{},{type:C.VC.FOLDER}))};return b.uploadCacheService.setItem(c,te),te})()}createDirectory(c,P){var b=this;return(0,O.Z)(function*(){const I=(yield b.graphqlService.mutate({mutation:"\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",variables:{scope:P,target:c.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield b.sendRequest(I)})()}moveRenameEntity(c,P,b,I,Q){var V=this;return(0,O.Z)(function*(){I||(I=b);const K=(yield V.graphqlService.mutate({mutation:"\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",variables:{scope:Q,source:(c.length?`${c.join("/")}/`:"")+b,target:(P.length?`${P.join("/")}/`:"")+I}})).data.uploadEntitiesMoveToken,te=yield V.sendRequest(K);return(0,m.Z)((0,m.Z)({},te),{},{time:1e3*te.time})})()}deleteEntity(c,P,b){var I=this;return(0,O.Z)(function*(){const Q=(yield I.graphqlService.mutate({mutation:"\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",variables:{scope:b,target:(c.length?`${c.join("/")}/`:"")+P}})).data.uploadEntitiesDeleteToken;return yield I.sendRequest(Q),!0})()}getHostToken(c,P,b){var I=this;return(0,O.Z)(function*(){return(yield I.graphqlService.query({query:"\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",variables:{scope:b,target:(c.length?`${c.join("/")}/`:"")+P}})).data.uploadEntitiesHostToken})()}sendRequest(c){var P=this;return(0,O.Z)(function*(){return(yield(0,M.z)(P.http.post(E.C7,JSON.stringify({payload:c}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(c,P){var b=this;return(0,O.Z)(function*(){return yield b.graphqlService.subscribe({query:"\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}",variables:{scope:P}},I=>{var Q;if(null===(Q=I.data)||void 0===Q||!Q.uploadEntities)return;const V=JSON.parse(I.data.uploadEntities.eventMessage);!V.payload.customHeaders||!V.payload.customHeaders.hasOwnProperty(e._o.HeaderKeys.UUID)||V.payload.customHeaders[e._o.HeaderKeys.UUID]===b.getGqlIdHeader()||c({type:I.data.uploadEntities.eventType,message:V})})})()}}return v.\u0275fac=function(c){return new(c||v)(Z.LFG(e.Jk),Z.LFG(l.B),Z.LFG(w.p),Z.LFG(G.eN))},v.\u0275prov=Z.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},9054:(q,R,t)=>{"use strict";t.d(R,{$H:()=>w,JN:()=>x,Lv:()=>U,Or:()=>E,Tb:()=>C,jL:()=>l,lY:()=>s,ok:()=>Z,rQ:()=>G,rc:()=>D,sT:()=>A,zO:()=>d});var m=t(5861),O=t(1413),e=t(5172),M=t(1990);function C(y){let v=y;if(y.indexOf("/")>-1){const b=y.split("/");v=b[b.length-1]}const f=v.replace(/\?.*$/,"").split("."),c=f.length>1?f[f.length-1].toLowerCase():"",P=decodeURIComponent(f.slice(0,-1).join("."));return{ext:c,filename:P,name:c?`${P}.${c}`:""}}function d(y,v={}){const f=C(y),c=Date.now();return(0,O.Z)({name:f.name,size:0,time:c,url:y,ext:f.ext,filename:f.filename,isImage:E(f.ext),embedUrl:`${y}?t=${c}`,type:e.VC.FILE},v)}function U(y){let v=y;v.endsWith("/")&&(v=v.slice(0,-1));const f=v.split("/");return{name:decodeURIComponent(f[f.length-1])}}function s(y){return{name:U(y).name,url:y,type:e.VC.FOLDER}}function A(y){return g.apply(this,arguments)}function g(){return(g=(0,m.Z)(function*(y){const v=new FileReader,f=new Promise(c=>v.addEventListener("load",()=>c(v.result)));return v.readAsDataURL(y),f})).apply(this,arguments)}function x(y){return r.apply(this,arguments)}function r(){return(r=(0,m.Z)(function*(y){const v=new DataView(yield y.arrayBuffer());if(2303741511===v.getUint32(0)&&218765834===v.getUint32(4)){if(-1===[4,6].indexOf(v.getUint8(25)))return!1;const c=Object.assign(new Image,{src:yield A(y)});yield new Promise(I=>c.addEventListener("load",()=>I(!0)));const P=Object.assign(document.createElement("canvas"),{width:c.width,height:c.height}).getContext("2d");if(!P)return!1;P.imageSmoothingEnabled=!1,P.drawImage(c,0,0);const b=null==P?void 0:P.getImageData(0,0,c.width,c.height);if(b)for(let I=0;I<b.data.length;I+=4)if(b.data[I+3]<255)return!0}return!1})).apply(this,arguments)}function l(y){return y.map(v=>({name:v.name,ext:v.ext,type:e.VC.FILE,url:v.url,embedUrl:v.embedUrl,isImage:v.isImage}))}function E(y,v=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(y)&&!v.includes(y)}function w(y){return E(y,["gif","svg"])}function D(y,v,f,c=[],P=""){let b=(0,O.Z)({},M.xt);const I=y.trim();b.invalidLength=0===I.length;const Q=(I+P).replace(/\s{2,}/g," ");return b.alreadyUsed=v!==I&&c.includes(Q),b.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(y),b.invalidCharacter=!(f===e.VC.FILE?M.Mi.test(y):M.er.test(y)),b}function Z(y,v){return y.join("/")===v.join("/")}function G(y){let v=[],f=[];for(const c of y)c.type===e.VC.FILE?v.push(c):f.push(c);return{[e.VC.FILE]:v,[e.VC.FOLDER]:f}}},4887:(q,R,t)=>{"use strict";t.d(R,{q:()=>G});var m=t(5861),O=t(1413),e=t(3705),M=t(4315),C=t.n(M),d=t(9829),U=t(9054),s=t(9862),A=t(8645),g=t(1687),x=t(9773),r=t(7621),l=t(1990),E=t(5487);class w{static findApp1Marker(v){const f=new DataView(v),c=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let P=0;P<v.byteLength-2;P+=2){const b=f.getUint16(P);if(65505===b)return{offset:P,size:f.getUint16(P+2),little:18761==f.getUint16(P+8,!1)};if(c.has(b))break}}static stripAndReturnExif(v){return(0,m.Z)(function*(){const f=yield v.arrayBuffer(),c=w.findApp1Marker(f);return c?{file:new File([f.slice(0,c.offset),f.slice(c.offset+c.size+2)],v.name,{type:v.type,lastModified:v.lastModified}),exif:f.slice(c.offset,c.offset+c.size)}:{file:v}})()}static checkImageOrientation(v){const f=new DataView(v);if(1165519206!=f.getUint32(4,!1))return-1;const c=18761==f.getUint16(10,!1);let P=10;P+=f.getUint32(P+4,c);const b=f.getUint16(P,c);P+=2;for(let I=0;I<b;I++)if(274==f.getUint16(P+12*I,c))return f.getUint16(P+12*I+8,c);return-1}}var D=t(5879),Z=t(9582);let G=(()=>{class y{constructor(f,c,P,b){this.http=f,this.uploadObservablesService=c,this.loadImageService=P,this.proxyService=b,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return(0,O.Z)({},this.uploaderOptionsObject)}set uploaderOptions(f){this.uploaderOptionsObject=(0,O.Z)({},f)}compressFileIfNeeded(f,c){return(0,m.Z)(function*(){let P=["image/png","image/jpeg"],b={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};c&&(P.push("image/webp"),b.width=c.width,b.height=c.height,b.resize="cover",b.strict=!1);const I=f.type.toLowerCase();return f.size<=4e6&&void 0===c||-1===P.indexOf(f.type.toLowerCase())?f:("image/png"===I&&(yield(0,U.JN)(f))&&(b.convertSize=1/0),new Promise((Q,V)=>{new(C())(f,(0,O.Z)((0,O.Z)({},b),{},{success:K=>{const te=K instanceof Blob?new File([K],f.name,{type:f.type,lastModified:f.lastModified}):f;Q(te)},error:V}))}))})()}orientFileIfNeeded(f){var c=this;return(0,m.Z)(function*(){if(-1===["image/jpeg"].indexOf(f.type.toLowerCase()))return f;const b=yield w.stripAndReturnExif(f);if(f=b.file,b.exif){const I=w.checkImageOrientation(b.exif);if(1!==I){let Q=0;switch(I){case 3:case 4:Q=180;break;case 5:case 6:Q=90;break;case 7:case 8:Q=270}const V=yield(0,U.sT)(f),K=yield new Promise((ne,re)=>{const le=new Image;le.onload=()=>ne({originalImage:le,originalBase64:V}),le.onerror=re,le.src=V}),te=yield c.loadImageService.transformLoadedImage({original:{base64:K.originalBase64,image:K.originalImage,size:{width:K.originalImage.naturalWidth,height:K.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(I),rotate:Q/90}},new d.R);f=new File([(0,e.L)(te.transformed.base64)],f.name,{type:f.type,lastModified:Date.now()}),f=yield c.compressFileIfNeeded(f)}}return f})()}upload(f,c,P,b=!1){const I=new A.x,Q=new FormData;Q.append("payload",P),Q.append("upload",f,f.name),b&&Q.append("allowOverwrite","1");const V=this.http.request(new s.aW("POST",l.C7,Q,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(V.subscribe({next:K=>{if(K.type===s.dt.UploadProgress){if(!K.total||(c.progress=Math.round(50*K.loaded/K.total)+20,c.progress<70))return;(0,g.F)(1e3).pipe((0,x.R)(I.asObservable())).subscribe(()=>{if(c.progress<95){const re=Math.round(8*Math.random()+8);c.progress+re>95?c.progress=95:c.progress+=re}})}else if(K instanceof s.Zn){var te,ne;if(c.progress=100,c.completed=!0,null!==(te=K.body)&&void 0!==te&&te.error||null===(ne=K.body)||void 0===ne||!ne.success)c.error=!0,this.uploadObservablesService.pushUploadingFileError(c);else{c.file.url=K.body.success.url,c.file.time=Date.now(),c.file.embedUrl=`${c.file.url}?t=${c.file.time}`;const re=(0,U.Tb)(c.file.url);c.file.name=re.name,c.file.filename=re.filename}I.next(),I.complete()}},error:()=>{c.error=!0,this.uploadObservablesService.pushUploadingFileError(c),I.next(),I.complete()}})),I.asObservable()}clearPendingRequests(){for(const f of this.requestSubscriptions)f.unsubscribe();this.requestSubscriptions=[]}}return y.\u0275fac=function(f){return new(f||y)(D.LFG(s.eN),D.LFG(E.r),D.LFG(Z.y),D.LFG(r.y))},y.\u0275prov=D.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()},4315:function(q){q.exports=function(){"use strict";function R(_,i){var u=Object.keys(_);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(_);i&&(p=p.filter(function(T){return Object.getOwnPropertyDescriptor(_,T).enumerable})),u.push.apply(u,p)}return u}function t(_){for(var i=1;i<arguments.length;i++){var u=null!=arguments[i]?arguments[i]:{};i%2?R(Object(u),!0).forEach(function(p){M(_,p,u[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(u)):R(Object(u)).forEach(function(p){Object.defineProperty(_,p,Object.getOwnPropertyDescriptor(u,p))})}return _}function O(_,i){for(var u=0;u<i.length;u++){var p=i[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(_,U(p.key),p)}}function M(_,i,u){return(i=U(i))in _?Object.defineProperty(_,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):_[i]=u,_}function C(){return C=Object.assign?Object.assign.bind():function(_){for(var i=1;i<arguments.length;i++){var u=arguments[i];for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(_[p]=u[p])}return _},C.apply(this,arguments)}function U(_){var i=function d(_,i){if("object"!=typeof _||null===_)return _;var u=_[Symbol.toPrimitive];if(void 0!==u){var p=u.call(_,i||"default");if("object"!=typeof p)return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(_)}(_,"string");return"symbol"==typeof i?i:String(i)}var _,i,u,p,T,S,H,N,s={exports:{}};_=s,typeof window>"u"||(i=window,u=i.HTMLCanvasElement&&i.HTMLCanvasElement.prototype,p=i.Blob&&function(){try{return!!new Blob}catch(B){return!1}}(),T=p&&i.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(B){return!1}}(),S=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder,H=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,N=(p||S)&&i.atob&&i.ArrayBuffer&&i.Uint8Array&&function(B){var W,k,z,ie,Y,o,F,n,h;if(!(W=B.match(H)))throw new Error("invalid data URI");for(k=W[2]?W[1]:"text/plain"+(W[3]||";charset=US-ASCII"),z=!!W[4],ie=B.slice(W[0].length),Y=z?atob(ie):decodeURIComponent(ie),o=new ArrayBuffer(Y.length),F=new Uint8Array(o),n=0;n<Y.length;n+=1)F[n]=Y.charCodeAt(n);return p?new Blob([T?F:o],{type:k}):((h=new S).append(o),h.getBlob(k))},i.HTMLCanvasElement&&!u.toBlob&&(u.mozGetAsFile?u.toBlob=function(B,W,k){var z=this;setTimeout(function(){B(k&&u.toDataURL&&N?N(z.toDataURL(W,k)):z.mozGetAsFile("blob",W))})}:u.toDataURL&&N&&(u.toBlob=u.msToBlob?function(B,W,k){var z=this;setTimeout(function(){B((W&&"image/png"!==W||k)&&u.toDataURL&&N?N(z.toDataURL(W,k)):z.msToBlob(W))})}:function(B,W,k){var z=this;setTimeout(function(){B(N(z.toDataURL(W,k)))})})),_.exports?_.exports=N:i.dataURLtoBlob=N);var A=s.exports,x={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},l=typeof window<"u"&&typeof window.document<"u"?window:{},E=function(i){return i>0&&i<1/0},w=Array.prototype.slice;function D(_){return Array.from?Array.from(_):w.call(_)}var Z=/^image\/.+$/;function G(_){return Z.test(_)}var v=String.fromCharCode;var c=l.btoa;function P(_,i){for(var u=[],T=new Uint8Array(_);T.length>0;)u.push(v.apply(null,D(T.subarray(0,8192)))),T=T.subarray(8192);return"data:".concat(i,";base64,").concat(c(u.join("")))}function b(_){var u,i=new DataView(_);try{var p,T,S;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var H=i.byteLength,N=2;N+1<H;){if(255===i.getUint8(N)&&225===i.getUint8(N+1)){T=N;break}N+=1}if(T){var W=T+10;if("Exif"===function f(_,i,u){var T,p="";for(u+=i,T=i;T<u;T+=1)p+=v(_.getUint8(T));return p}(i,T+4,4)){var k=i.getUint16(W);if(((p=18761===k)||19789===k)&&42===i.getUint16(W+2,p)){var z=i.getUint32(W+4,p);z>=8&&(S=W+z)}}}if(S){var Y,o,ie=i.getUint16(S,p);for(o=0;o<ie;o+=1)if(274===i.getUint16(Y=S+12*o+2,p)){u=i.getUint16(Y+=8,p),i.setUint16(Y,1,p);break}}}catch(F){u=1}return u}var Q=/\.\d*(?:0|9){12}\d*$/;function V(_){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return Q.test(_)?Math.round(_*i)/i:_}function K(_){var i=_.aspectRatio,u=_.height,p=_.width,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",S=E(p),H=E(u);if(S&&H){var N=u*i;("contain"===T||"none"===T)&&N>p||"cover"===T&&N<p?u=p/i:p=u*i}else S?u=p/i:H&&(p=u*i);return{width:p,height:u}}var re=l.ArrayBuffer,le=l.FileReader,ce=l.URL||l.webkitURL,_e=/\.\w+$/,ve=l.Compressor,Ee=function(){function _(i,u){(function m(_,i){if(!(_ instanceof i))throw new TypeError("Cannot call a class as a function")})(this,_),this.file=i,this.exif=[],this.image=new Image,this.options=t(t({},x),u),this.aborted=!1,this.result=null,this.init()}return function e(_,i,u){return i&&O(_.prototype,i),u&&O(_,u),Object.defineProperty(_,"prototype",{writable:!1}),_}(_,[{key:"init",value:function(){var u=this,p=this.file,T=this.options;if(function(i){return!(typeof Blob>"u")&&(i instanceof Blob||"[object Blob]"===Object.prototype.toString.call(i))}(p)){var S=p.type;if(G(S))if(ce&&le){re||(T.checkOrientation=!1,T.retainExif=!1);var H="image/jpeg"===S,N=H&&T.checkOrientation,B=H&&T.retainExif;if(!ce||N||B){var W=new le;this.reader=W,W.onload=function(k){var ie=k.target.result,Y={},o=1;N&&(o=b(ie))>1&&C(Y,function I(_){var i=0,u=1,p=1;switch(_){case 2:u=-1;break;case 3:i=-180;break;case 4:p=-1;break;case 5:i=90,p=-1;break;case 6:i=90;break;case 7:i=90,u=-1;break;case 8:i=-90}return{rotate:i,scaleX:u,scaleY:p}}(o)),B&&(u.exif=function te(_){for(var i=D(new Uint8Array(_)),u=i.length,p=[],T=0;T+3<u;){var S=i[T],H=i[T+1];if(255===S&&218===H)break;if(255===S&&216===H)T+=2;else{var B=T+(256*i[T+2]+i[T+3])+2,W=i.slice(T,B);p.push(W),T=B}}return p.reduce(function(k,z){return 255===z[0]&&225===z[1]?k.concat(z):k},[])}(ie)),Y.url=N||B?!ce||o>1?P(ie,S):ce.createObjectURL(p):ie,u.load(Y)},W.onabort=function(){u.fail(new Error("Aborted to read the image with FileReader."))},W.onerror=function(){u.fail(new Error("Failed to read the image with FileReader."))},W.onloadend=function(){u.reader=null},N||B?W.readAsArrayBuffer(p):W.readAsDataURL(p)}else this.load({url:ce.createObjectURL(p)})}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(u){var p=this,T=this.file,S=this.image;S.onload=function(){p.draw(t(t({},u),{},{naturalWidth:S.naturalWidth,naturalHeight:S.naturalHeight}))},S.onabort=function(){p.fail(new Error("Aborted to load the image."))},S.onerror=function(){p.fail(new Error("Failed to load the image."))},l.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(l.navigator.userAgent)&&(S.crossOrigin="anonymous"),S.alt=T.name,S.src=u.url}},{key:"draw",value:function(u){var p=this,T=u.naturalWidth,S=u.naturalHeight,H=u.rotate,N=void 0===H?0:H,B=u.scaleX,W=void 0===B?1:B,k=u.scaleY,z=void 0===k?1:k,ie=this.file,Y=this.image,o=this.options,F=document.createElement("canvas"),n=F.getContext("2d"),h=Math.abs(N)%180==90,a=("contain"===o.resize||"cover"===o.resize)&&E(o.width)&&E(o.height),L=Math.max(o.maxWidth,0)||1/0,j=Math.max(o.maxHeight,0)||1/0,J=Math.max(o.minWidth,0)||0,ae=Math.max(o.minHeight,0)||0,se=T/S,ee=o.width,X=o.height;if(h){var ue=[j,L];L=ue[0],j=ue[1];var $=[ae,J];J=$[0],ae=$[1];var oe=[X,ee];ee=oe[0],X=oe[1]}a&&(se=ee/X);var de=K({aspectRatio:se,width:L,height:j},"contain");L=de.width,j=de.height;var he=K({aspectRatio:se,width:J,height:ae},"cover");if(J=he.width,ae=he.height,a){var me=K({aspectRatio:se,width:ee,height:X},o.resize);ee=me.width,X=me.height}else{var Me=K({aspectRatio:se,width:ee,height:X}),Ue=Me.width;ee=void 0===Ue?T:Ue;var be=Me.height;X=void 0===be?S:be}var Fe=-(ee=Math.floor(V(Math.min(Math.max(ee,J),L))))/2,Be=-(X=Math.floor(V(Math.min(Math.max(X,ae),j))))/2,We=ee,je=X,Oe=[];if(a){var Ae,ye,Ce=K({aspectRatio:se,width:T,height:S},{contain:"cover",cover:"contain"}[o.resize]);Oe.push((T-(Ae=Ce.width))/2,(S-(ye=Ce.height))/2,Ae,ye)}if(Oe.push(Fe,Be,We,je),h){var De=[X,ee];ee=De[0],X=De[1]}F.width=ee,F.height=X,G(o.mimeType)||(o.mimeType=ie.type);var Ie="transparent";ie.size>o.convertSize&&o.convertTypes.indexOf(o.mimeType)>=0&&(o.mimeType="image/jpeg");var Se="image/jpeg"===o.mimeType;if(Se&&(Ie="#fff"),n.fillStyle=Ie,n.fillRect(0,0,ee,X),o.beforeDraw&&o.beforeDraw.call(this,n,F),!this.aborted&&(n.save(),n.translate(ee/2,X/2),n.rotate(N*Math.PI/180),n.scale(W,z),n.drawImage.apply(n,[Y].concat(Oe)),n.restore(),o.drew&&o.drew.call(this,n,F),!this.aborted)){var Le=function(ge){if(!p.aborted){var we=function(fe){return p.done({naturalWidth:T,naturalHeight:S,result:fe})};if(ge&&Se&&o.retainExif&&p.exif&&p.exif.length>0){var Re=function(fe){return we(A(P(function ne(_,i){var u=D(new Uint8Array(_));if(255!==u[2]||224!==u[3])return _;var T=[255,216].concat(i,u.slice(4+(256*u[4]+u[5])));return new Uint8Array(T)}(fe,p.exif),o.mimeType)))};if(ge.arrayBuffer)ge.arrayBuffer().then(Re).catch(function(){p.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var pe=new le;p.reader=pe,pe.onload=function(xe){Re(xe.target.result)},pe.onabort=function(){p.fail(new Error("Aborted to read the compressed image with FileReader."))},pe.onerror=function(){p.fail(new Error("Failed to read the compressed image with FileReader."))},pe.onloadend=function(){p.reader=null},pe.readAsArrayBuffer(ge)}}else we(ge)}};F.toBlob?F.toBlob(Le,o.mimeType,o.quality):Le(A(F.toDataURL(o.mimeType,o.quality)))}}},{key:"done",value:function(u){var p=u.naturalWidth,T=u.naturalHeight,S=u.result,H=this.file,N=this.image,B=this.options;if(ce&&0===N.src.indexOf("blob:")&&ce.revokeObjectURL(N.src),S)if(B.strict&&!B.retainExif&&S.size>H.size&&B.mimeType===H.type&&!(B.width>p||B.height>T||B.minWidth>p||B.minHeight>T||B.maxWidth<p||B.maxHeight<T))S=H;else{var W=new Date;S.lastModified=W.getTime(),S.lastModifiedDate=W,S.name=H.name,S.name&&S.type!==H.type&&(S.name=S.name.replace(_e,function y(_){var i=G(_)?_.substr(6):"";return"jpeg"===i&&(i="jpg"),".".concat(i)}(S.type)))}else S=H;this.result=S,B.success&&B.success.call(this,S)}},{key:"fail",value:function(u){var p=this.options;if(!p.error)throw u;p.error.call(this,u)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ve,_}},{key:"setDefaults",value:function(u){C(x,u)}}]),_}();return Ee}()},1687:(q,R,t)=>{"use strict";t.d(R,{F:()=>e});var m=t(6321),O=t(4825);function e(M=0,C=m.z){return M<0&&(M=0),(0,O.H)(M,M,C)}},4004:(q,R,t)=>{"use strict";t.d(R,{Z:()=>x});const O={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let e;const M=new Uint8Array(16);function C(){if(!e&&(e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(M)}const d=[];for(let r=0;r<256;++r)d.push((r+256).toString(16).slice(1));const x=function g(r,l,E){if(O.randomUUID&&!l&&!r)return O.randomUUID();const w=(r=r||{}).random||(r.rng||C)();if(w[6]=15&w[6]|64,w[8]=63&w[8]|128,l){E=E||0;for(let D=0;D<16;++D)l[E+D]=w[D];return l}return function U(r,l=0){return(d[r[l+0]]+d[r[l+1]]+d[r[l+2]]+d[r[l+3]]+"-"+d[r[l+4]]+d[r[l+5]]+"-"+d[r[l+6]]+d[r[l+7]]+"-"+d[r[l+8]]+d[r[l+9]]+"-"+d[r[l+10]]+d[r[l+11]]+d[r[l+12]]+d[r[l+13]]+d[r[l+14]]+d[r[l+15]]).toLowerCase()}(w)}}}]);