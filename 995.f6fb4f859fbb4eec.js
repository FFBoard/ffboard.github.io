"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[995],{4041:(T,U,r)=>{r.d(U,{C:()=>c});var a=r(6814),u=r(9212);let c=(()=>{var y;class p{}return(y=p).\u0275fac=function(I){return new(I||y)},y.\u0275mod=u.oAB({type:y}),y.\u0275inj=u.cJS({imports:[a.ez]}),p})()},9010:(T,U,r)=>{r.d(U,{b:()=>c});var a=r(8863),u=r(9212);let c=(()=>{var y;class p{transform(I,L=2){return(0,a.t)(I,L)}}return(y=p).\u0275fac=function(I){return new(I||y)},y.\u0275pipe=u.Yjl({name:"formatBytes",type:y,pure:!0}),p})()},8863:(T,U,r)=>{r.d(U,{t:()=>u});var a=r(2641);function u(c,y=2){if(!+c)return"0 Bytes";let p=!1;c<0&&(p=!0,c=Math.abs(c));const I=y<0?0:y,d=Math.floor(Math.log(c)/Math.log(1024));return"".concat(p?"-":"").concat((0,a.o)(parseFloat((c/Math.pow(1024,d)).toFixed(I)))," ").concat(["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][d])}},9996:(T,U,r)=>{r.d(U,{D:()=>a});var a=function(u){return u.OWNED="owned",u.LINKED="linked",u}(a||{})},5172:(T,U,r)=>{r.d(U,{In:()=>a,Ky:()=>p,VC:()=>u,c5:()=>y,gG:()=>c});var a=function(i){return i.FILE_SHOW_LINKS="fileLinks",i.FILE_EDIT="fileEdit",i.DELETE="delete",i.RENAME="rename",i.MOVE="move",i}(a||{}),u=function(i){return i.FILE="file",i.FOLDER="folder",i}(u||{}),c=function(i){return i.FILENAME="filename",i.SIZE="size",i.TIME="time",i.EXTENSION="ext",i}(c||{}),y=function(i){return i.GRID="grid",i.LIST="list",i}(y||{}),p=function(i){return i.W_768_I_1="(max-width: 767.98px)",i.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",i.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",i.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",i.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",i.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",i.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",i.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",i.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",i.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",i.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",i.W_3738_I_10="(min-width: 3424px)",i}(p||{})},1990:(T,U,r)=>{r.d(U,{JJ:()=>c,b3:()=>y,p$:()=>i,uJ:()=>p,vV:()=>u});var a=r(5172);const u={lastPath:[],layout:{asc:!0,orderBy:a.gG.FILENAME,type:a.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},c=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,y=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,p={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1},i=2147483648},5983:(T,U,r)=>{r.d(U,{B:()=>I});var a=r(5172),u=r(1745),c=r(1410),y=r(7595),p=r(9212),i=r(6779);let I=(()=>{var L;class d{constructor(n,t,e){this.globalsService=n,this.loginAsService=t,this.uploadEndpointsService=e,this.cache={},this.userStorage={},this.fileLimits={},this.widgetFolders={},this.profileSubscription=this.globalsService.profileObservable.subscribe(s=>{this.profileFfuid=null==s?void 0:s.user.ffuid})}get ffuid(){var n;return(null===(n=this.loginAsService.profile)||void 0===n?void 0:n.ffuid)||this.profileFfuid}getWidgetFolders(n){const t=this.createKey(n);return this.widgetFolders[t]}setWidgetFolders(n,t){this.widgetFolders[this.createKey(n)]=t}getFileLimits(){const n=this.createKey();return this.fileLimits[n]}setFileLimits(n){if(!this.ffuid)return;const t=this.createKey();this.fileLimits[t]=n}getUserStorage(){const n=this.createKey();return this.userStorage[n]}setUserStorage(n){if(!this.ffuid)return;const t=this.createKey();this.userStorage[t]=n}deleteUserStorage(){if(this.ffuid){const n=this.createKey();delete this.userStorage[n]}}getItem(n){const t=this.createKey(n);if((0,u.o8)(this.cache,t))return this.cache[t]}setItem(n,t){this.cache[this.createKey(n)]=t}removeItem(n){const t=this.createKey(n);if((0,u.o8)(this.cache,t)){if(this.cache[t].folders.length)for(const e of this.cache[t].folders)this.removeItem([...n,e.name]);return delete this.cache[t],!0}return!1}getEntities(n,t){const e={},s=this.createKey(n);if(!(0,u.o8)(this.cache,s))return e;for(const D of t){const P=(D.type===a.VC.FILE?this.cache[s].files:this.cache[s].folders).find(o=>o.name===D.name);P&&(e[P.name]=P)}return e}addEntities(n,t,e=a.VC.FILE){const s=this.createKey(n);return!!(0,u.o8)(this.cache,s)&&(Array.isArray(t)||(t=[t]),e===a.VC.FILE?this.cache[s].files.unshift(...t):this.cache[s].folders.unshift(...t),!0)}removeEntities(n,t,e=a.VC.FILE){if(Array.isArray(t)||(t=[t]),e===a.VC.FOLDER)for(const o of t)this.removeItem([...n,o]);const s=this.createKey(n);if(!(0,u.o8)(this.cache,s))return[];const D=e===a.VC.FILE?"files":"folders",P=[];for(const o of t){const h=this.cache[s][D].findIndex(E=>E.name===o);h>-1&&(this.cache[s][D].splice(h,1),P.push(o))}return P}refactorFolderContent(n,t){const e=this.createKey(n);if(!(0,u.o8)(this.cache,e))return!1;t.endsWith("/")||(t+="/");for(const s of this.cache[e].folders)s.url=t+s.name;for(const s of this.cache[e].files)s.url=s.embedUrl=t+s.name,s.time=Date.now();return!0}createKey(n=[]){return"".concat(this.ffuid,"/").concat(this.uploadEndpointsService.requiredActiveRemote.id,"/").concat(n.join("/"))}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return(L=d).\u0275fac=function(n){return new(n||L)(p.LFG(c.d),p.LFG(i.D),p.LFG(y.r))},L.\u0275prov=p.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),d})()},7595:(T,U,r)=>{r.d(U,{r:()=>e});var a=r(1413),u=r(5861),c=r(9212),y=r(1745),p=r(5571),i=r(446),I=r(5487),L=r(1410),d=r(9996),m=r(4601),n=r(6779),t=r(3892);let e=(()=>{var s;class D{constructor(){var o,h,E;this.graphqlService=(0,c.f3M)(y.Jk),this.uploadPreferencesService=(0,c.f3M)(i.p),this.uploadObservablesService=(0,c.f3M)(I.r),this.globalsService=(0,c.f3M)(L.d),this.loginAsService=(0,c.f3M)(n.D),this.uploadTokensService=(0,c.f3M)(t.J),this.defaultRemoteId="default",this.activeRemoteIdSignal=(0,c.tdS)((null===(o=this.uploadPreferencesService.remote)||void 0===o?void 0:o.id)||this.defaultRemoteId),this.remotesListSignal=(0,c.tdS)({[d.D.OWNED]:[],[d.D.LINKED]:[]}),this.isRemoteAdviceEnabledSignal=(0,c.tdS)(!(null!==(h=this.uploadPreferencesService.remote)&&void 0!==h&&null!==(h=h.advice)&&void 0!==h&&h.disabled&&Date.now()-this.uploadPreferencesService.remote.advice.disabledAt<2592e6)),this.profileFFUid=null===(E=this.globalsService.credentials)||void 0===E?void 0:E.user.ffuid,this.remotesCache={},this.canChangeActiveRemote=!0,this.activeRemoteId=this.activeRemoteIdSignal.asReadonly(),this.remotesList=this.remotesListSignal.asReadonly(),this.isRemoteAdviceEnabled=this.isRemoteAdviceEnabledSignal.asReadonly(),this.activeRemote=(0,c.Flj)(()=>{const v=this.activeRemoteIdSignal();return this.remotesListSignal().linked.find(S=>S.id===v&&!S.deleted)}),this.lastListSelected=void 0}get requiredActiveRemote(){const o=this.activeRemote();if(!o)throw new Error("UploadRemoteNotAvailableError");return o}disableActiveRemoteChange(){this.canChangeActiveRemote=!1}enableActiveRemoteChange(){this.canChangeActiveRemote=!0}disableRemoteAdvice(o=!1){this.isRemoteAdviceEnabledSignal.set(!1),o&&(this.uploadPreferencesService.remote={id:this.activeRemoteId(),advice:{disabled:!0,disabledAt:Date.now()}})}setActiveRemote(o){!this.canChangeActiveRemote||this.activeRemoteId()===o||(this.uploadPreferencesService.remoteId=o,this.activeRemoteIdSignal.set(o),this.uploadObservablesService.pushActiveRemote(this.activeRemote()))}resetActiveRemote(){this.setActiveRemote(this.defaultRemoteId)}canRemoteBeSelected(o){return this.remotesList().linked.findIndex(h=>h.id===o&&!h.deleted)>-1}setRemoteList(o,h){var E=this;return(0,u.Z)(function*(){const v=E.getRemotesCache();if(v)E.remotesListSignal.set({[d.D.OWNED]:[...v.owned],[d.D.LINKED]:[...v.defaults,...v.others]});else{const f=(0,a.Z)((0,a.Z)({},null!=h&&h.list?{target:h.list.paths.join("/")}:{}),(null==h?void 0:h.size)||{}),S=(yield E.graphqlService.query((0,a.Z)({query:null!=h&&h.list?p.km:null!=h&&h.size?p.Q5:p.DE},(0,m.nK)(f)?{}:{variables:E.loginAsService.prepareGqlPayload(f)}))).data,R=[],b=[],_=S.uploadRemoteList.map(l=>(0,a.Z)((0,a.Z)({},l),{},{default:E.isDefaultRemote(l.id)}));for(const l of S.uploadRemoteLinked){const g=(0,a.Z)((0,a.Z)({},l),{},{default:E.isDefaultRemote(l.id)});g.default?R.push(g):b.push(g)}E.remotesListSignal.set({[d.D.OWNED]:[..._.sort((l,g)=>l.name.localeCompare(g.name))],[d.D.LINKED]:[...R.sort((l,g)=>l.id.localeCompare(g.id)),...b.sort((l,g)=>l.name.localeCompare(g.name))]}),E.setRemotesCache({defaults:R,owned:_,others:b}),S.uploadEntitiesListToken&&(E.uploadTokensService.fileListToken=S.uploadEntitiesListToken),S.uploadEntitiesSizeToken&&(E.uploadTokensService.userStorageToken=S.uploadEntitiesSizeToken)}if(o&&E.activeRemoteId()!==o){if(E.canRemoteBeSelected(o))return E.setActiveRemote(o),E.uploadTokensService.fileListToken=void 0,{activeRemoteChangedId:o};E.uploadObservablesService.pushRemoteForm(o)}return E.activeRemote()?{}:(E.resetActiveRemote(),{activeRemoteChangedId:E.defaultRemoteId})})()}refreshRemoteList(){var o=this;return(0,u.Z)(function*(){o.deleteRemotesCache(),yield o.setRemoteList()})()}getRemoteInfo(o){var h=this;return(0,u.Z)(function*(){var E;const v=null===(E=(yield h.graphqlService.query({query:p.fm,variables:{remoteInfoId:o}})).data)||void 0===E?void 0:E.uploadRemoteInfo;if(v)return(0,a.Z)((0,a.Z)({},v),{},{default:h.isDefaultRemote(v.id)})})()}upsertRemote(o,h,E,v){var f=this;return(0,u.Z)(function*(){var S;const R=null===(S=(yield f.graphqlService.mutate({mutation:p.ND,variables:{id:v,address:h,name:o,email:E}})).data)||void 0===S?void 0:S.uploadRemoteUpsert;if(R)return yield f.refreshRemoteList(),R})()}linkRemote(o){var h=this;return(0,u.Z)(function*(){var E;const v=null===(E=(yield h.graphqlService.mutate({mutation:p.M7,variables:{id:o}})).data)||void 0===E?void 0:E.uploadRemoteLink;return o===v&&(yield h.refreshRemoteList(),!0)})()}deleteRemote(o){var h=this;return(0,u.Z)(function*(){return h.deleteUnlinkRemote(o,h.remotesList().owned,(0,u.Z)(function*(){return(yield h.graphqlService.mutate({mutation:p.Hy,variables:{id:o}})).data.uploadRemoteDelete}))})()}unlinkRemote(o){var h=this;return(0,u.Z)(function*(){return h.deleteUnlinkRemote(o,h.remotesList().linked,(0,u.Z)(function*(){return(yield h.graphqlService.mutate({mutation:p.HA,variables:{id:o}})).data.uploadRemoteUnlink}))})()}deleteUnlinkRemote(o,h,E){var v=this;return(0,u.Z)(function*(){return!(-1===h.findIndex(R=>R.id===o)||!(yield E())||(o===v.activeRemoteId()&&v.setActiveRemote(v.defaultRemoteId),yield v.refreshRemoteList(),0))})()}getRemotesCache(){return this.profileFFUid?this.remotesCache[this.profileFFUid]:void 0}setRemotesCache(o){this.profileFFUid&&(this.remotesCache[this.profileFFUid]=o)}deleteRemotesCache(){this.profileFFUid&&delete this.remotesCache[this.profileFFUid]}isDefaultRemote(o){return o.startsWith(this.defaultRemoteId)}}return(s=D).\u0275fac=function(o){return new(o||s)},s.\u0275prov=c.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),D})()},5571:(T,U,r)=>{r.d(U,{DE:()=>t,HA:()=>o,He:()=>I,Hy:()=>P,M7:()=>h,ND:()=>E,Q5:()=>s,fm:()=>D,gZ:()=>m,jt:()=>p,km:()=>e,oT:()=>c,pf:()=>i,t3:()=>d,vJ:()=>v,wm:()=>u,xj:()=>y});const a="\n    uploadEntitiesListToken(target: $target, targetUserId: $targetUserId)\n",u="\nquery UploadEntitiesListToken($target: String!, $targetUserId: String) {\n    ".concat(a,"\n}"),c="\nquery UploadEntitiesHostToken($target: String!, $targetUserId: String, $allowReplace: Boolean) {\n    uploadEntitiesHostToken(target: $target, targetUserId: $targetUserId, allowReplace: $allowReplace)\n}",y="\nquery UploadEntitiesCreateDirectoryToken($target: String!, $targetUserId: String) {\n    uploadEntitiesCreateDirectoryToken(target: $target, targetUserId: $targetUserId)\n}",p="\nquery UploadEntitiesMoveToken($source: String!, $target: String!, $targetUserId: String) {\n    uploadEntitiesMoveToken(source: $source, target: $target, targetUserId: $targetUserId)\n}",i="\nquery UploadEntitiesDeleteToken($target: String!, $targetUserId: String) {\n    uploadEntitiesDeleteToken(target: $target, targetUserId: $targetUserId)\n}",I="\nquery UploadHistoryAvailableDateRange {\n    uploadHistoryAvailableDateRange {\n        start\n        end\n    }\n}",L="\n    uploadEntitiesSizeToken(allowCompute: $allowCompute, targetUserId: $targetUserId)\n",d="\nquery UploadEntitiesSizeToken($allowCompute: Boolean, $targetUserId: String) {\n    ".concat(L,"\n}"),m="\nquery UploadEntitiesLimitsToken($targetUserId: String) {\n    uploadEntitiesLimitsToken(targetUserId: $targetUserId)\n}",n="\n    uploadRemoteLinked {\n        id\n        owner\n        email\n        name\n        address\n        lastUpdate\n        deleted\n    }\n    uploadRemoteList {\n        id\n        owner\n        email\n        name\n        address\n        lastUpdate\n        deleted\n    }\n",t="\nquery UploadRemotes {\n    ".concat(n,"\n}"),e="\nquery UploadRemotesAndListTokenAndSizeToken($target: String!, $targetUserId: String, $allowCompute: Boolean) {\n    ".concat(n,"\n    ").concat(a,"\n    ").concat(L,"\n}"),s="\nquery UploadRemotesAndSizeToken($allowCompute: Boolean, $targetUserId: String) {\n    ".concat(n,"\n    ").concat(L,"\n}"),D="\nquery UploadRemoteInfo($remoteInfoId: String!) {\n    uploadRemoteInfo(id: $remoteInfoId) {\n        id\n        owner\n        email\n        name\n        address\n        lastUpdate\n        deleted\n    }\n}",P="\nmutation UploadRemoteDelete($id: String!) {\n    uploadRemoteDelete(id: $id)\n}",o="\nmutation UploadRemoteUnlink($id: String!) {\n    uploadRemoteUnlink(id: $id)\n}",h="\nmutation UploadRemoteLink($id: String!) {\n    uploadRemoteLink(id: $id)\n}",E="\nmutation UploadRemoteUpsert($email: String!, $name: String!, $address: String!, $id: String) {\n    uploadRemoteUpsert(email: $email, name: $name, address: $address, id: $id)\n}",v="\nsubscription UploadEntities {\n    uploadEntities {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}"},5487:(T,U,r)=>{r.d(U,{r:()=>p});var a=r(8645),u=r(5619),c=r(446),y=r(9212);let p=(()=>{var i;class I{constructor(d){this.uploadPreferencesService=d,this.selectedFileListArray=[],this.actionSubject=new a.x,this.uploadingFileQueueSubject=new a.x,this.uploadingFileErrorSubject=new a.x,this.currentFolderPathSubject=new a.x,this.layoutOptionsSubject=new a.x,this.renameEntitySubject=new a.x,this.entityPendingSubject=new a.x,this.deleteFileSubject=new a.x,this.uploadedFileSubject=new a.x,this.draggedFileListSubject=new a.x,this.startUploadSubject=new a.x,this.startMoveSubject=new a.x,this.activeRemoteIdSubject=new a.x,this.remoteFormSubject=new a.x,this.selectedFileListSubject=new u.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(d){this.actionSubject.next(d)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(d){this.uploadPreferencesService.layoutOptions=d,this.layoutOptionsSubject.next(d)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(d){this.uploadPreferencesService.lastFolderPath=d,this.currentFolderPathSubject.next(d)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(d){this.uploadingFileQueueSubject.next(d)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(d){this.uploadingFileErrorSubject.next(d)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(d){this.renameEntitySubject.next(d)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(d){this.entityPendingSubject.next(d)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(d){this.deleteFileSubject.next(d)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(d){this.uploadedFileSubject.next(d)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(d){this.draggedFileListSubject.next(d)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(d){this.startUploadSubject.next(d)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(d){this.startMoveSubject.next(d)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(d){if(Array.isArray(d)||(d=[d]),0===d.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let m=!1;for(const n of d){const t=this.selectedFileListArray.findIndex(e=>e.name===n.name);n.selected?-1===t&&(this.selectedFileListArray.push({name:n.name}),m=!0):t>-1&&(this.selectedFileListArray.splice(t,1),m=!0)}m&&this.selectedFileListSubject.next(this.selectedFileListArray)}get activeRemoteObservable(){return this.activeRemoteIdSubject.asObservable()}pushActiveRemote(d){this.activeRemoteIdSubject.next(d)}get remoteFormObservable(){return this.remoteFormSubject.asObservable()}pushRemoteForm(d){this.remoteFormSubject.next(d)}}return(i=I).\u0275fac=function(d){return new(d||i)(y.LFG(c.p))},i.\u0275prov=y.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),I})()},446:(T,U,r)=>{r.d(U,{p:()=>d});var a=r(1413),u=r(1745),c=r(7165),y=r(463),p=r(1990),i=r(2986),I=r(9212),L=r(6779);let d=(()=>{var m;class n{constructor(e,s,D){this.preferencesService=e,this.urlQueryParamsService=s,this.loginAsService=D;const P=this.urlQueryParamsService.getAndDeleteParam(c.RT.UPLOAD_PATH);P&&(this.lastFolderPath=P.split("/").filter(o=>o.length>0))}get preferences(){return this.preferencesService.getItem(c.Ye.UPLOAD)||p.vV}set preferences(e){this.preferencesService.setItem(c.Ye.UPLOAD,e)}get lastFolderPath(){return this.loginAsService.isActive?[]:(this.preferences.lastPath||p.vV.lastPath).filter(e=>e.length>0)}set lastFolderPath(e){if(this.loginAsService.isActive)return;const s=this.preferences;s.lastPath=e,this.preferences=s}get layoutOptions(){const e=p.vV.layout,s=this.preferences.layout;return s&&0===Object.keys(e).filter(D=>!(0,u.o8)(s,D)).length?s:e}set layoutOptions(e){const s=this.preferences;s.layout=e,this.preferences=s}get uploader(){const e=this.preferences.uploader||p.vV.uploader;return!e.checkImage.active&&Date.now()-e.checkImage.time>6048e5&&(e.checkImage.active=!0,this.uploader=e),(0,u.o8)(e,"showLinkModal")||(e.showLinkModal=!1),e}set uploader(e){const s=this.preferences;s.uploader=e,this.preferences=s}get remote(){if(!this.loginAsService.isActive)return this.preferences.remote}set remote(e){if(this.loginAsService.isActive)return;const s=this.preferences;s.remote=e,this.preferences=s}set remoteId(e){var s;if(this.loginAsService.isActive)return;const D=this.preferences;D.remote={id:e,advice:(0,a.Z)({},(null===(s=D.remote)||void 0===s?void 0:s.advice)||{disabled:!1})},this.preferences=D}}return(m=n).\u0275fac=function(e){return new(e||m)(I.LFG(y.y),I.LFG(i.J),I.LFG(L.D))},m.\u0275prov=I.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),n})()},3892:(T,U,r)=>{r.d(U,{J:()=>i});var a=r(5861),u=r(9212),c=r(1745),y=r(6779),p=r(5571);let i=(()=>{var I;class L{constructor(){this.graphqlService=(0,u.f3M)(c.Jk),this.loginAsService=(0,u.f3M)(y.D)}set userStorageToken(m){this.userStorageCache=m}get userStorageToken(){const m=this.userStorageCache;return this.userStorageCache=void 0,m}set fileListToken(m){this.fileListCache=m}get fileListToken(){const m=this.fileListCache;return this.fileListCache=void 0,m}generateFileListToken(m){var n=this;return(0,a.Z)(function*(){return(yield n.graphqlService.query({query:p.wm,variables:n.loginAsService.prepareGqlPayload({target:m.join("/")})})).data.uploadEntitiesListToken})()}generateHostToken(m,n,t){var e=this;return(0,a.Z)(function*(){var s;return(null===(s=(yield e.graphqlService.query({query:p.oT,variables:e.loginAsService.prepareGqlPayload({allowReplace:t,target:(m.length?"".concat(m.join("/"),"/"):"")+n})})).data)||void 0===s?void 0:s.uploadEntitiesHostToken)||void 0})()}generateCreateDirectoryToken(m){var n=this;return(0,a.Z)(function*(){return(yield n.graphqlService.query({query:p.xj,variables:n.loginAsService.prepareGqlPayload({target:m.join("/")})})).data.uploadEntitiesCreateDirectoryToken})()}generateMoveRenameEntityToken(m,n,t,e){var s=this;return(0,a.Z)(function*(){return(yield s.graphqlService.query({query:p.jt,variables:s.loginAsService.prepareGqlPayload({source:(m.length?"".concat(m.join("/"),"/"):"")+t,target:(n.length?"".concat(n.join("/"),"/"):"")+e})})).data.uploadEntitiesMoveToken})()}generateDeleteEntityToken(m,n){var t=this;return(0,a.Z)(function*(){return(yield t.graphqlService.query({query:p.pf,variables:t.loginAsService.prepareGqlPayload({target:(m.length?"".concat(m.join("/"),"/"):"")+n})})).data.uploadEntitiesDeleteToken})()}generateUserStorageToken(m){var n=this;return(0,a.Z)(function*(){return(yield n.graphqlService.query({query:p.t3,variables:n.loginAsService.prepareGqlPayload({allowCompute:m})})).data.uploadEntitiesSizeToken})()}generateFileLimitsToken(){var m=this;return(0,a.Z)(function*(){return(yield m.graphqlService.query({query:p.gZ,variables:m.loginAsService.prepareGqlPayload()})).data.uploadEntitiesLimitsToken})()}}return(I=L).\u0275fac=function(m){return new(m||I)},I.\u0275prov=u.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),L})()},658:(T,U,r)=>{r.d(U,{C:()=>P});var a=r(1413),u=r(5861),c=r(1745),y=r(4036),p=r(5172),i=r(9054),I=r(5571),L=r(5983),d=r(446),m=r(4004),n=r(7595),t=r(3892),e=r(9212),s=r(9862),D=r(6779);let P=(()=>{var o;class h{constructor(v,f,S,R,b,_,l){this.graphqlService=v,this.uploadCacheService=f,this.uploadPreferencesService=S,this.http=R,this.loginAsService=b,this.uploadEndpointsService=_,this.uploadTokensService=l}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(c._3.UUID,(0,m.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(c._3.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(c._3.UUID)||""}getFileLimits(){var v=this;return(0,u.Z)(function*(){const f=v.cache.getFileLimits();if(f)return f;const S=yield v.uploadTokensService.generateFileLimitsToken(),b=(yield v.sendRequest(S)).map(_=>({ext:_.extension,maxSize:_.size}));return v.cache.setFileLimits(b),b})()}getUserStorage(v=!1){var f=this;return(0,u.Z)(function*(){return v?yield f.requestUserStorage(!0):f.cache.getUserStorage()||(yield f.requestUserStorage())})()}flushUserStorage(){this.cache.deleteUserStorage()}requestUserStorage(v=!1){var f=this;return(0,u.Z)(function*(){const S=f.uploadTokensService.userStorageToken||(yield f.uploadTokensService.generateUserStorageToken(v||void 0)),R=yield f.sendRequest(S),b={used:R.used,max:R.limit,exceeded:R.exceeded};return f.cache.setUserStorage(b),b})()}getFileList(v){var f=this;return(0,u.Z)(function*(){const S=f.uploadCacheService.getItem(v);if(S)return S;const R=f.uploadTokensService.fileListToken||(yield f.uploadTokensService.generateFileListToken(v)),b=yield f.sendRequest(R),l={files:b.files.map(g=>{const O=(0,i.Tb)(g.url);return(0,a.Z)((0,a.Z)({},g),{time:1e3*g.time,filename:O.filename,ext:O.ext,isImage:(0,i.Or)(O.ext),embedUrl:"".concat(g.url,"?t=").concat(g.time),type:p.VC.FILE})}),folders:b.folders.map(g=>(0,a.Z)((0,a.Z)({},g),{},{type:p.VC.FOLDER}))};return f.uploadCacheService.setItem(v,l),l})()}createDirectory(v){var f=this;return(0,u.Z)(function*(){const S=yield f.uploadTokensService.generateCreateDirectoryToken(v);return yield f.sendRequest(S)})()}moveRenameEntity(v,f,S,R){var b=this;return(0,u.Z)(function*(){R||(R=S);const _=yield b.uploadTokensService.generateMoveRenameEntityToken(v,f,S,R),l=yield b.sendRequest(_);return(0,a.Z)((0,a.Z)({},l),{},{time:1e3*l.time})})()}deleteEntity(v,f){var S=this;return(0,u.Z)(function*(){const R=yield S.uploadTokensService.generateDeleteEntityToken(v,f);return yield S.sendRequest(R),!0})()}sendRequest(v){var f=this;return(0,u.Z)(function*(){return(yield(0,y.z)(f.http.post(f.uploadEndpointsService.requiredActiveRemote.address,JSON.stringify({payload:v}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(v){var f=this;return(0,u.Z)(function*(){return yield f.graphqlService.subscribe({query:I.vJ,variables:f.loginAsService.prepareGqlPayload()},S=>{var R;if(null===(R=S.data)||void 0===R||!R.uploadEntities)return;const b=JSON.parse(S.data.uploadEntities.eventMessage);!b.payload.customHeaders||!(0,c.o8)(b.payload.customHeaders,c._3.UUID)||b.payload.customHeaders[c._3.UUID]===f.getGqlIdHeader()||v({type:S.data.uploadEntities.eventType,message:b})})})()}}return(o=h).\u0275fac=function(v){return new(v||o)(e.LFG(c.Jk),e.LFG(L.B),e.LFG(d.p),e.LFG(s.eN),e.LFG(D.D),e.LFG(n.r),e.LFG(t.J))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),h})()},9054:(T,U,r)=>{r.d(U,{$H:()=>E,JN:()=>e,LZ:()=>D,Lv:()=>d,Or:()=>h,Tb:()=>I,g0:()=>b,g8:()=>R,jL:()=>o,kl:()=>p,lY:()=>m,ok:()=>f,rQ:()=>S,rc:()=>v,zO:()=>L});var a=r(1413),u=r(5861),c=r(5172),y=r(1990);function p(_){return i.apply(this,arguments)}function i(){return i=(0,u.Z)(function*(_){return new Promise((l,g)=>{const O=new FileReader;O.onload=function(){var A=(0,u.Z)(function*(M){if(M.target&&M.target.result){const F=new Uint8Array(M.target.result),C=yield crypto.subtle.digest("SHA-256",F),x=Array.from(new Uint8Array(C)).map($=>$.toString(16).padStart(2,"0")).join("");l(x)}else g(new Error("Failed to read file."))});return function(M){return A.apply(this,arguments)}}(),O.onerror=A=>{g(A)},O.readAsArrayBuffer(_)})}),i.apply(this,arguments)}function I(_){let l=_;if(_.indexOf("/")>-1){const M=_.split("/");l=M[M.length-1]}const g=l.replace(/\?.*$/,"").split("."),O=g.length>1?g[g.length-1].toLowerCase():"",A=decodeURIComponent(g.slice(0,-1).join("."));return{ext:O,filename:A,name:O?"".concat(A,".").concat(O):""}}function L(_,l={}){const g=I(_),O=Date.now();return(0,a.Z)({name:g.name,size:0,time:O,accessedInThreshold:null,url:_,ext:g.ext,filename:g.filename,isImage:h(g.ext),embedUrl:"".concat(_,"?t=").concat(O),type:c.VC.FILE},l)}function d(_){let l=_;l.endsWith("/")&&(l=l.slice(0,-1));const g=l.split("/");return{name:decodeURIComponent(g[g.length-1])}}function m(_){return{name:d(_).name,url:_,type:c.VC.FOLDER}}function n(_){return t.apply(this,arguments)}function t(){return(t=(0,u.Z)(function*(_){const l=new FileReader,g=new Promise(O=>l.addEventListener("load",()=>O(l.result)));return l.readAsDataURL(_),g})).apply(this,arguments)}function e(_){return s.apply(this,arguments)}function s(){return(s=(0,u.Z)(function*(_){const l=new DataView(yield _.arrayBuffer());if(2303741511===l.getUint32(0)&&218765834===l.getUint32(4)){if(-1===[4,6].indexOf(l.getUint8(25)))return!1;const O=Object.assign(new Image,{src:yield n(_)});yield new Promise(F=>O.addEventListener("load",()=>F(!0)));const A=Object.assign(document.createElement("canvas"),{width:O.width,height:O.height}).getContext("2d");if(!A)return!1;A.imageSmoothingEnabled=!1,A.drawImage(O,0,0);const M=null==A?void 0:A.getImageData(0,0,O.width,O.height);if(M)for(let F=0;F<M.data.length;F+=4)if(M.data[F+3]<255)return!0}return!1})).apply(this,arguments)}function D(_){return P.apply(this,arguments)}function P(){return(P=(0,u.Z)(function*(_){const l=Object.assign(new Image,{src:yield n(_)});return yield new Promise(g=>l.addEventListener("load",()=>g(!0))),l})).apply(this,arguments)}function o(_){return _.map(l=>({name:l.name,ext:l.ext,type:c.VC.FILE,url:l.url,embedUrl:l.embedUrl,isImage:l.isImage}))}function h(_,l=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(_)&&!l.includes(_)}function E(_){return h(_,["gif","svg"])}function v(_,l,g,O=[],A=""){const M=(0,a.Z)({},y.uJ),F=_.trim();M.invalidLength=0===F.length;const C=(F+A).replace(/\s{2,}/g," ");return M.alreadyUsed=l!==F&&O.includes(C),M.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(_),M.invalidCharacter=!(g===c.VC.FILE?y.JJ.test(_):y.b3.test(_)),M}function f(_,l){return _.join("/")===l.join("/")}function S(_){const l=[],g=[];for(const O of _)O.type===c.VC.FILE?l.push(O):g.push(O);return{[c.VC.FILE]:l,[c.VC.FOLDER]:g}}function R(_,l){return l.find(g=>-1!==g.ext.indexOf(_))}function b(_,l,g){return l=l||I(_.name),{file:{name:_.name,size:_.size,time:0,accessedInThreshold:null,url:"",ext:l.ext,filename:l.filename,isImage:h(l.ext),embedUrl:"",type:c.VC.FILE},metadata:g,progress:0,completed:!1}}},4004:(T,U,r)=>{r.d(U,{Z:()=>n});const u={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let c;const y=new Uint8Array(16);function p(){if(!c&&(c=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!c))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return c(y)}const i=[];for(let t=0;t<256;++t)i.push((t+256).toString(16).slice(1));const n=function m(t,e,s){if(u.randomUUID&&!e&&!t)return u.randomUUID();const D=(t=t||{}).random||(t.rng||p)();if(D[6]=15&D[6]|64,D[8]=63&D[8]|128,e){s=s||0;for(let P=0;P<16;++P)e[s+P]=D[P];return e}return function I(t,e=0){return i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]}(D)}}}]);