"use strict";(self.webpackChunkboard=self.webpackChunkboard||[]).push([[120],{120:($,g,i)=>{i.r(g),i.d(g,{AdminPanelModule:()=>H});var e=i(4650),C=i(8621),c=i(5861),p=i(1309),h=i(1460),q=i(3138),m=i(5395),u=i(6378);let S=(()=>{class o{constructor(t){this.graphqlService=t,this.apolloIntrospectionRequestTime=0}get isApolloIntrospectionEnabled(){return Date.now()<this.apolloIntrospectionRequestTime+3e4}setApolloIntrospection(t){var n=this;return(0,c.Z)(function*(){const l=(yield n.graphqlService.mutate({mutation:"\nmutation ApolloIntrospectionStatus($status: Boolean!) {\n    apolloIntrospectionStatus(status: $status)\n}",variables:{status:t}})).data.apolloIntrospectionStatus;return l&&(n.apolloIntrospectionRequestTime=t?Date.now():0),l})()}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(m.J))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var A=i(2771),v=i(4425),_=i(4271),s=i(433),E=i(5174);const M=["app-admin-panel-graphql",""],f=function(){return[10,10]},Z=function(o,a){return{placement:"top-end",offset:o,hideOnClick:a}},P=function(o,a){return{hideOnClick:o,placement:"top-end",offset:a}};let k=(()=>{class o{constructor(t,n,l,r,Y){this.globalsService=t,this.graphqlService=n,this.toastService=l,this.adminPanelService=r,this.loginService=Y,this.touchDevice=h.eX,this.pendingRequest=!1,this.requestLogs=[],this.tokenCopyTimeout=0,this.tokenCopyMessage="Copia il token",this.tokenCopiedMessage="Token copiato!",this.graphql={localUrlLinked:!0,localEnvBasepaths:h._V,storage:this.globalsService.adminSettings?.graphql||{useLocalEnv:!1,urlHttpLocalEnv:this.graphqlService.localEnvUrls.http,urlWsLocalEnv:this.graphqlService.localEnvUrls.ws,loggerEnabled:this.graphqlService.loggerEnabled}},this.jwtEnv={useLocalEnv:this.loginService.localEnvEnabled,localUrl:this.loginService.localEnvUrl},this.token=this.graphqlService.params.token||"",this.tokenTippyMessage=this.touchDevice?this.tokenCopiedMessage:this.tokenCopyMessage,this.apolloInstrospectionEnabled=this.adminPanelService.isApolloIntrospectionEnabled,this.requestLogs=this.graphqlService.requestLogs,this.setApolloUrl()}ngOnInit(){}setApolloUrl(){this.apolloUrl=`https://studio.apollographql.com/sandbox/explorer?endpoint=${this.graphqlService.urlHttp}&headers=${JSON.stringify({Authorization:this.token})}`}setUrlWs(){this.graphql.localUrlLinked&&(this.graphql.storage.urlWsLocalEnv=this.graphql.storage.urlHttpLocalEnv)}saveAdminSettings(){this.globalsService.adminSettings={...this.globalsService.adminSettings||{},graphql:this.graphql.storage}}saveJwtLocalEnv(){this.loginService.localEnvEnabled=this.jwtEnv.useLocalEnv,this.loginService.localEnvUrl=this.jwtEnv.localUrl}saveGraphqlLocalEnv(){this.saveAdminSettings(),this.graphqlService.localEnvEnabled=this.graphql.storage.useLocalEnv,this.graphqlService.loggerEnabled=this.graphql.storage.loggerEnabled,this.graphql.storage.useLocalEnv&&(this.graphqlService.localEnvUrls={http:this.graphql.storage.urlHttpLocalEnv,ws:this.graphql.storage.urlWsLocalEnv}),this.setApolloUrl(),this.throwLocalEnvToast()}throwLocalEnvToast(){this.toastService.show({content:"Impostazioni dell'<strong>ambiente locale</strong> aggionate!",delay:5e3})}tokenCopiedCallback(){this.touchDevice||(window.clearTimeout(this.tokenCopyTimeout),this.tokenTippyMessage=this.tokenCopiedMessage,this.tokenCopyTimeout=window.setTimeout(()=>{this.tokenTippyMessage=this.tokenCopyMessage},3e3))}setApolloIntrospection(){var t=this;return(0,c.Z)(function*(){t.pendingRequest?t.toastService.advice(p.V.REQUEST_PENDING):t.apolloInstrospectionEnabled&&t.adminPanelService.isApolloIntrospectionEnabled?t.toastService.show({content:"L'introspection di Apollo \xe8 <strong>gi\xe0 attiva</strong>!",level:p.m.ERROR}):(t.pendingRequest=!0,(yield t.adminPanelService.setApolloIntrospection(t.apolloInstrospectionEnabled))?t.toastService.show({content:`Introspection di Apollo\n                <strong>${t.apolloInstrospectionEnabled?"abilitata":"disabilitata"}</strong> con successo!`}):t.toastService.advice(p.V.GENERIC),t.pendingRequest=!1)})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(q.d),e.Y36(m.J),e.Y36(u.k),e.Y36(S),e.Y36(A.r))},o.\u0275cmp=e.Xpm({type:o,selectors:[["","app-admin-panel-graphql",""]],attrs:M,decls:66,vars:31,consts:[[1,"h6","px-md-1","container-fluid"],[1,"flat-container","p-3"],[1,"mb-4","d-flex","align-items-end"],[1,"flex-grow-1","me-3"],["for","profile-token",1,"fs-sm"],["type","text","id","profile-token","disabled","",1,"form-control",3,"value"],[1,"d-block","ms-auto","btn","btn-primary",3,"cdkCopyToClipboard","appTippy","tippyProps","click"],[1,"material-icons","d-block"],[1,"px-3","pb-3","pt-2","rounded","mb-4"],[1,"legend-reset","fs-reset","px-2","mb-0"],[1,"d-flex","align-items-end","mb-3"],["for","graphql-url-http",1,"fs-sm"],[1,"input-group"],["disabled","",1,"form-control",3,"value"],["type","text","id","graphql-url-http",1,"form-control",3,"ngModel","ngModelChange"],[1,"d-block","ms-auto","btn","btn-success",3,"click"],[1,"mb-3"],["for","graphql-url-ws",1,"fs-sm"],["type","text","id","graphql-url-ws",1,"form-control",3,"disabled","ngModel","ngModelChange"],[1,"input-group-text","cursor-pointer",3,"appTippy","tippyProps","disableOnTouchDevice","click"],[1,"material-icons",3,"innerText"],[1,"form-check","form-switch","mb-2"],["type","checkbox","role","switch","id","enable-local-env",1,"form-check-input",3,"ngModel","ngModelChange"],["for","enable-local-env",1,"form-check-label"],["for","jwt-url-http",1,"fs-sm"],["type","text","id","jwt-url-http",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-check","form-switch","mb-0"],["type","checkbox","role","switch","id","enable-local-env-for-jwt",1,"form-check-input",3,"ngModel","ngModelChange"],["for","enable-local-env-for-jwt",1,"form-check-label"],[1,"px-3","pb-3","rounded","mb-4","pt-2"],[1,"form-check","form-switch","mb-3"],["type","checkbox","role","switch","id","enable-logs",1,"form-check-input",3,"ngModel","ngModelChange"],["for","enable-logs",1,"form-check-label"],[1,"logs-wrapper"],[3,"object"],["type","checkbox","role","switch","id","apollo-introspection",1,"form-check-input",3,"disabled","ngModel","ngModelChange"],["for","apollo-introspection",1,"form-check-label"],[1,"d-flex","justify-content-end"],[1,"d-block"],["target","_blank",3,"href"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._uU(1,"GraphQL e JWT"),e.qZA(),e.TgZ(2,"div",1)(3,"div",2)(4,"div",3)(5,"label",4),e._uU(6,"Token attuale:"),e.qZA(),e._UZ(7,"input",5),e.qZA(),e.TgZ(8,"button",6),e.NdJ("click",function(){return n.tokenCopiedCallback()}),e.TgZ(9,"span",7),e._uU(10,"content_copy"),e.qZA()()(),e.TgZ(11,"fieldset",8)(12,"legend",9),e._uU(13,"Ambiente locale"),e.qZA(),e.TgZ(14,"div",10)(15,"div",3)(16,"label",11),e._uU(17,"Url Locale HTTP:"),e.qZA(),e.TgZ(18,"div",12),e._UZ(19,"input",13),e.TgZ(20,"input",14),e.NdJ("ngModelChange",function(r){return n.graphql.storage.urlHttpLocalEnv=r})("ngModelChange",function(){return n.setUrlWs()}),e.qZA()()(),e.TgZ(21,"button",15),e.NdJ("click",function(){return n.saveGraphqlLocalEnv()}),e._uU(22,"Salva"),e.qZA()(),e.TgZ(23,"div",16)(24,"label",17),e._uU(25,"Url Locale WebSoscket:"),e.qZA(),e.TgZ(26,"div",12),e._UZ(27,"input",13),e.TgZ(28,"input",18),e.NdJ("ngModelChange",function(r){return n.graphql.storage.urlWsLocalEnv=r}),e.qZA(),e.TgZ(29,"span",19),e.NdJ("click",function(){return n.graphql.localUrlLinked=!n.graphql.localUrlLinked}),e._UZ(30,"span",20),e.qZA()()(),e.TgZ(31,"div",21)(32,"input",22),e.NdJ("ngModelChange",function(r){return n.graphql.storage.useLocalEnv=r})("ngModelChange",function(){return n.saveGraphqlLocalEnv()}),e.qZA(),e.TgZ(33,"label",23),e._uU(34,"Utilizza l'ambiente locale per le richieste"),e.qZA()(),e.TgZ(35,"div",10)(36,"div",3)(37,"label",24),e._uU(38,"Url Locale JWT:"),e.qZA(),e.TgZ(39,"div",12),e._UZ(40,"input",13),e.TgZ(41,"input",25),e.NdJ("ngModelChange",function(r){return n.jwtEnv.localUrl=r}),e.qZA()()(),e.TgZ(42,"button",15),e.NdJ("click",function(){return n.saveJwtLocalEnv()}),e._uU(43,"Salva"),e.qZA()(),e.TgZ(44,"div",26)(45,"input",27),e.NdJ("ngModelChange",function(r){return n.jwtEnv.useLocalEnv=r})("ngModelChange",function(){return n.saveJwtLocalEnv()}),e.qZA(),e.TgZ(46,"label",28),e._uU(47,"Utilizza l'ambiente locale per la generazione dei JWT"),e.qZA()()(),e.TgZ(48,"fieldset",29)(49,"legend",9),e._uU(50),e.qZA(),e.TgZ(51,"div",30)(52,"input",31),e.NdJ("ngModelChange",function(r){return n.graphql.storage.loggerEnabled=r})("ngModelChange",function(){return n.saveGraphqlLocalEnv()}),e.qZA(),e.TgZ(53,"label",32),e._uU(54,"Abilita il salvataggio dei log"),e.qZA()(),e.TgZ(55,"div",33),e._UZ(56,"app-custom-pre",34),e.qZA()(),e.TgZ(57,"div",26)(58,"input",35),e.NdJ("ngModelChange",function(r){return n.apolloInstrospectionEnabled=r})("ngModelChange",function(){return n.setApolloIntrospection()}),e.qZA(),e.TgZ(59,"label",36),e._uU(60,"Abilita l'introspection di Apollo"),e.qZA()(),e.TgZ(61,"div",37)(62,"small",38),e._uU(63,"Vai alla "),e.TgZ(64,"a",39),e._uU(65,"sandbox"),e.qZA()()()()),2&t&&(e.xp6(7),e.Q6J("value",n.token),e.xp6(1),e.Q6J("cdkCopyToClipboard",n.token)("appTippy",n.tokenTippyMessage)("tippyProps",e.WLB(24,Z,e.DdM(23,f),n.touchDevice)),e.xp6(11),e.Q6J("value",n.graphql.localEnvBasepaths.http),e.xp6(1),e.Q6J("ngModel",n.graphql.storage.urlHttpLocalEnv),e.xp6(7),e.Q6J("value",n.graphql.localEnvBasepaths.ws),e.xp6(1),e.Q6J("disabled",n.graphql.localUrlLinked)("ngModel",n.graphql.storage.urlWsLocalEnv),e.xp6(1),e.Q6J("appTippy",n.graphql.localUrlLinked?"Specifica un url diverso per WS":"Calcola automaticamente l'url WS")("tippyProps",e.WLB(28,P,n.touchDevice,e.DdM(27,f)))("disableOnTouchDevice",!0),e.xp6(1),e.Q6J("innerText",n.graphql.localUrlLinked?"link_off":"link"),e.xp6(2),e.Q6J("ngModel",n.graphql.storage.useLocalEnv),e.xp6(8),e.Q6J("value",n.graphql.localEnvBasepaths.http),e.xp6(1),e.Q6J("ngModel",n.jwtEnv.localUrl),e.xp6(4),e.Q6J("ngModel",n.jwtEnv.useLocalEnv),e.xp6(5),e.hij("Log delle richieste (#",n.requestLogs.length,")"),e.xp6(2),e.Q6J("ngModel",n.graphql.storage.loggerEnabled),e.xp6(4),e.Q6J("object",n.requestLogs),e.xp6(2),e.Q6J("disabled",n.pendingRequest)("ngModel",n.apolloInstrospectionEnabled),e.xp6(6),e.Q6J("href",n.apolloUrl,e.LSH))},dependencies:[v.i3,_.s,s.Fj,s.Wl,s.JJ,s.On,E.$],styles:["fieldset[_ngcontent-%COMP%]{border:1px dashed var(--bs-gray-500)}.logs-wrapper[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}"]}),o})();var L=i(5044),U=i(7163),d=i(6895),T=i(9631),y=i(2365),I=i(4500);const J=["cacheModal"],G=["deletionModal"],N=["app-admin-panel-script",""];function R(o,a){if(1&o&&e._UZ(0,"option",15),2&o){const t=a.$implicit;e.Q6J("ngValue",t.scriptId)("innerText",t.name)}}const Q=function(o){return{disabled:o}},w=function(o,a){return[o,a]};let j=(()=>{class o{constructor(t,n){this.scriptListService=t,this.toastService=n,this.scriptList=[],this.selectedScriptId=0,this.scriptSettingsPath=L.B2.SCRIPT_DEV_SETTINGS,this.cacheScriptId=0,this.deletionScriptId=0,this.pendingRequest=!1}ngOnInit(){var t=this;return(0,c.Z)(function*(){t.scriptList=(yield t.scriptListService.getAllScripts()).sort((n,l)=>n.name>l.name?1:l.name>n.name?-1:0)})()}findScriptName(t){return this.scriptList.find(n=>n.scriptId===t)?.name||""}openCacheModal(){this.pendingRequest?this.toastService.advice(p.V.REQUEST_PENDING):(this.cacheScriptId=this.selectedScriptId,this.cacheModalRef.open())}openDeletionModal(){this.pendingRequest?this.toastService.advice(p.V.REQUEST_PENDING):(this.deletionScriptId=this.selectedScriptId,this.deletionModalRef.open())}setPendingRequest(t){this.pendingRequest=0!==t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(U.o),e.Y36(u.k))},o.\u0275cmp=e.Xpm({type:o,selectors:[["","app-admin-panel-script",""]],viewQuery:function(t,n){if(1&t&&(e.Gf(J,5),e.Gf(G,5)),2&t){let l;e.iGM(l=e.CRH())&&(n.cacheModalRef=l.first),e.iGM(l=e.CRH())&&(n.deletionModalRef=l.first)}},attrs:N,decls:17,vars:20,consts:[[1,"h6","px-md-1","container-fluid"],[1,"flat-container","p-3"],[1,"mb-2"],["for","script-select",1,"fs-sm"],["id","script-select",1,"form-select",3,"disabled","ngModel","ngModelChange"],["selected","",3,"ngValue"],[3,"ngValue","innerText",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","flex-wrap"],[1,"btn","btn-indigo","mx-2","mt-3",3,"disabled","innerText","click"],[1,"btn","btn-primary","mx-2","mt-3",3,"ngClass","innerText","routerLink"],[1,"btn","btn-danger","mx-2","mt-3",3,"disabled","innerText","click"],[3,"scriptId","scriptName","cachePendingEvent"],["cacheModal",""],[3,"scriptName","scriptId","deletionPendingEvent"],["deletionModal",""],[3,"ngValue","innerText"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._uU(1,"Script"),e.qZA(),e.TgZ(2,"div",1)(3,"div",2)(4,"label",3),e._uU(5,"Seleziona lo script da amministrare:"),e.qZA(),e.TgZ(6,"select",4),e.NdJ("ngModelChange",function(r){return n.selectedScriptId=r}),e._UZ(7,"option",5),e.YNc(8,R,1,2,"option",6),e.qZA()(),e.TgZ(9,"div",7)(10,"button",8),e.NdJ("click",function(){return n.openCacheModal()}),e.qZA(),e._UZ(11,"a",9),e.TgZ(12,"button",10),e.NdJ("click",function(){return n.openDeletionModal()}),e.qZA()()(),e.TgZ(13,"app-script-dev-cache",11,12),e.NdJ("cachePendingEvent",function(r){return n.setPendingRequest(r)}),e.qZA(),e.TgZ(15,"app-script-dev-deletion",13,14),e.NdJ("deletionPendingEvent",function(r){return n.setPendingRequest(r)}),e.qZA()),2&t&&(e.xp6(6),e.Q6J("disabled",0===n.scriptList.length)("ngModel",n.selectedScriptId),e.xp6(1),e.Q6J("ngValue",0),e.xp6(1),e.Q6J("ngForOf",n.scriptList),e.xp6(2),e.Q6J("disabled",0===n.selectedScriptId||n.pendingRequest)("innerText","Cache"),e.xp6(1),e.Q6J("ngClass",e.VKq(15,Q,0===n.selectedScriptId))("innerText","Impostazioni")("routerLink",e.WLB(17,w,n.scriptSettingsPath,n.selectedScriptId)),e.xp6(1),e.Q6J("disabled",0===n.selectedScriptId||n.pendingRequest)("innerText","Cancella"),e.xp6(1),e.Q6J("scriptId",n.cacheScriptId)("scriptName",n.cacheScriptId>0?n.findScriptName(n.cacheScriptId):""),e.xp6(2),e.Q6J("scriptName",n.deletionScriptId>0?n.findScriptName(n.deletionScriptId):"")("scriptId",n.deletionScriptId))},dependencies:[d.mk,d.sg,s.YN,s.Kr,s.EJ,s.JJ,s.On,T.yS,y.s,I.F]}),o})(),O=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["ng-component"]],decls:4,vars:0,consts:[["pageTitle","Pannello di amministrazione"],[1,"d-grid","page-container"],["app-admin-panel-graphql",""],["app-admin-panel-script",""]],template:function(t,n){1&t&&(e._UZ(0,"app-breadcrumb",0),e.TgZ(1,"div",1),e._UZ(2,"div",2)(3,"div",3),e.qZA())},dependencies:[C.L,k,j],styles:[".page-container[_ngcontent-%COMP%]{gap:1rem}@media (min-width: 960px){.page-container[_ngcontent-%COMP%]{gap:1.5rem}}@media (min-width: 1500px){.page-container[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}"]}),o})();var D=i(5531),W=i(3792),z=i(5667),V=i(3735),B=i(5254);const F=[{path:"",component:O}];let H=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[D.w,v.Iq,d.ez,W.b,s.u5,T.Bz.forChild(F),z.U,V.a,B.G]}),o})()}}]);