"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[820],{3285:(E,P,p)=>{p.d(P,{L:()=>y});var s=p(7165),n=p(5879);let g=(()=>{class o{constructor(){this.dependences={[s.B2.LOGIN]:null,[s.B2.HOME]:null,[s.B2.SETTINGS]:s.B2.HOME,[s.B2.SCRIPT]:s.B2.HOME,[s.B2.SCRIPT_FORUM]:s.B2.SCRIPT,[s.B2.SCRIPT_USER]:s.B2.SCRIPT,[s.B2.SCRIPT_SETTINGS]:[s.B2.SCRIPT_USER,s.B2.SCRIPT_FORUM],[s.B2.SCRIPT_SANDBOX]:[s.B2.SCRIPT_USER,s.B2.SCRIPT_FORUM],[s.B2.SCRIPT_DEV]:s.B2.SCRIPT,[s.B2.SCRIPT_DEV_SETTINGS]:s.B2.SCRIPT_DEV,[s.B2.UPLOAD]:s.B2.HOME,[s.B2.ADMIN]:s.B2.HOME},this.names={[s.B2.LOGIN]:"Login",[s.B2.HOME]:"Home",[s.B2.SETTINGS]:"Notifiche",[s.B2.SCRIPT]:"Script",[s.B2.SCRIPT_FORUM]:"Forum",[s.B2.SCRIPT_USER]:"Utenti",[s.B2.SCRIPT_SETTINGS]:"Impostazioni",[s.B2.SCRIPT_SANDBOX]:"Altro",[s.B2.SCRIPT_DEV]:"Sviluppo",[s.B2.SCRIPT_DEV_SETTINGS]:"Impostazioni",[s.B2.UPLOAD]:"Upload",[s.B2.ADMIN]:"Amministrazione"}}createPathList(d,S=[]){const T=(i,t)=>{i.unshift({name:this.names[t]||"",path:t})},v=i=>this.dependences.hasOwnProperty(i)?this.dependences[i]instanceof Array?this.dependences[i].includes(S[0])?S.shift():this.dependences[i][0]:this.dependences[i]:null;let e=[{name:this.names[d]||"",path:""}],r=v(d);for(;r;)T(e,r),r=v(r);return e}}return o.\u0275fac=function(d){return new(d||o)},o.\u0275prov=n.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var L=p(8109),m=p(6814);function $(o,_){if(1&o&&n._UZ(0,"a",8),2&o){const d=n.oxw().$implicit;n.Q6J("routerLink",d.path)("innerText",d.name)}}function u(o,_){if(1&o&&n._UZ(0,"span",9),2&o){const d=n.oxw().$implicit;n.Q6J("innerText",d.name)}}const b=function(o){return{active:o}};function B(o,_){if(1&o&&(n.TgZ(0,"li",5),n.YNc(1,$,1,2,"a",6),n.YNc(2,u,1,1,"ng-template",null,7,n.W1O),n.qZA()),2&o){const d=_.last,S=n.MAs(3);n.Q6J("ngClass",n.VKq(4,b,d)),n.uIk("aria-current",d?"page":null),n.xp6(1),n.Q6J("ngIf",!d)("ngIfElse",S)}}let y=(()=>{class o{constructor(d,S){this.breadcrumbService=d,this.router=S,this.pageTitle="",this.url="",this.nodes=[],this.breadcrumbs=[]}ngOnInit(){this.url||(this.url=this.router.url),this.breadcrumbs=this.breadcrumbService.createPathList(this.url,this.nodes)}}return o.\u0275fac=function(d){return new(d||o)(n.Y36(g),n.Y36(L.F0))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-breadcrumb"]],inputs:{pageTitle:"pageTitle",url:"url",nodes:"nodes"},decls:5,vars:2,consts:[[1,"container-fluid","px-md-1","d-flex","flex-column","flex-md-row","align-items-md-center"],[1,"h3","fw-light","mb-0","lh-1","fv-small-caps","pb-1",3,"innerText"],["aria-label","breadcrumb",1,"ms-md-auto","mt-1"],[1,"breadcrumb","mb-0","justify-content-md-end"],["class","breadcrumb-item",3,"ngClass",4,"ngFor","ngForOf"],[1,"breadcrumb-item",3,"ngClass"],[3,"routerLink","innerText",4,"ngIf","ngIfElse"],["lastItem",""],[3,"routerLink","innerText"],[3,"innerText"]],template:function(d,S){1&d&&(n.TgZ(0,"div",0),n._UZ(1,"h2",1),n.TgZ(2,"nav",2)(3,"ol",3),n.YNc(4,B,4,6,"li",4),n.qZA()()()),2&d&&(n.xp6(1),n.Q6J("innerText",S.pageTitle),n.xp6(3),n.Q6J("ngForOf",S.breadcrumbs))},dependencies:[m.mk,m.sg,m.O5,L.rH],styles:[".container-fluid[_ngcontent-%COMP%]{margin-bottom:.75rem}@media (min-width: 960px){.container-fluid[_ngcontent-%COMP%]{margin-top:.5rem}}"]}),o})()},9090:(E,P,p)=>{p.d(P,{w:()=>L});var s=p(6814),n=p(8109),g=p(5879);let L=(()=>{class m{}return m.\u0275fac=function(u){return new(u||m)},m.\u0275mod=g.oAB({type:m}),m.\u0275inj=g.cJS({imports:[s.ez,n.Bz]}),m})()},3040:(E,P,p)=>{p.d(P,{HF:()=>$,Ry:()=>m,in:()=>u,m:()=>n,n8:()=>g,t6:()=>b,uD:()=>s,xt:()=>L});const s="\nquery FullScript($id: String!, $type: ScriptTargetTypeEnum!) {\n    scriptList {\n        scriptId,\n        script_type,\n        forum,\n        name,\n        sdesc,\n        public_link,\n        preview,\n        tab,\n        js,\n        js_beta,\n        js_sandboxes {\n            name\n            value\n            inSettings\n            slug\n        },\n        js_pos,\n        webhook,\n        libs,\n        deps,\n        settings_schema,\n        settings_default,\n        html_head,\n        hidden_script,\n        old_layout,\n        new_layout,\n        responsive_layout,\n        mobile,\n        demo,\n        wh_settings,\n        wh_manage,\n    }\n    scriptSettings(targetId: $id, targetType: $type) {\n        scriptId,\n        settings,\n    }\n    scriptInstalledList(targetId: $id, targetType: $type)\n    scriptRankedList {\n        scriptId\n        scriptRank\n    }\n    scriptPermissions {\n        scriptId\n        manage\n        edit\n    }\n}",n="\nquery Script($id: String!, $type: ScriptTargetTypeEnum!) {\n    scriptSettings(targetId: $id, targetType: $type) {\n        scriptId,\n        settings,\n    }\n    scriptInstalledList(targetId: $id, targetType: $type)\n}",g="\nquery ScriptStats {\n    scriptStats {\n        scriptId\n        entities {\n            targetId\n            targetType\n        }\n    }\n}",L="\nmutation DelCache($scriptId: Int!) {\n    delCache(id: $scriptId)\n}",m="\nmutation ScriptUpsert($scriptId: Int, $scriptType: Int, $name: String, $publicLink: String, $sdesc: String, $preview: String, $tab: String, $js: String, $jsBeta: String, $jsSandboxes: [JSSandboxInput!], $jsPos: String, $webhook: String, $libs: [String], $deps: [Int], $settingsSchema: String, $settingsDefault: String, $htmlHead: String, $hiddenScript: Boolean, $oldLayout: Boolean, $newLayout: Boolean, $responsiveLayout: Boolean, $mobile: Boolean, $demo: Boolean, $whSettings: Boolean, $whManage: Boolean) {\n    scriptUpsert(scriptId: $scriptId, scriptType: $scriptType, name: $name, publicLink: $publicLink, sdesc: $sdesc, preview: $preview, tab: $tab, js: $js, jsBeta: $jsBeta, jsSandboxes: $jsSandboxes, jsPos: $jsPos, webhook: $webhook, libs: $libs, deps: $deps, settingsSchema: $settingsSchema, settingsDefault: $settingsDefault, htmlHead: $htmlHead, hiddenScript: $hiddenScript, oldLayout: $oldLayout, newLayout: $newLayout, responsiveLayout: $responsiveLayout, mobile: $mobile, demo: $demo, whSettings: $whSettings, whManage: $whManage)\n}",$="\nmutation DelScript($scriptId: Int!) {\n    delScript(scriptId: $scriptId)\n}",u="\nmutation ScriptManage(\n    $targetId: String!,\n    $targetType: ScriptTargetTypeEnum!,\n    $scriptId: Int!,\n    $action: ScriptManageActionEnum!\n) {\n    scriptManage(\n        targetId: $targetId,\n        targetType: $targetType,\n        scriptId: $scriptId,\n        action: $action\n    )\n}",b="\nmutation ScriptSettings(\n    $targetId: String!,\n    $targetType: ScriptTargetTypeEnum!,\n    $scriptId: Int!,\n    $settings: String!\n) {\n    scriptSettings(\n        targetId: $targetId,\n        targetType: $targetType,\n        scriptId: $scriptId,\n        settings: $settings\n    )\n}"},9121:(E,P,p)=>{p.d(P,{o:()=>S});var s=p(1413),n=p(5861),g=p(1410),L=p(6347),m=p(8645),$=p(8372),u=p(3729),b=p(7165),B=p(463),y=p(5083),o=p(3040),_=p(4064),d=p(5879);let S=(()=>{class T{constructor(e,r,i,t){this.graphqlService=e,this.globalsService=r,this.profileService=i,this.preferencesService=t,this.scriptInstalledList=[],this.listInputsSubject=new m.x,this.ffuid="",this.cache={},this.allScriptCache={},this.lastRequestTime=0,this.profileSubscription=this.globalsService.profileObservable.subscribe(c=>{this.ffuid=(null==c?void 0:c.user.ffuid)||""})}createCacheKey(e,r){return e+r+this.ffuid}getData(e,r=u.D7.FORUM,i=!1){var t=this;return(0,n.Z)(function*(){var c;const a=t.createCacheKey(e,r);if(Date.now()-t.lastRequestTime>18e5&&t.clearCache(!0),i){if(t.scriptList)return{scriptList:t.scriptList,scriptSettings:[],scriptInstalledList:[],scriptRankedList:[],scriptPermissions:t.scriptPermissions}}else if(t.cache.hasOwnProperty(a))return t.cache[a];const l=yield t.graphqlService.query({query:t.scriptList?o.m:o.uD,variables:{id:e,type:r}});t.scriptList||(t.lastRequestTime=Date.now(),t.scriptList=t.parseScriptList(l.data.scriptList,l.data.scriptRankedList),t.scriptRankedList=l.data.scriptRankedList,t.scriptPermissions=l.data.scriptPermissions),t.scriptInstalledList=l.data.scriptInstalledList.filter(I=>t.scriptList.findIndex(f=>f.scriptId===I)>-1);const h=r===u.D7.FORUM&&!(null!==(c=t.globalsService.forum)&&void 0!==c&&c.admin);return t.cache[a]={scriptList:t.filterType(t.scriptList,e,r,h?t.scriptPermissions:void 0),scriptSettings:l.data.scriptSettings,scriptInstalledList:t.scriptInstalledList,scriptPermissions:t.scriptPermissions,scriptRankedList:t.scriptRankedList},i?{scriptList:t.scriptList,scriptSettings:[],scriptInstalledList:[],scriptRankedList:[],scriptPermissions:t.scriptPermissions}:t.cache[a]})()}parseScriptList(e,r){let i={};const t=e.map(c=>{const a=this.parseScript(c,e,r);if(a.parentIdList.length)for(const l of a.parentIdList)i[`script${l}`]=[...i[`script${l}`]||[],{childId:a.scriptId,childName:a.name}];return a});for(const[c,a]of Object.entries(i)){const l=Number(c.replace("script","")),h=t.find(I=>I.scriptId===l);h&&(h.childIdList=a.map(I=>I.childId),h.childNameList=a.map(I=>I.childName))}return t}parseScript(e,r,i){let t=(0,s.Z)((0,s.Z)({},e),{},{rank:1e3,parentIdList:[],parentNameList:[],childIdList:[],childNameList:[],originalName:e.name});if(t.name=t.name.replace(/^whitelist\[([^\]]*)]/i,"").trim(),i){const c=i.findIndex(a=>a.scriptId===t.scriptId);c>-1&&(t.rank=i[c].scriptRank)}t.parentIdList=t.deps.filter(c=>c!==t.scriptId);for(const c of t.parentIdList.keys()){const a=r.find(l=>l.scriptId===t.parentIdList[c]);a?t.parentNameList.push(a.name):t.parentIdList.splice(c,1)}return t}filterType(e,r,i,t){let a,l,c=null===i?[u.AV.FORUM,u.AV.USER,u.AV.ALL]:i===u.D7.FORUM?[u.AV.FORUM,u.AV.ALL]:[u.AV.USER,u.AV.ALL],h=-1;const I=this.profileService.hasAtLeastOnePermission([y.c.ADMIN]);return e.filter(f=>!(0===f.js.length||t&&(h=t.findIndex(O=>O.scriptId===f.scriptId),h<0||!t[h].manage.includes(this.ffuid)&&(!t[h].edit.includes(this.ffuid)||!this.scriptInstalledList.includes(f.scriptId))))&&(l=!1,f.hidden_script&&(l=f.forum===this.ffuid||I,a=f.originalName.match(/^whitelist\[([^\]]*)]/i),a&&!l&&(l=a[1].toLowerCase().split(",").includes(r))),c.includes(f.script_type)&&(!f.hidden_script||l)))}splitTabs(e){let r={};return e.forEach(i=>{r.hasOwnProperty(i.tab)||(r[i.tab]=[]),r[i.tab].push(i)}),r}getListInputsObservable(){return this.listInputsSubject.asObservable()}pushListInputs(e){this.listInputsSubject.next(e),this.listInputs=e}get listInputs(){return this.listInputsData}set listInputs(e){this.listInputsData=e}getScript(e,r,i){var t=this;return(0,n.Z)(function*(){var c;const a=yield t.getData(r,i),l=yield t.getScriptPermissions();return[(yield t.getAllScripts(r,i)).find(h=>h.scriptId===e),(null===(c=a.scriptSettings.find(h=>h.scriptId===e))||void 0===c?void 0:c.settings)||"{}",a.scriptInstalledList.includes(e),l[`script${e}`]||{scriptId:e,manage:!1,edit:!1}]})()}getScriptsByAuthor(e){var r=this;return(0,n.Z)(function*(){return(yield r.getData(e,u.D7.USER,!0)).scriptList.filter(t=>t.forum===e)})()}updateInstalledScriptSettings(e,r,i,t){const c=this.createCacheKey(e,r);if(this.cache[c]){let a=this.cache[c].scriptSettings.find(l=>l.scriptId=i);a?a.settings=t:this.cache[c].scriptSettings.push({scriptId:i,settings:t})}}getAllScripts(e,r){var i=this;return(0,n.Z)(function*(){if(e||(e=i.ffuid,r=u.D7.USER),i.allScriptCache.hasOwnProperty(e))return i.allScriptCache[e];const t=yield i.getData(e,r,!0);return i.allScriptCache[e]=i.filterType(t.scriptList,e,null)})()}getScriptPermissions(){var e=this;return(0,n.Z)(function*(){const r=e.scriptPermissions||(yield e.getData(e.ffuid,u.D7.USER)).scriptPermissions;let i={};return r.forEach(t=>{t.manage.includes(e.ffuid)&&(i[`script${t.scriptId}`]={scriptId:t.scriptId,manage:!0,edit:!1}),t.edit.includes(e.ffuid)&&(i.hasOwnProperty(`script${t.scriptId}`)?i[`script${t.scriptId}`].edit=!0:i[`script${t.scriptId}`]={scriptId:t.scriptId,manage:!1,edit:!0})}),i})()}updateScript(e,r){if(!this.scriptList)return;const i=this.scriptList.findIndex(t=>t.scriptId===r);if(i>-1){const t=this.scriptList[i].parentIdList.filter(a=>!e.deps.includes(a));for(const a of t){const l=this.scriptList.find(h=>h.scriptId===a);l&&this.removeChildFromParent(l,a)}const c=(0,s.Z)((0,s.Z)({},this.parseScript((0,s.Z)((0,s.Z)({},this.scriptList[i]),e),this.scriptList)),{},{rank:this.scriptList[i].rank,childIdList:this.scriptList[i].childIdList,childNameList:this.scriptList[i].childNameList});Object.assign(this.scriptList[i],c),this.clearCache(!1)}}removeScript(e){if(!this.scriptList)return;const r=this.scriptList.findIndex(i=>i.scriptId===e);if(r>-1){for(const i of this.scriptList[r].childIdList){const t=this.scriptList.find(c=>c.scriptId===i);t&&this.removeChildFromParent(t,e)}this.scriptList.splice(r,1),this.clearCache(!1)}}removeChildFromParent(e,r){const i=e.childIdList.indexOf(r);e.childIdList.splice(i,1),e.childNameList.splice(i,1)}clearCache(e=!0){this.cache={},this.allScriptCache={},e&&(this.scriptList=void 0,this.scriptPermissions=void 0)}get settingsOptions(){return this.preferencesService.getItem(b.Ye.SCRIPT_SETTINGS_OPTIONS)||_.iK}set settingsOptions(e){this.preferencesService.setItem(b.Ye.SCRIPT_SETTINGS_OPTIONS,e)}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return T.\u0275fac=function(e){return new(e||T)(d.LFG(L.J),d.LFG(g.d),d.LFG($.H),d.LFG(B.y))},T.\u0275prov=d.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})()}}]);