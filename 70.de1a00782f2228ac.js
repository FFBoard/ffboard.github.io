(self.webpackChunkpages=self.webpackChunkpages||[]).push([[70],{9829:(Y,w,t)=>{"use strict";t.d(w,{R:()=>_});class _{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(M=>M in this).forEach(M=>this[M]=e[M]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(M=>M in this).forEach(M=>this[M]=e[M].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},9582:(Y,w,t)=>{"use strict";t.d(w,{y:()=>A});var _=t(1413),O=t(5861);var s=t(5879);let A=(()=>{class f{constructor(){this.autoRotateSupported=function M(){return new Promise(f=>{const x=new Image;x.onload=()=>{f(1===x.width&&2===x.height)},x.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(r,u){return new Promise((v,C)=>{const D=new FileReader;D.onload=I=>{this.loadImage(I.target.result,r.type,u).then(v).catch(C)},D.readAsDataURL(r)})}loadImage(r,u,v){return this.isValidImageType(u)?this.loadBase64Image(r,v):Promise.reject(new Error("Invalid image type"))}isValidImageType(r){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(r)}loadImageFromURL(r,u){return new Promise((v,C)=>{const D=new Image;D.onerror=()=>C,D.onload=()=>{const I=document.createElement("canvas"),j=I.getContext("2d");I.width=D.width,I.height=D.height,null==j||j.drawImage(D,0,0),this.loadBase64Image(I.toDataURL(),u).then(v)},D.crossOrigin="anonymous",D.src=r})}loadBase64Image(r,u){return new Promise((v,C)=>{const D=new Image;D.onload=()=>v({originalImage:D,originalBase64:r}),D.onerror=C,D.src=r}).then(v=>this.transformImageBase64(v,u))}transformImageBase64(r,u){var v=this;return(0,O.Z)(function*(){const C=yield v.autoRotateSupported,D=yield function b(f){switch("string"==typeof f&&(f=function d(f){const x=new DataView(function E(f){f=f.replace(/^data\:([^\;]+)\;base64,/gim,"");const x=atob(f),r=x.length,u=new Uint8Array(r);for(let v=0;v<r;v++)u[v]=x.charCodeAt(v);return u.buffer}(f));if(65496!==x.getUint16(0,!1))return-2;const r=x.byteLength;let u=2;for(;u<r;){if(x.getUint16(u+2,!1)<=8)return-1;const v=x.getUint16(u,!1);if(u+=2,65505==v){if(1165519206!==x.getUint32(u+=2,!1))return-1;const C=18761==x.getUint16(u+=6,!1);u+=x.getUint32(u+4,C);const D=x.getUint16(u,C);u+=2;for(let I=0;I<D;I++)if(274==x.getUint16(u+12*I,C))return x.getUint16(u+12*I+8,C)}else{if(65280!=(65280&v))break;u+=x.getUint16(u,!1)}}return-1}(f)),f){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(C?-1:r.originalBase64);return r.originalImage&&r.originalImage.complete?v.transformLoadedImage({original:{base64:r.originalBase64,image:r.originalImage,size:{width:r.originalImage.naturalWidth,height:r.originalImage.naturalHeight}},exifTransform:D},u):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(r,u){var v=this;return(0,O.Z)(function*(){const C=u.canvasRotation+r.exifTransform.rotate,D={width:r.original.image.naturalWidth,height:r.original.image.naturalHeight};if(0===C&&!r.exifTransform.flip&&!u.containWithinAspectRatio)return{original:{base64:r.original.base64,image:r.original.image,size:(0,_.Z)({},D)},transformed:{base64:r.original.base64,image:r.original.image,size:(0,_.Z)({},D)},exifTransform:r.exifTransform};const I=v.getTransformedSize(D,r.exifTransform,u),j=document.createElement("canvas");j.width=I.width,j.height=I.height;const T=j.getContext("2d");null==T||T.setTransform(r.exifTransform.flip?-1:1,0,0,1,j.width/2,j.height/2),null==T||T.rotate(Math.PI*(C/2)),null==T||T.drawImage(r.original.image,-D.width/2,-D.height/2);const S=j.toDataURL(),l=yield v.loadImageFromBase64(S);return{original:{base64:r.original.base64,image:r.original.image,size:(0,_.Z)({},D)},transformed:{base64:S,image:l,size:{width:l.width,height:l.height}},exifTransform:r.exifTransform}})()}loadImageFromBase64(r){return new Promise((u,v)=>{const C=new Image;C.onload=()=>u(C),C.onerror=v,C.src=r})}getTransformedSize(r,u,v){const C=v.canvasRotation+u.rotate;if(v.containWithinAspectRatio){if(C%2){const I=r.height/v.aspectRatio;return{width:Math.max(r.height,r.width*v.aspectRatio),height:Math.max(r.width,I)}}{const I=r.width/v.aspectRatio;return{width:Math.max(r.width,r.height*v.aspectRatio),height:Math.max(r.height,I)}}}return C%2?{height:r.width,width:r.height}:{width:r.width,height:r.height}}}return f.\u0275fac=function(r){return new(r||f)},f.\u0275prov=s.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},3705:(Y,w,t)=>{"use strict";function _(O){const e=O.split(","),M=e[0].replace("data:","").replace(";base64",""),b=atob(e[1]),d=new ArrayBuffer(b.length),E=new Uint8Array(d);for(let s=0;s<b.length;s+=1)E[s]=b.charCodeAt(s);return new Blob([d],{type:M})}t.d(w,{L:()=>_})},5851:(Y,w,t)=>{"use strict";t.d(w,{B:()=>X});var _=t(5861),O=t(1378),e=t(5879),M=t(2438),b=t(4036),d=t(9054),E=t(4020),s=t(148),A=t(9093),f=t(7621),x=t(1990),r=t(5661),u=t(5172),v=t(3845),C=t(4887),D=t(5487),I=t(658),j=t(9515),T=t(6814),S=t(6223),l=t(9473),c=t(554),U=t(4464),y=t(4228);const Z=["fileInput"];function K(o,B){1&o&&(e.O4$(),e.TgZ(0,"svg",31),e._UZ(1,"path",32)(2,"path",33),e.qZA())}const V=function(){return["text-primary"]};function H(o,B){1&o&&e._UZ(0,"app-logo",34),2&o&&e.Q6J("svgClass",e.DdM(2,V))("responsive",!1)}function ee(o,B){1&o&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&o&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.DESKTOP"),e.oJD)}function ae(o,B){1&o&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&o&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.TOUCH"),e.oJD)}const ne=function(o){return{"fw-bold fs-md-lg":o}},ue=function(o){return{"text-decoration-underline":o}};function oe(o,B){if(1&o){const n=e.EpF();e.TgZ(0,"div",35),e.YNc(1,ee,2,3,"span",36),e.YNc(2,ae,2,3,"span",36),e.TgZ(3,"span",37),e.NdJ("click",function(a){e.CHM(n);const R=e.oxw(2),N=e.MAs(23);return e.KtG(R.toggleRemoteUrlForm(a,N))}),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&o){const n=e.oxw(2);e.Q6J("ngClass",e.VKq(7,ne,!n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.touchDevice),e.xp6(1),e.Q6J("ngIf",n.touchDevice),e.xp6(1),e.Q6J("ngClass",e.VKq(9,ue,n.isWidget)),e.xp6(1),e.Oqu(e.lcZ(5,5,"COMPONENTS.UPLOADER.DESCRIPTION.REMOTE_URL"))}}function fe(o,B){1&o&&e.GkF(0)}function ce(o,B){if(1&o){const n=e.EpF();e.TgZ(0,"div",39),e.YNc(1,fe,1,0,"ng-container",17),e.TgZ(2,"button",40),e.NdJ("click",function(a){e.CHM(n);const R=e.oxw(2);return e.KtG(R.handleRemoteUrlUpload(a))}),e.O4$(),e.TgZ(3,"svg",41),e._UZ(4,"path",42),e.qZA()(),e.kcU(),e.TgZ(5,"button",43),e.NdJ("click",function(a){e.CHM(n);const R=e.oxw(2);return e.KtG(R.toggleRemoteUrlForm(a))}),e.O4$(),e.TgZ(6,"svg",41),e._UZ(7,"path",44),e.qZA()()()}if(2&o){const n=e.oxw(2),h=e.MAs(34);e.xp6(1),e.Q6J("ngTemplateOutlet",h),e.xp6(1),e.Q6J("disabled",0===n.remoteUrl.length||!n.isRemoteUrlValid)}}function Oe(o,B){if(1&o&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"em",45),e.ALo(5,"arrayJoin"),e.BQk()),2&o){const n=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"COMPONENTS.UPLOADER.PATH.LONG")," "),e.xp6(2),e.Q6J("innerText",n.currentFolderPath.length?e.xi3(5,4,n.currentFolderPath,"/"):"root")}}function m(o,B){if(1&o&&(e._UZ(0,"div",50),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&o){const n=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,n.currentFolderPath,0,-1),"/"))}}function i(o,B){if(1&o&&(e.TgZ(0,"div",46)(1,"div",47),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,m,3,8,"div",48),e._UZ(5,"div",49),e.ALo(6,"arrayJoin"),e.ALo(7,"slice"),e.qZA()),2&o){const n=e.oxw(2);e.xp6(2),e.hij(" ",e.lcZ(3,3,"COMPONENTS.UPLOADER.PATH.SHORT")," "),e.xp6(2),e.Q6J("ngIf",n.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(n.currentFolderPath.length>1?"/":"")+(n.currentFolderPath.length?e.xi3(6,5,e.xi3(7,8,n.currentFolderPath,n.currentFolderPath.length-1),"/"):"root"))}}const p=function(){return{bottom:0,left:0}};function g(o,B){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"a",51),e.NdJ("click",function(){e.CHM(n);const a=e.oxw(2);return e.KtG(a.openInfoModal.emit())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",52),e.NdJ("click",function(){e.CHM(n),e.oxw(2);const a=e.MAs(7);return e.KtG(a.open())}),e._uU(5," settings "),e.qZA(),e.TgZ(6,"div",53),e.NdJ("click",function(a){e.CHM(n);const R=e.oxw(2),N=e.MAs(23);return e.KtG(R.toggleRemoteUrlForm(a,N))}),e._uU(7," add_link "),e.qZA(),e.BQk()}2&o&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,p)),e.xp6(1),e.Oqu(e.lcZ(3,2,"COMPONENTS.UPLOADER.INFO")))}const P=function(o,B,n){return{"cursor-pointer":o,"py-4 px-3 px-sm-4":B,"p-2 pb-3":n}},L=function(o,B,n){return{"my-2":o,"mb-2":B,"mw-100 mt-1":n}};function k(o,B){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",22,23),e.NdJ("dragenter",function(){e.CHM(n);const a=e.MAs(2),R=e.oxw();return e.KtG(R.setDragOverEvent(a))})("drop",function(a){e.CHM(n);const R=e.oxw();return e.KtG(R.handleDropEvent(a))})("click",function(){e.CHM(n);const a=e.oxw(),R=e.MAs(2);return e.KtG(!a.isWaitingRemoteUrl&&R.click())}),e.YNc(3,K,3,0,"svg",24),e.YNc(4,H,1,3,"ng-template",null,25,e.W1O),e.YNc(6,oe,6,11,"div",26),e.YNc(7,ce,8,2,"div",27),e.TgZ(8,"div",28),e.YNc(9,Oe,6,7,"ng-container",3),e.YNc(10,i,8,11,"ng-template",null,29,e.W1O),e.qZA()(),e.YNc(12,g,8,5,"ng-container",30),e.BQk()}if(2&o){const n=e.MAs(5),h=e.MAs(11),a=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(9,P,!a.loading&&!a.isWaitingRemoteUrl,!a.isWidget,a.isWidget)),e.xp6(2),e.Q6J("ngIf",!a.isWidget)("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",!a.isWidget||!a.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngIf",a.isWidget&&a.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngClass",e.kEZ(13,L,!a.isWidget&&!a.touchDevice,!a.isWidget&&a.touchDevice,a.isWidget)),e.xp6(1),e.Q6J("ngIf",!a.isWidget)("ngIfElse",h),e.xp6(3),e.Q6J("ngIf",!a.isWidget)}}const Q=function(o,B){return{"p-4":o,"p-2":B}};function F(o,B){if(1&o&&(e.TgZ(0,"div",54),e.O4$(),e.TgZ(1,"svg",55),e._UZ(2,"path",56),e.qZA(),e.kcU(),e._UZ(3,"app-loader",57),e.TgZ(4,"div",58),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&o){const n=e.oxw();e.Q6J("ngClass",e.WLB(6,Q,!n.isWidget,n.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",n.loadingMessage),e.xp6(2),e.hij(" ",e.lcZ(6,4,"COMPONENTS.UPLOADER.LOADING.SUBTEXT")," ")}}function W(o,B){1&o&&e.GkF(0)}const J=function(o){return{"fs-reset":o}};function $(o,B){if(1&o){const n=e.EpF();e.TgZ(0,"input",59,60),e.NdJ("ngModelChange",function(a){e.CHM(n);const R=e.oxw();return e.KtG(R.remoteUrl=a)})("ngModelChange",function(){e.CHM(n);const a=e.MAs(1),R=e.oxw();return e.KtG(R.isRemoteUrlValid=!a.invalid)}),e.ALo(2,"translate"),e.qZA()}if(2&o){const n=e.oxw();e.Q6J("placeholder",e.lcZ(2,4,"COMPONENTS.UPLOADER.REMOTE_URL_INPUT_PLACEHOLDER"))("ngClass",e.VKq(6,J,n.isWidget))("ngModel",n.remoteUrl)("pattern","^https?://[^.]+\\.(.+)")}}const re=function(o,B){return{uploading:o,"widget flex-grow-1 min-w-0":B}};let X=(()=>{class o{constructor(n,h,a,R,N,G,ie,se,te){this.postMessageService=n,this.uploadService=h,this.uploadObservablesService=a,this.uploaderService=R,this.toastService=N,this.renderer=G,this.ngZone=ie,this.translateService=se,this.proxyService=te,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="",this.touchDevice=E.eX,this.isWaitingRemoteUrl=!1,this.remoteUrl="",this.isRemoteUrlValid=!1,this.dragOverEvent=!1,this.checkingFileMessage="",this.options=this.uploaderService.uploaderOptions;const q=this.uploadService.preferences.uploader;q.checkImage.active||(this.options.compress=!1),q.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){var n=this;return(0,_.Z)(function*(){n.handleClipboardPasteEvent(),n.handleExternalUpload(),n.checkingFileMessage=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CHECK"),n.loadingMessage=n.checkingFileMessage})()}handleClipboardPasteEvent(){var n=this;this.clipboardPasteEventSubscription=(0,M.R)(document.body,"paste").subscribe(function(){var h=(0,_.Z)(function*(a){if(n.isWidget&&n.isWaitingRemoteUrl||!n.canUpload())return;const R=Array.from((a.clipboardData||a.originalEvent.clipboardData).items);let N=[];for(const G of R)if(0===G.type.indexOf("image")){const ie=G.getAsFile();ie&&N.push(ie)}N.length>0?yield n.preUpload(N):n.reset()});return function(a){return h.apply(this,arguments)}}())}handleExternalUpload(){var n=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var h=(0,_.Z)(function*(a){if(a){if(!n.canUpload())return;yield n.preUpload([a.file],a.options)}else n.fileInputRef.nativeElement.click()});return function(a){return h.apply(this,arguments)}}())}handleSelectionEvent(n){var h=this;return(0,_.Z)(function*(){if(!h.canUpload())return;const a=n.target;if(a.files&&a.files.length){const R=Array.from(a.files);return a.value="",h.preUpload(R)}h.reset()})()}handleDropEvent(n){var h=this;return(0,_.Z)(function*(){var a;if(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!h.canUpload())return;const R=null!==(a=n.dataTransfer)&&void 0!==a&&a.files?Array.from(n.dataTransfer.files):[];if(R.length)return h.preUpload(R);h.reset()})()}handleRemoteUrlUpload(n,h){var a=this;return(0,_.Z)(function*(){if(!a.isRemoteUrlValid||0===a.remoteUrl.length||!a.canUpload())return;const R=a.remoteUrl;a.loadingMessage=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.GETTING_REMOTE_FILE"),a.toggleRemoteUrlForm(n,h);const N=(0,d.Tb)(R);if(!N.ext||-1===x.O8.findIndex(ie=>-1!==ie.ext.indexOf(N.ext)))return a.handleErrors([N.name],[]),void a.reset();const G=yield a.proxyService.get(R);return G?a.preUpload([new File([G],N.name,{type:G.type,lastModified:Date.now()})]):(a.toastService.show({content:"Errore nel recupero dell'immagine dall'url!",level:O.m.ERROR}),a.postMessageService.send(s.l.UPLOAD_ERROR,{filename:N.name,error:v.S.REMOTE_URL_RESPONSE}),void a.reset())})()}saveOptions(n=!0){this.uploaderService.uploaderOptions=this.options,n&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(n){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(n,"dragover",h=>{h.preventDefault()})}))}canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage=this.checkingFileMessage,this.postMessageService.send(s.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(n,h){var a=this;return(0,_.Z)(function*(){const R=[...a.currentFolderPath];let N=[],G=[],ie=[],se=[];h?h.allowOverwrite=h.allowOverwrite||!1:(h=a.uploaderService.uploaderOptions).allowOverwrite=!1;for(let z=0;z<n.length;z++){const pe=yield a.uploaderService.orientAndCompressFileIfNeeded(n[z]),le=pe.compressorCheck?pe.file:h.compress?yield a.uploaderService.compressFileIfNeeded(n[z],h.imageDimensions):n[z];if(le){const ge=(0,d.Tb)(le.name),_e=x.O8.find(Ee=>-1!==Ee.ext.indexOf(ge.ext));if(!_e){ie.push(le.name);continue}if(le.size>_e.maxSize){se.push(le.name);continue}N.push({file:{name:le.name,size:le.size,time:0,url:"",ext:ge.ext,filename:ge.filename,isImage:(0,d.Or)(ge.ext),embedUrl:"",type:u.VC.FILE},progress:0,completed:!1}),G.push(le)}}if(a.handleErrors(ie,se),0===G.length)return void a.reset();const te=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.UPLOADING",{total:G.length}),q=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CREATING_PACKAGE",{total:G.length});a.uploadObservablesService.pushUploadingFileQueue(N);for(let z=0;z<G.length;++z){a.loadingMessage=q;const pe=yield a.uploadService.getHostToken(R,G[z].name);N[z].progress+=20,a.loadingMessage=te.replace("{{current}}",`${z+1}`),yield(0,b.z)(a.uploaderService.upload(G[z],N[z],pe,h.allowOverwrite))}a.uploadObservablesService.pushUploadingFileQueue([]);const de=N.filter(z=>!z.error).map(z=>z.file);de.length>0&&(a.fileUploadedEvent.emit({list:de,rewrite:h.allowOverwrite,destPath:R}),a.postMessageService.send(s.l.UPLOAD_SUCCESS,{fileList:de.map(z=>({filename:z.name,isImage:z.isImage,url:z.url}))}),h.openLinkModalAfterUpload&&a.uploadObservablesService.pushAction({name:u.In.FILE_SHOW_LINKS,payload:{entities:(0,d.jL)(de)}})),a.reset()})()}handleErrors(n,h){if(0!==n.length||0!==h.length){if(!this.isWidget)return void this.toastService.show({content:this.createToastMessage(n,h),level:O.m.ERROR});[[v.S.UNSUPPORTED,n],[v.S.OVERSIZED,h]].forEach(a=>{a[1].forEach(R=>{this.postMessageService.send(s.l.UPLOAD_ERROR,{filename:R,error:a[0]})})})}}createToastMessage(n,h){let a=[];return n.length&&a.push(n.length>1?`I file <strong>${n.join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${n[0]}</strong> ha un formato non supportato!`),h.length&&a.push(h.length>1?`I file <strong>${h.join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${h[0]}</strong> \xe8 troppo pesante!`),a.join("<br><br>")}toggleRemoteUrlForm(n,h){n.stopPropagation(),this.isWidget||(this.isWaitingRemoteUrl?null==h||h.close():null==h||h.open()),this.resetRemoteUrlForm(!this.isWaitingRemoteUrl)}resetRemoteUrlForm(n){this.isWaitingRemoteUrl=n,this.remoteUrl=""}ngOnDestroy(){var n;null===(n=this.startExternalUploadSubscription)||void 0===n||n.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return o.\u0275fac=function(n){return new(n||o)(e.Y36(A.F),e.Y36(I.C),e.Y36(D.r),e.Y36(C.q),e.Y36(r.k),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(j.sK),e.Y36(f.y))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-uploader"]],viewQuery:function(n,h){if(1&n&&e.Gf(Z,5),2&n){let a;e.iGM(a=e.CRH())&&(h.fileInputRef=a.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:35,vars:37,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],[3,"title"],["optionsModal",""],[3,"innerHtml"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto",3,"innerHTML"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto",3,"innerHTML"],["size","md",3,"title","disableCloseButton","hidden"],["remoteUrlModal",""],[1,"mb-2",3,"innerHTML"],[4,"ngTemplateOutlet"],["footer",""],["type","button",1,"btn","btn-secondary",3,"innerText","click"],["type","button",1,"btn","btn-primary",3,"disabled","innerText","click"],["remoteUrlInput",""],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],["class","description text-center",3,"ngClass",4,"ngIf"],["class","input-group input-group-sm remote-url-form justify-content-center mb-1",4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"description","text-center",3,"ngClass"],[3,"innerHTML",4,"ngIf"],[1,"ms-1","remote-url-btn","fst-italic","cursor-pointer",3,"ngClass","click"],[3,"innerHTML"],[1,"input-group","input-group-sm","remote-url-form","justify-content-center","mb-1"],[1,"input-group-text","bg-light",3,"disabled","click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 16 16"],["d","M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"],[1,"input-group-text","bg-light",3,"click"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","options-icon",3,"click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","remote-url-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"],["type","text","required","",1,"form-control",3,"placeholder","ngClass","ngModel","pattern","ngModelChange"],["input","ngModel"]],template:function(n,h){if(1&n){const a=e.EpF();e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(N){return h.handleSelectionEvent(N)}),e.qZA(),e.YNc(3,k,13,17,"ng-container",3),e.YNc(4,F,7,9,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6),e.ALo(8,"translate"),e._UZ(9,"div",7),e.ALo(10,"translate"),e.TgZ(11,"ul",8)(12,"li")(13,"div",9)(14,"input",10),e.NdJ("ngModelChange",function(N){return h.options.compress=N})("ngModelChange",function(){return h.saveOptions()}),e.qZA(),e._UZ(15,"label",11),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"li")(18,"div",9)(19,"input",12),e.NdJ("ngModelChange",function(N){return h.options.openLinkModalAfterUpload=N})("ngModelChange",function(){return h.saveOptions()}),e.qZA(),e._UZ(20,"label",13),e.ALo(21,"translate"),e.qZA()()()(),e.TgZ(22,"app-modal",14,15),e.NdJ("hidden",function(){return h.resetRemoteUrlForm(!1)}),e.ALo(24,"translate"),e._UZ(25,"p",16),e.ALo(26,"translate"),e.YNc(27,W,1,0,"ng-container",17),e.ynx(28,18),e.TgZ(29,"button",19),e.NdJ("click",function(){e.CHM(a);const N=e.MAs(23);return e.KtG(N.close())}),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",20),e.NdJ("click",function(N){e.CHM(a);const G=e.MAs(23);return e.KtG(h.handleRemoteUrlUpload(N,G))}),e.ALo(32,"translate"),e.qZA(),e.BQk(),e.qZA(),e.YNc(33,$,3,8,"ng-template",null,21,e.W1O)}if(2&n){const a=e.MAs(5),R=e.MAs(34);e.Q6J("ngClass",e.WLB(34,re,h.isUploading,h.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",h.loading||h.isUploading),e.xp6(2),e.Q6J("ngIf",!h.isUploading)("ngIfElse",a),e.xp6(3),e.Q6J("title",e.lcZ(8,18,"COMPONENTS.UPLOADER.SETTINGS_MODAL.TITLE")),e.xp6(3),e.Q6J("innerHtml",e.lcZ(10,20,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.DESCRIPTION"),e.oJD),e.xp6(5),e.Q6J("ngModel",h.options.compress),e.xp6(1),e.Q6J("innerHTML",e.lcZ(16,22,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.COMPRESS_SWITCH"),e.oJD),e.xp6(4),e.Q6J("ngModel",h.options.openLinkModalAfterUpload),e.xp6(1),e.Q6J("innerHTML",e.lcZ(21,24,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.SHOW_LINK_SWITCH"),e.oJD),e.xp6(2),e.Q6J("title",e.lcZ(24,26,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.TITLE"))("disableCloseButton",!0),e.xp6(3),e.Q6J("innerHTML",e.lcZ(26,28,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.CONTENT"),e.oJD),e.xp6(2),e.Q6J("ngTemplateOutlet",R),e.xp6(2),e.Q6J("innerText",e.lcZ(30,30,"SHARED.CANCEL")),e.xp6(2),e.Q6J("disabled",0===h.remoteUrl.length||!h.isRemoteUrlValid)("innerText",e.lcZ(32,32,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.UPLOAD_BTN"))}},dependencies:[T.mk,T.O5,T.tP,T.PC,S.Fj,S.Wl,S.JJ,S.Q7,S.c5,S.On,l.R,c.R,U.z,y.J,T.OU,j.X$],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864fe;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:350px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:_ngcontent-%COMP%_draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{top:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{opacity:1}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{right:5px}.uploader[_ngcontent-%COMP%]   .remote-url-icon[_ngcontent-%COMP%]{right:30px}.upload-area.cursor-pointer[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo):not(.description), .upload-area.cursor-pointer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.remote-url-btn){pointer-events:none}.remote-url-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:300px}.remote-url-form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:.5}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes _ngcontent-%COMP%_bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes _ngcontent-%COMP%_draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),o})()},529:(Y,w,t)=>{"use strict";t.d(w,{M:()=>A});var _=t(4243),O=t(6814),e=t(6223),M=t(5461),b=t(2740),d=t(4610),E=t(9515),s=t(5879);let A=(()=>{class f{}return f.\u0275fac=function(r){return new(r||f)},f.\u0275mod=s.oAB({type:f}),f.\u0275inj=s.cJS({imports:[_.r,O.ez,e.u5,M.q,b.h,d.z,E.aw.forChild()]}),f})()},3845:(Y,w,t)=>{"use strict";t.d(w,{S:()=>_});var _=function(O){return O.UNSUPPORTED="unsupported",O.OVERSIZED="oversized",O.REMOTE_URL_RESPONSE="remote-url-response",O.UPLOAD_FAILED="upload-failed",O}(_||{})},4243:(Y,w,t)=>{"use strict";t.d(w,{r:()=>e});var _=t(6814),O=t(5879);let e=(()=>{class M{}return M.\u0275fac=function(d){return new(d||M)},M.\u0275mod=O.oAB({type:M}),M.\u0275inj=O.cJS({imports:[_.ez]}),M})()},4228:(Y,w,t)=>{"use strict";t.d(w,{J:()=>O});var _=t(5879);let O=(()=>{class e{transform(b,d){return b.join(d)}}return e.\u0275fac=function(b){return new(b||e)},e.\u0275pipe=_.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},5172:(Y,w,t)=>{"use strict";t.d(w,{In:()=>_,Ky:()=>b,VC:()=>O,c5:()=>M,gG:()=>e});var _=function(d){return d.FILE_SHOW_LINKS="fileLinks",d.FILE_EDIT="fileEdit",d.DELETE="delete",d.RENAME="rename",d.MOVE="move",d}(_||{}),O=function(d){return d.FILE="file",d.FOLDER="folder",d}(O||{}),e=function(d){return d.FILENAME="filename",d.SIZE="size",d.TIME="time",d.EXTENSION="ext",d}(e||{}),M=function(d){return d.GRID="grid",d.LIST="list",d}(M||{}),b=function(d){return d.W_768_I_1="(max-width: 767.98px)",d.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",d.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",d.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",d.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",d.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",d.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",d.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",d.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",d.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",d.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",d.W_3738_I_10="(min-width: 3424px)",d}(b||{})},1990:(Y,w,t)=>{"use strict";t.d(w,{C7:()=>M,Mi:()=>b,O8:()=>O,er:()=>d,p0:()=>e,xt:()=>E});var _=t(5172);const O=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(s=>(s.maxSize*=1048576,s)),e={lastPath:[],layout:{asc:!0,orderBy:_.gG.FILENAME,type:_.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},M="https://upload.forumfree.net/api/",b=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,d=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,E={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},7621:(Y,w,t)=>{"use strict";t.d(w,{y:()=>f});var _=t(5861),O=t(2907),e=t(708),M=t(8180),b=t(4664),d=t(2096),E=t(6306),s=t(5879),A=t(9862);let f=(()=>{class x{constructor(u,v){this.http=u,this.endpointsService=v}get(u){var v=this;return(0,_.Z)(function*(){const C=v.sendRequest(u);return yield(0,e.n)(C)})()}sendRequest(u){return this.getUrlContent(u).pipe((0,M.q)(1),(0,b.w)(v=>(0,d.of)(v)),(0,E.K)(()=>this.getUrlContentWithProxy(u)))}getUrlContent(u){return this.http.get(u,{responseType:"blob"})}getUrlContentWithProxy(u){return this.http.get(this.endpointsService.get(O.jQ.PROXY,O.ph.COMMON),{headers:{[O._o.HeaderKeys.TOKEN_TYPE]:O.s9.ACCESS,"x-remote-url":u},responseType:"blob"}).pipe((0,M.q)(1),(0,E.K)(()=>(0,d.of)(void 0)))}}return x.\u0275fac=function(u){return new(u||x)(s.LFG(A.eN),s.LFG(O.oz))},x.\u0275prov=s.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},5983:(Y,w,t)=>{"use strict";t.d(w,{B:()=>M});var _=t(5172),O=t(1410),e=t(5879);let M=(()=>{class b{constructor(E){this.globalsService=E,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(s=>{this.ffuid=s?s.user.ffuid:""})}getItem(E){const s=this.createKey(E);if(this.cache.hasOwnProperty(s))return this.cache[s]}setItem(E,s){this.cache[this.createKey(E)]=s}removeItem(E){const s=this.createKey(E);if(this.cache.hasOwnProperty(s)){if(this.cache[s].folders.length)for(const A of this.cache[s].folders)this.removeItem([...E,A.name]);return delete this.cache[s],!0}return!1}getEntities(E,s){let A={};const f=this.createKey(E);if(!this.cache.hasOwnProperty(f))return A;for(const x of s){const r=(x.type===_.VC.FILE?this.cache[f].files:this.cache[f].folders).find(u=>u.name===x.name);r&&(A[r.name]=r)}return A}addEntities(E,s,A=_.VC.FILE){const f=this.createKey(E);return!!this.cache.hasOwnProperty(f)&&(Array.isArray(s)||(s=[s]),A===_.VC.FILE?this.cache[f].files.unshift(...s):this.cache[f].folders.unshift(...s),!0)}removeEntities(E,s,A=_.VC.FILE){if(Array.isArray(s)||(s=[s]),A===_.VC.FOLDER)for(const u of s)this.removeItem([...E,u]);const f=this.createKey(E);if(!this.cache.hasOwnProperty(f))return[];const x=A===_.VC.FILE?"files":"folders";let r=[];for(const u of s){const v=this.cache[f][x].findIndex(C=>C.name===u);v>-1&&(this.cache[f][x].splice(v,1),r.push(u))}return r}refactorFolderContent(E,s){const A=this.createKey(E);if(!this.cache.hasOwnProperty(A))return!1;s.endsWith("/")||(s+="/");for(const f of this.cache[A].folders)f.url=s+f.name;for(const f of this.cache[A].files)f.url=f.embedUrl=s+f.name,f.time=Date.now();return!0}createKey(E){return`${this.ffuid}/${E.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return b.\u0275fac=function(E){return new(E||b)(e.LFG(O.d))},b.\u0275prov=e.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"}),b})()},5571:(Y,w,t)=>{"use strict";t.d(w,{AD:()=>O,It:()=>d,ex:()=>_,mH:()=>E,r2:()=>M,vO:()=>b,xJ:()=>e});const _="\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",O="\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",e="\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",M="\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",b="\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",d="\nquery UploadHistoryAvailableDateRange {\n    uploadHistoryAvailableDateRange {\n        start\n        end\n    }\n}",E="\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}"},5487:(Y,w,t)=>{"use strict";t.d(w,{r:()=>b});var _=t(8645),O=t(5619),e=t(446),M=t(5879);let b=(()=>{class d{constructor(s){this.uploadPreferencesService=s,this.selectedFileListArray=[],this.actionSubject=new _.x,this.uploadingFileQueueSubject=new _.x,this.uploadingFileErrorSubject=new _.x,this.currentFolderPathSubject=new _.x,this.layoutOptionsSubject=new _.x,this.renameEntitySubject=new _.x,this.entityPendingSubject=new _.x,this.deleteFileSubject=new _.x,this.uploadedFileSubject=new _.x,this.draggedFileListSubject=new _.x,this.startUploadSubject=new _.x,this.startMoveSubject=new _.x,this.selectedFileListSubject=new O.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(s){this.actionSubject.next(s)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(s){this.uploadPreferencesService.layoutOptions=s,this.layoutOptionsSubject.next(s)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(s){this.uploadPreferencesService.lastFolderPath=s,this.currentFolderPathSubject.next(s)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(s){this.uploadingFileQueueSubject.next(s)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(s){this.uploadingFileErrorSubject.next(s)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(s){this.renameEntitySubject.next(s)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(s){this.entityPendingSubject.next(s)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(s){this.deleteFileSubject.next(s)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(s){this.uploadedFileSubject.next(s)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(s){this.draggedFileListSubject.next(s)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(s){this.startUploadSubject.next(s)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(s){this.startMoveSubject.next(s)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(s){if(Array.isArray(s)||(s=[s]),0===s.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let A=!1;for(const f of s){const x=this.selectedFileListArray.findIndex(r=>r.name===f.name);f.selected?-1===x&&(this.selectedFileListArray.push({name:f.name}),A=!0):x>-1&&(this.selectedFileListArray.splice(x,1),A=!0)}A&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return d.\u0275fac=function(s){return new(s||d)(M.LFG(e.p))},d.\u0275prov=M.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},446:(Y,w,t)=>{"use strict";t.d(w,{p:()=>d});var _=t(7165),O=t(463),e=t(1990),M=t(2986),b=t(5879);let d=(()=>{class E{constructor(A,f){this.preferencesService=A,this.urlQueryParamsService=f;const x=this.urlQueryParamsService.getAndDeleteParam(_.RT.UPLOAD_PATH);x&&(this.lastFolderPath=x.split("/").filter(r=>r.length>0))}get preferences(){return this.preferencesService.getItem(_.Ye.UPLOAD)||e.p0}set preferences(A){this.preferencesService.setItem(_.Ye.UPLOAD,A)}get lastFolderPath(){return(this.preferences.lastPath||e.p0.lastPath).filter(A=>A.length>0)}set lastFolderPath(A){const f=this.preferences;f.lastPath=A,this.preferences=f}get layoutOptions(){const A=e.p0.layout,f=this.preferences.layout;return f&&0===Object.keys(A).filter(x=>!f.hasOwnProperty(x)).length?f:A}set layoutOptions(A){const f=this.preferences;f.layout=A,this.preferences=f}get uploader(){const A=this.preferences.uploader||e.p0.uploader;return!A.checkImage.active&&Date.now()-A.checkImage.time>6048e5&&(A.checkImage.active=!0,this.uploader=A),A.hasOwnProperty("showLinkModal")||(A.showLinkModal=!1),A}set uploader(A){const f=this.preferences;f.uploader=A,this.preferences=f}}return E.\u0275fac=function(A){return new(A||E)(b.LFG(O.y),b.LFG(M.J))},E.\u0275prov=b.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})()},658:(Y,w,t)=>{"use strict";t.d(w,{C:()=>v});var _=t(1413),O=t(5861),e=t(2907),M=t(4036),b=t(5172),d=t(9054),E=t(5571),s=t(5983),A=t(1990),f=t(446),x=t(4004),r=t(5879),u=t(9862);let v=(()=>{class C{constructor(I,j,T,S){this.graphqlService=I,this.uploadCacheService=j,this.uploadPreferencesService=T,this.http=S}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(e._o.HeaderKeys.UUID,(0,x.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(e._o.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(e._o.HeaderKeys.UUID)||""}getFileList(I,j){var T=this;return(0,O.Z)(function*(){const S=T.uploadCacheService.getItem(I);if(S)return S;const l=(yield T.graphqlService.query({query:E.ex,variables:{scope:j,target:I.join("/")}})).data.uploadEntitiesListToken,c=yield T.sendRequest(l),y={files:c.files.map(Z=>{const K=(0,d.Tb)(Z.url);return(0,_.Z)((0,_.Z)({},Z),{time:1e3*Z.time,filename:K.filename,ext:K.ext,isImage:(0,d.Or)(K.ext),embedUrl:`${Z.url}?t=${Z.time}`,type:b.VC.FILE})}),folders:c.folders.map(Z=>(0,_.Z)((0,_.Z)({},Z),{},{type:b.VC.FOLDER}))};return T.uploadCacheService.setItem(I,y),y})()}createDirectory(I,j){var T=this;return(0,O.Z)(function*(){const S=(yield T.graphqlService.mutate({mutation:E.xJ,variables:{scope:j,target:I.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield T.sendRequest(S)})()}moveRenameEntity(I,j,T,S,l){var c=this;return(0,O.Z)(function*(){S||(S=T);const U=(yield c.graphqlService.mutate({mutation:E.r2,variables:{scope:l,source:(I.length?`${I.join("/")}/`:"")+T,target:(j.length?`${j.join("/")}/`:"")+S}})).data.uploadEntitiesMoveToken,y=yield c.sendRequest(U);return(0,_.Z)((0,_.Z)({},y),{},{time:1e3*y.time})})()}deleteEntity(I,j,T){var S=this;return(0,O.Z)(function*(){const l=(yield S.graphqlService.mutate({mutation:E.vO,variables:{scope:T,target:(I.length?`${I.join("/")}/`:"")+j}})).data.uploadEntitiesDeleteToken;return yield S.sendRequest(l),!0})()}getHostToken(I,j,T){var S=this;return(0,O.Z)(function*(){return(yield S.graphqlService.query({query:E.AD,variables:{scope:T,target:(I.length?`${I.join("/")}/`:"")+j}})).data.uploadEntitiesHostToken})()}sendRequest(I){var j=this;return(0,O.Z)(function*(){return(yield(0,M.z)(j.http.post(A.C7,JSON.stringify({payload:I}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(I,j){var T=this;return(0,O.Z)(function*(){return yield T.graphqlService.subscribe({query:E.mH,variables:{scope:j}},S=>{var l;if(null===(l=S.data)||void 0===l||!l.uploadEntities)return;const c=JSON.parse(S.data.uploadEntities.eventMessage);!c.payload.customHeaders||!c.payload.customHeaders.hasOwnProperty(e._o.HeaderKeys.UUID)||c.payload.customHeaders[e._o.HeaderKeys.UUID]===T.getGqlIdHeader()||I({type:S.data.uploadEntities.eventType,message:c})})})()}}return C.\u0275fac=function(I){return new(I||C)(r.LFG(e.Jk),r.LFG(s.B),r.LFG(f.p),r.LFG(u.eN))},C.\u0275prov=r.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},9054:(Y,w,t)=>{"use strict";t.d(w,{$H:()=>I,JN:()=>x,LZ:()=>u,Lv:()=>E,Or:()=>D,Tb:()=>b,jL:()=>C,lY:()=>s,ok:()=>T,rQ:()=>S,rc:()=>j,sT:()=>A,zO:()=>d});var _=t(5861),O=t(1413),e=t(5172),M=t(1990);function b(l){let c=l;if(l.indexOf("/")>-1){const K=l.split("/");c=K[K.length-1]}const U=c.replace(/\?.*$/,"").split("."),y=U.length>1?U[U.length-1].toLowerCase():"",Z=decodeURIComponent(U.slice(0,-1).join("."));return{ext:y,filename:Z,name:y?`${Z}.${y}`:""}}function d(l,c={}){const U=b(l),y=Date.now();return(0,O.Z)({name:U.name,size:0,time:y,url:l,ext:U.ext,filename:U.filename,isImage:D(U.ext),embedUrl:`${l}?t=${y}`,type:e.VC.FILE},c)}function E(l){let c=l;c.endsWith("/")&&(c=c.slice(0,-1));const U=c.split("/");return{name:decodeURIComponent(U[U.length-1])}}function s(l){return{name:E(l).name,url:l,type:e.VC.FOLDER}}function A(l){return f.apply(this,arguments)}function f(){return(f=(0,_.Z)(function*(l){const c=new FileReader,U=new Promise(y=>c.addEventListener("load",()=>y(c.result)));return c.readAsDataURL(l),U})).apply(this,arguments)}function x(l){return r.apply(this,arguments)}function r(){return(r=(0,_.Z)(function*(l){const c=new DataView(yield l.arrayBuffer());if(2303741511===c.getUint32(0)&&218765834===c.getUint32(4)){if(-1===[4,6].indexOf(c.getUint8(25)))return!1;const y=Object.assign(new Image,{src:yield A(l)});yield new Promise(V=>y.addEventListener("load",()=>V(!0)));const Z=Object.assign(document.createElement("canvas"),{width:y.width,height:y.height}).getContext("2d");if(!Z)return!1;Z.imageSmoothingEnabled=!1,Z.drawImage(y,0,0);const K=null==Z?void 0:Z.getImageData(0,0,y.width,y.height);if(K)for(let V=0;V<K.data.length;V+=4)if(K.data[V+3]<255)return!0}return!1})).apply(this,arguments)}function u(l){return v.apply(this,arguments)}function v(){return(v=(0,_.Z)(function*(l){const c=Object.assign(new Image,{src:yield A(l)});return yield new Promise(U=>c.addEventListener("load",()=>U(!0))),c})).apply(this,arguments)}function C(l){return l.map(c=>({name:c.name,ext:c.ext,type:e.VC.FILE,url:c.url,embedUrl:c.embedUrl,isImage:c.isImage}))}function D(l,c=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(l)&&!c.includes(l)}function I(l){return D(l,["gif","svg"])}function j(l,c,U,y=[],Z=""){let K=(0,O.Z)({},M.xt);const V=l.trim();K.invalidLength=0===V.length;const H=(V+Z).replace(/\s{2,}/g," ");return K.alreadyUsed=c!==V&&y.includes(H),K.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(l),K.invalidCharacter=!(U===e.VC.FILE?M.Mi.test(l):M.er.test(l)),K}function T(l,c){return l.join("/")===c.join("/")}function S(l){let c=[],U=[];for(const y of l)y.type===e.VC.FILE?c.push(y):U.push(y);return{[e.VC.FILE]:c,[e.VC.FOLDER]:U}}},4887:(Y,w,t)=>{"use strict";t.d(w,{q:()=>j});var _=t(5861),O=t(1413),e=t(3705),M=t(4315),b=t.n(M),d=t(9829),E=t(9054),s=t(9862),A=t(8645),f=t(1687),x=t(9773),r=t(1990),u=t(5487),v=function(T){return T[T.ORIENTATION=0]="ORIENTATION",T[T.CAMERA_MODEL=1]="CAMERA_MODEL",T}(v||{});class C{static findApp1Marker(S){const l=new DataView(S),c=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let U=0;U<S.byteLength-2;U+=2){const y=l.getUint16(U);if(65505===y)return{offset:U,size:l.getUint16(U+2),little:18761==l.getUint16(U+8,!1)};if(c.has(y))break}}static stripAndReturnExif(S){return(0,_.Z)(function*(){const l=yield S.arrayBuffer(),c=C.findApp1Marker(l);return c?{file:new File([l.slice(0,c.offset),l.slice(c.offset+c.size+2)],S.name,{type:S.type,lastModified:S.lastModified}),exif:l.slice(c.offset,c.offset+c.size)}:{file:S}})()}static checkExifTagValue(S,l){const c=new DataView(S);if(1165519206!==c.getUint32(4,!1))return;const U=18761===c.getUint16(10,!1);let y=10;y+=c.getUint32(y+4,U);const Z=c.getUint16(y,U);y+=2;for(let K=0;K<Z;K++){const V=c.getUint16(y+12*K,U);if(l===v.ORIENTATION&&274===V)return c.getUint16(y+12*K+8,U);if(l===v.CAMERA_MODEL&&272===V){const H=c.getUint32(y+12*K+4,U),ee=c.getUint32(y+12*K+8,U),ae=new Uint8Array(S,ee,H),ne=Array.from(ae);return String.fromCharCode.apply(null,ne)}}}}var D=t(5879),I=t(9582);let j=(()=>{class T{constructor(l,c,U){this.http=l,this.uploadObservablesService=c,this.loadImageService=U,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return(0,O.Z)({},this.uploaderOptionsObject)}set uploaderOptions(l){this.uploaderOptionsObject=(0,O.Z)({},l)}compressFileIfNeeded(l,c){return(0,_.Z)(function*(){let U=["image/png","image/jpeg"],y={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};c&&(U.push("image/webp"),y.width=c.width,y.height=c.height,y.resize="cover",y.strict=!1);const Z=l.type.toLowerCase();return l.size<=1e6&&void 0===c||-1===U.indexOf(l.type.toLowerCase())?l:("image/png"===Z&&(yield(0,E.JN)(l))&&(y.convertSize=1/0),new Promise((K,V)=>{new(b())(l,(0,O.Z)((0,O.Z)({},y),{},{success:H=>{const ee=H instanceof Blob?new File([H],l.name,{type:l.type,lastModified:l.lastModified}):l;K(ee)},error:V}))}))})()}getDimensionsForForcedResize(l){return(0,_.Z)(function*(){const U=yield(0,E.LZ)(l),y=U.width>U.height?"width":"height";if(U[y]>1e3)return{[y]:1e3}})()}orientAndCompressFileIfNeeded(l){var c=this;return(0,_.Z)(function*(){if(-1===["image/jpeg"].indexOf(l.type.toLowerCase()))return{file:l,compressorCheck:!1};const y=yield C.stripAndReturnExif(l),Z=y.file;if(y.exif){if(void 0!==C.checkExifTagValue(y.exif,v.CAMERA_MODEL)){const ee=yield c.getDimensionsForForcedResize(l);if(ee)return{file:yield c.compressFileIfNeeded(l,ee),compressorCheck:!0}}const H=C.checkExifTagValue(y.exif,v.ORIENTATION);if(1!==H){l=Z;let ee=0;switch(H){case 3:case 4:ee=180;break;case 5:case 6:ee=90;break;case 7:case 8:ee=270}const ae=yield(0,E.sT)(l),ne=yield new Promise((oe,fe)=>{const ce=new Image;ce.onload=()=>oe({originalImage:ce,originalBase64:ae}),ce.onerror=fe,ce.src=ae}),ue=yield c.loadImageService.transformLoadedImage({original:{base64:ne.originalBase64,image:ne.originalImage,size:{width:ne.originalImage.naturalWidth,height:ne.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(H),rotate:ee/90}},new d.R);return l=new File([(0,e.L)(ue.transformed.base64)],l.name,{type:l.type,lastModified:Date.now()}),{file:yield c.compressFileIfNeeded(l),compressorCheck:!0}}}return{file:Z,compressorCheck:!1}})()}upload(l,c,U,y=!1){const Z=new A.x,K=new FormData;K.append("payload",U),K.append("upload",l,l.name),y&&K.append("allowOverwrite","1");const V=this.http.request(new s.aW("POST",r.C7,K,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(V.subscribe({next:H=>{if(H.type===s.dt.UploadProgress){if(!H.total||(c.progress=Math.round(50*H.loaded/H.total)+20,c.progress<70))return;(0,f.F)(1e3).pipe((0,x.R)(Z.asObservable())).subscribe(()=>{if(c.progress<95){const ne=Math.round(8*Math.random()+8);c.progress+ne>95?c.progress=95:c.progress+=ne}})}else if(H instanceof s.Zn){var ee,ae;if(c.progress=100,c.completed=!0,null!==(ee=H.body)&&void 0!==ee&&ee.error||null===(ae=H.body)||void 0===ae||!ae.success)c.error=!0,this.uploadObservablesService.pushUploadingFileError(c);else{c.file.url=H.body.success.url,c.file.time=Date.now(),c.file.embedUrl=`${c.file.url}?t=${c.file.time}`;const ne=(0,E.Tb)(c.file.url);c.file.name=ne.name,c.file.filename=ne.filename}Z.next(),Z.complete()}},error:()=>{c.error=!0,this.uploadObservablesService.pushUploadingFileError(c),Z.next(),Z.complete()}})),Z.asObservable()}clearPendingRequests(){for(const l of this.requestSubscriptions)l.unsubscribe();this.requestSubscriptions=[]}}return T.\u0275fac=function(l){return new(l||T)(D.LFG(s.eN),D.LFG(u.r),D.LFG(I.y))},T.\u0275prov=D.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})()},4315:function(Y){Y.exports=function(){"use strict";function w(m,i){var p=Object.keys(m);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(m);i&&(g=g.filter(function(P){return Object.getOwnPropertyDescriptor(m,P).enumerable})),p.push.apply(p,g)}return p}function t(m){for(var i=1;i<arguments.length;i++){var p=null!=arguments[i]?arguments[i]:{};i%2?w(Object(p),!0).forEach(function(g){M(m,g,p[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(p)):w(Object(p)).forEach(function(g){Object.defineProperty(m,g,Object.getOwnPropertyDescriptor(p,g))})}return m}function O(m,i){for(var p=0;p<i.length;p++){var g=i[p];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(m,E(g.key),g)}}function M(m,i,p){return(i=E(i))in m?Object.defineProperty(m,i,{value:p,enumerable:!0,configurable:!0,writable:!0}):m[i]=p,m}function b(){return b=Object.assign?Object.assign.bind():function(m){for(var i=1;i<arguments.length;i++){var p=arguments[i];for(var g in p)Object.prototype.hasOwnProperty.call(p,g)&&(m[g]=p[g])}return m},b.apply(this,arguments)}function E(m){var i=function d(m,i){if("object"!=typeof m||null===m)return m;var p=m[Symbol.toPrimitive];if(void 0!==p){var g=p.call(m,i||"default");if("object"!=typeof g)return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(m)}(m,"string");return"symbol"==typeof i?i:String(i)}var m,i,p,g,P,L,k,Q,s={exports:{}};m=s,typeof window>"u"||(i=window,p=i.HTMLCanvasElement&&i.HTMLCanvasElement.prototype,g=i.Blob&&function(){try{return!!new Blob}catch(F){return!1}}(),P=g&&i.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(F){return!1}}(),L=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder,k=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,Q=(g||L)&&i.atob&&i.ArrayBuffer&&i.Uint8Array&&function(F){var W,J,$,re,X,o,B,n,h;if(!(W=F.match(k)))throw new Error("invalid data URI");for(J=W[2]?W[1]:"text/plain"+(W[3]||";charset=US-ASCII"),$=!!W[4],re=F.slice(W[0].length),X=$?atob(re):decodeURIComponent(re),o=new ArrayBuffer(X.length),B=new Uint8Array(o),n=0;n<X.length;n+=1)B[n]=X.charCodeAt(n);return g?new Blob([P?B:o],{type:J}):((h=new L).append(o),h.getBlob(J))},i.HTMLCanvasElement&&!p.toBlob&&(p.mozGetAsFile?p.toBlob=function(F,W,J){var $=this;setTimeout(function(){F(J&&p.toDataURL&&Q?Q($.toDataURL(W,J)):$.mozGetAsFile("blob",W))})}:p.toDataURL&&Q&&(p.toBlob=p.msToBlob?function(F,W,J){var $=this;setTimeout(function(){F((W&&"image/png"!==W||J)&&p.toDataURL&&Q?Q($.toDataURL(W,J)):$.msToBlob(W))})}:function(F,W,J){var $=this;setTimeout(function(){F(Q($.toDataURL(W,J)))})})),m.exports?m.exports=Q:i.dataURLtoBlob=Q);var A=s.exports,x={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},u=typeof window<"u"&&typeof window.document<"u"?window:{},v=function(i){return i>0&&i<1/0},C=Array.prototype.slice;function D(m){return Array.from?Array.from(m):C.call(m)}var I=/^image\/.+$/;function j(m){return I.test(m)}var S=String.fromCharCode;var c=u.btoa;function U(m,i){for(var p=[],P=new Uint8Array(m);P.length>0;)p.push(S.apply(null,D(P.subarray(0,8192)))),P=P.subarray(8192);return"data:".concat(i,";base64,").concat(c(p.join("")))}function y(m){var p,i=new DataView(m);try{var g,P,L;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var k=i.byteLength,Q=2;Q+1<k;){if(255===i.getUint8(Q)&&225===i.getUint8(Q+1)){P=Q;break}Q+=1}if(P){var W=P+10;if("Exif"===function l(m,i,p){var P,g="";for(p+=i,P=i;P<p;P+=1)g+=S(m.getUint8(P));return g}(i,P+4,4)){var J=i.getUint16(W);if(((g=18761===J)||19789===J)&&42===i.getUint16(W+2,g)){var $=i.getUint32(W+4,g);$>=8&&(L=W+$)}}}if(L){var X,o,re=i.getUint16(L,g);for(o=0;o<re;o+=1)if(274===i.getUint16(X=L+12*o+2,g)){p=i.getUint16(X+=8,g),i.setUint16(X,1,g);break}}}catch(B){p=1}return p}var K=/\.\d*(?:0|9){12}\d*$/;function V(m){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return K.test(m)?Math.round(m*i)/i:m}function H(m){var i=m.aspectRatio,p=m.height,g=m.width,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",L=v(g),k=v(p);if(L&&k){var Q=p*i;("contain"===P||"none"===P)&&Q>g||"cover"===P&&Q<g?p=g/i:g=p*i}else L?p=g/i:k&&(g=p*i);return{width:g,height:p}}var ne=u.ArrayBuffer,ue=u.FileReader,oe=u.URL||u.webkitURL,fe=/\.\w+$/,ce=u.Compressor,Oe=function(){function m(i,p){(function _(m,i){if(!(m instanceof i))throw new TypeError("Cannot call a class as a function")})(this,m),this.file=i,this.exif=[],this.image=new Image,this.options=t(t({},x),p),this.aborted=!1,this.result=null,this.init()}return function e(m,i,p){return i&&O(m.prototype,i),p&&O(m,p),Object.defineProperty(m,"prototype",{writable:!1}),m}(m,[{key:"init",value:function(){var p=this,g=this.file,P=this.options;if(function(i){return!(typeof Blob>"u")&&(i instanceof Blob||"[object Blob]"===Object.prototype.toString.call(i))}(g)){var L=g.type;if(j(L))if(oe&&ue){ne||(P.checkOrientation=!1,P.retainExif=!1);var k="image/jpeg"===L,Q=k&&P.checkOrientation,F=k&&P.retainExif;if(!oe||Q||F){var W=new ue;this.reader=W,W.onload=function(J){var re=J.target.result,X={},o=1;Q&&(o=y(re))>1&&b(X,function Z(m){var i=0,p=1,g=1;switch(m){case 2:p=-1;break;case 3:i=-180;break;case 4:g=-1;break;case 5:i=90,g=-1;break;case 6:i=90;break;case 7:i=90,p=-1;break;case 8:i=-90}return{rotate:i,scaleX:p,scaleY:g}}(o)),F&&(p.exif=function ee(m){for(var i=D(new Uint8Array(m)),p=i.length,g=[],P=0;P+3<p;){var L=i[P],k=i[P+1];if(255===L&&218===k)break;if(255===L&&216===k)P+=2;else{var F=P+(256*i[P+2]+i[P+3])+2,W=i.slice(P,F);g.push(W),P=F}}return g.reduce(function(J,$){return 255===$[0]&&225===$[1]?J.concat($):J},[])}(re)),X.url=Q||F?!oe||o>1?U(re,L):oe.createObjectURL(g):re,p.load(X)},W.onabort=function(){p.fail(new Error("Aborted to read the image with FileReader."))},W.onerror=function(){p.fail(new Error("Failed to read the image with FileReader."))},W.onloadend=function(){p.reader=null},Q||F?W.readAsArrayBuffer(g):W.readAsDataURL(g)}else this.load({url:oe.createObjectURL(g)})}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(p){var g=this,P=this.file,L=this.image;L.onload=function(){g.draw(t(t({},p),{},{naturalWidth:L.naturalWidth,naturalHeight:L.naturalHeight}))},L.onabort=function(){g.fail(new Error("Aborted to load the image."))},L.onerror=function(){g.fail(new Error("Failed to load the image."))},u.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(u.navigator.userAgent)&&(L.crossOrigin="anonymous"),L.alt=P.name,L.src=p.url}},{key:"draw",value:function(p){var g=this,P=p.naturalWidth,L=p.naturalHeight,k=p.rotate,Q=void 0===k?0:k,F=p.scaleX,W=void 0===F?1:F,J=p.scaleY,$=void 0===J?1:J,re=this.file,X=this.image,o=this.options,B=document.createElement("canvas"),n=B.getContext("2d"),h=Math.abs(Q)%180==90,a=("contain"===o.resize||"cover"===o.resize)&&v(o.width)&&v(o.height),R=Math.max(o.maxWidth,0)||1/0,N=Math.max(o.maxHeight,0)||1/0,G=Math.max(o.minWidth,0)||0,ie=Math.max(o.minHeight,0)||0,se=P/L,te=o.width,q=o.height;if(h){var de=[N,R];R=de[0],N=de[1];var z=[ie,G];G=z[0],ie=z[1];var pe=[q,te];te=pe[0],q=pe[1]}a&&(se=te/q);var le=H({aspectRatio:se,width:R,height:N},"contain");R=le.width,N=le.height;var ge=H({aspectRatio:se,width:G,height:ie},"cover");if(G=ge.width,ie=ge.height,a){var _e=H({aspectRatio:se,width:te,height:q},o.resize);te=_e.width,q=_e.height}else{var Ee=H({aspectRatio:se,width:te,height:q}),Ue=Ee.width;te=void 0===Ue?P:Ue;var be=Ee.height;q=void 0===be?L:be}var Be=-(te=Math.floor(V(Math.min(Math.max(te,G),R))))/2,Fe=-(q=Math.floor(V(Math.min(Math.max(q,ie),N))))/2,We=te,je=q,Ae=[];if(a){var Me,ye,Te=H({aspectRatio:se,width:P,height:L},{contain:"cover",cover:"contain"}[o.resize]);Ae.push((P-(Me=Te.width))/2,(L-(ye=Te.height))/2,Me,ye)}if(Ae.push(Be,Fe,We,je),h){var De=[q,te];te=De[0],q=De[1]}B.width=te,B.height=q,j(o.mimeType)||(o.mimeType=re.type);var Ie="transparent";re.size>o.convertSize&&o.convertTypes.indexOf(o.mimeType)>=0&&(o.mimeType="image/jpeg");var Le="image/jpeg"===o.mimeType;if(Le&&(Ie="#fff"),n.fillStyle=Ie,n.fillRect(0,0,te,q),o.beforeDraw&&o.beforeDraw.call(this,n,B),!this.aborted&&(n.save(),n.translate(te/2,q/2),n.rotate(Q*Math.PI/180),n.scale(W,$),n.drawImage.apply(n,[X].concat(Ae)),n.restore(),o.drew&&o.drew.call(this,n,B),!this.aborted)){var Re=function(me){if(!g.aborted){var Se=function(ve){return g.done({naturalWidth:P,naturalHeight:L,result:ve})};if(me&&Le&&o.retainExif&&g.exif&&g.exif.length>0){var we=function(ve){return Se(A(U(function ae(m,i){var p=D(new Uint8Array(m));if(255!==p[2]||224!==p[3])return m;var P=[255,216].concat(i,p.slice(4+(256*p[4]+p[5])));return new Uint8Array(P)}(ve,g.exif),o.mimeType)))};if(me.arrayBuffer)me.arrayBuffer().then(we).catch(function(){g.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var he=new ue;g.reader=he,he.onload=function(xe){we(xe.target.result)},he.onabort=function(){g.fail(new Error("Aborted to read the compressed image with FileReader."))},he.onerror=function(){g.fail(new Error("Failed to read the compressed image with FileReader."))},he.onloadend=function(){g.reader=null},he.readAsArrayBuffer(me)}}else Se(me)}};B.toBlob?B.toBlob(Re,o.mimeType,o.quality):Re(A(B.toDataURL(o.mimeType,o.quality)))}}},{key:"done",value:function(p){var g=p.naturalWidth,P=p.naturalHeight,L=p.result,k=this.file,Q=this.image,F=this.options;if(oe&&0===Q.src.indexOf("blob:")&&oe.revokeObjectURL(Q.src),L)if(F.strict&&!F.retainExif&&L.size>k.size&&F.mimeType===k.type&&!(F.width>g||F.height>P||F.minWidth>g||F.minHeight>P||F.maxWidth<g||F.maxHeight<P))L=k;else{var W=new Date;L.lastModified=W.getTime(),L.lastModifiedDate=W,L.name=k.name,L.name&&L.type!==k.type&&(L.name=L.name.replace(fe,function T(m){var i=j(m)?m.substr(6):"";return"jpeg"===i&&(i="jpg"),".".concat(i)}(L.type)))}else L=k;this.result=L,F.success&&F.success.call(this,L)}},{key:"fail",value:function(p){var g=this.options;if(!g.error)throw p;g.error.call(this,p)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ce,m}},{key:"setDefaults",value:function(p){b(x,p)}}]),m}();return Oe}()},1687:(Y,w,t)=>{"use strict";t.d(w,{F:()=>e});var _=t(6321),O=t(4825);function e(M=0,b=_.z){return M<0&&(M=0),(0,O.H)(M,M,b)}},4004:(Y,w,t)=>{"use strict";t.d(w,{Z:()=>x});const O={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let e;const M=new Uint8Array(16);function b(){if(!e&&(e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(M)}const d=[];for(let r=0;r<256;++r)d.push((r+256).toString(16).slice(1));const x=function f(r,u,v){if(O.randomUUID&&!u&&!r)return O.randomUUID();const C=(r=r||{}).random||(r.rng||b)();if(C[6]=15&C[6]|64,C[8]=63&C[8]|128,u){v=v||0;for(let D=0;D<16;++D)u[v+D]=C[D];return u}return function E(r,u=0){return(d[r[u+0]]+d[r[u+1]]+d[r[u+2]]+d[r[u+3]]+"-"+d[r[u+4]]+d[r[u+5]]+"-"+d[r[u+6]]+d[r[u+7]]+"-"+d[r[u+8]]+d[r[u+9]]+"-"+d[r[u+10]]+d[r[u+11]]+d[r[u+12]]+d[r[u+13]]+d[r[u+14]]+d[r[u+15]]).toLowerCase()}(C)}}}]);