(self.webpackChunkboard=self.webpackChunkboard||[]).push([[620],{9969:(Y,w,t)=>{"use strict";t.d(w,{R:()=>c});class c{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(x=>x in this).forEach(x=>this[x]=e[x]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(x=>x in this).forEach(x=>this[x]=e[x].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},2020:(Y,w,t)=>{"use strict";t.d(w,{y:()=>i});var c=t(5861);var _=t(4650);let i=(()=>{class u{constructor(){this.autoRotateSupported=function e(){return new Promise(u=>{const l=new Image;l.onload=()=>{u(1===l.width&&2===l.height)},l.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(a,v){return new Promise((d,E)=>{const I=new FileReader;I.onload=T=>{this.loadImage(T.target.result,a.type,v).then(d).catch(E)},I.readAsDataURL(a)})}loadImage(a,v,d){return this.isValidImageType(v)?this.loadBase64Image(a,d):Promise.reject(new Error("Invalid image type"))}isValidImageType(a){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(a)}loadImageFromURL(a,v){return new Promise((d,E)=>{const I=new Image;I.onerror=()=>E,I.onload=()=>{const T=document.createElement("canvas"),K=T.getContext("2d");T.width=I.width,T.height=I.height,K?.drawImage(I,0,0),this.loadBase64Image(T.toDataURL(),v).then(d)},I.crossOrigin="anonymous",I.src=a})}loadBase64Image(a,v){return new Promise((d,E)=>{const I=new Image;I.onload=()=>d({originalImage:I,originalBase64:a}),I.onerror=E,I.src=a}).then(d=>this.transformImageBase64(d,v))}transformImageBase64(a,v){var d=this;return(0,c.Z)(function*(){const E=yield d.autoRotateSupported,I=yield function x(u){switch("string"==typeof u&&(u=function C(u){const l=new DataView(function f(u){u=u.replace(/^data\:([^\;]+)\;base64,/gim,"");const l=atob(u),a=l.length,v=new Uint8Array(a);for(let d=0;d<a;d++)v[d]=l.charCodeAt(d);return v.buffer}(u));if(65496!==l.getUint16(0,!1))return-2;const a=l.byteLength;let v=2;for(;v<a;){if(l.getUint16(v+2,!1)<=8)return-1;const d=l.getUint16(v,!1);if(v+=2,65505==d){if(1165519206!==l.getUint32(v+=2,!1))return-1;const E=18761==l.getUint16(v+=6,!1);v+=l.getUint32(v+4,E);const I=l.getUint16(v,E);v+=2;for(let T=0;T<I;T++)if(274==l.getUint16(v+12*T,E))return l.getUint16(v+12*T+8,E)}else{if(65280!=(65280&d))break;v+=l.getUint16(v,!1)}}return-1}(u)),u){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(E?-1:a.originalBase64);return a.originalImage&&a.originalImage.complete?d.transformLoadedImage({original:{base64:a.originalBase64,image:a.originalImage,size:{width:a.originalImage.naturalWidth,height:a.originalImage.naturalHeight}},exifTransform:I},v):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(a,v){var d=this;return(0,c.Z)(function*(){const E=v.canvasRotation+a.exifTransform.rotate,I={width:a.original.image.naturalWidth,height:a.original.image.naturalHeight};if(0===E&&!a.exifTransform.flip&&!v.containWithinAspectRatio)return{original:{base64:a.original.base64,image:a.original.image,size:{...I}},transformed:{base64:a.original.base64,image:a.original.image,size:{...I}},exifTransform:a.exifTransform};const T=d.getTransformedSize(I,a.exifTransform,v),K=document.createElement("canvas");K.width=T.width,K.height=T.height;const U=K.getContext("2d");U?.setTransform(a.exifTransform.flip?-1:1,0,0,1,K.width/2,K.height/2),U?.rotate(Math.PI*(E/2)),U?.drawImage(a.original.image,-I.width/2,-I.height/2);const M=K.toDataURL(),s=yield d.loadImageFromBase64(M);return{original:{base64:a.original.base64,image:a.original.image,size:{...I}},transformed:{base64:M,image:s,size:{width:s.width,height:s.height}},exifTransform:a.exifTransform}})()}loadImageFromBase64(a){return new Promise((v,d)=>{const E=new Image;E.onload=()=>v(E),E.onerror=d,E.src=a})}getTransformedSize(a,v,d){const E=d.canvasRotation+v.rotate;if(d.containWithinAspectRatio){if(E%2){const T=a.height/d.aspectRatio;return{width:Math.max(a.height,a.width*d.aspectRatio),height:Math.max(a.width,T)}}{const T=a.width/d.aspectRatio;return{width:Math.max(a.width,a.height*d.aspectRatio),height:Math.max(a.height,T)}}}return E%2?{height:a.width,width:a.height}:{width:a.width,height:a.height}}}return u.\u0275fac=function(a){return new(a||u)},u.\u0275prov=_.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},8896:(Y,w,t)=>{"use strict";function c(A){const e=A.split(","),x=e[0].replace("data:","").replace(";base64",""),C=atob(e[1]),f=new ArrayBuffer(C.length),_=new Uint8Array(f);for(let i=0;i<C.length;i+=1)_[i]=C.charCodeAt(i);return new Blob([f],{type:x})}t.d(w,{L:()=>c})},1891:(Y,w,t)=>{"use strict";t.d(w,{B:()=>le});var c=t(5861),A=t(1309),e=t(4650),x=t(4968),C=t(3905),f=t(3848),_=t(1460),i=t(4323),u=t(6986),l=t(575),a=t(3403),v=t(7693),d=t(3207),E=t(146),I=t(3612),T=t(6378),K=t(9383),U=t(4573),M=t(6895),s=t(4006),m=t(4029),b=t(8279),P=t(3450),D=t(8212);const B=["fileInput"];function G(O,Z){1&O&&(e.O4$(),e.TgZ(0,"svg",31),e._UZ(1,"path",32)(2,"path",33),e.qZA())}const k=function(){return["text-primary"]};function q(O,Z){1&O&&e._UZ(0,"app-logo",34),2&O&&e.Q6J("svgClass",e.DdM(2,k))("responsive",!1)}function ee(O,Z){1&O&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&O&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.DESKTOP"),e.oJD)}function ae(O,Z){1&O&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&O&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.TOUCH"),e.oJD)}const oe=function(O){return{"fw-bold fs-md-lg":O}},fe=function(O){return{"text-decoration-underline":O}};function y(O,Z){if(1&O){const r=e.EpF();e.TgZ(0,"div",35),e.YNc(1,ee,2,3,"span",36),e.YNc(2,ae,2,3,"span",36),e.TgZ(3,"span",37),e.NdJ("click",function(n){e.CHM(r);const L=e.oxw(2),S=e.MAs(23);return e.KtG(L.toggleRemoteUrlForm(n,S))}),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&O){const r=e.oxw(2);e.Q6J("ngClass",e.VKq(7,oe,!r.isWidget)),e.xp6(1),e.Q6J("ngIf",!r.touchDevice),e.xp6(1),e.Q6J("ngIf",r.touchDevice),e.xp6(1),e.Q6J("ngClass",e.VKq(9,fe,r.isWidget)),e.xp6(1),e.Oqu(e.lcZ(5,5,"COMPONENTS.UPLOADER.DESCRIPTION.REMOTE_URL"))}}function o(O,Z){1&O&&e.GkF(0)}function p(O,Z){if(1&O){const r=e.EpF();e.TgZ(0,"div",39),e.YNc(1,o,1,0,"ng-container",17),e.TgZ(2,"button",40),e.NdJ("click",function(n){e.CHM(r);const L=e.oxw(2);return e.KtG(L.handleRemoteUrlUpload(n))}),e.O4$(),e.TgZ(3,"svg",41),e._UZ(4,"path",42),e.qZA()(),e.kcU(),e.TgZ(5,"button",43),e.NdJ("click",function(n){e.CHM(r);const L=e.oxw(2);return e.KtG(L.toggleRemoteUrlForm(n))}),e.O4$(),e.TgZ(6,"svg",41),e._UZ(7,"path",44),e.qZA()()()}if(2&O){const r=e.oxw(2),h=e.MAs(34);e.xp6(1),e.Q6J("ngTemplateOutlet",h),e.xp6(1),e.Q6J("disabled",0===r.remoteUrl.length||!r.isRemoteUrlValid)}}function g(O,Z){if(1&O&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"em",45),e.ALo(5,"arrayJoin"),e.BQk()),2&O){const r=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"COMPONENTS.UPLOADER.PATH.LONG")," "),e.xp6(2),e.Q6J("innerText",r.currentFolderPath.length?e.xi3(5,4,r.currentFolderPath,"/"):"root")}}function F(O,Z){if(1&O&&(e._UZ(0,"div",50),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&O){const r=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,r.currentFolderPath,0,-1),"/"))}}function R(O,Z){if(1&O&&(e.TgZ(0,"div",46)(1,"div",47),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,F,3,8,"div",48),e._UZ(5,"div",49),e.ALo(6,"arrayJoin"),e.ALo(7,"slice"),e.qZA()),2&O){const r=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,3,"COMPONENTS.UPLOADER.PATH.SHORT")),e.xp6(2),e.Q6J("ngIf",r.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(r.currentFolderPath.length>1?"/":"")+(r.currentFolderPath.length?e.xi3(6,5,e.xi3(7,8,r.currentFolderPath,r.currentFolderPath.length-1),"/"):"root"))}}const J=function(){return{bottom:0,left:0}};function H(O,Z){if(1&O){const r=e.EpF();e.ynx(0),e.TgZ(1,"a",51),e.NdJ("click",function(){e.CHM(r);const n=e.oxw(2);return e.KtG(n.openInfoModal.emit())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",52),e.NdJ("click",function(){e.CHM(r),e.oxw(2);const n=e.MAs(7);return e.KtG(n.open())}),e._uU(5,"settings"),e.qZA(),e.TgZ(6,"div",53),e.NdJ("click",function(n){e.CHM(r);const L=e.oxw(2),S=e.MAs(23);return e.KtG(L.toggleRemoteUrlForm(n,S))}),e._uU(7,"add_link"),e.qZA(),e.BQk()}2&O&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,J)),e.xp6(1),e.Oqu(e.lcZ(3,2,"COMPONENTS.UPLOADER.INFO")))}const N=function(O,Z,r){return{"cursor-pointer":O,"py-4 px-3 px-sm-4":Z,"p-2 pb-3":r}},Q=function(O,Z,r){return{"my-2":O,"mb-2":Z,"mw-100 mt-1":r}};function z(O,Z){if(1&O){const r=e.EpF();e.ynx(0),e.TgZ(1,"div",22,23),e.NdJ("dragenter",function(){e.CHM(r);const n=e.MAs(2),L=e.oxw();return e.KtG(L.setDragOverEvent(n))})("drop",function(n){e.CHM(r);const L=e.oxw();return e.KtG(L.handleDropEvent(n))})("click",function(){e.CHM(r);const n=e.oxw(),L=e.MAs(2);return e.KtG(!n.isWaitingRemoteUrl&&L.click())}),e.YNc(3,G,3,0,"svg",24),e.YNc(4,q,1,3,"ng-template",null,25,e.W1O),e.YNc(6,y,6,11,"div",26),e.YNc(7,p,8,2,"div",27),e.TgZ(8,"div",28),e.YNc(9,g,6,7,"ng-container",3),e.YNc(10,R,8,11,"ng-template",null,29,e.W1O),e.qZA()(),e.YNc(12,H,8,5,"ng-container",30),e.BQk()}if(2&O){const r=e.MAs(5),h=e.MAs(11),n=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(9,N,!n.loading&&!n.isWaitingRemoteUrl,!n.isWidget,n.isWidget)),e.xp6(2),e.Q6J("ngIf",!n.isWidget)("ngIfElse",r),e.xp6(3),e.Q6J("ngIf",!n.isWidget||!n.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngIf",n.isWidget&&n.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngClass",e.kEZ(13,Q,!n.isWidget&&!n.touchDevice,!n.isWidget&&n.touchDevice,n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.isWidget)("ngIfElse",h),e.xp6(3),e.Q6J("ngIf",!n.isWidget)}}const $=function(O,Z){return{"p-4":O,"p-2":Z}};function ie(O,Z){if(1&O&&(e.TgZ(0,"div",54),e.O4$(),e.TgZ(1,"svg",55),e._UZ(2,"path",56),e.qZA(),e.kcU(),e._UZ(3,"app-loader",57),e.TgZ(4,"div",58),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&O){const r=e.oxw();e.Q6J("ngClass",e.WLB(6,$,!r.isWidget,r.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",r.loadingMessage),e.xp6(2),e.Oqu(e.lcZ(6,4,"COMPONENTS.UPLOADER.LOADING.SUBTEXT"))}}function te(O,Z){1&O&&e.GkF(0)}const W=function(O){return{"fs-reset":O}};function ne(O,Z){if(1&O){const r=e.EpF();e.TgZ(0,"input",59,60),e.NdJ("ngModelChange",function(n){e.CHM(r);const L=e.oxw();return e.KtG(L.remoteUrl=n)})("ngModelChange",function(){e.CHM(r);const n=e.MAs(1),L=e.oxw();return e.KtG(L.isRemoteUrlValid=!n.invalid)}),e.ALo(2,"translate"),e.qZA()}if(2&O){const r=e.oxw();e.Q6J("placeholder",e.lcZ(2,4,"COMPONENTS.UPLOADER.REMOTE_URL_INPUT_PLACEHOLDER"))("ngClass",e.VKq(6,W,r.isWidget))("ngModel",r.remoteUrl)("pattern","^https?://[^.]+\\.(.+)")}}const X=function(O,Z){return{uploading:O,"widget flex-grow-1 min-w-0":Z}};let le=(()=>{class O{constructor(r,h,n,L,S,j,se,ce,he){this.postMessageService=r,this.uploadService=h,this.uploadObservablesService=n,this.uploaderService=L,this.toastService=S,this.renderer=j,this.ngZone=se,this.translateService=ce,this.proxyService=he,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="",this.touchDevice=_.eX,this.isWaitingRemoteUrl=!1,this.remoteUrl="",this.isRemoteUrlValid=!1,this.dragOverEvent=!1,this.checkingFileMessage="",this.options=this.uploaderService.uploaderOptions;const ue=this.uploadService.preferences.uploader;ue.checkImage.active||(this.options.compress=!1),ue.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){var r=this;return(0,c.Z)(function*(){r.handleClipboardPasteEvent(),r.handleExternalUpload(),r.checkingFileMessage=r.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CHECK"),r.loadingMessage=r.checkingFileMessage})()}handleClipboardPasteEvent(){var r=this;this.clipboardPasteEventSubscription=(0,x.R)(document.body,"paste").subscribe(function(){var h=(0,c.Z)(function*(n){if(r.isWidget&&r.isWaitingRemoteUrl||!r.canUpload())return;const L=Array.from((n.clipboardData||n.originalEvent.clipboardData).items);let S=[];for(const j of L)if(0===j.type.indexOf("image")){const se=j.getAsFile();se&&S.push(se)}S.length>0?yield r.preUpload(S):r.reset()});return function(n){return h.apply(this,arguments)}}())}handleExternalUpload(){var r=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var h=(0,c.Z)(function*(n){if(n){if(!r.canUpload())return;yield r.preUpload([n.file],n.options)}else r.fileInputRef.nativeElement.click()});return function(n){return h.apply(this,arguments)}}())}handleSelectionEvent(r){var h=this;return(0,c.Z)(function*(){if(!h.canUpload())return;const n=r.target;if(n.files&&n.files.length){const L=Array.from(n.files);return n.value="",h.preUpload(L)}h.reset()})()}handleDropEvent(r){var h=this;return(0,c.Z)(function*(){if(r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation(),!h.canUpload())return;const n=r.dataTransfer?.files?Array.from(r.dataTransfer.files):[];if(n.length)return h.preUpload(n);h.reset()})()}handleRemoteUrlUpload(r,h){var n=this;return(0,c.Z)(function*(){if(!n.isRemoteUrlValid||0===n.remoteUrl.length||!n.canUpload())return;const L=n.remoteUrl;n.loadingMessage=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.GETTING_REMOTE_FILE"),n.toggleRemoteUrlForm(r,h);const S=(0,f.Tb)(L);if(!S.ext||-1===u.O8.findIndex(se=>-1!==se.ext.indexOf(S.ext)))return n.handleErrors([S.name],[]),void n.reset();const j=yield n.proxyService.get(L);return j?n.preUpload([new File([j],S.name,{type:j.type,lastModified:Date.now()})]):(n.toastService.show({content:"Errore nel recupero dell'immagine dall'url!",level:A.m.ERROR}),n.reset(),void n.postMessageService.send(i.l.UPLOAD_ERROR,{filename:S.name,error:a.S.REMOTE_URL_RESPONSE}))})()}saveOptions(r=!0){this.uploaderService.uploaderOptions=this.options,r&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(r){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(r,"dragover",h=>{h.preventDefault()})}))}canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage=this.checkingFileMessage,this.postMessageService.send(i.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(r,h){var n=this;return(0,c.Z)(function*(){const L=[...n.currentFolderPath];let S=[],j=[],se=[],ce=[];h?h.allowOverwrite=h.allowOverwrite||!1:(h=n.uploaderService.uploaderOptions).allowOverwrite=!1;for(let V=0;V<r.length;V++){let re=h.compress?yield n.uploaderService.compressFileIfNeeded(r[V],h.imageDimensions):r[V];if(re=yield n.uploaderService.orientFileIfNeeded(re),re){const pe=(0,f.Tb)(re.name),ge=u.O8.find(me=>-1!==me.ext.indexOf(pe.ext));if(!ge){se.push(re.name);continue}if(re.size>ge.maxSize){ce.push(re.name);continue}S.push({file:{name:re.name,size:re.size,time:0,url:"",ext:pe.ext,filename:pe.filename,isImage:(0,f.Or)(pe.ext),embedUrl:"",type:l.VC.FILE},progress:0,completed:!1}),j.push(re)}}if(n.handleErrors(se,ce),0===j.length)return void n.reset();const he=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.UPLOADING",{total:j.length}),ue=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CREATING_PACKAGE",{total:j.length});n.uploadObservablesService.pushUploadingFileQueue(S);for(let V=0;V<j.length;++V){n.loadingMessage=ue;const re=yield n.uploadService.getHostToken(L,j[V].name);S[V].progress+=20,n.loadingMessage=he.replace("{{current}}",`${V+1}`),yield(0,C.z)(n.uploaderService.upload(j[V],S[V],re,h.allowOverwrite))}n.uploadObservablesService.pushUploadingFileQueue([]);const de=S.filter(V=>!V.error).map(V=>V.file);de.length>0&&(n.fileUploadedEvent.emit({list:de,rewrite:h.allowOverwrite,destPath:L}),n.postMessageService.send(i.l.UPLOAD_SUCCESS,{fileList:de.map(V=>({filename:V.name,isImage:V.isImage,url:V.url}))}),h.openLinkModalAfterUpload&&n.uploadObservablesService.pushAction({name:l.In.FILE_SHOW_LINKS,payload:{entities:(0,f.jL)(de)}})),n.reset()})()}handleErrors(r,h){if(0!==r.length||0!==h.length){if(!this.isWidget)return void this.toastService.show({content:this.createToastMessage(r,h),level:A.m.ERROR});[[a.S.UNSUPPORTED,r],[a.S.OVERSIZED,h]].forEach(n=>{n[1].forEach(L=>{this.postMessageService.send(i.l.UPLOAD_ERROR,{filename:L,error:n[0]})})})}}createToastMessage(r,h){let n=[];return r.length&&n.push(r.length>1?`I file <strong>${r.join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${r[0]}</strong> ha un formato non supportato!`),h.length&&n.push(h.length>1?`I file <strong>${h.join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${h[0]}</strong> \xe8 troppo pesante!`),n.join("<br><br>")}toggleRemoteUrlForm(r,h){r.stopPropagation(),this.isWidget||(this.isWaitingRemoteUrl?h?.close():h?.open()),this.resetRemoteUrlForm(!this.isWaitingRemoteUrl)}resetRemoteUrlForm(r){this.isWaitingRemoteUrl=r,this.remoteUrl=""}ngOnDestroy(){this.startExternalUploadSubscription?.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return O.\u0275fac=function(r){return new(r||O)(e.Y36(v.F),e.Y36(d.C),e.Y36(E.r),e.Y36(I.q),e.Y36(T.k),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(K.sK),e.Y36(U.y))},O.\u0275cmp=e.Xpm({type:O,selectors:[["app-uploader"]],viewQuery:function(r,h){if(1&r&&e.Gf(B,5),2&r){let n;e.iGM(n=e.CRH())&&(h.fileInputRef=n.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:35,vars:37,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],[3,"title"],["optionsModal",""],[3,"innerHtml"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto",3,"innerHTML"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto",3,"innerHTML"],["size","md",3,"title","disableCloseButton","hidden"],["remoteUrlModal",""],[1,"mb-2",3,"innerHTML"],[4,"ngTemplateOutlet"],["footer",""],["type","button",1,"btn","btn-secondary",3,"innerText","click"],["type","button",1,"btn","btn-primary",3,"disabled","innerText","click"],["remoteUrlInput",""],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],["class","description text-center",3,"ngClass",4,"ngIf"],["class","input-group input-group-sm remote-url-form justify-content-center mb-1",4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"description","text-center",3,"ngClass"],[3,"innerHTML",4,"ngIf"],[1,"ms-1","remote-url-btn","fst-italic","cursor-pointer",3,"ngClass","click"],[3,"innerHTML"],[1,"input-group","input-group-sm","remote-url-form","justify-content-center","mb-1"],[1,"input-group-text","bg-light",3,"disabled","click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 16 16"],["d","M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"],[1,"input-group-text","bg-light",3,"click"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","options-icon",3,"click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","remote-url-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"],["type","text","required","",1,"form-control",3,"placeholder","ngClass","ngModel","pattern","ngModelChange"],["input","ngModel"]],template:function(r,h){if(1&r){const n=e.EpF();e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(S){return h.handleSelectionEvent(S)}),e.qZA(),e.YNc(3,z,13,17,"ng-container",3),e.YNc(4,ie,7,9,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6),e.ALo(8,"translate"),e._UZ(9,"div",7),e.ALo(10,"translate"),e.TgZ(11,"ul",8)(12,"li")(13,"div",9)(14,"input",10),e.NdJ("ngModelChange",function(S){return h.options.compress=S})("ngModelChange",function(){return h.saveOptions()}),e.qZA(),e._UZ(15,"label",11),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"li")(18,"div",9)(19,"input",12),e.NdJ("ngModelChange",function(S){return h.options.openLinkModalAfterUpload=S})("ngModelChange",function(){return h.saveOptions()}),e.qZA(),e._UZ(20,"label",13),e.ALo(21,"translate"),e.qZA()()()(),e.TgZ(22,"app-modal",14,15),e.NdJ("hidden",function(){return h.resetRemoteUrlForm(!1)}),e.ALo(24,"translate"),e._UZ(25,"p",16),e.ALo(26,"translate"),e.YNc(27,te,1,0,"ng-container",17),e.ynx(28,18),e.TgZ(29,"button",19),e.NdJ("click",function(){e.CHM(n);const S=e.MAs(23);return e.KtG(S.close())}),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",20),e.NdJ("click",function(S){e.CHM(n);const j=e.MAs(23);return e.KtG(h.handleRemoteUrlUpload(S,j))}),e.ALo(32,"translate"),e.qZA(),e.BQk(),e.qZA(),e.YNc(33,ne,3,8,"ng-template",null,21,e.W1O)}if(2&r){const n=e.MAs(5),L=e.MAs(34);e.Q6J("ngClass",e.WLB(34,X,h.isUploading,h.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",h.loading||h.isUploading),e.xp6(2),e.Q6J("ngIf",!h.isUploading)("ngIfElse",n),e.xp6(3),e.Q6J("title",e.lcZ(8,18,"COMPONENTS.UPLOADER.SETTINGS_MODAL.TITLE")),e.xp6(3),e.Q6J("innerHtml",e.lcZ(10,20,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.DESCRIPTION"),e.oJD),e.xp6(5),e.Q6J("ngModel",h.options.compress),e.xp6(1),e.Q6J("innerHTML",e.lcZ(16,22,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.COMPRESS_SWITCH"),e.oJD),e.xp6(4),e.Q6J("ngModel",h.options.openLinkModalAfterUpload),e.xp6(1),e.Q6J("innerHTML",e.lcZ(21,24,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.SHOW_LINK_SWITCH"),e.oJD),e.xp6(2),e.Q6J("title",e.lcZ(24,26,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.TITLE"))("disableCloseButton",!0),e.xp6(3),e.Q6J("innerHTML",e.lcZ(26,28,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.CONTENT"),e.oJD),e.xp6(2),e.Q6J("ngTemplateOutlet",L),e.xp6(2),e.Q6J("innerText",e.lcZ(30,30,"SHARED.CANCEL")),e.xp6(2),e.Q6J("disabled",0===h.remoteUrl.length||!h.isRemoteUrlValid)("innerText",e.lcZ(32,32,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.UPLOAD_BTN"))}},dependencies:[M.mk,M.O5,M.tP,M.PC,s.Fj,s.Wl,s.JJ,s.Q7,s.c5,s.On,m.R,b.R,P.z,D.J,M.OU,K.X$],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864FE;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:350px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{top:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{opacity:1}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{right:5px}.uploader[_ngcontent-%COMP%]   .remote-url-icon[_ngcontent-%COMP%]{right:30px}.upload-area.cursor-pointer[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo):not(.description), .upload-area.cursor-pointer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.remote-url-btn){pointer-events:none}.remote-url-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:300px}.remote-url-form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:.5}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),O})()},1197:(Y,w,t)=>{"use strict";t.d(w,{M:()=>u});var c=t(8694),A=t(6895),e=t(4006),x=t(6818),C=t(1043),f=t(582),_=t(9383),i=t(4650);let u=(()=>{class l{}return l.\u0275fac=function(v){return new(v||l)},l.\u0275mod=i.oAB({type:l}),l.\u0275inj=i.cJS({imports:[c.r,A.ez,e.u5,x.q,C.h,f.z,_.aw.forChild()]}),l})()},3403:(Y,w,t)=>{"use strict";t.d(w,{S:()=>c});var c=(()=>{return(A=c||(c={})).UNSUPPORTED="unsupported",A.OVERSIZED="oversized",A.REMOTE_URL_RESPONSE="remote-url-response",A.UPLOAD_FAILED="upload-failed",c;var A})()},8694:(Y,w,t)=>{"use strict";t.d(w,{r:()=>e});var c=t(6895),A=t(4650);let e=(()=>{class x{}return x.\u0275fac=function(f){return new(f||x)},x.\u0275mod=A.oAB({type:x}),x.\u0275inj=A.cJS({imports:[c.ez]}),x})()},8212:(Y,w,t)=>{"use strict";t.d(w,{J:()=>A});var c=t(4650);let A=(()=>{class e{transform(C,f){return C.join(f)}}return e.\u0275fac=function(C){return new(C||e)},e.\u0275pipe=c.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},575:(Y,w,t)=>{"use strict";t.d(w,{In:()=>c,Ky:()=>C,VC:()=>A,c5:()=>x,gG:()=>e});var c=(()=>{return(f=c||(c={})).FILE_SHOW_LINKS="fileLinks",f.FILE_EDIT="fileEdit",f.DELETE="delete",f.RENAME="rename",f.MOVE="move",c;var f})(),A=(()=>{return(f=A||(A={})).FILE="file",f.FOLDER="folder",A;var f})(),e=(()=>{return(f=e||(e={})).FILENAME="filename",f.SIZE="size",f.TIME="time",f.EXTENSION="ext",e;var f})(),x=(()=>{return(f=x||(x={})).GRID="grid",f.LIST="list",x;var f})(),C=(()=>{return(f=C||(C={})).W_768_I_1="(max-width: 767.98px)",f.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",f.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",f.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",f.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",f.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",f.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",f.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",f.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",f.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",f.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",f.W_3738_I_10="(min-width: 3424px)",C;var f})()},6986:(Y,w,t)=>{"use strict";t.d(w,{C7:()=>x,Mi:()=>C,O8:()=>A,er:()=>f,p0:()=>e,xt:()=>_});var c=t(575);const A=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(i=>(i.maxSize*=1048576,i)),e={lastPath:[],layout:{asc:!0,orderBy:c.gG.FILENAME,type:c.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},x="https://upload.forumfree.net/api/",C=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,f=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,_={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},4573:(Y,w,t)=>{"use strict";t.d(w,{y:()=>d});var c=t(5861),A=t(2227),e=t(7824),x=t(9808),C=t(5698),f=t(3900),_=t(9646),i=t(262),u=t(608),l=t(4650),a=t(529),v=t(4896);let d=(()=>{class E{constructor(T,K){this.http=T,this.endpointsService=K}get(T){var K=this;return(0,c.Z)(function*(){const U=K.sendRequest(T);return yield(0,x.n)(U)})()}sendRequest(T){return this.getUrlContent(T).pipe((0,C.q)(1),(0,f.w)(K=>(0,_.of)(K)),(0,i.K)(()=>this.getUrlContentWithProxy(T)))}getUrlContent(T){return this.http.get(T,{responseType:"blob"})}getUrlContentWithProxy(T){return this.http.get(this.endpointsService.get(A.jQ.PROXY,A.ph.COMMON),{headers:{[e._.HeaderKeys.TOKEN_TYPE]:u.s.ACCESS,"x-remote-url":T},responseType:"blob"}).pipe((0,C.q)(1),(0,i.K)(()=>(0,_.of)(void 0)))}}return E.\u0275fac=function(T){return new(T||E)(l.LFG(a.eN),l.LFG(v.o))},E.\u0275prov=l.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})()},3124:(Y,w,t)=>{"use strict";t.d(w,{B:()=>x});var c=t(575),A=t(4650),e=t(3138);let x=(()=>{class C{constructor(_){this.globalsService=_,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(i=>{this.ffuid=i?i.user.ffuid:""})}getItem(_){const i=this.createKey(_);if(this.cache.hasOwnProperty(i))return this.cache[i]}setItem(_,i){this.cache[this.createKey(_)]=i}removeItem(_){const i=this.createKey(_);if(this.cache.hasOwnProperty(i)){if(this.cache[i].folders.length)for(const u of this.cache[i].folders)this.removeItem([..._,u.name]);return delete this.cache[i],!0}return!1}getEntities(_,i){let u={};const l=this.createKey(_);if(!this.cache.hasOwnProperty(l))return u;for(const a of i){const v=(a.type===c.VC.FILE?this.cache[l].files:this.cache[l].folders).find(d=>d.name===a.name);v&&(u[v.name]=v)}return u}addEntities(_,i,u=c.VC.FILE){const l=this.createKey(_);return!!this.cache.hasOwnProperty(l)&&(Array.isArray(i)||(i=[i]),u===c.VC.FILE?this.cache[l].files.unshift(...i):this.cache[l].folders.unshift(...i),!0)}removeEntities(_,i,u=c.VC.FILE){if(Array.isArray(i)||(i=[i]),u===c.VC.FOLDER)for(const d of i)this.removeItem([..._,d]);const l=this.createKey(_);if(!this.cache.hasOwnProperty(l))return[];const a=u===c.VC.FILE?"files":"folders";let v=[];for(const d of i){const E=this.cache[l][a].findIndex(I=>I.name===d);E>-1&&(this.cache[l][a].splice(E,1),v.push(d))}return v}refactorFolderContent(_,i){const u=this.createKey(_);if(!this.cache.hasOwnProperty(u))return!1;i.endsWith("/")||(i+="/");for(const l of this.cache[u].folders)l.url=i+l.name;for(const l of this.cache[u].files)l.url=l.embedUrl=i+l.name,l.time=Date.now();return!0}createKey(_){return`${this.ffuid}/${_.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return C.\u0275fac=function(_){return new(_||C)(A.LFG(e.d))},C.\u0275prov=A.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},146:(Y,w,t)=>{"use strict";t.d(w,{r:()=>C});var c=t(7579),A=t(1135),e=t(4650),x=t(8745);let C=(()=>{class f{constructor(i){this.uploadPreferencesService=i,this.selectedFileListArray=[],this.actionSubject=new c.x,this.uploadingFileQueueSubject=new c.x,this.uploadingFileErrorSubject=new c.x,this.currentFolderPathSubject=new c.x,this.layoutOptionsSubject=new c.x,this.renameEntitySubject=new c.x,this.entityPendingSubject=new c.x,this.deleteFileSubject=new c.x,this.uploadedFileSubject=new c.x,this.draggedFileListSubject=new c.x,this.startUploadSubject=new c.x,this.startMoveSubject=new c.x,this.selectedFileListSubject=new A.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(i){this.actionSubject.next(i)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(i){this.uploadPreferencesService.layoutOptions=i,this.layoutOptionsSubject.next(i)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(i){this.uploadPreferencesService.lastFolderPath=i,this.currentFolderPathSubject.next(i)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(i){this.uploadingFileQueueSubject.next(i)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(i){this.uploadingFileErrorSubject.next(i)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(i){this.renameEntitySubject.next(i)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(i){this.entityPendingSubject.next(i)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(i){this.deleteFileSubject.next(i)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(i){this.uploadedFileSubject.next(i)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(i){this.draggedFileListSubject.next(i)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(i){this.startUploadSubject.next(i)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(i){this.startMoveSubject.next(i)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(i){if(Array.isArray(i)||(i=[i]),0===i.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let u=!1;for(const l of i){const a=this.selectedFileListArray.findIndex(v=>v.name===l.name);l.selected?-1===a&&(this.selectedFileListArray.push({name:l.name}),u=!0):a>-1&&(this.selectedFileListArray.splice(a,1),u=!0)}u&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return f.\u0275fac=function(i){return new(i||f)(e.LFG(x.p))},f.\u0275prov=e.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},8745:(Y,w,t)=>{"use strict";t.d(w,{p:()=>f});var c=t(5044),A=t(6986),e=t(4650),x=t(2381),C=t(6161);let f=(()=>{class _{constructor(u,l){this.preferencesService=u,this.urlQueryParamsService=l;const a=this.urlQueryParamsService.getAndDeleteParam(c.RT.UPLOAD_PATH);a&&(this.lastFolderPath=a.split("/").filter(v=>v.length>0))}get preferences(){return this.preferencesService.getItem(c.Ye.UPLOAD)||A.p0}set preferences(u){this.preferencesService.setItem(c.Ye.UPLOAD,u)}get lastFolderPath(){return(this.preferences.lastPath||A.p0.lastPath).filter(u=>u.length>0)}set lastFolderPath(u){const l=this.preferences;l.lastPath=u,this.preferences=l}get layoutOptions(){const u=A.p0.layout,l=this.preferences.layout;return l&&0===Object.keys(u).filter(a=>!l.hasOwnProperty(a)).length?l:u}set layoutOptions(u){const l=this.preferences;l.layout=u,this.preferences=l}get uploader(){const u=this.preferences.uploader||A.p0.uploader;return!u.checkImage.active&&Date.now()-u.checkImage.time>6048e5&&(u.checkImage.active=!0,this.uploader=u),u.hasOwnProperty("showLinkModal")||(u.showLinkModal=!1),u}set uploader(u){const l=this.preferences;l.uploader=u,this.preferences=l}}return _.\u0275fac=function(u){return new(u||_)(e.LFG(x.y),e.LFG(C.J))},_.\u0275prov=e.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},3207:(Y,w,t)=>{"use strict";t.d(w,{C:()=>M});var c=t(5861),A=t(7824),e=t(3905),x=t(575),C=t(3848),v=t(6986),d=t(1042),E=t(4650),I=t(5395),T=t(3124),K=t(8745),U=t(529);let M=(()=>{class s{constructor(b,P,D,B){this.graphqlService=b,this.uploadCacheService=P,this.uploadPreferencesService=D,this.http=B}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(A._.HeaderKeys.UUID,(0,d.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(A._.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(A._.HeaderKeys.UUID)||""}getFileList(b,P){var D=this;return(0,c.Z)(function*(){const B=D.uploadCacheService.getItem(b);if(B)return B;const G=(yield D.graphqlService.query({query:"\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",variables:{scope:P,target:b.join("/")}})).data.uploadEntitiesListToken,k=yield D.sendRequest(G),ee={files:k.files.map(ae=>{const oe=(0,C.Tb)(ae.url);return{...ae,time:1e3*ae.time,filename:oe.filename,ext:oe.ext,isImage:(0,C.Or)(oe.ext),embedUrl:`${ae.url}?t=${ae.time}`,type:x.VC.FILE}}),folders:k.folders.map(ae=>({...ae,type:x.VC.FOLDER}))};return D.uploadCacheService.setItem(b,ee),ee})()}createDirectory(b,P){var D=this;return(0,c.Z)(function*(){const B=(yield D.graphqlService.mutate({mutation:"\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",variables:{scope:P,target:b.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield D.sendRequest(B)})()}moveRenameEntity(b,P,D,B,G){var k=this;return(0,c.Z)(function*(){B||(B=D);const q=(yield k.graphqlService.mutate({mutation:"\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",variables:{scope:G,source:(b.length?`${b.join("/")}/`:"")+D,target:(P.length?`${P.join("/")}/`:"")+B}})).data.uploadEntitiesMoveToken,ee=yield k.sendRequest(q);return{...ee,time:1e3*ee.time}})()}deleteEntity(b,P,D){var B=this;return(0,c.Z)(function*(){const G=(yield B.graphqlService.mutate({mutation:"\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",variables:{scope:D,target:(b.length?`${b.join("/")}/`:"")+P}})).data.uploadEntitiesDeleteToken;return yield B.sendRequest(G),!0})()}getHostToken(b,P,D){var B=this;return(0,c.Z)(function*(){return(yield B.graphqlService.query({query:"\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",variables:{scope:D,target:(b.length?`${b.join("/")}/`:"")+P}})).data.uploadEntitiesHostToken})()}sendRequest(b){var P=this;return(0,c.Z)(function*(){return(yield(0,e.z)(P.http.post(v.C7,JSON.stringify({payload:b}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(b,P){var D=this;return(0,c.Z)(function*(){return yield D.graphqlService.subscribe({query:"\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}",variables:{scope:P}},B=>{if(!B.data?.uploadEntities)return;const G=JSON.parse(B.data.uploadEntities.eventMessage);!G.payload.customHeaders||!G.payload.customHeaders.hasOwnProperty(A._.HeaderKeys.UUID)||G.payload.customHeaders[A._.HeaderKeys.UUID]===D.getGqlIdHeader()||b({type:B.data.uploadEntities.eventType,message:G})})})()}}return s.\u0275fac=function(b){return new(b||s)(E.LFG(I.J),E.LFG(T.B),E.LFG(K.p),E.LFG(U.eN))},s.\u0275prov=E.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})()},3848:(Y,w,t)=>{"use strict";t.d(w,{$H:()=>E,JN:()=>l,Lv:()=>f,Or:()=>d,Tb:()=>x,jL:()=>v,lY:()=>_,ok:()=>T,rQ:()=>K,rc:()=>I,sT:()=>i,zO:()=>C});var c=t(5861),A=t(575),e=t(6986);function x(U){let M=U;if(U.indexOf("/")>-1){const P=U.split("/");M=P[P.length-1]}const s=M.replace(/\?.*$/,"").split("."),m=s.length>1?s[s.length-1].toLowerCase():"",b=decodeURIComponent(s.slice(0,-1).join("."));return{ext:m,filename:b,name:m?`${b}.${m}`:""}}function C(U,M={}){const s=x(U),m=Date.now();return{name:s.name,size:0,time:m,url:U,ext:s.ext,filename:s.filename,isImage:d(s.ext),embedUrl:`${U}?t=${m}`,type:A.VC.FILE,...M}}function f(U){let M=U;M.endsWith("/")&&(M=M.slice(0,-1));const s=M.split("/");return{name:decodeURIComponent(s[s.length-1])}}function _(U){return{name:f(U).name,url:U,type:A.VC.FOLDER}}function i(U){return u.apply(this,arguments)}function u(){return(u=(0,c.Z)(function*(U){const M=new FileReader,s=new Promise(m=>M.addEventListener("load",()=>m(M.result)));return M.readAsDataURL(U),s})).apply(this,arguments)}function l(U){return a.apply(this,arguments)}function a(){return(a=(0,c.Z)(function*(U){const M=new DataView(yield U.arrayBuffer());if(2303741511===M.getUint32(0)&&218765834===M.getUint32(4)){if(-1===[4,6].indexOf(M.getUint8(25)))return!1;const m=Object.assign(new Image,{src:yield i(U)});yield new Promise(D=>m.addEventListener("load",()=>D(!0)));const b=Object.assign(document.createElement("canvas"),{width:m.width,height:m.height}).getContext("2d");if(!b)return!1;b.imageSmoothingEnabled=!1,b.drawImage(m,0,0);const P=b?.getImageData(0,0,m.width,m.height);if(P)for(let D=0;D<P.data.length;D+=4)if(P.data[D+3]<255)return!0}return!1})).apply(this,arguments)}function v(U){return U.map(M=>({name:M.name,ext:M.ext,type:A.VC.FILE,url:M.url,embedUrl:M.embedUrl,isImage:M.isImage}))}function d(U,M=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(U)&&!M.includes(U)}function E(U){return d(U,["gif","svg"])}function I(U,M,s,m=[],b=""){let P={...e.xt};const D=U.trim();P.invalidLength=0===D.length;const B=(D+b).replace(/\s{2,}/g," ");return P.alreadyUsed=M!==D&&m.includes(B),P.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(U),P.invalidCharacter=!(s===A.VC.FILE?e.Mi.test(U):e.er.test(U)),P}function T(U,M){return U.join("/")===M.join("/")}function K(U){let M=[],s=[];for(const m of U)m.type===A.VC.FILE?M.push(m):s.push(m);return{[A.VC.FILE]:M,[A.VC.FOLDER]:s}}},3612:(Y,w,t)=>{"use strict";t.d(w,{q:()=>K});var c=t(5861),A=t(8896),e=t(6730),x=t.n(e),C=t(9969),f=t(3848),_=t(529),i=t(7579),u=t(7445),l=t(2722),a=t(6986);class v{static findApp1Marker(M){const s=new DataView(M),m=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let b=0;b<M.byteLength-2;b+=2){const P=s.getUint16(b);if(65505===P)return{offset:b,size:s.getUint16(b+2),little:18761==s.getUint16(b+8,!1)};if(m.has(P))break}}static stripAndReturnExif(M){return(0,c.Z)(function*(){const s=yield M.arrayBuffer(),m=v.findApp1Marker(s);return m?{file:new File([s.slice(0,m.offset),s.slice(m.offset+m.size+2)],M.name,{type:M.type,lastModified:M.lastModified}),exif:s.slice(m.offset,m.offset+m.size)}:{file:M}})()}static checkImageOrientation(M){const s=new DataView(M);if(1165519206!=s.getUint32(4,!1))return-1;const m=18761==s.getUint16(10,!1);let b=10;b+=s.getUint32(b+4,m);const P=s.getUint16(b,m);b+=2;for(let D=0;D<P;D++)if(274==s.getUint16(b+12*D,m))return s.getUint16(b+12*D+8,m);return-1}}var d=t(4650),E=t(146),I=t(2020),T=t(4573);let K=(()=>{class U{constructor(s,m,b,P){this.http=s,this.uploadObservablesService=m,this.loadImageService=b,this.proxyService=P,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return{...this.uploaderOptionsObject}}set uploaderOptions(s){this.uploaderOptionsObject={...s}}compressFileIfNeeded(s,m){return(0,c.Z)(function*(){let b=["image/png","image/jpeg"],P={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};m&&(b.push("image/webp"),P.width=m.width,P.height=m.height,P.resize="cover",P.strict=!1);const D=s.type.toLowerCase();return s.size<=4e6&&void 0===m||-1===b.indexOf(s.type.toLowerCase())?s:("image/png"===D&&(yield(0,f.JN)(s))&&(P.convertSize=1/0),new Promise((B,G)=>{new(x())(s,{...P,success:k=>{const q=k instanceof Blob?new File([k],s.name,{type:s.type,lastModified:s.lastModified}):s;B(q)},error:G})}))})()}orientFileIfNeeded(s){var m=this;return(0,c.Z)(function*(){if(-1===["image/jpeg"].indexOf(s.type.toLowerCase()))return s;const P=yield v.stripAndReturnExif(s);if(s=P.file,P.exif){const D=v.checkImageOrientation(P.exif);if(1!==D){let B=0;switch(D){case 3:case 4:B=180;break;case 5:case 6:B=90;break;case 7:case 8:B=270}const G=yield(0,f.sT)(s),k=yield new Promise((ee,ae)=>{const oe=new Image;oe.onload=()=>ee({originalImage:oe,originalBase64:G}),oe.onerror=ae,oe.src=G}),q=yield m.loadImageService.transformLoadedImage({original:{base64:k.originalBase64,image:k.originalImage,size:{width:k.originalImage.naturalWidth,height:k.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(D),rotate:B/90}},new C.R);s=new File([(0,A.L)(q.transformed.base64)],s.name,{type:s.type,lastModified:Date.now()}),s=yield m.compressFileIfNeeded(s)}}return s})()}upload(s,m,b,P=!1){const D=new i.x,B=new FormData;B.append("payload",b),B.append("upload",s,s.name),P&&B.append("allowOverwrite","1");const G=this.http.request(new _.aW("POST",a.C7,B,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(G.subscribe({next:k=>{if(k.type===_.dt.UploadProgress){if(!k.total||(m.progress=Math.round(50*k.loaded/k.total)+20,m.progress<70))return;(0,u.F)(1e3).pipe((0,l.R)(D.asObservable())).subscribe(()=>{if(m.progress<95){const q=Math.round(8*Math.random()+8);m.progress+q>95?m.progress=95:m.progress+=q}})}else if(k instanceof _.Zn){if(m.progress=100,m.completed=!0,k.body?.error||!k.body?.success)m.error=!0,this.uploadObservablesService.pushUploadingFileError(m);else{m.file.url=k.body.success.url,m.file.time=Date.now(),m.file.embedUrl=`${m.file.url}?t=${m.file.time}`;const q=(0,f.Tb)(m.file.url);m.file.name=q.name,m.file.filename=q.filename}D.next(),D.complete()}},error:()=>{m.error=!0,this.uploadObservablesService.pushUploadingFileError(m),D.next(),D.complete()}})),D.asObservable()}clearPendingRequests(){for(const s of this.requestSubscriptions)s.unsubscribe();this.requestSubscriptions=[]}}return U.\u0275fac=function(s){return new(s||U)(d.LFG(_.eN),d.LFG(E.r),d.LFG(I.y),d.LFG(T.y))},U.\u0275prov=d.Yz7({token:U,factory:U.\u0275fac,providedIn:"root"}),U})()},6730:function(Y){Y.exports=function(){"use strict";function w(y,o){var p=Object.keys(y);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(y);o&&(g=g.filter(function(F){return Object.getOwnPropertyDescriptor(y,F).enumerable})),p.push.apply(p,g)}return p}function t(y){for(var o=1;o<arguments.length;o++){var p=null!=arguments[o]?arguments[o]:{};o%2?w(Object(p),!0).forEach(function(g){x(y,g,p[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(p)):w(Object(p)).forEach(function(g){Object.defineProperty(y,g,Object.getOwnPropertyDescriptor(p,g))})}return y}function A(y,o){for(var p=0;p<o.length;p++){var g=o[p];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(y,g.key,g)}}function x(y,o,p){return o in y?Object.defineProperty(y,o,{value:p,enumerable:!0,configurable:!0,writable:!0}):y[o]=p,y}function C(){return C=Object.assign||function(y){for(var o=1;o<arguments.length;o++){var p=arguments[o];for(var g in p)Object.prototype.hasOwnProperty.call(p,g)&&(y[g]=p[g])}return y},C.apply(this,arguments)}var y,o,p,g,F,R,J,H,f={exports:{}};y=f,typeof window>"u"||(o=window,p=o.HTMLCanvasElement&&o.HTMLCanvasElement.prototype,g=o.Blob&&function(){try{return Boolean(new Blob)}catch{return!1}}(),F=g&&o.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch{return!1}}(),R=o.BlobBuilder||o.WebKitBlobBuilder||o.MozBlobBuilder||o.MSBlobBuilder,J=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,H=(g||R)&&o.atob&&o.ArrayBuffer&&o.Uint8Array&&function(N){var Q,z,$,ie,te,W,ne,X,le;if(!(Q=N.match(J)))throw new Error("invalid data URI");for(z=Q[2]?Q[1]:"text/plain"+(Q[3]||";charset=US-ASCII"),$=!!Q[4],ie=N.slice(Q[0].length),te=$?atob(ie):decodeURIComponent(ie),W=new ArrayBuffer(te.length),ne=new Uint8Array(W),X=0;X<te.length;X+=1)ne[X]=te.charCodeAt(X);return g?new Blob([F?ne:W],{type:z}):((le=new R).append(W),le.getBlob(z))},o.HTMLCanvasElement&&!p.toBlob&&(p.mozGetAsFile?p.toBlob=function(N,Q,z){var $=this;setTimeout(function(){N(z&&p.toDataURL&&H?H($.toDataURL(Q,z)):$.mozGetAsFile("blob",Q))})}:p.toDataURL&&H&&(p.toBlob=p.msToBlob?function(N,Q,z){var $=this;setTimeout(function(){N((Q&&"image/png"!==Q||z)&&p.toDataURL&&H?H($.toDataURL(Q,z)):$.msToBlob(Q))})}:function(N,Q,z){var $=this;setTimeout(function(){N(H($.toDataURL(Q,z)))})})),y.exports?y.exports=H:o.dataURLtoBlob=H);var _=f.exports,u={strict:!0,checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},a=typeof window<"u"&&typeof window.document<"u"?window:{},v=function(o){return o>0&&o<1/0},d=Array.prototype.slice;function E(y){return Array.from?Array.from(y):d.call(y)}var I=/^image\/.+$/;function T(y){return I.test(y)}var U=String.fromCharCode;var s=a.btoa;function b(y){var p,o=new DataView(y);try{var g,F,R;if(255===o.getUint8(0)&&216===o.getUint8(1))for(var J=o.byteLength,H=2;H+1<J;){if(255===o.getUint8(H)&&225===o.getUint8(H+1)){F=H;break}H+=1}if(F){var Q=F+10;if("Exif"===function M(y,o,p){var F,g="";for(p+=o,F=o;F<p;F+=1)g+=U(y.getUint8(F));return g}(o,F+4,4)){var z=o.getUint16(Q);if(((g=18761===z)||19789===z)&&42===o.getUint16(Q+2,g)){var $=o.getUint32(Q+4,g);$>=8&&(R=Q+$)}}}if(R){var te,W,ie=o.getUint16(R,g);for(W=0;W<ie;W+=1)if(274===o.getUint16(te=R+12*W+2,g)){p=o.getUint16(te+=8,g),o.setUint16(te,1,g);break}}}catch{p=1}return p}var D=/\.\d*(?:0|9){12}\d*$/;function B(y){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return D.test(y)?Math.round(y*o)/o:y}function G(y){var o=y.aspectRatio,p=y.height,g=y.width,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",R=v(g),J=v(p);if(R&&J){var H=p*o;("contain"===F||"none"===F)&&H>g||"cover"===F&&H<g?p=g/o:g=p*o}else R?p=g/o:J&&(g=p*o);return{width:g,height:p}}var k=a.ArrayBuffer,q=a.FileReader,ee=a.URL||a.webkitURL,ae=/\.\w+$/,oe=a.Compressor;return function(){function y(o,p){(function c(y,o){if(!(y instanceof o))throw new TypeError("Cannot call a class as a function")})(this,y),this.file=o,this.image=new Image,this.options=t(t({},u),p),this.aborted=!1,this.result=null,this.init()}return function e(y,o,p){return o&&A(y.prototype,o),p&&A(y,p),y}(y,[{key:"init",value:function(){var p=this,g=this.file,F=this.options;if(function(o){return!(typeof Blob>"u")&&(o instanceof Blob||"[object Blob]"===Object.prototype.toString.call(o))}(g)){var R=g.type;if(T(R))if(ee&&q)if(k||(F.checkOrientation=!1),ee&&!F.checkOrientation)this.load({url:ee.createObjectURL(g)});else{var J=new q,H=F.checkOrientation&&"image/jpeg"===R;this.reader=J,J.onload=function(N){var z=N.target.result,$={};if(H){var ie=b(z);ie>1||!ee?($.url=function m(y,o){for(var p=[],F=new Uint8Array(y);F.length>0;)p.push(U.apply(null,E(F.subarray(0,8192)))),F=F.subarray(8192);return"data:".concat(o,";base64,").concat(s(p.join("")))}(z,R),ie>1&&C($,function P(y){var o=0,p=1,g=1;switch(y){case 2:p=-1;break;case 3:o=-180;break;case 4:g=-1;break;case 5:o=90,g=-1;break;case 6:o=90;break;case 7:o=90,p=-1;break;case 8:o=-90}return{rotate:o,scaleX:p,scaleY:g}}(ie))):$.url=ee.createObjectURL(g)}else $.url=z;p.load($)},J.onabort=function(){p.fail(new Error("Aborted to read the image with FileReader."))},J.onerror=function(){p.fail(new Error("Failed to read the image with FileReader."))},J.onloadend=function(){p.reader=null},H?J.readAsArrayBuffer(g):J.readAsDataURL(g)}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(p){var g=this,F=this.file,R=this.image;R.onload=function(){g.draw(t(t({},p),{},{naturalWidth:R.naturalWidth,naturalHeight:R.naturalHeight}))},R.onabort=function(){g.fail(new Error("Aborted to load the image."))},R.onerror=function(){g.fail(new Error("Failed to load the image."))},a.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(a.navigator.userAgent)&&(R.crossOrigin="anonymous"),R.alt=F.name,R.src=p.url}},{key:"draw",value:function(p){var g=this,F=p.naturalWidth,R=p.naturalHeight,J=p.rotate,H=void 0===J?0:J,N=p.scaleX,Q=void 0===N?1:N,z=p.scaleY,$=void 0===z?1:z,ie=this.file,te=this.image,W=this.options,ne=document.createElement("canvas"),X=ne.getContext("2d"),le=Math.abs(H)%180==90,O=("contain"===W.resize||"cover"===W.resize)&&v(W.width)&&v(W.height),Z=Math.max(W.maxWidth,0)||1/0,r=Math.max(W.maxHeight,0)||1/0,h=Math.max(W.minWidth,0)||0,n=Math.max(W.minHeight,0)||0,L=F/R,S=W.width,j=W.height;if(le){var se=[r,Z];Z=se[0],r=se[1];var ce=[n,h];h=ce[0],n=ce[1];var he=[j,S];S=he[0],j=he[1]}O&&(L=S/j);var ue=G({aspectRatio:L,width:Z,height:r},"contain");Z=ue.width,r=ue.height;var de=G({aspectRatio:L,width:h,height:n},"cover");if(h=de.width,n=de.height,O){var V=G({aspectRatio:L,width:S,height:j},W.resize);S=V.width,j=V.height}else{var re=G({aspectRatio:L,width:S,height:j}),pe=re.width;S=void 0===pe?F:pe;var ge=re.height;j=void 0===ge?R:ge}var me=-(S=Math.floor(B(Math.min(Math.max(S,h),Z))))/2,Ue=-(j=Math.floor(B(Math.min(Math.max(j,n),r))))/2,Pe=S,Ce=j,_e=[];if(O){var ve,Ee,ye=G({aspectRatio:L,width:F,height:R},{contain:"cover",cover:"contain"}[W.resize]);_e.push((F-(ve=ye.width))/2,(R-(Ee=ye.height))/2,ve,Ee)}if(_e.push(me,Ue,Pe,Ce),le){var Me=[j,S];S=Me[0],j=Me[1]}ne.width=S,ne.height=j,T(W.mimeType)||(W.mimeType=ie.type);var xe="transparent";if(ie.size>W.convertSize&&W.convertTypes.indexOf(W.mimeType)>=0&&(W.mimeType="image/jpeg"),"image/jpeg"===W.mimeType&&(xe="#fff"),X.fillStyle=xe,X.fillRect(0,0,S,j),W.beforeDraw&&W.beforeDraw.call(this,X,ne),!this.aborted&&(X.save(),X.translate(S/2,j/2),X.rotate(H*Math.PI/180),X.scale(Q,$),X.drawImage.apply(X,[te].concat(_e)),X.restore(),W.drew&&W.drew.call(this,X,ne),!this.aborted)){var be=function(Te){g.aborted||g.done({naturalWidth:F,naturalHeight:R,result:Te})};ne.toBlob?ne.toBlob(be,W.mimeType,W.quality):be(_(ne.toDataURL(W.mimeType,W.quality)))}}},{key:"done",value:function(p){var g=p.naturalWidth,F=p.naturalHeight,R=p.result,J=this.file,N=this.options;if(ee&&!N.checkOrientation&&ee.revokeObjectURL(this.image.src),R)if(N.strict&&R.size>J.size&&N.mimeType===J.type&&!(N.width>g||N.height>F||N.minWidth>g||N.minHeight>F||N.maxWidth<g||N.maxHeight<F))R=J;else{var Q=new Date;R.lastModified=Q.getTime(),R.lastModifiedDate=Q,R.name=J.name,R.name&&R.type!==J.type&&(R.name=R.name.replace(ae,function K(y){var o=T(y)?y.substr(6):"";return"jpeg"===o&&(o="jpg"),".".concat(o)}(R.type)))}else R=J;this.result=R,N.success&&N.success.call(this,R)}},{key:"fail",value:function(p){var g=this.options;if(!g.error)throw p;g.error.call(this,p)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=oe,y}},{key:"setDefaults",value:function(p){C(u,p)}}]),y}()}()},7445:(Y,w,t)=>{"use strict";t.d(w,{F:()=>e});var c=t(4986),A=t(5963);function e(x=0,C=c.z){return x<0&&(x=0),(0,A.H)(x,x,C)}},1042:(Y,w,t)=>{"use strict";t.d(w,{Z:()=>v});var c,A=new Uint8Array(16);function e(){if(!c&&!(c=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return c(A)}const x=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,f=function C(d){return"string"==typeof d&&x.test(d)};for(var _=[],i=0;i<256;++i)_.push((i+256).toString(16).substr(1));const v=function a(d,E,I){var T=(d=d||{}).random||(d.rng||e)();if(T[6]=15&T[6]|64,T[8]=63&T[8]|128,E){I=I||0;for(var K=0;K<16;++K)E[I+K]=T[K];return E}return function u(d){var E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=(_[d[E+0]]+_[d[E+1]]+_[d[E+2]]+_[d[E+3]]+"-"+_[d[E+4]]+_[d[E+5]]+"-"+_[d[E+6]]+_[d[E+7]]+"-"+_[d[E+8]]+_[d[E+9]]+"-"+_[d[E+10]]+_[d[E+11]]+_[d[E+12]]+_[d[E+13]]+_[d[E+14]]+_[d[E+15]]).toLowerCase();if(!f(I))throw TypeError("Stringified UUID is invalid");return I}(T)}}}]);