(self.webpackChunkpages=self.webpackChunkpages||[]).push([[712],{9829:(q,w,t)=>{"use strict";t.d(w,{R:()=>f});class f{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(y=>y in this).forEach(y=>this[y]=e[y]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(y=>y in this).forEach(y=>this[y]=e[y].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},9582:(q,w,t)=>{"use strict";t.d(w,{y:()=>O});var f=t(1413),U=t(5861);var s=t(5879);let O=(()=>{class g{constructor(){this.autoRotateSupported=function y(){return new Promise(g=>{const P=new Image;P.onload=()=>{g(1===P.width&&2===P.height)},P.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(r,d){return new Promise((v,R)=>{const E=new FileReader;E.onload=N=>{this.loadImage(N.target.result,r.type,d).then(v).catch(R)},E.readAsDataURL(r)})}loadImage(r,d,v){return this.isValidImageType(d)?this.loadBase64Image(r,v):Promise.reject(new Error("Invalid image type"))}isValidImageType(r){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(r)}loadImageFromURL(r,d){return new Promise((v,R)=>{const E=new Image;E.onerror=()=>R,E.onload=()=>{const N=document.createElement("canvas"),H=N.getContext("2d");N.width=E.width,N.height=E.height,null==H||H.drawImage(E,0,0),this.loadBase64Image(N.toDataURL(),d).then(v)},E.crossOrigin="anonymous",E.src=r})}loadBase64Image(r,d){return new Promise((v,R)=>{const E=new Image;E.onload=()=>v({originalImage:E,originalBase64:r}),E.onerror=R,E.src=r}).then(v=>this.transformImageBase64(v,d))}transformImageBase64(r,d){var v=this;return(0,U.Z)(function*(){const R=yield v.autoRotateSupported,E=yield function I(g){switch("string"==typeof g&&(g=function c(g){const P=new DataView(function b(g){g=g.replace(/^data\:([^\;]+)\;base64,/gim,"");const P=atob(g),r=P.length,d=new Uint8Array(r);for(let v=0;v<r;v++)d[v]=P.charCodeAt(v);return d.buffer}(g));if(65496!==P.getUint16(0,!1))return-2;const r=P.byteLength;let d=2;for(;d<r;){if(P.getUint16(d+2,!1)<=8)return-1;const v=P.getUint16(d,!1);if(d+=2,65505==v){if(1165519206!==P.getUint32(d+=2,!1))return-1;const R=18761==P.getUint16(d+=6,!1);d+=P.getUint32(d+4,R);const E=P.getUint16(d,R);d+=2;for(let N=0;N<E;N++)if(274==P.getUint16(d+12*N,R))return P.getUint16(d+12*N+8,R)}else{if(65280!=(65280&v))break;d+=P.getUint16(d,!1)}}return-1}(g)),g){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(R?-1:r.originalBase64);return r.originalImage&&r.originalImage.complete?v.transformLoadedImage({original:{base64:r.originalBase64,image:r.originalImage,size:{width:r.originalImage.naturalWidth,height:r.originalImage.naturalHeight}},exifTransform:E},d):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(r,d){var v=this;return(0,U.Z)(function*(){const R=d.canvasRotation+r.exifTransform.rotate,E={width:r.original.image.naturalWidth,height:r.original.image.naturalHeight};if(0===R&&!r.exifTransform.flip&&!d.containWithinAspectRatio)return{original:{base64:r.original.base64,image:r.original.image,size:(0,f.Z)({},E)},transformed:{base64:r.original.base64,image:r.original.image,size:(0,f.Z)({},E)},exifTransform:r.exifTransform};const N=v.getTransformedSize(E,r.exifTransform,d),H=document.createElement("canvas");H.width=N.width,H.height=N.height;const A=H.getContext("2d");null==A||A.setTransform(r.exifTransform.flip?-1:1,0,0,1,H.width/2,H.height/2),null==A||A.rotate(Math.PI*(R/2)),null==A||A.drawImage(r.original.image,-E.width/2,-E.height/2);const x=H.toDataURL(),p=yield v.loadImageFromBase64(x);return{original:{base64:r.original.base64,image:r.original.image,size:(0,f.Z)({},E)},transformed:{base64:x,image:p,size:{width:p.width,height:p.height}},exifTransform:r.exifTransform}})()}loadImageFromBase64(r){return new Promise((d,v)=>{const R=new Image;R.onload=()=>d(R),R.onerror=v,R.src=r})}getTransformedSize(r,d,v){const R=v.canvasRotation+d.rotate;if(v.containWithinAspectRatio){if(R%2){const N=r.height/v.aspectRatio;return{width:Math.max(r.height,r.width*v.aspectRatio),height:Math.max(r.width,N)}}{const N=r.width/v.aspectRatio;return{width:Math.max(r.width,r.height*v.aspectRatio),height:Math.max(r.height,N)}}}return R%2?{height:r.width,width:r.height}:{width:r.width,height:r.height}}}return g.\u0275fac=function(r){return new(r||g)},g.\u0275prov=s.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},3705:(q,w,t)=>{"use strict";function f(U){const e=U.split(","),y=e[0].replace("data:","").replace(";base64",""),I=atob(e[1]),c=new ArrayBuffer(I.length),b=new Uint8Array(c);for(let s=0;s<I.length;s+=1)b[s]=I.charCodeAt(s);return new Blob([c],{type:y})}t.d(w,{L:()=>f})},5851:(q,w,t)=>{"use strict";t.d(w,{B:()=>Y});var f=t(5861),U=t(1378),e=t(5879),y=t(2438),I=t(4036),c=t(9054),b=t(4020),s=t(148),O=t(9093),g=t(7621),P=t(1990),r=t(5661),d=t(5172),v=t(3845),R=t(4887),E=t(5487),N=t(3779),H=t(9515),A=t(6814),x=t(6223),p=t(4929),_=t(554),M=t(4464),C=t(4228);const D=["fileInput"];function B(o,F){1&o&&(e.O4$(),e.TgZ(0,"svg",31),e._UZ(1,"path",32)(2,"path",33),e.qZA())}const V=function(){return["text-primary"]};function K(o,F){1&o&&e._UZ(0,"app-logo",34),2&o&&e.Q6J("svgClass",e.DdM(2,V))("responsive",!1)}function oe(o,F){1&o&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&o&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.DESKTOP"),e.oJD)}function ne(o,F){1&o&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&o&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.TOUCH"),e.oJD)}const te=function(o){return{"fw-bold fs-md-lg":o}},se=function(o){return{"text-decoration-underline":o}};function ce(o,F){if(1&o){const n=e.EpF();e.TgZ(0,"div",35),e.YNc(1,oe,2,3,"span",36),e.YNc(2,ne,2,3,"span",36),e.TgZ(3,"span",37),e.NdJ("click",function(a){e.CHM(n);const L=e.oxw(2),Z=e.MAs(23);return e.KtG(L.toggleRemoteUrlForm(a,Z))}),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&o){const n=e.oxw(2);e.Q6J("ngClass",e.VKq(7,te,!n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.touchDevice),e.xp6(1),e.Q6J("ngIf",n.touchDevice),e.xp6(1),e.Q6J("ngClass",e.VKq(9,se,n.isWidget)),e.xp6(1),e.Oqu(e.lcZ(5,5,"COMPONENTS.UPLOADER.DESCRIPTION.REMOTE_URL"))}}function _e(o,F){1&o&&e.GkF(0)}function ve(o,F){if(1&o){const n=e.EpF();e.TgZ(0,"div",39),e.YNc(1,_e,1,0,"ng-container",17),e.TgZ(2,"button",40),e.NdJ("click",function(a){e.CHM(n);const L=e.oxw(2);return e.KtG(L.handleRemoteUrlUpload(a))}),e.O4$(),e.TgZ(3,"svg",41),e._UZ(4,"path",42),e.qZA()(),e.kcU(),e.TgZ(5,"button",43),e.NdJ("click",function(a){e.CHM(n);const L=e.oxw(2);return e.KtG(L.toggleRemoteUrlForm(a))}),e.O4$(),e.TgZ(6,"svg",41),e._UZ(7,"path",44),e.qZA()()()}if(2&o){const n=e.oxw(2),h=e.MAs(34);e.xp6(1),e.Q6J("ngTemplateOutlet",h),e.xp6(1),e.Q6J("disabled",0===n.remoteUrl.length||!n.isRemoteUrlValid)}}function Ee(o,F){if(1&o&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"em",45),e.ALo(5,"arrayJoin"),e.BQk()),2&o){const n=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"COMPONENTS.UPLOADER.PATH.LONG")," "),e.xp6(2),e.Q6J("innerText",n.currentFolderPath.length?e.xi3(5,4,n.currentFolderPath,"/"):"root")}}function m(o,F){if(1&o&&(e._UZ(0,"div",50),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&o){const n=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,n.currentFolderPath,0,-1),"/"))}}function i(o,F){if(1&o&&(e.TgZ(0,"div",46)(1,"div",47),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,m,3,8,"div",48),e._UZ(5,"div",49),e.ALo(6,"arrayJoin"),e.ALo(7,"slice"),e.qZA()),2&o){const n=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,3,"COMPONENTS.UPLOADER.PATH.SHORT")),e.xp6(2),e.Q6J("ngIf",n.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(n.currentFolderPath.length>1?"/":"")+(n.currentFolderPath.length?e.xi3(6,5,e.xi3(7,8,n.currentFolderPath,n.currentFolderPath.length-1),"/"):"root"))}}const l=function(){return{bottom:0,left:0}};function u(o,F){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"a",51),e.NdJ("click",function(){e.CHM(n);const a=e.oxw(2);return e.KtG(a.openInfoModal.emit())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",52),e.NdJ("click",function(){e.CHM(n),e.oxw(2);const a=e.MAs(7);return e.KtG(a.open())}),e._uU(5,"settings"),e.qZA(),e.TgZ(6,"div",53),e.NdJ("click",function(a){e.CHM(n);const L=e.oxw(2),Z=e.MAs(23);return e.KtG(L.toggleRemoteUrlForm(a,Z))}),e._uU(7,"add_link"),e.qZA(),e.BQk()}2&o&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,l)),e.xp6(1),e.Oqu(e.lcZ(3,2,"COMPONENTS.UPLOADER.INFO")))}const T=function(o,F,n){return{"cursor-pointer":o,"py-4 px-3 px-sm-4":F,"p-2 pb-3":n}},S=function(o,F,n){return{"my-2":o,"mb-2":F,"mw-100 mt-1":n}};function k(o,F){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",22,23),e.NdJ("dragenter",function(){e.CHM(n);const a=e.MAs(2),L=e.oxw();return e.KtG(L.setDragOverEvent(a))})("drop",function(a){e.CHM(n);const L=e.oxw();return e.KtG(L.handleDropEvent(a))})("click",function(){e.CHM(n);const a=e.oxw(),L=e.MAs(2);return e.KtG(!a.isWaitingRemoteUrl&&L.click())}),e.YNc(3,B,3,0,"svg",24),e.YNc(4,K,1,3,"ng-template",null,25,e.W1O),e.YNc(6,ce,6,11,"div",26),e.YNc(7,ve,8,2,"div",27),e.TgZ(8,"div",28),e.YNc(9,Ee,6,7,"ng-container",3),e.YNc(10,i,8,11,"ng-template",null,29,e.W1O),e.qZA()(),e.YNc(12,u,8,5,"ng-container",30),e.BQk()}if(2&o){const n=e.MAs(5),h=e.MAs(11),a=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(9,T,!a.loading&&!a.isWaitingRemoteUrl,!a.isWidget,a.isWidget)),e.xp6(2),e.Q6J("ngIf",!a.isWidget)("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",!a.isWidget||!a.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngIf",a.isWidget&&a.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngClass",e.kEZ(13,S,!a.isWidget&&!a.touchDevice,!a.isWidget&&a.touchDevice,a.isWidget)),e.xp6(1),e.Q6J("ngIf",!a.isWidget)("ngIfElse",h),e.xp6(3),e.Q6J("ngIf",!a.isWidget)}}const Q=function(o,F){return{"p-4":o,"p-2":F}};function W(o,F){if(1&o&&(e.TgZ(0,"div",54),e.O4$(),e.TgZ(1,"svg",55),e._UZ(2,"path",56),e.qZA(),e.kcU(),e._UZ(3,"app-loader",57),e.TgZ(4,"div",58),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&o){const n=e.oxw();e.Q6J("ngClass",e.WLB(6,Q,!n.isWidget,n.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",n.loadingMessage),e.xp6(2),e.Oqu(e.lcZ(6,4,"COMPONENTS.UPLOADER.LOADING.SUBTEXT"))}}function j(o,F){1&o&&e.GkF(0)}const J=function(o){return{"fs-reset":o}};function z(o,F){if(1&o){const n=e.EpF();e.TgZ(0,"input",59,60),e.NdJ("ngModelChange",function(a){e.CHM(n);const L=e.oxw();return e.KtG(L.remoteUrl=a)})("ngModelChange",function(){e.CHM(n);const a=e.MAs(1),L=e.oxw();return e.KtG(L.isRemoteUrlValid=!a.invalid)}),e.ALo(2,"translate"),e.qZA()}if(2&o){const n=e.oxw();e.Q6J("placeholder",e.lcZ(2,4,"COMPONENTS.UPLOADER.REMOTE_URL_INPUT_PLACEHOLDER"))("ngClass",e.VKq(6,J,n.isWidget))("ngModel",n.remoteUrl)("pattern","^https?://[^.]+\\.(.+)")}}const re=function(o,F){return{uploading:o,"widget flex-grow-1 min-w-0":F}};let Y=(()=>{class o{constructor(n,h,a,L,Z,G,ie,le,ee){this.postMessageService=n,this.uploadService=h,this.uploadObservablesService=a,this.uploaderService=L,this.toastService=Z,this.renderer=G,this.ngZone=ie,this.translateService=le,this.proxyService=ee,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="",this.touchDevice=b.eX,this.isWaitingRemoteUrl=!1,this.remoteUrl="",this.isRemoteUrlValid=!1,this.dragOverEvent=!1,this.checkingFileMessage="",this.options=this.uploaderService.uploaderOptions;const X=this.uploadService.preferences.uploader;X.checkImage.active||(this.options.compress=!1),X.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){var n=this;return(0,f.Z)(function*(){n.handleClipboardPasteEvent(),n.handleExternalUpload(),n.checkingFileMessage=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CHECK"),n.loadingMessage=n.checkingFileMessage})()}handleClipboardPasteEvent(){var n=this;this.clipboardPasteEventSubscription=(0,y.R)(document.body,"paste").subscribe(function(){var h=(0,f.Z)(function*(a){if(n.isWidget&&n.isWaitingRemoteUrl||!n.canUpload())return;const L=Array.from((a.clipboardData||a.originalEvent.clipboardData).items);let Z=[];for(const G of L)if(0===G.type.indexOf("image")){const ie=G.getAsFile();ie&&Z.push(ie)}Z.length>0?yield n.preUpload(Z):n.reset()});return function(a){return h.apply(this,arguments)}}())}handleExternalUpload(){var n=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var h=(0,f.Z)(function*(a){if(a){if(!n.canUpload())return;yield n.preUpload([a.file],a.options)}else n.fileInputRef.nativeElement.click()});return function(a){return h.apply(this,arguments)}}())}handleSelectionEvent(n){var h=this;return(0,f.Z)(function*(){if(!h.canUpload())return;const a=n.target;if(a.files&&a.files.length){const L=Array.from(a.files);return a.value="",h.preUpload(L)}h.reset()})()}handleDropEvent(n){var h=this;return(0,f.Z)(function*(){var a;if(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!h.canUpload())return;const L=null!==(a=n.dataTransfer)&&void 0!==a&&a.files?Array.from(n.dataTransfer.files):[];if(L.length)return h.preUpload(L);h.reset()})()}handleRemoteUrlUpload(n,h){var a=this;return(0,f.Z)(function*(){if(!a.isRemoteUrlValid||0===a.remoteUrl.length||!a.canUpload())return;const L=a.remoteUrl;a.loadingMessage=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.GETTING_REMOTE_FILE"),a.toggleRemoteUrlForm(n,h);const Z=(0,c.Tb)(L);if(!Z.ext||-1===P.O8.findIndex(ie=>-1!==ie.ext.indexOf(Z.ext)))return a.handleErrors([Z.name],[]),void a.reset();const G=yield a.proxyService.get(L);return G?a.preUpload([new File([G],Z.name,{type:G.type,lastModified:Date.now()})]):(a.toastService.show({content:"Errore nel recupero dell'immagine dall'url!",level:U.m.ERROR}),a.reset(),void a.postMessageService.send(s.l.UPLOAD_ERROR,{filename:Z.name,error:v.S.REMOTE_URL_RESPONSE}))})()}saveOptions(n=!0){this.uploaderService.uploaderOptions=this.options,n&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(n){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(n,"dragover",h=>{h.preventDefault()})}))}canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage=this.checkingFileMessage,this.postMessageService.send(s.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(n,h){var a=this;return(0,f.Z)(function*(){const L=[...a.currentFolderPath];let Z=[],G=[],ie=[],le=[];h?h.allowOverwrite=h.allowOverwrite||!1:(h=a.uploaderService.uploaderOptions).allowOverwrite=!1;for(let $=0;$<n.length;$++){let ae=h.compress?yield a.uploaderService.compressFileIfNeeded(n[$],h.imageDimensions):n[$];if(ae=yield a.uploaderService.orientFileIfNeeded(ae),ae){const de=(0,c.Tb)(ae.name),he=P.O8.find(me=>-1!==me.ext.indexOf(de.ext));if(!he){ie.push(ae.name);continue}if(ae.size>he.maxSize){le.push(ae.name);continue}Z.push({file:{name:ae.name,size:ae.size,time:0,url:"",ext:de.ext,filename:de.filename,isImage:(0,c.Or)(de.ext),embedUrl:"",type:d.VC.FILE},progress:0,completed:!1}),G.push(ae)}}if(a.handleErrors(ie,le),0===G.length)return void a.reset();const ee=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.UPLOADING",{total:G.length}),X=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CREATING_PACKAGE",{total:G.length});a.uploadObservablesService.pushUploadingFileQueue(Z);for(let $=0;$<G.length;++$){a.loadingMessage=X;const ae=yield a.uploadService.getHostToken(L,G[$].name);Z[$].progress+=20,a.loadingMessage=ee.replace("{{current}}",`${$+1}`),yield(0,I.z)(a.uploaderService.upload(G[$],Z[$],ae,h.allowOverwrite))}a.uploadObservablesService.pushUploadingFileQueue([]);const ue=Z.filter($=>!$.error).map($=>$.file);ue.length>0&&(a.fileUploadedEvent.emit({list:ue,rewrite:h.allowOverwrite,destPath:L}),a.postMessageService.send(s.l.UPLOAD_SUCCESS,{fileList:ue.map($=>({filename:$.name,isImage:$.isImage,url:$.url}))}),h.openLinkModalAfterUpload&&a.uploadObservablesService.pushAction({name:d.In.FILE_SHOW_LINKS,payload:{entities:(0,c.jL)(ue)}})),a.reset()})()}handleErrors(n,h){if(0!==n.length||0!==h.length){if(!this.isWidget)return void this.toastService.show({content:this.createToastMessage(n,h),level:U.m.ERROR});[[v.S.UNSUPPORTED,n],[v.S.OVERSIZED,h]].forEach(a=>{a[1].forEach(L=>{this.postMessageService.send(s.l.UPLOAD_ERROR,{filename:L,error:a[0]})})})}}createToastMessage(n,h){let a=[];return n.length&&a.push(n.length>1?`I file <strong>${n.join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${n[0]}</strong> ha un formato non supportato!`),h.length&&a.push(h.length>1?`I file <strong>${h.join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${h[0]}</strong> \xe8 troppo pesante!`),a.join("<br><br>")}toggleRemoteUrlForm(n,h){n.stopPropagation(),this.isWidget||(this.isWaitingRemoteUrl?null==h||h.close():null==h||h.open()),this.resetRemoteUrlForm(!this.isWaitingRemoteUrl)}resetRemoteUrlForm(n){this.isWaitingRemoteUrl=n,this.remoteUrl=""}ngOnDestroy(){var n;null===(n=this.startExternalUploadSubscription)||void 0===n||n.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return o.\u0275fac=function(n){return new(n||o)(e.Y36(O.F),e.Y36(N.C),e.Y36(E.r),e.Y36(R.q),e.Y36(r.k),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(H.sK),e.Y36(g.y))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-uploader"]],viewQuery:function(n,h){if(1&n&&e.Gf(D,5),2&n){let a;e.iGM(a=e.CRH())&&(h.fileInputRef=a.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:35,vars:37,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],[3,"title"],["optionsModal",""],[3,"innerHtml"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto",3,"innerHTML"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto",3,"innerHTML"],["size","md",3,"title","disableCloseButton","hidden"],["remoteUrlModal",""],[1,"mb-2",3,"innerHTML"],[4,"ngTemplateOutlet"],["footer",""],["type","button",1,"btn","btn-secondary",3,"innerText","click"],["type","button",1,"btn","btn-primary",3,"disabled","innerText","click"],["remoteUrlInput",""],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],["class","description text-center",3,"ngClass",4,"ngIf"],["class","input-group input-group-sm remote-url-form justify-content-center mb-1",4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"description","text-center",3,"ngClass"],[3,"innerHTML",4,"ngIf"],[1,"ms-1","remote-url-btn","fst-italic","cursor-pointer",3,"ngClass","click"],[3,"innerHTML"],[1,"input-group","input-group-sm","remote-url-form","justify-content-center","mb-1"],[1,"input-group-text","bg-light",3,"disabled","click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 16 16"],["d","M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"],[1,"input-group-text","bg-light",3,"click"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","options-icon",3,"click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","remote-url-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"],["type","text","required","",1,"form-control",3,"placeholder","ngClass","ngModel","pattern","ngModelChange"],["input","ngModel"]],template:function(n,h){if(1&n){const a=e.EpF();e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(Z){return h.handleSelectionEvent(Z)}),e.qZA(),e.YNc(3,k,13,17,"ng-container",3),e.YNc(4,W,7,9,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6),e.ALo(8,"translate"),e._UZ(9,"div",7),e.ALo(10,"translate"),e.TgZ(11,"ul",8)(12,"li")(13,"div",9)(14,"input",10),e.NdJ("ngModelChange",function(Z){return h.options.compress=Z})("ngModelChange",function(){return h.saveOptions()}),e.qZA(),e._UZ(15,"label",11),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"li")(18,"div",9)(19,"input",12),e.NdJ("ngModelChange",function(Z){return h.options.openLinkModalAfterUpload=Z})("ngModelChange",function(){return h.saveOptions()}),e.qZA(),e._UZ(20,"label",13),e.ALo(21,"translate"),e.qZA()()()(),e.TgZ(22,"app-modal",14,15),e.NdJ("hidden",function(){return h.resetRemoteUrlForm(!1)}),e.ALo(24,"translate"),e._UZ(25,"p",16),e.ALo(26,"translate"),e.YNc(27,j,1,0,"ng-container",17),e.ynx(28,18),e.TgZ(29,"button",19),e.NdJ("click",function(){e.CHM(a);const Z=e.MAs(23);return e.KtG(Z.close())}),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",20),e.NdJ("click",function(Z){e.CHM(a);const G=e.MAs(23);return e.KtG(h.handleRemoteUrlUpload(Z,G))}),e.ALo(32,"translate"),e.qZA(),e.BQk(),e.qZA(),e.YNc(33,z,3,8,"ng-template",null,21,e.W1O)}if(2&n){const a=e.MAs(5),L=e.MAs(34);e.Q6J("ngClass",e.WLB(34,re,h.isUploading,h.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",h.loading||h.isUploading),e.xp6(2),e.Q6J("ngIf",!h.isUploading)("ngIfElse",a),e.xp6(3),e.Q6J("title",e.lcZ(8,18,"COMPONENTS.UPLOADER.SETTINGS_MODAL.TITLE")),e.xp6(3),e.Q6J("innerHtml",e.lcZ(10,20,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.DESCRIPTION"),e.oJD),e.xp6(5),e.Q6J("ngModel",h.options.compress),e.xp6(1),e.Q6J("innerHTML",e.lcZ(16,22,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.COMPRESS_SWITCH"),e.oJD),e.xp6(4),e.Q6J("ngModel",h.options.openLinkModalAfterUpload),e.xp6(1),e.Q6J("innerHTML",e.lcZ(21,24,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.SHOW_LINK_SWITCH"),e.oJD),e.xp6(2),e.Q6J("title",e.lcZ(24,26,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.TITLE"))("disableCloseButton",!0),e.xp6(3),e.Q6J("innerHTML",e.lcZ(26,28,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.CONTENT"),e.oJD),e.xp6(2),e.Q6J("ngTemplateOutlet",L),e.xp6(2),e.Q6J("innerText",e.lcZ(30,30,"SHARED.CANCEL")),e.xp6(2),e.Q6J("disabled",0===h.remoteUrl.length||!h.isRemoteUrlValid)("innerText",e.lcZ(32,32,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.UPLOAD_BTN"))}},dependencies:[A.mk,A.O5,A.tP,A.PC,x.Fj,x.Wl,x.JJ,x.Q7,x.c5,x.On,p.R,_.R,M.z,C.J,A.OU,H.X$],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864FE;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:350px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:_ngcontent-%COMP%_draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{top:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{opacity:1}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{right:5px}.uploader[_ngcontent-%COMP%]   .remote-url-icon[_ngcontent-%COMP%]{right:30px}.upload-area.cursor-pointer[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo):not(.description), .upload-area.cursor-pointer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.remote-url-btn){pointer-events:none}.remote-url-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:300px}.remote-url-form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:.5}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes _ngcontent-%COMP%_bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes _ngcontent-%COMP%_draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),o})()},529:(q,w,t)=>{"use strict";t.d(w,{M:()=>O});var f=t(4243),U=t(6814),e=t(6223),y=t(7535),I=t(2740),c=t(4610),b=t(9515),s=t(5879);let O=(()=>{class g{}return g.\u0275fac=function(r){return new(r||g)},g.\u0275mod=s.oAB({type:g}),g.\u0275inj=s.cJS({imports:[f.r,U.ez,e.u5,y.q,I.h,c.z,b.aw.forChild()]}),g})()},3845:(q,w,t)=>{"use strict";t.d(w,{S:()=>f});var f=function(U){return U.UNSUPPORTED="unsupported",U.OVERSIZED="oversized",U.REMOTE_URL_RESPONSE="remote-url-response",U.UPLOAD_FAILED="upload-failed",U}(f||{})},4243:(q,w,t)=>{"use strict";t.d(w,{r:()=>e});var f=t(6814),U=t(5879);let e=(()=>{class y{}return y.\u0275fac=function(c){return new(c||y)},y.\u0275mod=U.oAB({type:y}),y.\u0275inj=U.cJS({imports:[f.ez]}),y})()},4228:(q,w,t)=>{"use strict";t.d(w,{J:()=>U});var f=t(5879);let U=(()=>{class e{transform(I,c){return I.join(c)}}return e.\u0275fac=function(I){return new(I||e)},e.\u0275pipe=f.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},5172:(q,w,t)=>{"use strict";t.d(w,{In:()=>f,Ky:()=>I,VC:()=>U,c5:()=>y,gG:()=>e});var f=function(c){return c.FILE_SHOW_LINKS="fileLinks",c.FILE_EDIT="fileEdit",c.DELETE="delete",c.RENAME="rename",c.MOVE="move",c}(f||{}),U=function(c){return c.FILE="file",c.FOLDER="folder",c}(U||{}),e=function(c){return c.FILENAME="filename",c.SIZE="size",c.TIME="time",c.EXTENSION="ext",c}(e||{}),y=function(c){return c.GRID="grid",c.LIST="list",c}(y||{}),I=function(c){return c.W_768_I_1="(max-width: 767.98px)",c.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",c.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",c.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",c.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",c.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",c.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",c.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",c.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",c.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",c.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",c.W_3738_I_10="(min-width: 3424px)",c}(I||{})},1990:(q,w,t)=>{"use strict";t.d(w,{C7:()=>y,Mi:()=>I,O8:()=>U,er:()=>c,p0:()=>e,xt:()=>b});var f=t(5172);const U=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(s=>(s.maxSize*=1048576,s)),e={lastPath:[],layout:{asc:!0,orderBy:f.gG.FILENAME,type:f.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},y="https://upload.forumfree.net/api/",I=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,c=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,b={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},7621:(q,w,t)=>{"use strict";t.d(w,{y:()=>d});var f=t(5861),U=t(1345),e=t(4725),y=t(622),I=t(708),c=t(8180),b=t(4664),s=t(2096),O=t(6306),g=t(5083),P=t(5879),r=t(9862);let d=(()=>{class v{constructor(E,N){this.http=E,this.endpointsService=N}get(E){var N=this;return(0,f.Z)(function*(){const H=N.sendRequest(E);return yield(0,I.n)(H)})()}sendRequest(E){return this.getUrlContent(E).pipe((0,c.q)(1),(0,b.w)(N=>(0,s.of)(N)),(0,O.K)(()=>this.getUrlContentWithProxy(E)))}getUrlContent(E){return this.http.get(E,{responseType:"blob"})}getUrlContentWithProxy(E){return this.http.get(this.endpointsService.get(U.jQ.PROXY,U.ph.COMMON),{headers:{[y._.HeaderKeys.TOKEN_TYPE]:g.s.ACCESS,"x-remote-url":E},responseType:"blob"}).pipe((0,c.q)(1),(0,O.K)(()=>(0,s.of)(void 0)))}}return v.\u0275fac=function(E){return new(E||v)(P.LFG(r.eN),P.LFG(e.o))},v.\u0275prov=P.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},5983:(q,w,t)=>{"use strict";t.d(w,{B:()=>y});var f=t(5172),U=t(1410),e=t(5879);let y=(()=>{class I{constructor(b){this.globalsService=b,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(s=>{this.ffuid=s?s.user.ffuid:""})}getItem(b){const s=this.createKey(b);if(this.cache.hasOwnProperty(s))return this.cache[s]}setItem(b,s){this.cache[this.createKey(b)]=s}removeItem(b){const s=this.createKey(b);if(this.cache.hasOwnProperty(s)){if(this.cache[s].folders.length)for(const O of this.cache[s].folders)this.removeItem([...b,O.name]);return delete this.cache[s],!0}return!1}getEntities(b,s){let O={};const g=this.createKey(b);if(!this.cache.hasOwnProperty(g))return O;for(const P of s){const r=(P.type===f.VC.FILE?this.cache[g].files:this.cache[g].folders).find(d=>d.name===P.name);r&&(O[r.name]=r)}return O}addEntities(b,s,O=f.VC.FILE){const g=this.createKey(b);return!!this.cache.hasOwnProperty(g)&&(Array.isArray(s)||(s=[s]),O===f.VC.FILE?this.cache[g].files.unshift(...s):this.cache[g].folders.unshift(...s),!0)}removeEntities(b,s,O=f.VC.FILE){if(Array.isArray(s)||(s=[s]),O===f.VC.FOLDER)for(const d of s)this.removeItem([...b,d]);const g=this.createKey(b);if(!this.cache.hasOwnProperty(g))return[];const P=O===f.VC.FILE?"files":"folders";let r=[];for(const d of s){const v=this.cache[g][P].findIndex(R=>R.name===d);v>-1&&(this.cache[g][P].splice(v,1),r.push(d))}return r}refactorFolderContent(b,s){const O=this.createKey(b);if(!this.cache.hasOwnProperty(O))return!1;s.endsWith("/")||(s+="/");for(const g of this.cache[O].folders)g.url=s+g.name;for(const g of this.cache[O].files)g.url=g.embedUrl=s+g.name,g.time=Date.now();return!0}createKey(b){return`${this.ffuid}/${b.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return I.\u0275fac=function(b){return new(b||I)(e.LFG(U.d))},I.\u0275prov=e.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),I})()},5487:(q,w,t)=>{"use strict";t.d(w,{r:()=>I});var f=t(8645),U=t(5619),e=t(446),y=t(5879);let I=(()=>{class c{constructor(s){this.uploadPreferencesService=s,this.selectedFileListArray=[],this.actionSubject=new f.x,this.uploadingFileQueueSubject=new f.x,this.uploadingFileErrorSubject=new f.x,this.currentFolderPathSubject=new f.x,this.layoutOptionsSubject=new f.x,this.renameEntitySubject=new f.x,this.entityPendingSubject=new f.x,this.deleteFileSubject=new f.x,this.uploadedFileSubject=new f.x,this.draggedFileListSubject=new f.x,this.startUploadSubject=new f.x,this.startMoveSubject=new f.x,this.selectedFileListSubject=new U.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(s){this.actionSubject.next(s)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(s){this.uploadPreferencesService.layoutOptions=s,this.layoutOptionsSubject.next(s)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(s){this.uploadPreferencesService.lastFolderPath=s,this.currentFolderPathSubject.next(s)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(s){this.uploadingFileQueueSubject.next(s)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(s){this.uploadingFileErrorSubject.next(s)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(s){this.renameEntitySubject.next(s)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(s){this.entityPendingSubject.next(s)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(s){this.deleteFileSubject.next(s)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(s){this.uploadedFileSubject.next(s)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(s){this.draggedFileListSubject.next(s)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(s){this.startUploadSubject.next(s)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(s){this.startMoveSubject.next(s)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(s){if(Array.isArray(s)||(s=[s]),0===s.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let O=!1;for(const g of s){const P=this.selectedFileListArray.findIndex(r=>r.name===g.name);g.selected?-1===P&&(this.selectedFileListArray.push({name:g.name}),O=!0):P>-1&&(this.selectedFileListArray.splice(P,1),O=!0)}O&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return c.\u0275fac=function(s){return new(s||c)(y.LFG(e.p))},c.\u0275prov=y.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},446:(q,w,t)=>{"use strict";t.d(w,{p:()=>c});var f=t(7165),U=t(463),e=t(1990),y=t(2986),I=t(5879);let c=(()=>{class b{constructor(O,g){this.preferencesService=O,this.urlQueryParamsService=g;const P=this.urlQueryParamsService.getAndDeleteParam(f.RT.UPLOAD_PATH);P&&(this.lastFolderPath=P.split("/").filter(r=>r.length>0))}get preferences(){return this.preferencesService.getItem(f.Ye.UPLOAD)||e.p0}set preferences(O){this.preferencesService.setItem(f.Ye.UPLOAD,O)}get lastFolderPath(){return(this.preferences.lastPath||e.p0.lastPath).filter(O=>O.length>0)}set lastFolderPath(O){const g=this.preferences;g.lastPath=O,this.preferences=g}get layoutOptions(){const O=e.p0.layout,g=this.preferences.layout;return g&&0===Object.keys(O).filter(P=>!g.hasOwnProperty(P)).length?g:O}set layoutOptions(O){const g=this.preferences;g.layout=O,this.preferences=g}get uploader(){const O=this.preferences.uploader||e.p0.uploader;return!O.checkImage.active&&Date.now()-O.checkImage.time>6048e5&&(O.checkImage.active=!0,this.uploader=O),O.hasOwnProperty("showLinkModal")||(O.showLinkModal=!1),O}set uploader(O){const g=this.preferences;g.uploader=O,this.preferences=g}}return b.\u0275fac=function(O){return new(O||b)(I.LFG(U.y),I.LFG(y.J))},b.\u0275prov=I.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"}),b})()},3779:(q,w,t)=>{"use strict";t.d(w,{C:()=>x});var f=t(1413),U=t(5861),e=t(6347),y=t(622),I=t(4036),c=t(5172),b=t(9054),v=t(5983),R=t(1990),E=t(446),N=t(4004),H=t(5879),A=t(9862);let x=(()=>{class p{constructor(M,C,D,B){this.graphqlService=M,this.uploadCacheService=C,this.uploadPreferencesService=D,this.http=B}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(y._.HeaderKeys.UUID,(0,N.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(y._.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(y._.HeaderKeys.UUID)||""}getFileList(M,C){var D=this;return(0,U.Z)(function*(){const B=D.uploadCacheService.getItem(M);if(B)return B;const V=(yield D.graphqlService.query({query:"\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",variables:{scope:C,target:M.join("/")}})).data.uploadEntitiesListToken,K=yield D.sendRequest(V),ne={files:K.files.map(te=>{const se=(0,b.Tb)(te.url);return(0,f.Z)((0,f.Z)({},te),{time:1e3*te.time,filename:se.filename,ext:se.ext,isImage:(0,b.Or)(se.ext),embedUrl:`${te.url}?t=${te.time}`,type:c.VC.FILE})}),folders:K.folders.map(te=>(0,f.Z)((0,f.Z)({},te),{},{type:c.VC.FOLDER}))};return D.uploadCacheService.setItem(M,ne),ne})()}createDirectory(M,C){var D=this;return(0,U.Z)(function*(){const B=(yield D.graphqlService.mutate({mutation:"\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",variables:{scope:C,target:M.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield D.sendRequest(B)})()}moveRenameEntity(M,C,D,B,V){var K=this;return(0,U.Z)(function*(){B||(B=D);const oe=(yield K.graphqlService.mutate({mutation:"\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",variables:{scope:V,source:(M.length?`${M.join("/")}/`:"")+D,target:(C.length?`${C.join("/")}/`:"")+B}})).data.uploadEntitiesMoveToken,ne=yield K.sendRequest(oe);return(0,f.Z)((0,f.Z)({},ne),{},{time:1e3*ne.time})})()}deleteEntity(M,C,D){var B=this;return(0,U.Z)(function*(){const V=(yield B.graphqlService.mutate({mutation:"\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",variables:{scope:D,target:(M.length?`${M.join("/")}/`:"")+C}})).data.uploadEntitiesDeleteToken;return yield B.sendRequest(V),!0})()}getHostToken(M,C,D){var B=this;return(0,U.Z)(function*(){return(yield B.graphqlService.query({query:"\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",variables:{scope:D,target:(M.length?`${M.join("/")}/`:"")+C}})).data.uploadEntitiesHostToken})()}sendRequest(M){var C=this;return(0,U.Z)(function*(){return(yield(0,I.z)(C.http.post(R.C7,JSON.stringify({payload:M}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(M,C){var D=this;return(0,U.Z)(function*(){return yield D.graphqlService.subscribe({query:"\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}",variables:{scope:C}},B=>{var V;if(null===(V=B.data)||void 0===V||!V.uploadEntities)return;const K=JSON.parse(B.data.uploadEntities.eventMessage);!K.payload.customHeaders||!K.payload.customHeaders.hasOwnProperty(y._.HeaderKeys.UUID)||K.payload.customHeaders[y._.HeaderKeys.UUID]===D.getGqlIdHeader()||M({type:B.data.uploadEntities.eventType,message:K})})})()}}return p.\u0275fac=function(M){return new(M||p)(H.LFG(e.J),H.LFG(v.B),H.LFG(E.p),H.LFG(A.eN))},p.\u0275prov=H.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()},9054:(q,w,t)=>{"use strict";t.d(w,{$H:()=>R,JN:()=>P,Lv:()=>b,Or:()=>v,Tb:()=>I,jL:()=>d,lY:()=>s,ok:()=>N,rQ:()=>H,rc:()=>E,sT:()=>O,zO:()=>c});var f=t(5861),U=t(1413),e=t(5172),y=t(1990);function I(A){let x=A;if(A.indexOf("/")>-1){const C=A.split("/");x=C[C.length-1]}const p=x.replace(/\?.*$/,"").split("."),_=p.length>1?p[p.length-1].toLowerCase():"",M=decodeURIComponent(p.slice(0,-1).join("."));return{ext:_,filename:M,name:_?`${M}.${_}`:""}}function c(A,x={}){const p=I(A),_=Date.now();return(0,U.Z)({name:p.name,size:0,time:_,url:A,ext:p.ext,filename:p.filename,isImage:v(p.ext),embedUrl:`${A}?t=${_}`,type:e.VC.FILE},x)}function b(A){let x=A;x.endsWith("/")&&(x=x.slice(0,-1));const p=x.split("/");return{name:decodeURIComponent(p[p.length-1])}}function s(A){return{name:b(A).name,url:A,type:e.VC.FOLDER}}function O(A){return g.apply(this,arguments)}function g(){return(g=(0,f.Z)(function*(A){const x=new FileReader,p=new Promise(_=>x.addEventListener("load",()=>_(x.result)));return x.readAsDataURL(A),p})).apply(this,arguments)}function P(A){return r.apply(this,arguments)}function r(){return(r=(0,f.Z)(function*(A){const x=new DataView(yield A.arrayBuffer());if(2303741511===x.getUint32(0)&&218765834===x.getUint32(4)){if(-1===[4,6].indexOf(x.getUint8(25)))return!1;const _=Object.assign(new Image,{src:yield O(A)});yield new Promise(D=>_.addEventListener("load",()=>D(!0)));const M=Object.assign(document.createElement("canvas"),{width:_.width,height:_.height}).getContext("2d");if(!M)return!1;M.imageSmoothingEnabled=!1,M.drawImage(_,0,0);const C=null==M?void 0:M.getImageData(0,0,_.width,_.height);if(C)for(let D=0;D<C.data.length;D+=4)if(C.data[D+3]<255)return!0}return!1})).apply(this,arguments)}function d(A){return A.map(x=>({name:x.name,ext:x.ext,type:e.VC.FILE,url:x.url,embedUrl:x.embedUrl,isImage:x.isImage}))}function v(A,x=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(A)&&!x.includes(A)}function R(A){return v(A,["gif","svg"])}function E(A,x,p,_=[],M=""){let C=(0,U.Z)({},y.xt);const D=A.trim();C.invalidLength=0===D.length;const B=(D+M).replace(/\s{2,}/g," ");return C.alreadyUsed=x!==D&&_.includes(B),C.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(A),C.invalidCharacter=!(p===e.VC.FILE?y.Mi.test(A):y.er.test(A)),C}function N(A,x){return A.join("/")===x.join("/")}function H(A){let x=[],p=[];for(const _ of A)_.type===e.VC.FILE?x.push(_):p.push(_);return{[e.VC.FILE]:x,[e.VC.FOLDER]:p}}},4887:(q,w,t)=>{"use strict";t.d(w,{q:()=>H});var f=t(5861),U=t(1413),e=t(3705),y=t(4315),I=t.n(y),c=t(9829),b=t(9054),s=t(9862),O=t(8645),g=t(1687),P=t(9773),r=t(7621),d=t(1990),v=t(5487);class R{static findApp1Marker(x){const p=new DataView(x),_=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let M=0;M<x.byteLength-2;M+=2){const C=p.getUint16(M);if(65505===C)return{offset:M,size:p.getUint16(M+2),little:18761==p.getUint16(M+8,!1)};if(_.has(C))break}}static stripAndReturnExif(x){return(0,f.Z)(function*(){const p=yield x.arrayBuffer(),_=R.findApp1Marker(p);return _?{file:new File([p.slice(0,_.offset),p.slice(_.offset+_.size+2)],x.name,{type:x.type,lastModified:x.lastModified}),exif:p.slice(_.offset,_.offset+_.size)}:{file:x}})()}static checkImageOrientation(x){const p=new DataView(x);if(1165519206!=p.getUint32(4,!1))return-1;const _=18761==p.getUint16(10,!1);let M=10;M+=p.getUint32(M+4,_);const C=p.getUint16(M,_);M+=2;for(let D=0;D<C;D++)if(274==p.getUint16(M+12*D,_))return p.getUint16(M+12*D+8,_);return-1}}var E=t(5879),N=t(9582);let H=(()=>{class A{constructor(p,_,M,C){this.http=p,this.uploadObservablesService=_,this.loadImageService=M,this.proxyService=C,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return(0,U.Z)({},this.uploaderOptionsObject)}set uploaderOptions(p){this.uploaderOptionsObject=(0,U.Z)({},p)}compressFileIfNeeded(p,_){return(0,f.Z)(function*(){let M=["image/png","image/jpeg"],C={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};_&&(M.push("image/webp"),C.width=_.width,C.height=_.height,C.resize="cover",C.strict=!1);const D=p.type.toLowerCase();return p.size<=4e6&&void 0===_||-1===M.indexOf(p.type.toLowerCase())?p:("image/png"===D&&(yield(0,b.JN)(p))&&(C.convertSize=1/0),new Promise((B,V)=>{new(I())(p,(0,U.Z)((0,U.Z)({},C),{},{success:K=>{const oe=K instanceof Blob?new File([K],p.name,{type:p.type,lastModified:p.lastModified}):p;B(oe)},error:V}))}))})()}orientFileIfNeeded(p){var _=this;return(0,f.Z)(function*(){if(-1===["image/jpeg"].indexOf(p.type.toLowerCase()))return p;const C=yield R.stripAndReturnExif(p);if(p=C.file,C.exif){const D=R.checkImageOrientation(C.exif);if(1!==D){let B=0;switch(D){case 3:case 4:B=180;break;case 5:case 6:B=90;break;case 7:case 8:B=270}const V=yield(0,b.sT)(p),K=yield new Promise((ne,te)=>{const se=new Image;se.onload=()=>ne({originalImage:se,originalBase64:V}),se.onerror=te,se.src=V}),oe=yield _.loadImageService.transformLoadedImage({original:{base64:K.originalBase64,image:K.originalImage,size:{width:K.originalImage.naturalWidth,height:K.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(D),rotate:B/90}},new c.R);p=new File([(0,e.L)(oe.transformed.base64)],p.name,{type:p.type,lastModified:Date.now()}),p=yield _.compressFileIfNeeded(p)}}return p})()}upload(p,_,M,C=!1){const D=new O.x,B=new FormData;B.append("payload",M),B.append("upload",p,p.name),C&&B.append("allowOverwrite","1");const V=this.http.request(new s.aW("POST",d.C7,B,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(V.subscribe({next:K=>{if(K.type===s.dt.UploadProgress){if(!K.total||(_.progress=Math.round(50*K.loaded/K.total)+20,_.progress<70))return;(0,g.F)(1e3).pipe((0,P.R)(D.asObservable())).subscribe(()=>{if(_.progress<95){const te=Math.round(8*Math.random()+8);_.progress+te>95?_.progress=95:_.progress+=te}})}else if(K instanceof s.Zn){var oe,ne;if(_.progress=100,_.completed=!0,null!==(oe=K.body)&&void 0!==oe&&oe.error||null===(ne=K.body)||void 0===ne||!ne.success)_.error=!0,this.uploadObservablesService.pushUploadingFileError(_);else{_.file.url=K.body.success.url,_.file.time=Date.now(),_.file.embedUrl=`${_.file.url}?t=${_.file.time}`;const te=(0,b.Tb)(_.file.url);_.file.name=te.name,_.file.filename=te.filename}D.next(),D.complete()}},error:()=>{_.error=!0,this.uploadObservablesService.pushUploadingFileError(_),D.next(),D.complete()}})),D.asObservable()}clearPendingRequests(){for(const p of this.requestSubscriptions)p.unsubscribe();this.requestSubscriptions=[]}}return A.\u0275fac=function(p){return new(p||A)(E.LFG(s.eN),E.LFG(v.r),E.LFG(N.y),E.LFG(r.y))},A.\u0275prov=E.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"}),A})()},4315:function(q){q.exports=function(){"use strict";function w(m,i){var l=Object.keys(m);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(m);i&&(u=u.filter(function(T){return Object.getOwnPropertyDescriptor(m,T).enumerable})),l.push.apply(l,u)}return l}function t(m){for(var i=1;i<arguments.length;i++){var l=null!=arguments[i]?arguments[i]:{};i%2?w(Object(l),!0).forEach(function(u){y(m,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(l)):w(Object(l)).forEach(function(u){Object.defineProperty(m,u,Object.getOwnPropertyDescriptor(l,u))})}return m}function U(m,i){for(var l=0;l<i.length;l++){var u=i[l];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(m,b(u.key),u)}}function y(m,i,l){return(i=b(i))in m?Object.defineProperty(m,i,{value:l,enumerable:!0,configurable:!0,writable:!0}):m[i]=l,m}function I(){return I=Object.assign?Object.assign.bind():function(m){for(var i=1;i<arguments.length;i++){var l=arguments[i];for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(m[u]=l[u])}return m},I.apply(this,arguments)}function b(m){var i=function c(m,i){if("object"!=typeof m||null===m)return m;var l=m[Symbol.toPrimitive];if(void 0!==l){var u=l.call(m,i||"default");if("object"!=typeof u)return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(m)}(m,"string");return"symbol"==typeof i?i:String(i)}var m,i,l,u,T,S,k,Q,s={exports:{}};m=s,typeof window>"u"||(i=window,l=i.HTMLCanvasElement&&i.HTMLCanvasElement.prototype,u=i.Blob&&function(){try{return!!new Blob}catch(W){return!1}}(),T=u&&i.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(W){return!1}}(),S=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder,k=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,Q=(u||S)&&i.atob&&i.ArrayBuffer&&i.Uint8Array&&function(W){var j,J,z,re,Y,o,F,n,h;if(!(j=W.match(k)))throw new Error("invalid data URI");for(J=j[2]?j[1]:"text/plain"+(j[3]||";charset=US-ASCII"),z=!!j[4],re=W.slice(j[0].length),Y=z?atob(re):decodeURIComponent(re),o=new ArrayBuffer(Y.length),F=new Uint8Array(o),n=0;n<Y.length;n+=1)F[n]=Y.charCodeAt(n);return u?new Blob([T?F:o],{type:J}):((h=new S).append(o),h.getBlob(J))},i.HTMLCanvasElement&&!l.toBlob&&(l.mozGetAsFile?l.toBlob=function(W,j,J){var z=this;setTimeout(function(){W(J&&l.toDataURL&&Q?Q(z.toDataURL(j,J)):z.mozGetAsFile("blob",j))})}:l.toDataURL&&Q&&(l.toBlob=l.msToBlob?function(W,j,J){var z=this;setTimeout(function(){W((j&&"image/png"!==j||J)&&l.toDataURL&&Q?Q(z.toDataURL(j,J)):z.msToBlob(j))})}:function(W,j,J){var z=this;setTimeout(function(){W(Q(z.toDataURL(j,J)))})})),m.exports?m.exports=Q:i.dataURLtoBlob=Q);var O=s.exports,P={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},d=typeof window<"u"&&typeof window.document<"u"?window:{},v=function(i){return i>0&&i<1/0},R=Array.prototype.slice;function E(m){return Array.from?Array.from(m):R.call(m)}var N=/^image\/.+$/;function H(m){return N.test(m)}var x=String.fromCharCode;var _=d.btoa;function M(m,i){for(var l=[],T=new Uint8Array(m);T.length>0;)l.push(x.apply(null,E(T.subarray(0,8192)))),T=T.subarray(8192);return"data:".concat(i,";base64,").concat(_(l.join("")))}function C(m){var l,i=new DataView(m);try{var u,T,S;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var k=i.byteLength,Q=2;Q+1<k;){if(255===i.getUint8(Q)&&225===i.getUint8(Q+1)){T=Q;break}Q+=1}if(T){var j=T+10;if("Exif"===function p(m,i,l){var T,u="";for(l+=i,T=i;T<l;T+=1)u+=x(m.getUint8(T));return u}(i,T+4,4)){var J=i.getUint16(j);if(((u=18761===J)||19789===J)&&42===i.getUint16(j+2,u)){var z=i.getUint32(j+4,u);z>=8&&(S=j+z)}}}if(S){var Y,o,re=i.getUint16(S,u);for(o=0;o<re;o+=1)if(274===i.getUint16(Y=S+12*o+2,u)){l=i.getUint16(Y+=8,u),i.setUint16(Y,1,u);break}}}catch(F){l=1}return l}var B=/\.\d*(?:0|9){12}\d*$/;function V(m){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return B.test(m)?Math.round(m*i)/i:m}function K(m){var i=m.aspectRatio,l=m.height,u=m.width,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",S=v(u),k=v(l);if(S&&k){var Q=l*i;("contain"===T||"none"===T)&&Q>u||"cover"===T&&Q<u?l=u/i:u=l*i}else S?l=u/i:k&&(u=l*i);return{width:u,height:l}}var te=d.ArrayBuffer,se=d.FileReader,ce=d.URL||d.webkitURL,_e=/\.\w+$/,ve=d.Compressor,Ee=function(){function m(i,l){(function f(m,i){if(!(m instanceof i))throw new TypeError("Cannot call a class as a function")})(this,m),this.file=i,this.exif=[],this.image=new Image,this.options=t(t({},P),l),this.aborted=!1,this.result=null,this.init()}return function e(m,i,l){return i&&U(m.prototype,i),l&&U(m,l),Object.defineProperty(m,"prototype",{writable:!1}),m}(m,[{key:"init",value:function(){var l=this,u=this.file,T=this.options;if(function(i){return!(typeof Blob>"u")&&(i instanceof Blob||"[object Blob]"===Object.prototype.toString.call(i))}(u)){var S=u.type;if(H(S))if(ce&&se){te||(T.checkOrientation=!1,T.retainExif=!1);var k="image/jpeg"===S,Q=k&&T.checkOrientation,W=k&&T.retainExif;if(!ce||Q||W){var j=new se;this.reader=j,j.onload=function(J){var re=J.target.result,Y={},o=1;Q&&(o=C(re))>1&&I(Y,function D(m){var i=0,l=1,u=1;switch(m){case 2:l=-1;break;case 3:i=-180;break;case 4:u=-1;break;case 5:i=90,u=-1;break;case 6:i=90;break;case 7:i=90,l=-1;break;case 8:i=-90}return{rotate:i,scaleX:l,scaleY:u}}(o)),W&&(l.exif=function oe(m){for(var i=E(new Uint8Array(m)),l=i.length,u=[],T=0;T+3<l;){var S=i[T],k=i[T+1];if(255===S&&218===k)break;if(255===S&&216===k)T+=2;else{var W=T+(256*i[T+2]+i[T+3])+2,j=i.slice(T,W);u.push(j),T=W}}return u.reduce(function(J,z){return 255===z[0]&&225===z[1]?J.concat(z):J},[])}(re)),Y.url=Q||W?!ce||o>1?M(re,S):ce.createObjectURL(u):re,l.load(Y)},j.onabort=function(){l.fail(new Error("Aborted to read the image with FileReader."))},j.onerror=function(){l.fail(new Error("Failed to read the image with FileReader."))},j.onloadend=function(){l.reader=null},Q||W?j.readAsArrayBuffer(u):j.readAsDataURL(u)}else this.load({url:ce.createObjectURL(u)})}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(l){var u=this,T=this.file,S=this.image;S.onload=function(){u.draw(t(t({},l),{},{naturalWidth:S.naturalWidth,naturalHeight:S.naturalHeight}))},S.onabort=function(){u.fail(new Error("Aborted to load the image."))},S.onerror=function(){u.fail(new Error("Failed to load the image."))},d.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(d.navigator.userAgent)&&(S.crossOrigin="anonymous"),S.alt=T.name,S.src=l.url}},{key:"draw",value:function(l){var u=this,T=l.naturalWidth,S=l.naturalHeight,k=l.rotate,Q=void 0===k?0:k,W=l.scaleX,j=void 0===W?1:W,J=l.scaleY,z=void 0===J?1:J,re=this.file,Y=this.image,o=this.options,F=document.createElement("canvas"),n=F.getContext("2d"),h=Math.abs(Q)%180==90,a=("contain"===o.resize||"cover"===o.resize)&&v(o.width)&&v(o.height),L=Math.max(o.maxWidth,0)||1/0,Z=Math.max(o.maxHeight,0)||1/0,G=Math.max(o.minWidth,0)||0,ie=Math.max(o.minHeight,0)||0,le=T/S,ee=o.width,X=o.height;if(h){var ue=[Z,L];L=ue[0],Z=ue[1];var $=[ie,G];G=$[0],ie=$[1];var ae=[X,ee];ee=ae[0],X=ae[1]}a&&(le=ee/X);var de=K({aspectRatio:le,width:L,height:Z},"contain");L=de.width,Z=de.height;var he=K({aspectRatio:le,width:G,height:ie},"cover");if(G=he.width,ie=he.height,a){var me=K({aspectRatio:le,width:ee,height:X},o.resize);ee=me.width,X=me.height}else{var Me=K({aspectRatio:le,width:ee,height:X}),Ue=Me.width;ee=void 0===Ue?T:Ue;var be=Me.height;X=void 0===be?S:be}var Fe=-(ee=Math.floor(V(Math.min(Math.max(ee,G),L))))/2,Be=-(X=Math.floor(V(Math.min(Math.max(X,ie),Z))))/2,We=ee,je=X,Oe=[];if(a){var Ae,ye,Ce=K({aspectRatio:le,width:T,height:S},{contain:"cover",cover:"contain"}[o.resize]);Oe.push((T-(Ae=Ce.width))/2,(S-(ye=Ce.height))/2,Ae,ye)}if(Oe.push(Fe,Be,We,je),h){var De=[X,ee];ee=De[0],X=De[1]}F.width=ee,F.height=X,H(o.mimeType)||(o.mimeType=re.type);var Ie="transparent";re.size>o.convertSize&&o.convertTypes.indexOf(o.mimeType)>=0&&(o.mimeType="image/jpeg");var Se="image/jpeg"===o.mimeType;if(Se&&(Ie="#fff"),n.fillStyle=Ie,n.fillRect(0,0,ee,X),o.beforeDraw&&o.beforeDraw.call(this,n,F),!this.aborted&&(n.save(),n.translate(ee/2,X/2),n.rotate(Q*Math.PI/180),n.scale(j,z),n.drawImage.apply(n,[Y].concat(Oe)),n.restore(),o.drew&&o.drew.call(this,n,F),!this.aborted)){var Le=function(ge){if(!u.aborted){var Re=function(fe){return u.done({naturalWidth:T,naturalHeight:S,result:fe})};if(ge&&Se&&o.retainExif&&u.exif&&u.exif.length>0){var we=function(fe){return Re(O(M(function ne(m,i){var l=E(new Uint8Array(m));if(255!==l[2]||224!==l[3])return m;var T=[255,216].concat(i,l.slice(4+(256*l[4]+l[5])));return new Uint8Array(T)}(fe,u.exif),o.mimeType)))};if(ge.arrayBuffer)ge.arrayBuffer().then(we).catch(function(){u.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var pe=new se;u.reader=pe,pe.onload=function(xe){we(xe.target.result)},pe.onabort=function(){u.fail(new Error("Aborted to read the compressed image with FileReader."))},pe.onerror=function(){u.fail(new Error("Failed to read the compressed image with FileReader."))},pe.onloadend=function(){u.reader=null},pe.readAsArrayBuffer(ge)}}else Re(ge)}};F.toBlob?F.toBlob(Le,o.mimeType,o.quality):Le(O(F.toDataURL(o.mimeType,o.quality)))}}},{key:"done",value:function(l){var u=l.naturalWidth,T=l.naturalHeight,S=l.result,k=this.file,Q=this.image,W=this.options;if(ce&&0===Q.src.indexOf("blob:")&&ce.revokeObjectURL(Q.src),S)if(W.strict&&!W.retainExif&&S.size>k.size&&W.mimeType===k.type&&!(W.width>u||W.height>T||W.minWidth>u||W.minHeight>T||W.maxWidth<u||W.maxHeight<T))S=k;else{var j=new Date;S.lastModified=j.getTime(),S.lastModifiedDate=j,S.name=k.name,S.name&&S.type!==k.type&&(S.name=S.name.replace(_e,function A(m){var i=H(m)?m.substr(6):"";return"jpeg"===i&&(i="jpg"),".".concat(i)}(S.type)))}else S=k;this.result=S,W.success&&W.success.call(this,S)}},{key:"fail",value:function(l){var u=this.options;if(!u.error)throw l;u.error.call(this,l)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ve,m}},{key:"setDefaults",value:function(l){I(P,l)}}]),m}();return Ee}()},1687:(q,w,t)=>{"use strict";t.d(w,{F:()=>e});var f=t(6321),U=t(4825);function e(y=0,I=f.z){return y<0&&(y=0),(0,U.H)(y,y,I)}},4004:(q,w,t)=>{"use strict";t.d(w,{Z:()=>P});const U={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let e;const y=new Uint8Array(16);function I(){if(!e&&(e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(y)}const c=[];for(let r=0;r<256;++r)c.push((r+256).toString(16).slice(1));const P=function g(r,d,v){if(U.randomUUID&&!d&&!r)return U.randomUUID();const R=(r=r||{}).random||(r.rng||I)();if(R[6]=15&R[6]|64,R[8]=63&R[8]|128,d){v=v||0;for(let E=0;E<16;++E)d[v+E]=R[E];return d}return function b(r,d=0){return(c[r[d+0]]+c[r[d+1]]+c[r[d+2]]+c[r[d+3]]+"-"+c[r[d+4]]+c[r[d+5]]+"-"+c[r[d+6]]+c[r[d+7]]+"-"+c[r[d+8]]+c[r[d+9]]+"-"+c[r[d+10]]+c[r[d+11]]+c[r[d+12]]+c[r[d+13]]+c[r[d+14]]+c[r[d+15]]).toLowerCase()}(R)}}}]);