(self.webpackChunkpages=self.webpackChunkpages||[]).push([[70],{9829:(V,S,t)=>{"use strict";t.d(S,{R:()=>v});class v{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(x=>x in this).forEach(x=>this[x]=e[x]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(x=>x in this).forEach(x=>this[x]=e[x].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},9582:(V,S,t)=>{"use strict";t.d(S,{y:()=>y});var v=t(1413),M=t(5861);var s=t(5879);let y=(()=>{class _{constructor(){this.autoRotateSupported=function x(){return new Promise(_=>{const U=new Image;U.onload=()=>{_(1===U.width&&2===U.height)},U.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(r,l){return new Promise((A,T)=>{const C=new FileReader;C.onload=D=>{this.loadImage(D.target.result,r.type,l).then(A).catch(T)},C.readAsDataURL(r)})}loadImage(r,l,A){return this.isValidImageType(l)?this.loadBase64Image(r,A):Promise.reject(new Error("Invalid image type"))}isValidImageType(r){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(r)}loadImageFromURL(r,l){return new Promise((A,T)=>{const C=new Image;C.onerror=()=>T,C.onload=()=>{const D=document.createElement("canvas"),Z=D.getContext("2d");D.width=C.width,D.height=C.height,null==Z||Z.drawImage(C,0,0),this.loadBase64Image(D.toDataURL(),l).then(A)},C.crossOrigin="anonymous",C.src=r})}loadBase64Image(r,l){return new Promise((A,T)=>{const C=new Image;C.onload=()=>A({originalImage:C,originalBase64:r}),C.onerror=T,C.src=r}).then(A=>this.transformImageBase64(A,l))}transformImageBase64(r,l){var A=this;return(0,M.Z)(function*(){const T=yield A.autoRotateSupported,C=yield function b(_){switch("string"==typeof _&&(_=function c(_){const U=new DataView(function O(_){_=_.replace(/^data\:([^\;]+)\;base64,/gim,"");const U=atob(_),r=U.length,l=new Uint8Array(r);for(let A=0;A<r;A++)l[A]=U.charCodeAt(A);return l.buffer}(_));if(65496!==U.getUint16(0,!1))return-2;const r=U.byteLength;let l=2;for(;l<r;){if(U.getUint16(l+2,!1)<=8)return-1;const A=U.getUint16(l,!1);if(l+=2,65505==A){if(1165519206!==U.getUint32(l+=2,!1))return-1;const T=18761==U.getUint16(l+=6,!1);l+=U.getUint32(l+4,T);const C=U.getUint16(l,T);l+=2;for(let D=0;D<C;D++)if(274==U.getUint16(l+12*D,T))return U.getUint16(l+12*D+8,T)}else{if(65280!=(65280&A))break;l+=U.getUint16(l,!1)}}return-1}(_)),_){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(T?-1:r.originalBase64);return r.originalImage&&r.originalImage.complete?A.transformLoadedImage({original:{base64:r.originalBase64,image:r.originalImage,size:{width:r.originalImage.naturalWidth,height:r.originalImage.naturalHeight}},exifTransform:C},l):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(r,l){var A=this;return(0,M.Z)(function*(){const T=l.canvasRotation+r.exifTransform.rotate,C={width:r.original.image.naturalWidth,height:r.original.image.naturalHeight};if(0===T&&!r.exifTransform.flip&&!l.containWithinAspectRatio)return{original:{base64:r.original.base64,image:r.original.image,size:(0,v.Z)({},C)},transformed:{base64:r.original.base64,image:r.original.image,size:(0,v.Z)({},C)},exifTransform:r.exifTransform};const D=A.getTransformedSize(C,r.exifTransform,l),Z=document.createElement("canvas");Z.width=D.width,Z.height=D.height;const f=Z.getContext("2d");null==f||f.setTransform(r.exifTransform.flip?-1:1,0,0,1,Z.width/2,Z.height/2),null==f||f.rotate(Math.PI*(T/2)),null==f||f.drawImage(r.original.image,-C.width/2,-C.height/2);const m=Z.toDataURL(),p=yield A.loadImageFromBase64(m);return{original:{base64:r.original.base64,image:r.original.image,size:(0,v.Z)({},C)},transformed:{base64:m,image:p,size:{width:p.width,height:p.height}},exifTransform:r.exifTransform}})()}loadImageFromBase64(r){return new Promise((l,A)=>{const T=new Image;T.onload=()=>l(T),T.onerror=A,T.src=r})}getTransformedSize(r,l,A){const T=A.canvasRotation+l.rotate;if(A.containWithinAspectRatio){if(T%2){const D=r.height/A.aspectRatio;return{width:Math.max(r.height,r.width*A.aspectRatio),height:Math.max(r.width,D)}}{const D=r.width/A.aspectRatio;return{width:Math.max(r.width,r.height*A.aspectRatio),height:Math.max(r.height,D)}}}return T%2?{height:r.width,width:r.height}:{width:r.width,height:r.height}}}return _.\u0275fac=function(r){return new(r||_)},_.\u0275prov=s.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},3705:(V,S,t)=>{"use strict";function v(M){const e=M.split(","),x=e[0].replace("data:","").replace(";base64",""),b=atob(e[1]),c=new ArrayBuffer(b.length),O=new Uint8Array(c);for(let s=0;s<b.length;s+=1)O[s]=b.charCodeAt(s);return new Blob([c],{type:x})}t.d(S,{L:()=>v})},5851:(V,S,t)=>{"use strict";t.d(S,{B:()=>Y});var v=t(5861),M=t(1378),e=t(5879),x=t(2438),b=t(4036),c=t(9054),O=t(4020),s=t(148),y=t(9093),_=t(7621),U=t(1990),r=t(5661),l=t(5172),A=t(3845),T=t(4887),C=t(5487),D=t(658),Z=t(9515),f=t(6814),m=t(6223),p=t(9473),g=t(554),w=t(4464),R=t(4228);const F=["fileInput"];function G(o,B){1&o&&(e.O4$(),e.TgZ(0,"svg",31),e._UZ(1,"path",32)(2,"path",33),e.qZA())}const re=function(){return["text-primary"]};function Q(o,B){1&o&&e._UZ(0,"app-logo",34),2&o&&e.Q6J("svgClass",e.DdM(2,re))("responsive",!1)}function ie(o,B){1&o&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&o&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.DESKTOP"),e.oJD)}function le(o,B){1&o&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&o&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.TOUCH"),e.oJD)}const ae=function(o){return{"fw-bold fs-md-lg":o}},se=function(o){return{"text-decoration-underline":o}};function ce(o,B){if(1&o){const n=e.EpF();e.TgZ(0,"div",35),e.YNc(1,ie,2,3,"span",36),e.YNc(2,le,2,3,"span",36),e.TgZ(3,"span",37),e.NdJ("click",function(a){e.CHM(n);const L=e.oxw(2),K=e.MAs(23);return e.KtG(L.toggleRemoteUrlForm(a,K))}),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&o){const n=e.oxw(2);e.Q6J("ngClass",e.VKq(7,ae,!n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.touchDevice),e.xp6(1),e.Q6J("ngIf",n.touchDevice),e.xp6(1),e.Q6J("ngClass",e.VKq(9,se,n.isWidget)),e.xp6(1),e.Oqu(e.lcZ(5,5,"COMPONENTS.UPLOADER.DESCRIPTION.REMOTE_URL"))}}function me(o,B){1&o&&e.GkF(0)}function ve(o,B){if(1&o){const n=e.EpF();e.TgZ(0,"div",39),e.YNc(1,me,1,0,"ng-container",17),e.TgZ(2,"button",40),e.NdJ("click",function(a){e.CHM(n);const L=e.oxw(2);return e.KtG(L.handleRemoteUrlUpload(a))}),e.O4$(),e.TgZ(3,"svg",41),e._UZ(4,"path",42),e.qZA()(),e.kcU(),e.TgZ(5,"button",43),e.NdJ("click",function(a){e.CHM(n);const L=e.oxw(2);return e.KtG(L.toggleRemoteUrlForm(a))}),e.O4$(),e.TgZ(6,"svg",41),e._UZ(7,"path",44),e.qZA()()()}if(2&o){const n=e.oxw(2),h=e.MAs(34);e.xp6(1),e.Q6J("ngTemplateOutlet",h),e.xp6(1),e.Q6J("disabled",0===n.remoteUrl.length||!n.isRemoteUrlValid)}}function Ee(o,B){if(1&o&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"em",45),e.ALo(5,"arrayJoin"),e.BQk()),2&o){const n=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"COMPONENTS.UPLOADER.PATH.LONG")," "),e.xp6(2),e.Q6J("innerText",n.currentFolderPath.length?e.xi3(5,4,n.currentFolderPath,"/"):"root")}}function E(o,B){if(1&o&&(e._UZ(0,"div",50),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&o){const n=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,n.currentFolderPath,0,-1),"/"))}}function i(o,B){if(1&o&&(e.TgZ(0,"div",46)(1,"div",47),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,E,3,8,"div",48),e._UZ(5,"div",49),e.ALo(6,"arrayJoin"),e.ALo(7,"slice"),e.qZA()),2&o){const n=e.oxw(2);e.xp6(2),e.hij(" ",e.lcZ(3,3,"COMPONENTS.UPLOADER.PATH.SHORT")," "),e.xp6(2),e.Q6J("ngIf",n.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(n.currentFolderPath.length>1?"/":"")+(n.currentFolderPath.length?e.xi3(6,5,e.xi3(7,8,n.currentFolderPath,n.currentFolderPath.length-1),"/"):"root"))}}const u=function(){return{bottom:0,left:0}};function d(o,B){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"a",51),e.NdJ("click",function(){e.CHM(n);const a=e.oxw(2);return e.KtG(a.openInfoModal.emit())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",52),e.NdJ("click",function(){e.CHM(n),e.oxw(2);const a=e.MAs(7);return e.KtG(a.open())}),e._uU(5," settings "),e.qZA(),e.TgZ(6,"div",53),e.NdJ("click",function(a){e.CHM(n);const L=e.oxw(2),K=e.MAs(23);return e.KtG(L.toggleRemoteUrlForm(a,K))}),e._uU(7," add_link "),e.qZA(),e.BQk()}2&o&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,u)),e.xp6(1),e.Oqu(e.lcZ(3,2,"COMPONENTS.UPLOADER.INFO")))}const P=function(o,B,n){return{"cursor-pointer":o,"py-4 px-3 px-sm-4":B,"p-2 pb-3":n}},I=function(o,B,n){return{"my-2":o,"mb-2":B,"mw-100 mt-1":n}};function H(o,B){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",22,23),e.NdJ("dragenter",function(){e.CHM(n);const a=e.MAs(2),L=e.oxw();return e.KtG(L.setDragOverEvent(a))})("drop",function(a){e.CHM(n);const L=e.oxw();return e.KtG(L.handleDropEvent(a))})("click",function(){e.CHM(n);const a=e.oxw(),L=e.MAs(2);return e.KtG(!a.isWaitingRemoteUrl&&L.click())}),e.YNc(3,G,3,0,"svg",24),e.YNc(4,Q,1,3,"ng-template",null,25,e.W1O),e.YNc(6,ce,6,11,"div",26),e.YNc(7,ve,8,2,"div",27),e.TgZ(8,"div",28),e.YNc(9,Ee,6,7,"ng-container",3),e.YNc(10,i,8,11,"ng-template",null,29,e.W1O),e.qZA()(),e.YNc(12,d,8,5,"ng-container",30),e.BQk()}if(2&o){const n=e.MAs(5),h=e.MAs(11),a=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(9,P,!a.loading&&!a.isWaitingRemoteUrl,!a.isWidget,a.isWidget)),e.xp6(2),e.Q6J("ngIf",!a.isWidget)("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",!a.isWidget||!a.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngIf",a.isWidget&&a.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngClass",e.kEZ(13,I,!a.isWidget&&!a.touchDevice,!a.isWidget&&a.touchDevice,a.isWidget)),e.xp6(1),e.Q6J("ngIf",!a.isWidget)("ngIfElse",h),e.xp6(3),e.Q6J("ngIf",!a.isWidget)}}const N=function(o,B){return{"p-4":o,"p-2":B}};function W(o,B){if(1&o&&(e.TgZ(0,"div",54),e.O4$(),e.TgZ(1,"svg",55),e._UZ(2,"path",56),e.qZA(),e.kcU(),e._UZ(3,"app-loader",57),e.TgZ(4,"div",58),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&o){const n=e.oxw();e.Q6J("ngClass",e.WLB(6,N,!n.isWidget,n.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",n.loadingMessage),e.xp6(2),e.hij(" ",e.lcZ(6,4,"COMPONENTS.UPLOADER.LOADING.SUBTEXT")," ")}}function j(o,B){1&o&&e.GkF(0)}const k=function(o){return{"fs-reset":o}};function z(o,B){if(1&o){const n=e.EpF();e.TgZ(0,"input",59,60),e.NdJ("ngModelChange",function(a){e.CHM(n);const L=e.oxw();return e.KtG(L.remoteUrl=a)})("ngModelChange",function(){e.CHM(n);const a=e.MAs(1),L=e.oxw();return e.KtG(L.isRemoteUrlValid=!a.invalid)}),e.ALo(2,"translate"),e.qZA()}if(2&o){const n=e.oxw();e.Q6J("placeholder",e.lcZ(2,4,"COMPONENTS.UPLOADER.REMOTE_URL_INPUT_PLACEHOLDER"))("ngClass",e.VKq(6,k,n.isWidget))("ngModel",n.remoteUrl)("pattern","^https?://[^.]+\\.(.+)")}}const ee=function(o,B){return{uploading:o,"widget flex-grow-1 min-w-0":B}};let Y=(()=>{class o{constructor(n,h,a,L,K,J,te,oe,q){this.postMessageService=n,this.uploadService=h,this.uploadObservablesService=a,this.uploaderService=L,this.toastService=K,this.renderer=J,this.ngZone=te,this.translateService=oe,this.proxyService=q,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="",this.touchDevice=O.eX,this.isWaitingRemoteUrl=!1,this.remoteUrl="",this.isRemoteUrlValid=!1,this.dragOverEvent=!1,this.checkingFileMessage="",this.options=this.uploaderService.uploaderOptions;const X=this.uploadService.preferences.uploader;X.checkImage.active||(this.options.compress=!1),X.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){var n=this;return(0,v.Z)(function*(){n.handleClipboardPasteEvent(),n.handleExternalUpload(),n.checkingFileMessage=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CHECK"),n.loadingMessage=n.checkingFileMessage})()}handleClipboardPasteEvent(){var n=this;this.clipboardPasteEventSubscription=(0,x.R)(document.body,"paste").subscribe(function(){var h=(0,v.Z)(function*(a){if(n.isWidget&&n.isWaitingRemoteUrl||!n.canUpload())return;const L=Array.from((a.clipboardData||a.originalEvent.clipboardData).items);let K=[];for(const J of L)if(0===J.type.indexOf("image")){const te=J.getAsFile();te&&K.push(te)}K.length>0?yield n.preUpload(K):n.reset()});return function(a){return h.apply(this,arguments)}}())}handleExternalUpload(){var n=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var h=(0,v.Z)(function*(a){if(a){if(!n.canUpload())return;yield n.preUpload([a.file],a.options)}else n.fileInputRef.nativeElement.click()});return function(a){return h.apply(this,arguments)}}())}handleSelectionEvent(n){var h=this;return(0,v.Z)(function*(){if(!h.canUpload())return;const a=n.target;if(a.files&&a.files.length){const L=Array.from(a.files);return a.value="",h.preUpload(L)}h.reset()})()}handleDropEvent(n){var h=this;return(0,v.Z)(function*(){var a;if(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!h.canUpload())return;const L=null!==(a=n.dataTransfer)&&void 0!==a&&a.files?Array.from(n.dataTransfer.files):[];if(L.length)return h.preUpload(L);h.reset()})()}handleRemoteUrlUpload(n,h){var a=this;return(0,v.Z)(function*(){if(!a.isRemoteUrlValid||0===a.remoteUrl.length||!a.canUpload())return;const L=a.remoteUrl;a.loadingMessage=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.GETTING_REMOTE_FILE"),a.toggleRemoteUrlForm(n,h);const K=(0,c.Tb)(L);if(!K.ext||-1===U.O8.findIndex(te=>-1!==te.ext.indexOf(K.ext)))return a.handleErrors([K.name],[]),void a.reset();const J=yield a.proxyService.get(L);return J?a.preUpload([new File([J],K.name,{type:J.type,lastModified:Date.now()})]):(a.toastService.show({content:"Errore nel recupero dell'immagine dall'url!",level:M.m.ERROR}),a.postMessageService.send(s.l.UPLOAD_ERROR,{filename:K.name,error:A.S.REMOTE_URL_RESPONSE}),void a.reset())})()}saveOptions(n=!0){this.uploaderService.uploaderOptions=this.options,n&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(n){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(n,"dragover",h=>{h.preventDefault()})}))}canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage=this.checkingFileMessage,this.postMessageService.send(s.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(n,h){var a=this;return(0,v.Z)(function*(){const L=[...a.currentFolderPath];let K=[],J=[],te=[],oe=[];h?h.allowOverwrite=h.allowOverwrite||!1:(h=a.uploaderService.uploaderOptions).allowOverwrite=!1;for(let $=0;$<n.length;$++){let ne=h.compress?yield a.uploaderService.compressFileIfNeeded(n[$],h.imageDimensions):n[$];if(ne=yield a.uploaderService.orientFileIfNeeded(ne),ne){const de=(0,c.Tb)(ne.name),he=U.O8.find(fe=>-1!==fe.ext.indexOf(de.ext));if(!he){te.push(ne.name);continue}if(ne.size>he.maxSize){oe.push(ne.name);continue}K.push({file:{name:ne.name,size:ne.size,time:0,url:"",ext:de.ext,filename:de.filename,isImage:(0,c.Or)(de.ext),embedUrl:"",type:l.VC.FILE},progress:0,completed:!1}),J.push(ne)}}if(a.handleErrors(te,oe),0===J.length)return void a.reset();const q=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.UPLOADING",{total:J.length}),X=a.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CREATING_PACKAGE",{total:J.length});a.uploadObservablesService.pushUploadingFileQueue(K);for(let $=0;$<J.length;++$){a.loadingMessage=X;const ne=yield a.uploadService.getHostToken(L,J[$].name);K[$].progress+=20,a.loadingMessage=q.replace("{{current}}",`${$+1}`),yield(0,b.z)(a.uploaderService.upload(J[$],K[$],ne,h.allowOverwrite))}a.uploadObservablesService.pushUploadingFileQueue([]);const ue=K.filter($=>!$.error).map($=>$.file);ue.length>0&&(a.fileUploadedEvent.emit({list:ue,rewrite:h.allowOverwrite,destPath:L}),a.postMessageService.send(s.l.UPLOAD_SUCCESS,{fileList:ue.map($=>({filename:$.name,isImage:$.isImage,url:$.url}))}),h.openLinkModalAfterUpload&&a.uploadObservablesService.pushAction({name:l.In.FILE_SHOW_LINKS,payload:{entities:(0,c.jL)(ue)}})),a.reset()})()}handleErrors(n,h){if(0!==n.length||0!==h.length){if(!this.isWidget)return void this.toastService.show({content:this.createToastMessage(n,h),level:M.m.ERROR});[[A.S.UNSUPPORTED,n],[A.S.OVERSIZED,h]].forEach(a=>{a[1].forEach(L=>{this.postMessageService.send(s.l.UPLOAD_ERROR,{filename:L,error:a[0]})})})}}createToastMessage(n,h){let a=[];return n.length&&a.push(n.length>1?`I file <strong>${n.join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${n[0]}</strong> ha un formato non supportato!`),h.length&&a.push(h.length>1?`I file <strong>${h.join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${h[0]}</strong> \xe8 troppo pesante!`),a.join("<br><br>")}toggleRemoteUrlForm(n,h){n.stopPropagation(),this.isWidget||(this.isWaitingRemoteUrl?null==h||h.close():null==h||h.open()),this.resetRemoteUrlForm(!this.isWaitingRemoteUrl)}resetRemoteUrlForm(n){this.isWaitingRemoteUrl=n,this.remoteUrl=""}ngOnDestroy(){var n;null===(n=this.startExternalUploadSubscription)||void 0===n||n.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return o.\u0275fac=function(n){return new(n||o)(e.Y36(y.F),e.Y36(D.C),e.Y36(C.r),e.Y36(T.q),e.Y36(r.k),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(Z.sK),e.Y36(_.y))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-uploader"]],viewQuery:function(n,h){if(1&n&&e.Gf(F,5),2&n){let a;e.iGM(a=e.CRH())&&(h.fileInputRef=a.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:35,vars:37,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],[3,"title"],["optionsModal",""],[3,"innerHtml"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto",3,"innerHTML"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto",3,"innerHTML"],["size","md",3,"title","disableCloseButton","hidden"],["remoteUrlModal",""],[1,"mb-2",3,"innerHTML"],[4,"ngTemplateOutlet"],["footer",""],["type","button",1,"btn","btn-secondary",3,"innerText","click"],["type","button",1,"btn","btn-primary",3,"disabled","innerText","click"],["remoteUrlInput",""],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],["class","description text-center",3,"ngClass",4,"ngIf"],["class","input-group input-group-sm remote-url-form justify-content-center mb-1",4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"description","text-center",3,"ngClass"],[3,"innerHTML",4,"ngIf"],[1,"ms-1","remote-url-btn","fst-italic","cursor-pointer",3,"ngClass","click"],[3,"innerHTML"],[1,"input-group","input-group-sm","remote-url-form","justify-content-center","mb-1"],[1,"input-group-text","bg-light",3,"disabled","click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 16 16"],["d","M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"],[1,"input-group-text","bg-light",3,"click"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","options-icon",3,"click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","remote-url-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"],["type","text","required","",1,"form-control",3,"placeholder","ngClass","ngModel","pattern","ngModelChange"],["input","ngModel"]],template:function(n,h){if(1&n){const a=e.EpF();e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(K){return h.handleSelectionEvent(K)}),e.qZA(),e.YNc(3,H,13,17,"ng-container",3),e.YNc(4,W,7,9,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6),e.ALo(8,"translate"),e._UZ(9,"div",7),e.ALo(10,"translate"),e.TgZ(11,"ul",8)(12,"li")(13,"div",9)(14,"input",10),e.NdJ("ngModelChange",function(K){return h.options.compress=K})("ngModelChange",function(){return h.saveOptions()}),e.qZA(),e._UZ(15,"label",11),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"li")(18,"div",9)(19,"input",12),e.NdJ("ngModelChange",function(K){return h.options.openLinkModalAfterUpload=K})("ngModelChange",function(){return h.saveOptions()}),e.qZA(),e._UZ(20,"label",13),e.ALo(21,"translate"),e.qZA()()()(),e.TgZ(22,"app-modal",14,15),e.NdJ("hidden",function(){return h.resetRemoteUrlForm(!1)}),e.ALo(24,"translate"),e._UZ(25,"p",16),e.ALo(26,"translate"),e.YNc(27,j,1,0,"ng-container",17),e.ynx(28,18),e.TgZ(29,"button",19),e.NdJ("click",function(){e.CHM(a);const K=e.MAs(23);return e.KtG(K.close())}),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",20),e.NdJ("click",function(K){e.CHM(a);const J=e.MAs(23);return e.KtG(h.handleRemoteUrlUpload(K,J))}),e.ALo(32,"translate"),e.qZA(),e.BQk(),e.qZA(),e.YNc(33,z,3,8,"ng-template",null,21,e.W1O)}if(2&n){const a=e.MAs(5),L=e.MAs(34);e.Q6J("ngClass",e.WLB(34,ee,h.isUploading,h.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",h.loading||h.isUploading),e.xp6(2),e.Q6J("ngIf",!h.isUploading)("ngIfElse",a),e.xp6(3),e.Q6J("title",e.lcZ(8,18,"COMPONENTS.UPLOADER.SETTINGS_MODAL.TITLE")),e.xp6(3),e.Q6J("innerHtml",e.lcZ(10,20,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.DESCRIPTION"),e.oJD),e.xp6(5),e.Q6J("ngModel",h.options.compress),e.xp6(1),e.Q6J("innerHTML",e.lcZ(16,22,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.COMPRESS_SWITCH"),e.oJD),e.xp6(4),e.Q6J("ngModel",h.options.openLinkModalAfterUpload),e.xp6(1),e.Q6J("innerHTML",e.lcZ(21,24,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.SHOW_LINK_SWITCH"),e.oJD),e.xp6(2),e.Q6J("title",e.lcZ(24,26,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.TITLE"))("disableCloseButton",!0),e.xp6(3),e.Q6J("innerHTML",e.lcZ(26,28,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.CONTENT"),e.oJD),e.xp6(2),e.Q6J("ngTemplateOutlet",L),e.xp6(2),e.Q6J("innerText",e.lcZ(30,30,"SHARED.CANCEL")),e.xp6(2),e.Q6J("disabled",0===h.remoteUrl.length||!h.isRemoteUrlValid)("innerText",e.lcZ(32,32,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.UPLOAD_BTN"))}},dependencies:[f.mk,f.O5,f.tP,f.PC,m.Fj,m.Wl,m.JJ,m.Q7,m.c5,m.On,p.R,g.R,w.z,R.J,f.OU,Z.X$],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864fe;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:350px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:_ngcontent-%COMP%_draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{top:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{opacity:1}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{right:5px}.uploader[_ngcontent-%COMP%]   .remote-url-icon[_ngcontent-%COMP%]{right:30px}.upload-area.cursor-pointer[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo):not(.description), .upload-area.cursor-pointer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.remote-url-btn){pointer-events:none}.remote-url-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:300px}.remote-url-form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:.5}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes _ngcontent-%COMP%_bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes _ngcontent-%COMP%_draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),o})()},529:(V,S,t)=>{"use strict";t.d(S,{M:()=>y});var v=t(4243),M=t(6814),e=t(6223),x=t(475),b=t(2740),c=t(4610),O=t(9515),s=t(5879);let y=(()=>{class _{}return _.\u0275fac=function(r){return new(r||_)},_.\u0275mod=s.oAB({type:_}),_.\u0275inj=s.cJS({imports:[v.r,M.ez,e.u5,x.q,b.h,c.z,O.aw.forChild()]}),_})()},3845:(V,S,t)=>{"use strict";t.d(S,{S:()=>v});var v=function(M){return M.UNSUPPORTED="unsupported",M.OVERSIZED="oversized",M.REMOTE_URL_RESPONSE="remote-url-response",M.UPLOAD_FAILED="upload-failed",M}(v||{})},4243:(V,S,t)=>{"use strict";t.d(S,{r:()=>e});var v=t(6814),M=t(5879);let e=(()=>{class x{}return x.\u0275fac=function(c){return new(c||x)},x.\u0275mod=M.oAB({type:x}),x.\u0275inj=M.cJS({imports:[v.ez]}),x})()},4228:(V,S,t)=>{"use strict";t.d(S,{J:()=>M});var v=t(5879);let M=(()=>{class e{transform(b,c){return b.join(c)}}return e.\u0275fac=function(b){return new(b||e)},e.\u0275pipe=v.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},5172:(V,S,t)=>{"use strict";t.d(S,{In:()=>v,Ky:()=>b,VC:()=>M,c5:()=>x,gG:()=>e});var v=function(c){return c.FILE_SHOW_LINKS="fileLinks",c.FILE_EDIT="fileEdit",c.DELETE="delete",c.RENAME="rename",c.MOVE="move",c}(v||{}),M=function(c){return c.FILE="file",c.FOLDER="folder",c}(M||{}),e=function(c){return c.FILENAME="filename",c.SIZE="size",c.TIME="time",c.EXTENSION="ext",c}(e||{}),x=function(c){return c.GRID="grid",c.LIST="list",c}(x||{}),b=function(c){return c.W_768_I_1="(max-width: 767.98px)",c.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",c.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",c.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",c.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",c.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",c.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",c.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",c.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",c.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",c.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",c.W_3738_I_10="(min-width: 3424px)",c}(b||{})},1990:(V,S,t)=>{"use strict";t.d(S,{C7:()=>x,Mi:()=>b,O8:()=>M,er:()=>c,p0:()=>e,xt:()=>O});var v=t(5172);const M=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(s=>(s.maxSize*=1048576,s)),e={lastPath:[],layout:{asc:!0,orderBy:v.gG.FILENAME,type:v.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},x="https://upload.forumfree.net/api/",b=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,c=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,O={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},7621:(V,S,t)=>{"use strict";t.d(S,{y:()=>_});var v=t(5861),M=t(8685),e=t(708),x=t(8180),b=t(4664),c=t(2096),O=t(6306),s=t(5879),y=t(9862);let _=(()=>{class U{constructor(l,A){this.http=l,this.endpointsService=A}get(l){var A=this;return(0,v.Z)(function*(){const T=A.sendRequest(l);return yield(0,e.n)(T)})()}sendRequest(l){return this.getUrlContent(l).pipe((0,x.q)(1),(0,b.w)(A=>(0,c.of)(A)),(0,O.K)(()=>this.getUrlContentWithProxy(l)))}getUrlContent(l){return this.http.get(l,{responseType:"blob"})}getUrlContentWithProxy(l){return this.http.get(this.endpointsService.get(M.jQ.PROXY,M.ph.COMMON),{headers:{[M._o.HeaderKeys.TOKEN_TYPE]:M.s9.ACCESS,"x-remote-url":l},responseType:"blob"}).pipe((0,x.q)(1),(0,O.K)(()=>(0,c.of)(void 0)))}}return U.\u0275fac=function(l){return new(l||U)(s.LFG(y.eN),s.LFG(M.oz))},U.\u0275prov=s.Yz7({token:U,factory:U.\u0275fac,providedIn:"root"}),U})()},5983:(V,S,t)=>{"use strict";t.d(S,{B:()=>x});var v=t(5172),M=t(1410),e=t(5879);let x=(()=>{class b{constructor(O){this.globalsService=O,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(s=>{this.ffuid=s?s.user.ffuid:""})}getItem(O){const s=this.createKey(O);if(this.cache.hasOwnProperty(s))return this.cache[s]}setItem(O,s){this.cache[this.createKey(O)]=s}removeItem(O){const s=this.createKey(O);if(this.cache.hasOwnProperty(s)){if(this.cache[s].folders.length)for(const y of this.cache[s].folders)this.removeItem([...O,y.name]);return delete this.cache[s],!0}return!1}getEntities(O,s){let y={};const _=this.createKey(O);if(!this.cache.hasOwnProperty(_))return y;for(const U of s){const r=(U.type===v.VC.FILE?this.cache[_].files:this.cache[_].folders).find(l=>l.name===U.name);r&&(y[r.name]=r)}return y}addEntities(O,s,y=v.VC.FILE){const _=this.createKey(O);return!!this.cache.hasOwnProperty(_)&&(Array.isArray(s)||(s=[s]),y===v.VC.FILE?this.cache[_].files.unshift(...s):this.cache[_].folders.unshift(...s),!0)}removeEntities(O,s,y=v.VC.FILE){if(Array.isArray(s)||(s=[s]),y===v.VC.FOLDER)for(const l of s)this.removeItem([...O,l]);const _=this.createKey(O);if(!this.cache.hasOwnProperty(_))return[];const U=y===v.VC.FILE?"files":"folders";let r=[];for(const l of s){const A=this.cache[_][U].findIndex(T=>T.name===l);A>-1&&(this.cache[_][U].splice(A,1),r.push(l))}return r}refactorFolderContent(O,s){const y=this.createKey(O);if(!this.cache.hasOwnProperty(y))return!1;s.endsWith("/")||(s+="/");for(const _ of this.cache[y].folders)_.url=s+_.name;for(const _ of this.cache[y].files)_.url=_.embedUrl=s+_.name,_.time=Date.now();return!0}createKey(O){return`${this.ffuid}/${O.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return b.\u0275fac=function(O){return new(O||b)(e.LFG(M.d))},b.\u0275prov=e.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"}),b})()},5571:(V,S,t)=>{"use strict";t.d(S,{AD:()=>M,It:()=>c,ex:()=>v,mH:()=>O,r2:()=>x,vO:()=>b,xJ:()=>e});const v="\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",M="\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",e="\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",x="\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",b="\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",c="\nquery UploadHistoryAvailableDateRange {\n    uploadHistoryAvailableDateRange {\n        start\n        end\n    }\n}",O="\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}"},5487:(V,S,t)=>{"use strict";t.d(S,{r:()=>b});var v=t(8645),M=t(5619),e=t(446),x=t(5879);let b=(()=>{class c{constructor(s){this.uploadPreferencesService=s,this.selectedFileListArray=[],this.actionSubject=new v.x,this.uploadingFileQueueSubject=new v.x,this.uploadingFileErrorSubject=new v.x,this.currentFolderPathSubject=new v.x,this.layoutOptionsSubject=new v.x,this.renameEntitySubject=new v.x,this.entityPendingSubject=new v.x,this.deleteFileSubject=new v.x,this.uploadedFileSubject=new v.x,this.draggedFileListSubject=new v.x,this.startUploadSubject=new v.x,this.startMoveSubject=new v.x,this.selectedFileListSubject=new M.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(s){this.actionSubject.next(s)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(s){this.uploadPreferencesService.layoutOptions=s,this.layoutOptionsSubject.next(s)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(s){this.uploadPreferencesService.lastFolderPath=s,this.currentFolderPathSubject.next(s)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(s){this.uploadingFileQueueSubject.next(s)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(s){this.uploadingFileErrorSubject.next(s)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(s){this.renameEntitySubject.next(s)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(s){this.entityPendingSubject.next(s)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(s){this.deleteFileSubject.next(s)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(s){this.uploadedFileSubject.next(s)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(s){this.draggedFileListSubject.next(s)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(s){this.startUploadSubject.next(s)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(s){this.startMoveSubject.next(s)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(s){if(Array.isArray(s)||(s=[s]),0===s.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let y=!1;for(const _ of s){const U=this.selectedFileListArray.findIndex(r=>r.name===_.name);_.selected?-1===U&&(this.selectedFileListArray.push({name:_.name}),y=!0):U>-1&&(this.selectedFileListArray.splice(U,1),y=!0)}y&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return c.\u0275fac=function(s){return new(s||c)(x.LFG(e.p))},c.\u0275prov=x.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},446:(V,S,t)=>{"use strict";t.d(S,{p:()=>c});var v=t(7165),M=t(463),e=t(1990),x=t(2986),b=t(5879);let c=(()=>{class O{constructor(y,_){this.preferencesService=y,this.urlQueryParamsService=_;const U=this.urlQueryParamsService.getAndDeleteParam(v.RT.UPLOAD_PATH);U&&(this.lastFolderPath=U.split("/").filter(r=>r.length>0))}get preferences(){return this.preferencesService.getItem(v.Ye.UPLOAD)||e.p0}set preferences(y){this.preferencesService.setItem(v.Ye.UPLOAD,y)}get lastFolderPath(){return(this.preferences.lastPath||e.p0.lastPath).filter(y=>y.length>0)}set lastFolderPath(y){const _=this.preferences;_.lastPath=y,this.preferences=_}get layoutOptions(){const y=e.p0.layout,_=this.preferences.layout;return _&&0===Object.keys(y).filter(U=>!_.hasOwnProperty(U)).length?_:y}set layoutOptions(y){const _=this.preferences;_.layout=y,this.preferences=_}get uploader(){const y=this.preferences.uploader||e.p0.uploader;return!y.checkImage.active&&Date.now()-y.checkImage.time>6048e5&&(y.checkImage.active=!0,this.uploader=y),y.hasOwnProperty("showLinkModal")||(y.showLinkModal=!1),y}set uploader(y){const _=this.preferences;_.uploader=y,this.preferences=_}}return O.\u0275fac=function(y){return new(y||O)(b.LFG(M.y),b.LFG(x.J))},O.\u0275prov=b.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"}),O})()},658:(V,S,t)=>{"use strict";t.d(S,{C:()=>A});var v=t(1413),M=t(5861),e=t(8685),x=t(4036),b=t(5172),c=t(9054),O=t(5571),s=t(5983),y=t(1990),_=t(446),U=t(4004),r=t(5879),l=t(9862);let A=(()=>{class T{constructor(D,Z,f,m){this.graphqlService=D,this.uploadCacheService=Z,this.uploadPreferencesService=f,this.http=m}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(e._o.HeaderKeys.UUID,(0,U.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(e._o.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(e._o.HeaderKeys.UUID)||""}getFileList(D,Z){var f=this;return(0,M.Z)(function*(){const m=f.uploadCacheService.getItem(D);if(m)return m;const p=(yield f.graphqlService.query({query:O.ex,variables:{scope:Z,target:D.join("/")}})).data.uploadEntitiesListToken,g=yield f.sendRequest(p),R={files:g.files.map(F=>{const G=(0,c.Tb)(F.url);return(0,v.Z)((0,v.Z)({},F),{time:1e3*F.time,filename:G.filename,ext:G.ext,isImage:(0,c.Or)(G.ext),embedUrl:`${F.url}?t=${F.time}`,type:b.VC.FILE})}),folders:g.folders.map(F=>(0,v.Z)((0,v.Z)({},F),{},{type:b.VC.FOLDER}))};return f.uploadCacheService.setItem(D,R),R})()}createDirectory(D,Z){var f=this;return(0,M.Z)(function*(){const m=(yield f.graphqlService.mutate({mutation:O.xJ,variables:{scope:Z,target:D.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield f.sendRequest(m)})()}moveRenameEntity(D,Z,f,m,p){var g=this;return(0,M.Z)(function*(){m||(m=f);const w=(yield g.graphqlService.mutate({mutation:O.r2,variables:{scope:p,source:(D.length?`${D.join("/")}/`:"")+f,target:(Z.length?`${Z.join("/")}/`:"")+m}})).data.uploadEntitiesMoveToken,R=yield g.sendRequest(w);return(0,v.Z)((0,v.Z)({},R),{},{time:1e3*R.time})})()}deleteEntity(D,Z,f){var m=this;return(0,M.Z)(function*(){const p=(yield m.graphqlService.mutate({mutation:O.vO,variables:{scope:f,target:(D.length?`${D.join("/")}/`:"")+Z}})).data.uploadEntitiesDeleteToken;return yield m.sendRequest(p),!0})()}getHostToken(D,Z,f){var m=this;return(0,M.Z)(function*(){return(yield m.graphqlService.query({query:O.AD,variables:{scope:f,target:(D.length?`${D.join("/")}/`:"")+Z}})).data.uploadEntitiesHostToken})()}sendRequest(D){var Z=this;return(0,M.Z)(function*(){return(yield(0,x.z)(Z.http.post(y.C7,JSON.stringify({payload:D}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(D,Z){var f=this;return(0,M.Z)(function*(){return yield f.graphqlService.subscribe({query:O.mH,variables:{scope:Z}},m=>{var p;if(null===(p=m.data)||void 0===p||!p.uploadEntities)return;const g=JSON.parse(m.data.uploadEntities.eventMessage);!g.payload.customHeaders||!g.payload.customHeaders.hasOwnProperty(e._o.HeaderKeys.UUID)||g.payload.customHeaders[e._o.HeaderKeys.UUID]===f.getGqlIdHeader()||D({type:m.data.uploadEntities.eventType,message:g})})})()}}return T.\u0275fac=function(D){return new(D||T)(r.LFG(e.Jk),r.LFG(s.B),r.LFG(_.p),r.LFG(l.eN))},T.\u0275prov=r.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})()},9054:(V,S,t)=>{"use strict";t.d(S,{$H:()=>T,JN:()=>U,Lv:()=>O,Or:()=>A,Tb:()=>b,jL:()=>l,lY:()=>s,ok:()=>D,rQ:()=>Z,rc:()=>C,sT:()=>y,zO:()=>c});var v=t(5861),M=t(1413),e=t(5172),x=t(1990);function b(f){let m=f;if(f.indexOf("/")>-1){const R=f.split("/");m=R[R.length-1]}const p=m.replace(/\?.*$/,"").split("."),g=p.length>1?p[p.length-1].toLowerCase():"",w=decodeURIComponent(p.slice(0,-1).join("."));return{ext:g,filename:w,name:g?`${w}.${g}`:""}}function c(f,m={}){const p=b(f),g=Date.now();return(0,M.Z)({name:p.name,size:0,time:g,url:f,ext:p.ext,filename:p.filename,isImage:A(p.ext),embedUrl:`${f}?t=${g}`,type:e.VC.FILE},m)}function O(f){let m=f;m.endsWith("/")&&(m=m.slice(0,-1));const p=m.split("/");return{name:decodeURIComponent(p[p.length-1])}}function s(f){return{name:O(f).name,url:f,type:e.VC.FOLDER}}function y(f){return _.apply(this,arguments)}function _(){return(_=(0,v.Z)(function*(f){const m=new FileReader,p=new Promise(g=>m.addEventListener("load",()=>g(m.result)));return m.readAsDataURL(f),p})).apply(this,arguments)}function U(f){return r.apply(this,arguments)}function r(){return(r=(0,v.Z)(function*(f){const m=new DataView(yield f.arrayBuffer());if(2303741511===m.getUint32(0)&&218765834===m.getUint32(4)){if(-1===[4,6].indexOf(m.getUint8(25)))return!1;const g=Object.assign(new Image,{src:yield y(f)});yield new Promise(F=>g.addEventListener("load",()=>F(!0)));const w=Object.assign(document.createElement("canvas"),{width:g.width,height:g.height}).getContext("2d");if(!w)return!1;w.imageSmoothingEnabled=!1,w.drawImage(g,0,0);const R=null==w?void 0:w.getImageData(0,0,g.width,g.height);if(R)for(let F=0;F<R.data.length;F+=4)if(R.data[F+3]<255)return!0}return!1})).apply(this,arguments)}function l(f){return f.map(m=>({name:m.name,ext:m.ext,type:e.VC.FILE,url:m.url,embedUrl:m.embedUrl,isImage:m.isImage}))}function A(f,m=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(f)&&!m.includes(f)}function T(f){return A(f,["gif","svg"])}function C(f,m,p,g=[],w=""){let R=(0,M.Z)({},x.xt);const F=f.trim();R.invalidLength=0===F.length;const G=(F+w).replace(/\s{2,}/g," ");return R.alreadyUsed=m!==F&&g.includes(G),R.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(f),R.invalidCharacter=!(p===e.VC.FILE?x.Mi.test(f):x.er.test(f)),R}function D(f,m){return f.join("/")===m.join("/")}function Z(f){let m=[],p=[];for(const g of f)g.type===e.VC.FILE?m.push(g):p.push(g);return{[e.VC.FILE]:m,[e.VC.FOLDER]:p}}},4887:(V,S,t)=>{"use strict";t.d(S,{q:()=>Z});var v=t(5861),M=t(1413),e=t(3705),x=t(4315),b=t.n(x),c=t(9829),O=t(9054),s=t(9862),y=t(8645),_=t(1687),U=t(9773),r=t(7621),l=t(1990),A=t(5487);class T{static findApp1Marker(m){const p=new DataView(m),g=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let w=0;w<m.byteLength-2;w+=2){const R=p.getUint16(w);if(65505===R)return{offset:w,size:p.getUint16(w+2),little:18761==p.getUint16(w+8,!1)};if(g.has(R))break}}static stripAndReturnExif(m){return(0,v.Z)(function*(){const p=yield m.arrayBuffer(),g=T.findApp1Marker(p);return g?{file:new File([p.slice(0,g.offset),p.slice(g.offset+g.size+2)],m.name,{type:m.type,lastModified:m.lastModified}),exif:p.slice(g.offset,g.offset+g.size)}:{file:m}})()}static checkImageOrientation(m){const p=new DataView(m);if(1165519206!=p.getUint32(4,!1))return-1;const g=18761==p.getUint16(10,!1);let w=10;w+=p.getUint32(w+4,g);const R=p.getUint16(w,g);w+=2;for(let F=0;F<R;F++)if(274==p.getUint16(w+12*F,g))return p.getUint16(w+12*F+8,g);return-1}}var C=t(5879),D=t(9582);let Z=(()=>{class f{constructor(p,g,w,R){this.http=p,this.uploadObservablesService=g,this.loadImageService=w,this.proxyService=R,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return(0,M.Z)({},this.uploaderOptionsObject)}set uploaderOptions(p){this.uploaderOptionsObject=(0,M.Z)({},p)}compressFileIfNeeded(p,g){return(0,v.Z)(function*(){let w=["image/png","image/jpeg"],R={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};g&&(w.push("image/webp"),R.width=g.width,R.height=g.height,R.resize="cover",R.strict=!1);const F=p.type.toLowerCase();return p.size<=1e6&&void 0===g||-1===w.indexOf(p.type.toLowerCase())?p:("image/png"===F&&(yield(0,O.JN)(p))&&(R.convertSize=1/0),new Promise((G,re)=>{new(b())(p,(0,M.Z)((0,M.Z)({},R),{},{success:Q=>{const ie=Q instanceof Blob?new File([Q],p.name,{type:p.type,lastModified:p.lastModified}):p;G(ie)},error:re}))}))})()}orientFileIfNeeded(p){var g=this;return(0,v.Z)(function*(){if(-1===["image/jpeg"].indexOf(p.type.toLowerCase()))return p;const R=yield T.stripAndReturnExif(p);if(p=R.file,R.exif){const F=T.checkImageOrientation(R.exif);if(1!==F){let G=0;switch(F){case 3:case 4:G=180;break;case 5:case 6:G=90;break;case 7:case 8:G=270}const re=yield(0,O.sT)(p),Q=yield new Promise((le,ae)=>{const se=new Image;se.onload=()=>le({originalImage:se,originalBase64:re}),se.onerror=ae,se.src=re}),ie=yield g.loadImageService.transformLoadedImage({original:{base64:Q.originalBase64,image:Q.originalImage,size:{width:Q.originalImage.naturalWidth,height:Q.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(F),rotate:G/90}},new c.R);p=new File([(0,e.L)(ie.transformed.base64)],p.name,{type:p.type,lastModified:Date.now()}),p=yield g.compressFileIfNeeded(p)}}return p})()}upload(p,g,w,R=!1){const F=new y.x,G=new FormData;G.append("payload",w),G.append("upload",p,p.name),R&&G.append("allowOverwrite","1");const re=this.http.request(new s.aW("POST",l.C7,G,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push(re.subscribe({next:Q=>{if(Q.type===s.dt.UploadProgress){if(!Q.total||(g.progress=Math.round(50*Q.loaded/Q.total)+20,g.progress<70))return;(0,_.F)(1e3).pipe((0,U.R)(F.asObservable())).subscribe(()=>{if(g.progress<95){const ae=Math.round(8*Math.random()+8);g.progress+ae>95?g.progress=95:g.progress+=ae}})}else if(Q instanceof s.Zn){var ie,le;if(g.progress=100,g.completed=!0,null!==(ie=Q.body)&&void 0!==ie&&ie.error||null===(le=Q.body)||void 0===le||!le.success)g.error=!0,this.uploadObservablesService.pushUploadingFileError(g);else{g.file.url=Q.body.success.url,g.file.time=Date.now(),g.file.embedUrl=`${g.file.url}?t=${g.file.time}`;const ae=(0,O.Tb)(g.file.url);g.file.name=ae.name,g.file.filename=ae.filename}F.next(),F.complete()}},error:()=>{g.error=!0,this.uploadObservablesService.pushUploadingFileError(g),F.next(),F.complete()}})),F.asObservable()}clearPendingRequests(){for(const p of this.requestSubscriptions)p.unsubscribe();this.requestSubscriptions=[]}}return f.\u0275fac=function(p){return new(p||f)(C.LFG(s.eN),C.LFG(A.r),C.LFG(D.y),C.LFG(r.y))},f.\u0275prov=C.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},4315:function(V){V.exports=function(){"use strict";function S(E,i){var u=Object.keys(E);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(E);i&&(d=d.filter(function(P){return Object.getOwnPropertyDescriptor(E,P).enumerable})),u.push.apply(u,d)}return u}function t(E){for(var i=1;i<arguments.length;i++){var u=null!=arguments[i]?arguments[i]:{};i%2?S(Object(u),!0).forEach(function(d){x(E,d,u[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(u)):S(Object(u)).forEach(function(d){Object.defineProperty(E,d,Object.getOwnPropertyDescriptor(u,d))})}return E}function M(E,i){for(var u=0;u<i.length;u++){var d=i[u];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(E,O(d.key),d)}}function x(E,i,u){return(i=O(i))in E?Object.defineProperty(E,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):E[i]=u,E}function b(){return b=Object.assign?Object.assign.bind():function(E){for(var i=1;i<arguments.length;i++){var u=arguments[i];for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(E[d]=u[d])}return E},b.apply(this,arguments)}function O(E){var i=function c(E,i){if("object"!=typeof E||null===E)return E;var u=E[Symbol.toPrimitive];if(void 0!==u){var d=u.call(E,i||"default");if("object"!=typeof d)return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(E)}(E,"string");return"symbol"==typeof i?i:String(i)}var E,i,u,d,P,I,H,N,s={exports:{}};E=s,typeof window>"u"||(i=window,u=i.HTMLCanvasElement&&i.HTMLCanvasElement.prototype,d=i.Blob&&function(){try{return!!new Blob}catch(W){return!1}}(),P=d&&i.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(W){return!1}}(),I=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder,H=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,N=(d||I)&&i.atob&&i.ArrayBuffer&&i.Uint8Array&&function(W){var j,k,z,ee,Y,o,B,n,h;if(!(j=W.match(H)))throw new Error("invalid data URI");for(k=j[2]?j[1]:"text/plain"+(j[3]||";charset=US-ASCII"),z=!!j[4],ee=W.slice(j[0].length),Y=z?atob(ee):decodeURIComponent(ee),o=new ArrayBuffer(Y.length),B=new Uint8Array(o),n=0;n<Y.length;n+=1)B[n]=Y.charCodeAt(n);return d?new Blob([P?B:o],{type:k}):((h=new I).append(o),h.getBlob(k))},i.HTMLCanvasElement&&!u.toBlob&&(u.mozGetAsFile?u.toBlob=function(W,j,k){var z=this;setTimeout(function(){W(k&&u.toDataURL&&N?N(z.toDataURL(j,k)):z.mozGetAsFile("blob",j))})}:u.toDataURL&&N&&(u.toBlob=u.msToBlob?function(W,j,k){var z=this;setTimeout(function(){W((j&&"image/png"!==j||k)&&u.toDataURL&&N?N(z.toDataURL(j,k)):z.msToBlob(j))})}:function(W,j,k){var z=this;setTimeout(function(){W(N(z.toDataURL(j,k)))})})),E.exports?E.exports=N:i.dataURLtoBlob=N);var y=s.exports,U={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},l=typeof window<"u"&&typeof window.document<"u"?window:{},A=function(i){return i>0&&i<1/0},T=Array.prototype.slice;function C(E){return Array.from?Array.from(E):T.call(E)}var D=/^image\/.+$/;function Z(E){return D.test(E)}var m=String.fromCharCode;var g=l.btoa;function w(E,i){for(var u=[],P=new Uint8Array(E);P.length>0;)u.push(m.apply(null,C(P.subarray(0,8192)))),P=P.subarray(8192);return"data:".concat(i,";base64,").concat(g(u.join("")))}function R(E){var u,i=new DataView(E);try{var d,P,I;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var H=i.byteLength,N=2;N+1<H;){if(255===i.getUint8(N)&&225===i.getUint8(N+1)){P=N;break}N+=1}if(P){var j=P+10;if("Exif"===function p(E,i,u){var P,d="";for(u+=i,P=i;P<u;P+=1)d+=m(E.getUint8(P));return d}(i,P+4,4)){var k=i.getUint16(j);if(((d=18761===k)||19789===k)&&42===i.getUint16(j+2,d)){var z=i.getUint32(j+4,d);z>=8&&(I=j+z)}}}if(I){var Y,o,ee=i.getUint16(I,d);for(o=0;o<ee;o+=1)if(274===i.getUint16(Y=I+12*o+2,d)){u=i.getUint16(Y+=8,d),i.setUint16(Y,1,d);break}}}catch(B){u=1}return u}var G=/\.\d*(?:0|9){12}\d*$/;function re(E){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return G.test(E)?Math.round(E*i)/i:E}function Q(E){var i=E.aspectRatio,u=E.height,d=E.width,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",I=A(d),H=A(u);if(I&&H){var N=u*i;("contain"===P||"none"===P)&&N>d||"cover"===P&&N<d?u=d/i:d=u*i}else I?u=d/i:H&&(d=u*i);return{width:d,height:u}}var ae=l.ArrayBuffer,se=l.FileReader,ce=l.URL||l.webkitURL,me=/\.\w+$/,ve=l.Compressor,Ee=function(){function E(i,u){(function v(E,i){if(!(E instanceof i))throw new TypeError("Cannot call a class as a function")})(this,E),this.file=i,this.exif=[],this.image=new Image,this.options=t(t({},U),u),this.aborted=!1,this.result=null,this.init()}return function e(E,i,u){return i&&M(E.prototype,i),u&&M(E,u),Object.defineProperty(E,"prototype",{writable:!1}),E}(E,[{key:"init",value:function(){var u=this,d=this.file,P=this.options;if(function(i){return!(typeof Blob>"u")&&(i instanceof Blob||"[object Blob]"===Object.prototype.toString.call(i))}(d)){var I=d.type;if(Z(I))if(ce&&se){ae||(P.checkOrientation=!1,P.retainExif=!1);var H="image/jpeg"===I,N=H&&P.checkOrientation,W=H&&P.retainExif;if(!ce||N||W){var j=new se;this.reader=j,j.onload=function(k){var ee=k.target.result,Y={},o=1;N&&(o=R(ee))>1&&b(Y,function F(E){var i=0,u=1,d=1;switch(E){case 2:u=-1;break;case 3:i=-180;break;case 4:d=-1;break;case 5:i=90,d=-1;break;case 6:i=90;break;case 7:i=90,u=-1;break;case 8:i=-90}return{rotate:i,scaleX:u,scaleY:d}}(o)),W&&(u.exif=function ie(E){for(var i=C(new Uint8Array(E)),u=i.length,d=[],P=0;P+3<u;){var I=i[P],H=i[P+1];if(255===I&&218===H)break;if(255===I&&216===H)P+=2;else{var W=P+(256*i[P+2]+i[P+3])+2,j=i.slice(P,W);d.push(j),P=W}}return d.reduce(function(k,z){return 255===z[0]&&225===z[1]?k.concat(z):k},[])}(ee)),Y.url=N||W?!ce||o>1?w(ee,I):ce.createObjectURL(d):ee,u.load(Y)},j.onabort=function(){u.fail(new Error("Aborted to read the image with FileReader."))},j.onerror=function(){u.fail(new Error("Failed to read the image with FileReader."))},j.onloadend=function(){u.reader=null},N||W?j.readAsArrayBuffer(d):j.readAsDataURL(d)}else this.load({url:ce.createObjectURL(d)})}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(u){var d=this,P=this.file,I=this.image;I.onload=function(){d.draw(t(t({},u),{},{naturalWidth:I.naturalWidth,naturalHeight:I.naturalHeight}))},I.onabort=function(){d.fail(new Error("Aborted to load the image."))},I.onerror=function(){d.fail(new Error("Failed to load the image."))},l.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(l.navigator.userAgent)&&(I.crossOrigin="anonymous"),I.alt=P.name,I.src=u.url}},{key:"draw",value:function(u){var d=this,P=u.naturalWidth,I=u.naturalHeight,H=u.rotate,N=void 0===H?0:H,W=u.scaleX,j=void 0===W?1:W,k=u.scaleY,z=void 0===k?1:k,ee=this.file,Y=this.image,o=this.options,B=document.createElement("canvas"),n=B.getContext("2d"),h=Math.abs(N)%180==90,a=("contain"===o.resize||"cover"===o.resize)&&A(o.width)&&A(o.height),L=Math.max(o.maxWidth,0)||1/0,K=Math.max(o.maxHeight,0)||1/0,J=Math.max(o.minWidth,0)||0,te=Math.max(o.minHeight,0)||0,oe=P/I,q=o.width,X=o.height;if(h){var ue=[K,L];L=ue[0],K=ue[1];var $=[te,J];J=$[0],te=$[1];var ne=[X,q];q=ne[0],X=ne[1]}a&&(oe=q/X);var de=Q({aspectRatio:oe,width:L,height:K},"contain");L=de.width,K=de.height;var he=Q({aspectRatio:oe,width:J,height:te},"cover");if(J=he.width,te=he.height,a){var fe=Q({aspectRatio:oe,width:q,height:X},o.resize);q=fe.width,X=fe.height}else{var xe=Q({aspectRatio:oe,width:q,height:X}),Ue=xe.width;q=void 0===Ue?P:Ue;var be=xe.height;X=void 0===be?I:be}var Be=-(q=Math.floor(re(Math.min(Math.max(q,J),L))))/2,Fe=-(X=Math.floor(re(Math.min(Math.max(X,te),K))))/2,We=q,je=X,Oe=[];if(a){var Ae,Me,Ce=Q({aspectRatio:oe,width:P,height:I},{contain:"cover",cover:"contain"}[o.resize]);Oe.push((P-(Ae=Ce.width))/2,(I-(Me=Ce.height))/2,Ae,Me)}if(Oe.push(Be,Fe,We,je),h){var De=[X,q];q=De[0],X=De[1]}B.width=q,B.height=X,Z(o.mimeType)||(o.mimeType=ee.type);var Ie="transparent";ee.size>o.convertSize&&o.convertTypes.indexOf(o.mimeType)>=0&&(o.mimeType="image/jpeg");var Le="image/jpeg"===o.mimeType;if(Le&&(Ie="#fff"),n.fillStyle=Ie,n.fillRect(0,0,q,X),o.beforeDraw&&o.beforeDraw.call(this,n,B),!this.aborted&&(n.save(),n.translate(q/2,X/2),n.rotate(N*Math.PI/180),n.scale(j,z),n.drawImage.apply(n,[Y].concat(Oe)),n.restore(),o.drew&&o.drew.call(this,n,B),!this.aborted)){var Se=function(ge){if(!d.aborted){var Re=function(_e){return d.done({naturalWidth:P,naturalHeight:I,result:_e})};if(ge&&Le&&o.retainExif&&d.exif&&d.exif.length>0){var we=function(_e){return Re(y(w(function le(E,i){var u=C(new Uint8Array(E));if(255!==u[2]||224!==u[3])return E;var P=[255,216].concat(i,u.slice(4+(256*u[4]+u[5])));return new Uint8Array(P)}(_e,d.exif),o.mimeType)))};if(ge.arrayBuffer)ge.arrayBuffer().then(we).catch(function(){d.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var pe=new se;d.reader=pe,pe.onload=function(ye){we(ye.target.result)},pe.onabort=function(){d.fail(new Error("Aborted to read the compressed image with FileReader."))},pe.onerror=function(){d.fail(new Error("Failed to read the compressed image with FileReader."))},pe.onloadend=function(){d.reader=null},pe.readAsArrayBuffer(ge)}}else Re(ge)}};B.toBlob?B.toBlob(Se,o.mimeType,o.quality):Se(y(B.toDataURL(o.mimeType,o.quality)))}}},{key:"done",value:function(u){var d=u.naturalWidth,P=u.naturalHeight,I=u.result,H=this.file,N=this.image,W=this.options;if(ce&&0===N.src.indexOf("blob:")&&ce.revokeObjectURL(N.src),I)if(W.strict&&!W.retainExif&&I.size>H.size&&W.mimeType===H.type&&!(W.width>d||W.height>P||W.minWidth>d||W.minHeight>P||W.maxWidth<d||W.maxHeight<P))I=H;else{var j=new Date;I.lastModified=j.getTime(),I.lastModifiedDate=j,I.name=H.name,I.name&&I.type!==H.type&&(I.name=I.name.replace(me,function f(E){var i=Z(E)?E.substr(6):"";return"jpeg"===i&&(i="jpg"),".".concat(i)}(I.type)))}else I=H;this.result=I,W.success&&W.success.call(this,I)}},{key:"fail",value:function(u){var d=this.options;if(!d.error)throw u;d.error.call(this,u)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ve,E}},{key:"setDefaults",value:function(u){b(U,u)}}]),E}();return Ee}()},1687:(V,S,t)=>{"use strict";t.d(S,{F:()=>e});var v=t(6321),M=t(4825);function e(x=0,b=v.z){return x<0&&(x=0),(0,M.H)(x,x,b)}},4004:(V,S,t)=>{"use strict";t.d(S,{Z:()=>U});const M={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let e;const x=new Uint8Array(16);function b(){if(!e&&(e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(x)}const c=[];for(let r=0;r<256;++r)c.push((r+256).toString(16).slice(1));const U=function _(r,l,A){if(M.randomUUID&&!l&&!r)return M.randomUUID();const T=(r=r||{}).random||(r.rng||b)();if(T[6]=15&T[6]|64,T[8]=63&T[8]|128,l){A=A||0;for(let C=0;C<16;++C)l[A+C]=T[C];return l}return function O(r,l=0){return(c[r[l+0]]+c[r[l+1]]+c[r[l+2]]+c[r[l+3]]+"-"+c[r[l+4]]+c[r[l+5]]+"-"+c[r[l+6]]+c[r[l+7]]+"-"+c[r[l+8]]+c[r[l+9]]+"-"+c[r[l+10]]+c[r[l+11]]+c[r[l+12]]+c[r[l+13]]+c[r[l+14]]+c[r[l+15]]).toLowerCase()}(T)}}}]);