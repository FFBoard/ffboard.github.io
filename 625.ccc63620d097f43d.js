"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[625],{3285:(w,P,p)=>{p.d(P,{L:()=>k});var s=p(7165),r=p(5879);let C=(()=>{var o;class m{constructor(){this.dependences={[s.B2.LOGIN]:null,[s.B2.HOME]:null,[s.B2.SETTINGS]:s.B2.HOME,[s.B2.SCRIPT]:s.B2.HOME,[s.B2.SCRIPT_FORUM]:s.B2.SCRIPT,[s.B2.SCRIPT_USER]:s.B2.SCRIPT,[s.B2.SCRIPT_SETTINGS]:[s.B2.SCRIPT_USER,s.B2.SCRIPT_FORUM],[s.B2.SCRIPT_SANDBOX]:[s.B2.SCRIPT_USER,s.B2.SCRIPT_FORUM],[s.B2.SCRIPT_DEV]:s.B2.SCRIPT,[s.B2.SCRIPT_DEV_SETTINGS]:s.B2.SCRIPT_DEV,[s.B2.UPLOAD]:s.B2.HOME,[s.B2.ADMIN]:s.B2.HOME,[s.B2.STATS]:s.B2.HOME,[s.B2.STATS_UPLOAD]:s.B2.STATS},this.names={[s.B2.LOGIN]:"Login",[s.B2.HOME]:"Home",[s.B2.SETTINGS]:"Notifiche",[s.B2.SCRIPT]:"Script",[s.B2.SCRIPT_FORUM]:"Forum",[s.B2.SCRIPT_USER]:"Utenti",[s.B2.SCRIPT_SETTINGS]:"Impostazioni",[s.B2.SCRIPT_SANDBOX]:"Altro",[s.B2.SCRIPT_DEV]:"Sviluppo",[s.B2.SCRIPT_DEV_SETTINGS]:"Impostazioni",[s.B2.UPLOAD]:"Upload",[s.B2.ADMIN]:"Amministrazione",[s.B2.STATS]:"Statistiche",[s.B2.STATS_UPLOAD]:"Upload"}}createPathList(h,I=[]){const x=($,t)=>{$.unshift({name:this.names[t]||"",path:t})},E=$=>this.dependences.hasOwnProperty($)?this.dependences[$]instanceof Array?this.dependences[$].includes(I[0])?I.shift():this.dependences[$][0]:this.dependences[$]:null;let D=[{name:this.names[h]||"",path:""}],v=E(h);for(;v;)x(D,v),v=E(v);return D}}return(o=m).\u0275fac=function(h){return new(h||o)},o.\u0275prov=r.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),m})();var B=p(2655),c=p(6814);function b(o,m){if(1&o&&r._UZ(0,"a",8),2&o){const S=r.oxw().$implicit;r.Q6J("routerLink",S.path)("innerText",S.name)}}function L(o,m){if(1&o&&r._UZ(0,"span",9),2&o){const S=r.oxw().$implicit;r.Q6J("innerText",S.name)}}const O=function(o){return{active:o}};function R(o,m){if(1&o&&(r.TgZ(0,"li",5),r.YNc(1,b,1,2,"a",6),r.YNc(2,L,1,1,"ng-template",null,7,r.W1O),r.qZA()),2&o){const S=m.last,h=r.MAs(3);r.Q6J("ngClass",r.VKq(4,O,S)),r.uIk("aria-current",S?"page":null),r.xp6(1),r.Q6J("ngIf",!S)("ngIfElse",h)}}const M=function(o){return{"hide-nav":o}},U=function(o){return{"d-none d-md-block":o}};let k=(()=>{var o;class m{constructor(h,I){this.breadcrumbService=h,this.router=I,this.pageTitle="",this.url="",this.nodes=[],this.hideNavOnSmallScreen=!1,this.breadcrumbs=[]}ngOnInit(){this.url||(this.url=this.router.url),this.breadcrumbs=this.breadcrumbService.createPathList(this.url,this.nodes)}}return(o=m).\u0275fac=function(h){return new(h||o)(r.Y36(C),r.Y36(B.F0))},o.\u0275cmp=r.Xpm({type:o,selectors:[["app-breadcrumb"]],inputs:{pageTitle:"pageTitle",url:"url",nodes:"nodes",hideNavOnSmallScreen:"hideNavOnSmallScreen"},decls:5,vars:8,consts:[[1,"container-fluid","px-md-1","d-flex","flex-column","flex-md-row","align-items-md-center",3,"ngClass"],[1,"h3","fw-light","mb-0","lh-1","fv-small-caps","pb-1",3,"innerText"],["aria-label","breadcrumb",1,"ms-md-auto","mt-1","flex-shrink-0",3,"ngClass"],[1,"breadcrumb","mb-0","justify-content-md-end"],["class","breadcrumb-item",3,"ngClass",4,"ngFor","ngForOf"],[1,"breadcrumb-item",3,"ngClass"],[3,"routerLink","innerText",4,"ngIf","ngIfElse"],["lastItem",""],[3,"routerLink","innerText"],[3,"innerText"]],template:function(h,I){1&h&&(r.TgZ(0,"div",0),r._UZ(1,"h2",1),r.TgZ(2,"nav",2)(3,"ol",3),r.YNc(4,R,4,6,"li",4),r.qZA()()()),2&h&&(r.Q6J("ngClass",r.VKq(4,M,I.hideNavOnSmallScreen)),r.xp6(1),r.Q6J("innerText",I.pageTitle),r.xp6(1),r.Q6J("ngClass",r.VKq(6,U,I.hideNavOnSmallScreen)),r.xp6(2),r.Q6J("ngForOf",I.breadcrumbs))},dependencies:[c.mk,c.sg,c.O5,B.rH],styles:[".container-fluid[_ngcontent-%COMP%]:not(.hide-nav){margin-bottom:.75rem}.container-fluid.hide-nav[_ngcontent-%COMP%]{margin-bottom:.5rem}@media (min-width: 768px){.container-fluid.hide-nav[_ngcontent-%COMP%]{margin-bottom:.75rem}}@media (min-width: 960px){.container-fluid[_ngcontent-%COMP%]{margin-top:.5rem}}"]}),m})()},9090:(w,P,p)=>{p.d(P,{w:()=>B});var s=p(6814),r=p(2655),C=p(5879);let B=(()=>{var c;class b{}return(c=b).\u0275fac=function(O){return new(O||c)},c.\u0275mod=C.oAB({type:c}),c.\u0275inj=C.cJS({imports:[s.ez,r.Bz]}),b})()},3040:(w,P,p)=>{p.d(P,{HF:()=>b,Ry:()=>c,in:()=>L,m:()=>r,n8:()=>C,t6:()=>O,uD:()=>s,xt:()=>B});const s="\nquery FullScript($id: String!, $type: ScriptTargetTypeEnum!) {\n    scriptList {\n        scriptId\n        type\n        author\n        name\n        description\n        faqLink\n        preview\n        publisher\n        source\n        sourceBeta\n        position\n        sandboxes {\n            name\n            slug\n            value\n            inSettings\n        }\n        packages\n        dependencies\n        settingsSchema\n        settingsDefault\n        html\n        hidden\n        cpQuirks\n        cpStandard\n        cpMobile\n        webhook\n        webhookCallOnSettings\n        webhookCallOnManage\n    }\n    scriptSettings(targetId: $id, targetType: $type) {\n        scriptId,\n        settings,\n    }\n    scriptInstalledList(targetId: $id, targetType: $type)\n    scriptRankedList {\n        scriptId\n        scriptRank\n    }\n    scriptPermissions {\n        scriptId\n        manage\n        edit\n        settings\n    }\n}",r="\nquery Script($id: String!, $type: ScriptTargetTypeEnum!) {\n    scriptSettings(targetId: $id, targetType: $type) {\n        scriptId,\n        settings,\n    }\n    scriptInstalledList(targetId: $id, targetType: $type)\n}",C="\nquery ScriptStats {\n    scriptStats {\n        scriptId\n        entities {\n            targetId\n            targetType\n        }\n    }\n}",B="\nmutation DelCache($scriptId: String!) {\n    delCache(scriptId: $scriptId)\n}",c="\nmutation ScriptUpsert($scriptId: String, $type: String, $name: String, $description: String, $faqLink: String, $preview: String, $publisher: String, $source: String, $sourceBeta: String, $sandboxes: [JSSandboxInput!], $position: String, $packages: [String], $dependencies: [String], $settingsSchema: String, $settingsDefault: String, $html: String, $hidden: Boolean, $cpQuirks: Boolean, $cpStandard: Boolean, $cpMobile: Boolean, $webhook: String, $webhookCallOnSettings: Boolean, $whManage: Boolean) {\n    scriptUpsert(scriptId: $scriptId, type: $type, name: $name, description: $description, faqLink: $faqLink, preview: $preview, publisher: $publisher, source: $source, sourceBeta: $sourceBeta, sandboxes: $sandboxes, position: $position, packages: $packages, dependencies: $dependencies, settingsSchema: $settingsSchema, settingsDefault: $settingsDefault, html: $html, hidden: $hidden, cpQuirks: $cpQuirks, cpStandard: $cpStandard, cpMobile: $cpMobile, webhook: $webhook, webhookCallOnSettings: $webhookCallOnSettings, whManage: $whManage)\n}",b="\nmutation DelScript($scriptId: String!) {\n    delScript(scriptId: $scriptId)\n}",L="\nmutation ScriptManage(\n    $targetId: String!,\n    $targetType: ScriptTargetTypeEnum!,\n    $scriptId: String!,\n    $action: ScriptManageActionEnum!\n) {\n    scriptManage(\n        targetId: $targetId,\n        targetType: $targetType,\n        scriptId: $scriptId,\n        action: $action\n    )\n}",O="\nmutation ScriptSettings(\n    $targetId: String!,\n    $targetType: ScriptTargetTypeEnum!,\n    $scriptId: String!,\n    $settings: String!\n) {\n    scriptSettings(\n        targetId: $targetId,\n        targetType: $targetType,\n        scriptId: $scriptId,\n        settings: $settings\n    )\n}"},6245:(w,P,p)=>{p.d(P,{o:()=>$});var s=p(5861),r=p(1410),C=p(3912),B=p(8645),c=p(3729),b=p(7165),L=p(463),O=p(3040),R=p(4064);const M=/^whitelist\[([^\]]*)]/i;function o(t){const l=t.match(M);let u=[],e=[];if(l){const n=l[1].toLowerCase().split(",");u=n.reduce((a,i)=>{const d=i.match(/^(ff|fc|bf)u(\d+)/);return d&&a.push(d[1]+d[2]),a},[]),e=n.filter(a=>/^(ff|fc|bf)\d+/.test(a))}return{users:u,forums:e}}function m(t){return t.replace(M,"").trim()}function S(t,l,u,e,n=[],a){const i={};return{list:t.reduce((g,T)=>{const y=[...new Set([...I(l,T.id,u),...n])];return!y.includes(c.Af.EDIT)&&function h(t,l,u){return!!t.privacy.hidden&&(u===c.D7.USER&&!t.privacy.allowed.users.includes(l)||u===c.D7.FORUM&&!t.privacy.allowed.forums.includes(l))}(T,e.id,e.type)||0===y.length||a&&!a.every(_=>y.includes(_))||(i[T.id]=y,g.push(T)),g},[]),permissions:i}}function I(t,l,u){const e=t.find(n=>n.scriptId===l);return e?[...D(u,e)?[c.Af.SETTINGS]:[],...x(u,e)?[c.Af.EDIT]:[],...E(u,e)?[c.Af.MANAGE]:[]]:[]}function x(t,l){return l.edit.includes(t)}function E(t,l){return l.manage.includes(t)}function D(t,l){return l.settings.includes(t)}var v=p(5879);let $=(()=>{var t;class l{constructor(e,n,a){this.graphqlService=e,this.globalsService=n,this.preferencesService=a,this.installedScript={cacheKey:"",list:[]},this.ffuid="",this.lastRequestTime=0,this.scriptCache={},this.scriptFilteredByPermissionsCache={},this.listInputsSubject=new B.x,this.profileSubscription=this.globalsService.profileObservable.subscribe(i=>{this.ffuid=(null==i?void 0:i.user.ffuid)||""})}createCacheKey(e,n){return e+n+this.ffuid}isCurrentUserForumAdmin(e){return!(!this.globalsService.forum||this.globalsService.forum.cid!==e||!this.globalsService.forum.admin)}getData(e,n=c.D7.FORUM,a=!0){var i=this;return(0,s.Z)(function*(){const d=i.createCacheKey(e,n),g=Date.now()-i.lastRequestTime>18e5;if(i.installedScript={cacheKey:d,list:[]},!g){if(!a)return{list:i.scriptList,settings:{},permissions:{}};if(i.scriptCache.hasOwnProperty(d))return i.installedScript.list=i.scriptCache[d].installedList,i.scriptCache[d]}let T,y=[];if(g){i.clearCache(),i.lastRequestTime=Date.now();const f=yield i.graphqlService.query({query:O.uD,variables:{id:e,type:n}});i.scriptList=function U(t,l){const u={},e=t.map(n=>{const a=function k(t,l,u){var e;return{author:R.$m[t.author]||R.$m.ff7482873,dependencies:{parents:t.dependencies.reduce((n,a)=>{const i=l.find(d=>d.scriptId===a);return i&&n.push({id:i.scriptId,name:m(i.name)}),n},[]),children:[]},description:t.description,docs:{link:t.faqLink},html:t.html,id:t.scriptId,layouts:{quirks:t.cpQuirks,standard:t.cpStandard,mobile:t.cpMobile},name:m(t.name),packages:t.packages,preview:t.preview,privacy:{hidden:t.hidden,allowed:o(t.name)},publisher:R.yT[t.publisher]||R.yT[c.tr.OTHER],rank:(null===(e=u.find(n=>n.scriptId===t.scriptId))||void 0===e?void 0:e.scriptRank)||999,sandboxes:t.sandboxes,settings:{default:t.settingsDefault,schema:"{}"!==t.settingsSchema?t.settingsSchema:void 0},sources:{prod:t.source,beta:t.sourceBeta,position:t.position},type:t.type,webhook:{source:t.webhook,calls:{onManage:t.webhookCallOnManage,onSettings:t.webhookCallOnSettings}}}}(n,t,l);for(const i of Object.keys(a.dependencies.parents))u.hasOwnProperty(i)||(u[i]=[]),u[i].push({id:a.id,name:a.name});return a});for(const[n,a]of Object.entries(u)){const i=e.find(d=>d.id===n);i&&(i.dependencies.children=a)}return e}(f.data.scriptList,f.data.scriptRankedList),i.scriptPermissions=f.data.scriptPermissions,T=f.data}else T=(yield i.graphqlService.query({query:O.m,variables:{id:e,type:n}})).data;if(!a)return{list:i.scriptList,settings:{},permissions:{}};i.installedScript.list=T.scriptInstalledList.filter(f=>i.scriptList.findIndex(A=>A.id===f)>-1),y=T.scriptSettings;const _=n===c.D7.FORUM?c.AV.FORUM:c.AV.USER,N=n===c.D7.FORUM&&i.isCurrentUserForumAdmin(e)||n===c.D7.USER&&e===i.ffuid?[c.Af.SETTINGS,c.Af.MANAGE]:[],F=S(i.scriptList.filter(f=>f.type===_||f.type===c.AV.ALL),i.scriptPermissions,i.ffuid,{id:e,type:n},N);return i.scriptCache[d]={list:F.list,installedList:i.installedScript.list,settings:y.reduce((f,A)=>(f[A.scriptId]=A.settings,f),{}),permissions:F.permissions},i.scriptCache[d]})()}splitTabs(e){const n={};for(const a of e)n.hasOwnProperty(a.publisher.id)?n[a.publisher.id].push(a):n[a.publisher.id]=[a];return n}getListInputsObservable(){return this.listInputsSubject.asObservable()}pushListInputs(e){this.listInputsSubject.next(e),this.listInputs=e}get listInputs(){return this.listInputsData}set listInputs(e){this.listInputsData=e}updateInstalledScriptList(e,n){if(n)this.installedScript.list.push(e);else{const a=this.installedScript.list.indexOf(e);a>-1&&this.installedScript.list.splice(a,1)}this.scriptCache[this.installedScript.cacheKey].installedList=this.installedScript.list}get installedList(){return this.installedScript.list}getSingleScriptData(e,n,a){var i=this;return(0,s.Z)(function*(){const d=yield i.getData(n,a),g=d.list.find(T=>T.id===e);if(g)return{script:g,installed:i.installedList.includes(g.id),settings:d.settings[g.id],permissions:d.permissions[g.id]}})()}updateInstalledScriptSettings(e,n,a,i){const d=this.createCacheKey(e,n);this.scriptCache[d]&&(this.scriptCache[d].settings[a]=i)}getScriptsByPermissions(e){var n=this;return(0,s.Z)(function*(){const a=`${n.ffuid}:${e.join("-")}`;if(n.scriptFilteredByPermissionsCache.hasOwnProperty(a))return n.scriptFilteredByPermissionsCache[a];const i=(yield n.getData(n.ffuid,c.D7.USER,!1)).list;return n.scriptFilteredByPermissionsCache[a]=S(i,n.scriptPermissions,n.ffuid,{id:n.ffuid,type:c.D7.USER},[],e)})()}clearCache(){this.lastRequestTime=0,this.scriptList=void 0,this.scriptPermissions=void 0,this.scriptCache={},this.scriptFilteredByPermissionsCache={}}getAllScripts(){var e=this;return(0,s.Z)(function*(){return(yield e.getData(e.ffuid,c.D7.USER,!1)).list})()}get settingsOptions(){return this.preferencesService.getItem(b.Ye.SCRIPT_SETTINGS_OPTIONS)||R.iK}set settingsOptions(e){this.preferencesService.setItem(b.Ye.SCRIPT_SETTINGS_OPTIONS,e)}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return(t=l).\u0275fac=function(e){return new(e||t)(v.LFG(C.Jk),v.LFG(r.d),v.LFG(L.y))},t.\u0275prov=v.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),l})()}}]);